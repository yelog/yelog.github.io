/**
 *
 * @name:  表格筛选扩展
 * @author: yelog
 * @link: https://github.com/yelog/layui-soul-table
 * @license: MIT
 * @version: v1.8.0
 */
layui.define(["table","form","laydate","util","excel","laytpl"],function(e){var R,q,B,l,a,E=layui.jquery,Y=layui.table,j=layui.form,f=layui.laydate,M=layui.laytpl,y=layui.util,G=layui.excel,J={},H="SOUL_ROW_INDEX",X={},A="layui-hide",i=1,V=[void 0,"",null],$={},K={},Q={},_={eq:"等于",ne:"≠ 不等于",gt:"> 大于",ge:"≥ 大于等于",lt:"< 小于",le:"≤ 小于等于",contain:"包含",notContain:"不包含",start:"以...开头",end:"以...结尾",null:"为空",notNull:"不为空"},b={all:"全部",yesterday:"昨天",thisWeek:"本周",lastWeek:"上周",thisMonth:"本月",thisYear:"今年"},U=["column","data","condition","editCondition","excel"],p={column:"soul-column",data:"soul-dropList",condition:"soul-condition",editCondition:"soul-edit-condition",excel:"soul-export",clearCache:"soul-clear-cache"},u={in:"data",condition:"condition",date:"condition"},c={data:{mode:"condition",type:"eq",value:""},condition:{mode:"in",values:[]}};e("tableFilter",{destroy:function(e){if(e)if(Array.isArray(e))for(var i=0;i<e.length;i++)t(e[i]);else t(e);function t(e){e&&(e=e.config.id,E("#soul-filter-list"+e).remove(),E("#soulCondition"+e).remove(),E("#soulDropList"+e).remove(),delete J[e],delete $[e],delete Q[e])}},clearFilter:function(e){$[(e="string"==typeof e?Q[e]:e).id]&&$[e.id].filterSos&&"[]"!==$[e.id].filterSos&&($[e.id].filterSos="[]",this.soulReload(e,!0),Q[e.id].where)&&Q[e.id].where.filterSos&&"[]"!==Q[e.id].where.filterSos&&(Q[e.id].where.filterSos="[]")},render:function(m){var v=this,t=E(m.elem),e=t.next().children(".layui-table-box").children(".layui-table-main"),i=t.next().children(".layui-table-box").children(".layui-table-header").children("table"),l=t.next().children(".layui-table-box").children(".layui-table-fixed-l").children(".layui-table-header").children("table"),a=t.next().children(".layui-table-box").children(".layui-table-fixed-r").children(".layui-table-header").children("table"),b=m.id,g=v.getCompleteCols(m.cols),o=m.filter&&m.filter.items||U,d=!1,n=!1,s=void 0===m.excel||!(!m.excel||void 0!==m.excel.on&&!m.excel.on)&&m.excel;for(x=0;x<g.length;x++)g[x].field&&g[x].filter&&(d=!0,0===i.find('th[data-field="'+g[x].field+'"]').children().children(".soul-table-filter").length)&&(n=!0,0<i.find('th[data-field="'+g[x].field+'"]').children().children(".layui-table-sort").length?(i.find('th[data-field="'+g[x].field+'"]').children().children(".layui-table-sort").hide(),i.find('th[data-field="'+g[x].field+'"]').children().append('<span class="layui-table-sort soul-table-filter layui-inline" data-items="'+(g[x].filter.items?g[x].filter.items.join(","):"")+'" data-column="'+g[x].field+'" lay-sort="'+i.find('th[data-field="'+g[x].field+'"]').children().children(".layui-table-sort").attr("lay-sort")+'" '+(void 0===g[x].filter.split?"":'data-split="'+g[x].filter.split+'"')+'><i class="soul-icon soul-icon-filter"></i><i class="soul-icon soul-icon-filter-asc"></i><i class="soul-icon soul-icon-filter-desc"></i></span>')):i.find('th[data-field="'+g[x].field+'"]').children().append('<span class="soul-table-filter layui-inline" data-items="'+(g[x].filter.items?g[x].filter.items.join(","):"")+'" data-column="'+g[x].field+'" '+(void 0===g[x].filter.split?"":'data-split="'+g[x].filter.split+'"')+'><i class="soul-icon soul-icon-filter"></i><i class="soul-icon soul-icon-filter-asc"></i><i class="soul-icon soul-icon-filter-desc"></i></span>'),0<l.find('th[data-field="'+g[x].field+'"]').children().children(".layui-table-sort").length?(l.find('th[data-field="'+g[x].field+'"]').children().children(".layui-table-sort").hide(),l.find('th[data-field="'+g[x].field+'"]').children().append('<span class="layui-table-sort soul-table-filter layui-inline" data-items="'+(g[x].filter.items?g[x].filter.items.join(","):"")+'" data-column="'+g[x].field+'" lay-sort="'+l.find('th[data-field="'+g[x].field+'"]').children().children(".layui-table-sort").attr("lay-sort")+'" '+(void 0===g[x].filter.split?"":'data-split="'+g[x].filter.split+'"')+'><i class="soul-icon soul-icon-filter"></i><i class="soul-icon soul-icon-filter-asc"></i><i class="soul-icon soul-icon-filter-desc"></i></span>')):l.find('th[data-field="'+g[x].field+'"]').children().append('<span class="soul-table-filter layui-inline" data-items="'+(g[x].filter.items?g[x].filter.items.join(","):"")+'" data-column="'+g[x].field+'" '+(void 0===g[x].filter.split?"":'data-split="'+g[x].filter.split+'"')+'><i class="soul-icon soul-icon-filter"></i><i class="soul-icon soul-icon-filter-asc"></i><i class="soul-icon soul-icon-filter-desc"></i></span>'),0<a.find('th[data-field="'+g[x].field+'"]').children().children(".layui-table-sort").length?(a.find('th[data-field="'+g[x].field+'"]').children().children(".layui-table-sort").hide(),a.find('th[data-field="'+g[x].field+'"]').children().append('<span class="layui-table-sort soul-table-filter layui-inline" data-items="'+(g[x].filter.items?g[x].filter.items.join(","):"")+'" data-column="'+g[x].field+'" lay-sort="'+a.find('th[data-field="'+g[x].field+'"]').children().children(".layui-table-sort").attr("lay-sort")+'" '+(void 0===g[x].filter.split?"":'data-split="'+g[x].filter.split+'"')+'><i class="soul-icon soul-icon-filter"></i><i class="soul-icon soul-icon-filter-asc"></i><i class="soul-icon soul-icon-filter-desc"></i></span>')):a.find('th[data-field="'+g[x].field+'"]').children().append('<span class="soul-table-filter layui-inline" data-items="'+(g[x].filter.items?g[x].filter.items.join(","):"")+'" data-column="'+g[x].field+'" '+(void 0===g[x].filter.split?"":'data-split="'+g[x].filter.split+'"')+'><i class="soul-icon soul-icon-filter"></i><i class="soul-icon soul-icon-filter-asc"></i><i class="soul-icon soul-icon-filter-desc"></i></span>'));if(Q[m.id]=m,K[m.id]=d){if(m.filter&&void 0!==m.filter.bottom&&!m.filter.bottom||0!==t.next().children(".soul-bottom-contion").length||(t.next().children(".layui-table-box").after('<div class="soul-bottom-contion"><div class="condition-items"></div><div class="editCondtion"><a class="layui-btn layui-btn-primary">编辑筛选条件</a></div></div>'),y=t.next().children(".layui-table-box").children(".layui-table-body").outerHeight()-t.next().children(".soul-bottom-contion").outerHeight(),m.page&&t.next().children(".layui-table-page").hasClass("layui-hide")&&(y+=t.next().children(".layui-table-page").outerHeight()),t.next().children(".layui-table-box").children(".layui-table-body").css("height",y),y=y-v.getScrollWidth(e[0]),e=e.children("table").height(),t.next().children(".layui-table-box").children(".layui-table-fixed").children(".layui-table-body").css("height",y<=e?y:"auto"),t.next().children(".soul-bottom-contion").children(".condition-items").css("width",t.next().children(".soul-bottom-contion").width()-t.next().children(".soul-bottom-contion").children(".editCondtion").width()+"px"),t.next().children(".soul-bottom-contion").children(".editCondtion").children("a").on("click",function(){v.showConditionBoard(m)})),!n||J[m.id]||m.isSoulFrontFilter)J[m.id]=!1,m.isSoulFrontFilter=!1,!m.url&&m.page&&m.data&&m.data.forEach(function(e){for(x=0;x<X[m.id].length;x++)if(X[m.id][x][H]===e[H]){X[m.id][x]=e;break}});else{if(!m.url&&m.page&&m.data&&m.data.length>m.limit&&layui.each(m.data,function(e,i){i[m.indexName]=e}),m.url&&!m.page?X[m.id]=layui.table.cache[m.id]:X[m.id]=m.data||layui.table.cache[m.id],X[m.id].forEach(function(e,i){e[H]=i}),m.filter&&m.filter.clearFilter){if(m.where&&m.where.filterSos&&0<JSON.parse(m.where.filterSos).length)return m.where.filterSos="[]",$[m.id]=m.where||{},void v.soulReload(m,!1)}else if((void 0===m.url||!m.page||void 0===m.where.filterSos)&&$[m.id]&&0<JSON.parse($[m.id].filterSos||"[]").length)return m.where.filterSos=$[m.id].filterSos,$[m.id]=m.where,void v.soulReload(m,!1);if($[m.id]=m.where||{},0===E("#soul-filter-list"+b).length){void 0!==m.soulSort&&!m.soulSort||(void 0===t.attr("lay-filter")&&t.attr("lay-filter",b),Y.on("sort("+t.attr("lay-filter")+")",function(e){m.limit=Q[m.id].limit,m.url&&m.page?($[m.id].field=e.field,$[m.id].order=e.type,J[m.id]=!0,Y.render(E.extend(m,{initSort:e,where:$[m.id],page:{curr:1}}))):!m.url&&m.page&&("asc"===e.type?X[m.id]=layui.sort(X[m.id],e.field):"desc"===e.type?X[m.id]=layui.sort(X[m.id],e.field,!0):X[m.id]=layui.sort(X[m.id],m.indexName),m.initSort=e,m.page={curr:1},v.soulReload(m,!1))}));var r=[],u={column:'<li class="soul-column"><i class="layui-icon layui-icon-table"></i> 表格列 <i class="layui-icon layui-icon-right" style="float: right"></i></li>',data:'<li class="soul-dropList"><i class="soul-icon soul-icon-drop-list"></i> 筛选数据 <i class="layui-icon layui-icon-right" style="float: right"></i></li>',condition:'<li class="soul-condition"><i class="soul-icon soul-icon-query"></i> 筛选条件 <i class="layui-icon layui-icon-right" style="float: right"></i></li>',editCondition:'<li class="soul-edit-condition"><i class="layui-icon layui-icon-edit"></i> 编辑筛选条件 </li>',excel:'<li class="soul-export"><i class="soul-icon soul-icon-download"></i> 导出excel </li>',clearCache:'<li class="soul-clear-cache"><i class="layui-icon layui-icon-delete"></i> 清除缓存 </li>'};for(r.push('<div id="soul-filter-list'+b+'"><form action="" class="layui-form" lay-filter="orm"><ul id="main-list'+b+'" style="display: none">'),r.push('<li class="soul-sort" data-value="asc" ><i class="soul-icon soul-icon-asc"></i> 升序排列 </li>'),r.push('<li class="soul-sort" data-value="desc"  style="border-bottom: 1px solid #e6e6e6"><i class="soul-icon soul-icon-desc"></i> 降序排列 </li>'),x=0;x<U.length;x++)"excel"===U[x]&&!s||r.push(u[U[x]]);r.push('</ul><ul id="soul-columns'+b+'" style="display: none;">');for(var c={},x=0;x<g.length;x++)"checkbox"!==g[x].type&&g[x].field?(r.push('<li data-value="'+g[x].field+'" data-key="'+x+'"><input type="checkbox" value="'+m.index+"-"+g[x].key+'" title="'+g[x].title+'" data-fixed="'+(g[x].fixed||"")+'" lay-skin="primary" lay-filter="changeColumns'+b+'" '+(g[x].hide?"":"checked")+"></li>"),g[x].filter&&g[x].filter.type&&(g[x].filter.field?c[g[x].filter.field]=g[x].filter.type:c[g[x].field]=g[x].filter.type)):r.push('<li class="layui-hide"><input type="checkbox" title="'+g[x].title+'" /></li>');2!==JSON.stringify(c).length&&(m.where.tableFilterType=JSON.stringify(c)),r.push('</ul><div id="soul-dropList'+b+'" style="display: none"><div class="filter-search"><input type="text" placeholder="关键字搜索" class="layui-input"></div><div class="check"><div class="multiOption" data-type="all"><i class="soul-icon">&#xe623;</i> 全选</div><div class="multiOption" data-type="none"><i class="soul-icon">&#xe63e;</i> 清空</div><div class="multiOption" data-type="reverse"><i class="soul-icon">&#xe614;</i>反选</div></div><ul></ul></div>'),r.push('<ul id="soul-condition'+b+'" style="display: none;"></ul></form></div>'),E("body").append(r.join(""));var h=!0;j.on("checkbox(changeColumns"+b+")",function(e){h=!1;var i=e.value;for(e.elem.checked?t.next().find("[data-key="+i+"]").removeClass(A):t.next().find("[data-key="+i+"]").addClass(A),x=0;x<m.cols.length;x++)for(D=0;D<m.cols[x].length;D++)m.index+"-"+m.cols[x][D].key===i&&(m.cols[x][D].hide=!e.elem.checked);layui.soulTable&&layui.soulTable.fixTableRemember(m),t.next().children(".layui-table-box").children(".layui-table-body").children("table").children("tbody").children("tr.childTr").children("td").attr("colspan",t.next().children(".layui-table-box").children(".layui-table-header").find("thead>tr>th:visible").length),Y.resize(b)}),E("#soul-columns"+b+">li[data-value]").on("click",function(){E(this).find(":checkbox").is(":disabled")||(h&&E(this).find("div.layui-form-checkbox").trigger("click"),h=!0)}),E("#soul-dropList"+b+" .check [data-type]").on("click",function(){switch(E(this).data("type")){case"all":E(this).parents("#soul-dropList"+b).find("input[type=checkbox]:not(:checked)").prop("checked",!0);break;case"reverse":E(this).parents("#soul-dropList"+b).find("input[type=checkbox]").each(function(){E(this).prop("checked",!E(this).prop("checked"))});break;case"none":E(this).parents("#soul-dropList"+b).find("input[type=checkbox]:checked").prop("checked",!1)}return j.render("checkbox","orm"),v.updateDropList(m,E("#main-list"+b).data("field")),!1}),E("#soul-dropList"+b+" .filter-search input").on("input",function(){var e=E(this).val();(""===e?E("#soul-dropList"+b+">ul>li"):(E("#soul-dropList"+b+">ul>li").hide(),E("#soul-dropList"+b+'>ul>li[data-value*="'+e.toLowerCase()+'"]'))).show()}),E("#main-list"+b+" .soul-column").on("mouseover",function(e){for(v.hideDropList(m),v.hideCondition(m),e.stopPropagation(),R&&clearTimeout(R),g=v.getCompleteCols(m.cols),x=0;x<g.length;x++)E("#soul-columns"+b).find('li[data-value="'+g[x].field+'"]>input').prop("checked",!g[x].hide);var i;j.render("checkbox","orm"),E("#soul-columns"+b).show(),e=E(this).parent().offset().left+E(this).parent().width()+E("#soul-columns"+b).width()<document.body.clientWidth?(i=E(this).parent().offset().left+E(this).parent().width(),"fadeInLeft"):(i=E(this).parent().offset().left-E("#soul-columns"+b).width(),"fadeInRight"),E("#soul-columns"+b).css({top:E(this).offset().top,left:i}).removeClass().addClass(e+" animated")}),E("#main-list"+b+" .soul-dropList").on("mouseover",function(e){if(E("#soul-dropList"+b).is(":visible")&&!E("#soul-dropList"+b).hasClass("fadeOutLeft"))return!1;v.hideColumns(m),v.hideCondition(m),e.stopPropagation(),q&&clearTimeout(q),E("#soul-dropList"+b+">.filter-search>input").val(""),E("#soul-dropList"+b).show();var i,t=E("#main-list"+b).data("field"),e=E("#main-list"+b).offset().left+E("#soul-dropList"+b).width()+E("#soul-dropList"+b).width()<document.body.clientWidth?(i=E("#main-list"+b).offset().left+E("#main-list"+b).width(),"fadeInLeft"):(i=E("#main-list"+b).offset().left-E("#soul-dropList"+b).width(),"fadeInRight"),l=(E("#soulDropList"+b).find("."+t+"DropList li input[type=checkbox]:checked").prop("checked",!1),$[m.id]||{}),a=JSON.parse(l.filterSos||null),o="",d="";if(a)for(x=0;x<a.length;x++)if(a[x].head&&"in"===a[x].mode&&a[x].field===t){for(o=a[x].id,d=a[x].prefix,D=0;D<a[x].values.length;D++)E("#soulDropList"+b).find("."+t+'DropList li input[type=checkbox][value="'+a[x].values[D]+'"]').prop("checked",!0);break}E("#soul-dropList"+b+">ul").data({head:!0,id:o,prefix:d,refresh:!0,split:E("#main-list"+b).data("split")}).html(E("#soulDropList"+b).find("."+t+"DropList li").clone()),E("#soul-dropList"+b).css({top:E(this).offset().top,left:i}).show().removeClass().addClass(e+" animated"),setTimeout(function(){E("#soul-dropList"+b+">.filter-search>input").focus(),j.render("checkbox","orm")},1);var n=!0;j.on("checkbox(soulDropList"+b+")",function(e){n=!1,v.updateDropList(m,t)}),E("#soul-dropList"+b+">ul>li[data-value]").on("click",function(){n&&E(this).find("div.layui-form-checkbox").trigger("click"),n=!0})}),E("#main-list"+b+" .soul-condition").on("mouseover",function(e){if(E("#soul-condition"+b).is(":visible")&&!E("#soul-condition"+b).hasClass("fadeOutLeft"))return!1;v.hideColumns(m),v.hideDropList(m),e.stopPropagation(),B&&clearTimeout(B);e=document.body.clientWidth;E("#soul-condition"+b).show();var i,n,s=E(this).parent().data("field"),e=E(this).parent().offset().left+E(this).parent().width()+E("#soul-condition"+b).width()<e?(i=E(this).parent().offset().left+E(this).parent().width(),"fadeInLeft"):(i=E(this).parent().offset().left-E("#soul-condition"+b).width(),"fadeInRight"),t=[],l=$[m.id]||{},a=JSON.parse(l.filterSos||null);if(a)for(x=0;x<a.length;x++)if(a[x].head&&a[x].field===s&&("date"===a[x].mode||"group"===a[x].mode)){n=a[x];break}l=E(this).parent().data("type");if(v.startsWith(l,"date"))v.showDate(m,s,n,e,E(this).offset().top,E(this).parent().offset().left+E(this).parent().width(),"down",!0);else{var o={};for(x=0;x<g.length;x++)g[x].field&&(o[g[x].field]=g[x]);var d="<select lay-filter='conditionChange'>";for(r in _)d+='<option value="'+r+'">'+_[r]+"</option>";if(d+="</select>",t.push('<table class="condition-table"><tbody>'),n&&n.children&&0<n.children.length)for(x=0;x<n.children.length;x++){var r,u=n.children[x].id,c=n.children[x].prefix,h=n.children[x].type,p=n.children[x].value;for(r in t.push('<tr data-id="'+u+'">'),t.push(0===x?'<td class="soul-condition-title">'+o[s].title+"</td>":'<td>   <div>      <input type="checkbox" name="switch" lay-filter="soul-coondition-switch" lay-skin="switch" lay-text="与|或" '+(c&&"and"!==c?"":"checked")+">    </div></td>"),t.push('<td style="width: 110px;"><div class="layui-block" ><select lay-filter="conditionChange">'),_)t.push('<option value="'+r+'" '+(r===h?"selected":"")+">"+_[r]+"</option>");t.push("</select></div></td>"),t.push('<td style="width: 110px;"><div class="layui-block" ><input class="layui-input value" value="'+(p||"")+'" placeholder="值" /></div></td>'),t.push('<td><i class="layui-icon layui-icon-delete del" style="font-size: 23px; color: #FF5722; cursor: pointer"></i></td>'),t.push("</tr>")}else t.push('<tr data-id="" data-type="eq" data-value=""><td class="soul-condition-title">'+o[s].title+'</td><td style="width: 110px;"><div class="layui-block" >'+d+'</div></td><td style="width: 110px;"><div class="layui-block" ><input class="layui-input value" placeholder="值" /></div></td><td><i class="layui-icon layui-icon-delete del" style="font-size: 23px; color: #FF5722; cursor: pointer"></i></td></tr>');function f(e){var i=e.data("id"),t=E("#soul-condition"+b).data("id"),l=e.find('input[lay-filter="soul-coondition-switch"]:checked').prop("checked")?"and":"or",a=e.find("select").val(),o=e.find(".value").val(),d=E("#soul-condition"+b).data("head");n=t?{id:i,prefix:l,mode:"condition",field:s,type:a,value:o,groupId:t}:{head:d,prefix:"and",mode:"group",field:s,children:[{id:v.getDifId(),prefix:l,mode:"condition",field:s,type:a,value:o,groupId:t}]},v.updateWhere(m,n),t?i||e.data("id",n.id):(E("#soul-condition"+b).data("id",n.id),e.data("id",n.children[0].id))}function y(e){var i;1===E(e).parents("table:eq(0)").find("tr").length?(i=E("#soul-condition"+b).data("id"),E("#soul-condition"+b).data("id",""),E(e).parents("tr:eq(0)").find("select").val("eq"),E(e).parents("tr:eq(0)").find(".value").val("").show(),j.render("select","orm")):(i=E(e).parents("tr:eq(0)").data("id"),0===E(e).parents("tr:eq(0)").index()&&E(e).parents("table:eq(0)").find("tr:eq(1)>td:eq(0)").html(o[s].title).addClass("soul-condition-title"),E(e).parents("tr:eq(0)").remove()),i&&v.updateWhere(m,{id:i,delete:!0})}t.push('</tbody></table><div style="text-align: center; padding-top: 5px"><button class="layui-btn layui-btn-sm" data-type="add"><i class="layui-icon">&#xe654;</i>添加</button><span style="display: inline-block;width: 50px"></span><button class="layui-btn layui-btn-sm" data-type="search"><i class="layui-icon">&#xe615;</i>查询</button></div>'),E("#soul-condition"+b).data({head:!0,id:n&&n.id||""}).html(t.join("")).css({top:E(this).offset().top,left:i}).show().removeClass().addClass(e+" animated"),E(".condition-table").on("click",function(){return!1}),E("#soul-condition"+b+" button[data-type]").on("click",function(){var e,i,t;return"add"===E(this).data("type")?(e=E("#soul-condition"+b).data("id"),i=E("#soul-condition"+b).data("head"),t=E("#soul-condition"+b).find("tr:eq(0)"),i=e?{head:i,prefix:"and",field:s,mode:"condition",type:"eq",value:"",groupId:e}:{head:i,prefix:"and",mode:"group",field:s,children:[{id:v.getDifId(),prefix:"and",field:s,mode:"condition",type:t.find("select").val(),value:t.find(".value").val()},{id:v.getDifId(),prefix:"and",field:s,mode:"condition",type:"eq",value:""}]},v.updateWhere(m,i),e||(E("#soul-condition"+b).data("id",i.id),t.data("id",i.children[0].id)),t='<tr data-id="'+(e?i:i.children[1]).id+'"><td>   <div>      <input type="checkbox" name="switch" lay-filter="soul-coondition-switch" lay-skin="switch" lay-text="与|或" checked>   </div></td><td style="width: 110px;"><div class="layui-block">'+d+'</div></td><td style="width: 110px;"><div class="layui-block"><input class="layui-input value" placeholder="值" /></div></td><td><i class="layui-icon layui-icon-delete del" style="font-size: 23px; color: #FF5722; cursor: pointer"></i></td></tr>',E("#soul-condition"+b+">table>tbody").append(t),E("#soul-condition"+b).find(".del:last").on("click",function(){y(this)}),E("#soul-condition"+b+" input.value:last").on("input",function(){f(E(this).parents("tr:eq(0)"))})):"search"===E(this).data("type")&&v.soulReload(m),j.render("select","orm"),j.render("checkbox","orm"),!1}),E("#soul-condition"+b+" input.value").on("input",function(){f(E(this).parents("tr:eq(0)"))}),j.on("select(conditionChange)",function(e){"null"===e.value||"notNull"===e.value?E(this).parents("tr").find("input.value").hide():E(this).parents("tr").find("input.value").show(),f(E(e.elem).parents("tr:eq(0)"))}),j.on("switch(soul-coondition-switch)",function(e){f(E(this).parents("tr:eq(0)"))}),E("#soul-condition"+b+" .del").on("click",function(){y(this)})}j.render("select","orm"),j.render("checkbox","orm")}),E("#soul-columns"+b+", #soul-dropList"+b).on("mouseover",function(e){e.stopPropagation()}),E("#main-list"+b+" .soul-edit-condition").on("mouseover",function(e){v.hideColumns(m),v.hideDropList(m),v.hideCondition(m),e.stopPropagation()}).on("click",function(){E("#main-list"+b).hide(),v.showConditionBoard(m)}),E("#main-list"+b+" .soul-export").on("mouseover",function(e){v.hideColumns(m),v.hideDropList(m),v.hideCondition(m),e.stopPropagation()}).on("click",function(){E("#main-list"+b).hide(),v.export(Q[m.id])}),E("#main-list"+b+" .soul-clear-cache").on("mouseover",function(e){v.hideColumns(m),v.hideDropList(m),v.hideCondition(m),e.stopPropagation()}).on("click",function(){E("#main-list"+b).hide(),layui.soulTable&&layui.soulTable.clearCache(m),layer.msg("已还原！",{icon:1,time:1e3})}),E("#main-list"+b).on("mouseover",function(e){var i=e.pageX,e=e.pageY,t=E(this),l=t.offset().top,a=l+t.height(),o=t.offset().left,t=o+t.width();i<=o||t<=i||e<=l||a<=e||(v.hideColumns(m),v.hideDropList(m),v.hideCondition(m))})}else{for(c={},x=0;x<g.length;x++)"checkbox"!==g[x].type&&g[x].field&&g[x].filter&&g[x].filter.type&&(g[x].filter.field?c[g[x].filter.field]=g[x].filter.type:c[g[x].field]=g[x].filter.type);2!==JSON.stringify(c).length&&(m.where.tableFilterType=JSON.stringify(c))}if(0===E("#soulDropList"+b).length&&E("body").append('<div id="soulDropList'+b+'" style="display: none"></div>'),0<i.find(".soul-table-filter").length){var p=[],f=-1!==o.indexOf("data");if(i.find(".soul-table-filter").each(function(e,i){E(this).data("column")&&(f&&!E(this).data("items")||-1!==E(this).data("items").split(",").indexOf("data"))&&p.push(E(this).data("column"))}),0<p.length)if(void 0!==m.url&&m.page){var e=JSON.parse(JSON.stringify(m.where)),y=m.url;e.columns=JSON.stringify(p),E.ajax({url:y,data:e,dataType:"json",method:"post",headers:m.headers||{},contentType:m.contentType,success:function(e){var i,t=[];for(i in e){var l=e[i];if(1===l.length&&""===l[0]||0===l.length)t.push("<ul class='"+i+"DropList' data-value='"+i+"'><li style='color: gray;line-height: 25px;padding-left: 20px;'>(无数据)</li></ul>");else{var a,o=[],d=(o.push("<ul class='"+i+"DropList' data-value='"+i+"'>"),g);for(D=0;D<d.length;D++)if(d[D].field===i){if(d[D].filter.split){var n=[];for(x=0;x<l.length;x++)for(var s=l[x].split(d[D].filter.split),r=0;r<s.length;r++)-1===n.indexOf(s[r])&&n.push(s[r]);l=n}for(l.sort(function(e,i){return isNaN(e)||isNaN(i)?String(e)>=String(i):Number(e)-Number(i)}),x=0;x<l.length;x++)-1===V.indexOf(l[x])&&((a={})[i]=l[x],o.push('<li data-value="'+String(l[x]).toLowerCase()+'"><input type="checkbox" value="'+l[x]+'" title="'+v.parseTempData(d[D],l[x],a,!0).replace(/\"|\'/g,"'")+'" lay-skin="primary" lay-filter="soulDropList'+b+'"></li>'));break}o.push("</ul>"),t.push(o.join(""))}}E("#soulDropList"+b).html(t.join(""))},error:function(){}})}else{var k=X[m.id],C={};for(x=0;x<k.length;x++)for(D=0;D<p.length;D++){var w=void 0===k[x][p[D]]?"":k[x][p[D]];C[p[D]]?-1===C[p[D]].indexOf(w)&&C[p[D]].push(w):C[p[D]]=[w]}for(var L=g,S=[],D=0;D<L.length;D++){var N=L[D].field,O=C[N];if(!O||1===O.length&&""===O[0])S.push("<ul class='"+N+"DropList' data-value='"+N+"'><li style='color: gray;line-height: 25px;padding-left: 20px;'>(无数据)</li></ul>");else{if(L[D].filter&&L[D].filter.split){var T=[];for(x=0;x<O.length;x++)for(var F=String(O[x]).split(L[D].filter.split),I=0;I<F.length;I++)-1===T.indexOf(F[I])&&T.push(F[I]);O=T}O.sort(function(e,i){return isNaN(e)||isNaN(i)?String(e)>=String(i):Number(e)-Number(i)});var W,P=[];for(P.push("<ul class='"+N+"DropList' data-value='"+N+"'>"),x=0;x<O.length;x++)-1===V.indexOf(O[x])&&((W={})[N]=O[x],P.push('<li data-value="'+String(O[x]).toLowerCase()+'"><input type="checkbox" value="'+O[x]+'" title="'+v.parseTempData(L[D],O[x],W,!0).replace(/\"|\'/g,"'")+'" lay-skin="primary" lay-filter="soulDropList'+b+'"></li>'));P.push("</ul>"),S.push(P.join(""))}}E("#soulDropList"+b).html(S.join(""))}else v.bindFilterClick(m)}}this.bindFilterClick(m)}else m.url&&!m.page?X[m.id]=layui.table.cache[m.id]:X[m.id]=m.data||layui.table.cache[m.id]},showConditionBoard:function(f){for(var a,e,y=this,m=f.id,i=$[f.id]||{},o=i.tableFilterType?JSON.parse(i.tableFilterType):{},t=i.filterSos?JSON.parse(i.filterSos):[],d=[],n={},l=f.filter&&f.filter.items||U,s=y.getCompleteCols(f.cols),v=0;v<s.length;v++)s[v].field&&s[v].filter&&(a=a||s[v],e=s[v].filter.items||l,n[s[v].field]={title:s[v].title,items:e});for(d.push('<div class="soul-edit-out">'),d.push('<div class="layui-form" lay-filter="soul-edit-out">'),d.push('<div><a class="layui-btn layui-btn-sm" data-type="addOne"><i class="layui-icon layui-icon-add-1"></i> 添加条件</a><a class="layui-btn layui-btn-sm" data-type="addGroup"><i class="layui-icon layui-icon-add-circle" ></i> 添加分组</a><a class="layui-btn layui-btn-sm" data-type="search" style="float: right"><i class="layui-icon layui-icon-search"></i> 查询</a><span style="float: right"><input type="checkbox" lay-filter="out_auto" class="out_auto" title="实时更新"></span></div>'),d.push("<hr>"),d.push("<ul>"),v=0;v<t.length;v++)!function e(i,t,l,a,o){var d=i.id,n=i.field,s=i.mode,r=i.type,u="or"===i.prefix;t.push('<li data-id="'+d+'" data-field="'+n+'" '+(o?'class="last"':"")+' data-mode="'+s+'" data-type="'+r+'" data-value="'+(void 0===i.value?"":i.value)+'" >');t.push('<div><table><tbody><tr><td data-type="top"></td></tr><tr><td data-type="bottom"></td></tr></tbody></table></div>');t.push('<div><input type="checkbox" name="switch" lay-filter="soul-edit-switch" lay-skin="switch" lay-text="与|或" '+(u?"":"checked")+"></div>");switch(s){case"in":t.push('<div class="layui-firebrick item-field">'+l[n].title+"</div>"),t.push('<div class="layui-deeppink item-type" >筛选数据</div>'),t.push('<div class="layui-blueviolet item-value">共'+(i.values?i.values.length:0)+"条数据</div>"),t.push('<div class="layui-red delete-item"><i class="layui-icon layui-icon-close-fill"></i></div>');break;case"date":t.push('<div class="layui-firebrick item-field">'+l[n].title+"</div>"),t.push('<div class="layui-deeppink item-type">选择日期</div>'),t.push('<div class="layui-blueviolet item-value">'+("specific"===i.type?i.value||"请选择":b[i.type])+"</div>"),t.push('<div class="layui-red delete-item"><i class="layui-icon layui-icon-close-fill"></i></div>');break;case"condition":t.push('<div class="layui-firebrick item-field">'+l[n].title+"</div>"),t.push('<div class="layui-deeppink item-type">'+_[i.type]+"</div>"),"null"!==r&&"notNull"!==r&&t.push('<div class="layui-blueviolet item-value">'+(void 0===i.value||""===i.value?"请输入...":i.value)+"</div>"),t.push('<div class="layui-red delete-item"><i class="layui-icon layui-icon-close-fill"></i></div>');break;case"group":if(t.push('<div class="layui-firebrick">分组</div>'),t.push('<div><a class="layui-btn layui-btn-xs" data-type="addOne"><i class="layui-icon layui-icon-add-1"></i> 添加条件</a><a class="layui-btn layui-btn-xs" data-type="addGroup"><i class="layui-icon layui-icon-add-circle"></i> 添加分组</a></div>'),t.push('<div class="layui-red delete-item"><i class="layui-icon layui-icon-close-fill"></i></div>'),t.push('<ul class="group '+(o?"":"line")+'">'),i.children)for(var c=0;c<i.children.length;c++)e(i.children[c],t,l,0===c,c===i.children.length-1);t.push("</ul>")}t.push("</li>")}(t[v],d,n,0,v===t.length-1);function r(e){y.hideDropList(f),y.hideCondition(f),y.hideColumns(f),y.hideBfPrefix(f),y.hideBfType(f);var i=E(e).offset().top+E(e).outerHeight(),t=E(e).offset().left;E("#soul-bf-column"+m).find("li.soul-bf-selected").removeClass("soul-bf-selected"),E("#soul-bf-column"+m).data("field",E(e).parent().data("field")).data("id",E(e).parent().data("id")).data("mode",E(e).parent().data("mode")).data("group",E(e).parents("li:eq(2)").data("id")||"").data("refresh",E(".soul-edit-out .out_auto").prop("checked")).show().css({top:i,left:t}).removeClass().addClass("fadeInUp animated").find('li[data-field="'+E(e).parent().data("field")+'"]').addClass("soul-bf-selected")}function u(e){y.hideDropList(f),y.hideCondition(f),y.hideColumns(f),y.hideBfColumn(f),y.hideBfPrefix(f);var i=E(e).offset().top+E(e).outerHeight(),t=E(e).offset().left,l=E(e).parent().data("field");switch(E("#soul-bf-type"+m+" li").hide(),o[l]&&0===o[l].indexOf("date")&&E("#soul-bf-type"+m+" li[data-mode=date]").show(),-1!==n[l].items.indexOf("data")&&E("#soul-bf-type"+m+" li[data-mode=in]").show(),-1!==n[l].items.indexOf("condition")&&E("#soul-bf-type"+m+" li[data-mode=condition]").show(),E("#soul-bf-type"+m).find("li.soul-bf-selected").removeClass("soul-bf-selected"),E(e).parent().data("mode")){case"in":E("#soul-bf-type"+m).find('li[data-mode="in"]').addClass("soul-bf-selected");break;case"date":E("#soul-bf-type"+m).find('li[data-mode="date"]').addClass("soul-bf-selected");case"condition":E("#soul-bf-type"+m).find('li[data-value="'+E(e).parent().data("type")+'"]').addClass("soul-bf-selected")}E("#soul-bf-type"+m).data("type",E(e).parent().data("type")).data("mode",E(e).parent().data("mode")).data("id",E(e).parent().data("id")).data("group",E(e).parents("li:eq(2)").data("id")||"").data("refresh",E(".soul-edit-out .out_auto").prop("checked")).show().css({top:i,left:t}).removeClass().addClass("fadeInUp animated")}function c(i){y.hideColumns(f),y.hideBfType(f),y.hideBfPrefix(f),y.hideBfColumn(f);var e=E(i).offset().left,t=E(i).parent().data("mode"),l=E(i).parent().data("field"),a=E(i).parent().data("id"),o=E(i).parent().data("head"),d=E(i).parent().data("prefix"),n=E(i).parent().data("value"),s=E(".soul-edit-out .out_auto").prop("checked"),r=$[f.id]||{},u=r.filterSos?JSON.parse(r.filterSos):[];switch(t){case"in":if(y.hideCondition(f),q&&clearTimeout(q),E("#soul-dropList"+m+">.filter-search>input").val(""),E("#soul-dropList"+m).show(),E("#soulDropList"+m).find("."+l+"DropList li input[type=checkbox]:checked").prop("checked",!1),(h=y.getFilterSoById(u,a)).values)for(v=0;v<h.values.length;v++)E("#soulDropList"+m).find("."+l+'DropList li input[type=checkbox][value="'+h.values[v]+'"]').prop("checked",!0);E("#soul-dropList"+m+">ul").data("id",a).data("head",o).data("refresh",s).data("prefix",d).html(E("#soulDropList"+m).find("."+l+"DropList li").clone()),j.render("checkbox","orm"),p=E(i).offset().top+E(i).outerHeight(),E("#soul-dropList"+m).css({top:p,left:e}).show().removeClass().addClass("fadeInUp animated"),setTimeout(function(){E("#soul-dropList"+m+">.filter-search>input").focus()},1);var c=!0;j.on("checkbox(soulDropList"+m+")",function(e){c=!1,y.updateDropList(f,l)}),E("#soul-dropList"+m+">ul>li[data-value]").on("click",function(){c&&E(this).find("div.layui-form-checkbox").trigger("click"),c=!0});break;case"date":y.hideDropList(f),B&&clearTimeout(B);var h=y.getFilterSoById(u,a),p=E(i).offset().top+E(i).height();y.showDate(f,l,h,"fadeInUp",p,e,"down",s);break;case"condition":E(i).hide(),E(i).after('<div><input class="layui-input tempValue" value="" /></div>'),E(i).next().children().val(n).select().on("keydown",function(e){13===e.keyCode&&E(this).blur()}).on("blur",function(){var e=E(this).val();E(i).html(void 0===e||""===e?"请输入...":e),E(i).show(),E(this).parent().remove(),e!==n&&(E(i).parent().data("value",e),y.updateWhere(f,{id:a,value:e}),s)&&y.soulReload(f)})}}d.push("</ul>"),d.push("</div>"),d.push("</div>"),layer.open({title:"编辑条件",type:1,offset:"auto",area:["480px","480px"],content:d.join("")}),j.render(null,"soul-edit-out"),j.on("checkbox(out_auto)",function(e){e.elem.checked&&y.soulReload(f)}),j.on("switch(soul-edit-switch)",function(e){var i,t,l;i=(e=e).elem.checked?"and":"or",t=E(e.elem).parents("li:eq(0)").data("id"),l=E(".soul-edit-out .out_auto").prop("checked"),E(e.elem).parents("li:eq(0)").data("prefix",i),y.updateWhere(f,{id:t,prefix:i}),l&&y.soulReload(f)}),E(".soul-edit-out .item-field").on("click",function(e){e.stopPropagation(),r(this)}),E(".soul-edit-out .item-type").on("click",function(e){e.stopPropagation(),u(this)}),E(".soul-edit-out .item-value").on("click",function(e){e.stopPropagation(),c(this)}),E(".soul-edit-out .delete-item").on("click",function(){var e=E(this).parent().data("id"),i=E(".soul-edit-out .out_auto").prop("checked");E(this).parent().remove(),y.updateWhere(f,{id:e,delete:!0}),i&&y.soulReload(f)}),E(".soul-edit-out a[data-type]").on("click",function(){"search"===E(this).data("type")?y.soulReload(f):function e(i){var t=E(".soul-edit-out .out_auto").prop("checked");d=[];switch(E(i).data("type")){case"addOne":var l={prefix:"and",field:a.field,mode:"condition",type:"eq",value:""};E(i).parent().parent().data("id")&&E.extend(l,{groupId:E(i).parent().parent().data("id")}),y.updateWhere(f,l),d.push('<li data-id="'+l.id+'" data-field="'+l.field+'" data-mode="'+l.mode+'" data-type="'+l.type+'" data-value="'+l.value+'" data-prefix="'+l.prefix+'" class="last">'),d.push('<div><table><tbody><tr><td data-type="top"></td></tr><tr><td data-type="bottom"></td></tr></tbody></table></div>'),d.push('<div><input type="checkbox" name="switch" lay-filter="soul-edit-switch" lay-skin="switch" lay-text="与|或" checked></div>'),d.push('<div class="layui-firebrick item-field">'+n[l.field].title+"</div>"),d.push('<div class="layui-deeppink item-type">等于</div>'),d.push('<div class="layui-blueviolet item-value">请输入...</div>'),d.push('<div class="layui-red delete-item"><i class="layui-icon layui-icon-close-fill"></i></div>'),d.push("</li>");break;case"addGroup":l={prefix:"and",mode:"group",children:[]};E(i).parent().parent().data("id")&&E.extend(l,{groupId:E(i).parent().parent().data("id")}),y.updateWhere(f,l),d.push('<li data-id="'+l.id+'" class="last">'),d.push('<div><table><tbody><tr><td data-type="top"></td></tr><tr><td data-type="bottom"></td></tr></tbody></table></div>'),d.push('<div><input type="checkbox" name="switch" lay-filter="soul-edit-switch" lay-skin="switch" lay-text="与|或" checked></div>'),d.push('<div class="layui-firebrick">分组</div>'),d.push('<div><a class="layui-btn layui-btn-xs" data-type="addOne"><i class="layui-icon layui-icon-add-1"></i> 添加条件</a><a class="layui-btn layui-btn-xs" data-type="addGroup"><i class="layui-icon layui-icon-add-circle"></i> 添加分组</a></div>'),d.push('<div class="layui-red delete-item"><i class="layui-icon layui-icon-close-fill"></i></div>'),d.push('<ul class="group">'),d.push("</ul>"),d.push("</li>")}t&&y.soulReload(f);0<E(i).parent().parent().children("ul").children("li").length&&(E(i).parent().parent().children("ul").children("li:last").removeClass("last"),0<E(i).parent().parent().children("ul").children("li:last").children("ul.group").length)&&E(i).parent().parent().children("ul").children("li:last").children("ul.group").addClass("line");E(i).parent().parent().children("ul").append(d.join(""));j.render("checkbox","soul-edit-out");"addGroup"===E(i).data("type")?E(i).parent().parent().children("ul").children("li:last").find("a[data-type]").on("click",function(){e(this)}):(E(i).parent().parent().children("ul").children("li:last").find(".item-field").on("click",function(e){e.stopPropagation(),r(this)}),E(i).parent().parent().children("ul").children("li:last").find(".item-type").on("click",function(e){e.stopPropagation(),u(this)}),E(i).parent().parent().children("ul").children("li:last").find(".item-value").on("click",function(e){e.stopPropagation(),c(this)}));E(i).parent().parent().children("ul").children("li:last").children(".delete-item").on("click",function(){var e=E(this).parent().data("id"),i=E(".soul-edit-out .out_auto").prop("checked");E(this).parent().remove(),y.updateWhere(f,{id:e,delete:!0}),i&&y.soulReload(f)})}(this)})},hideColumns:function(e,i){var t=e.id;E("#soul-columns"+t).removeClass().addClass("fadeOutLeft animated"),R&&clearTimeout(R),void 0===i||i?R=setTimeout(function(e){E("#soul-columns"+t).hide()},500):E("[id^=soul-columns]").hide()},hideDropList:function(e,i){var t=e.id;E("#soul-dropList"+t).removeClass().addClass("fadeOutLeft animated"),q&&clearTimeout(q),void 0===i||i?q=setTimeout(function(e){E("#soul-dropList"+t).hide()},500):E("[id^=soul-dropList]").hide()},hideCondition:function(e,i){var t=e.id;E("#soul-condition"+t).removeClass().addClass("fadeOutLeft animated"),B&&clearTimeout(B),void 0===i||i?B=setTimeout(function(e){E("#soul-condition"+t).hide()},500):E("[id^=soul-condition]").hide()},hideBfPrefix:function(e,i){var t=e.id;E("#soul-bf-prefix"+t).removeClass().addClass("fadeOutDown animated"),l&&clearTimeout(l),void 0===i||i?l=setTimeout(function(){E("#soul-bf-prefix"+t).hide()},500):E("[id=soul-bf-prefix"+t+"]").hide()},hideBfColumn:function(e,i){var t=e.id;E("#soul-bf-column"+t).removeClass().addClass("fadeOutDown animated"),l&&clearTimeout(l),void 0===i||i?l=setTimeout(function(){E("#soul-bf-column"+t).hide()},500):E("[id=soul-bf-column"+t+"]").hide()},hideBfType:function(e,i){var t=e.id;E("#soul-bf-type"+t).removeClass().addClass("fadeOutDown animated"),a&&clearTimeout(a),void 0===i||i?a=setTimeout(function(){E("#soul-bf-type"+t).hide()},500):E("[id=soul-bf-type"+t+"]").hide()},bindFilterClick:function(o){var d,n=this,e=E(o.elem),i=e.next().children(".layui-table-box").children(".layui-table-header").children("table"),t=e.next().children(".layui-table-box").children(".layui-table-fixed-l").children(".layui-table-header").children("table"),l=e.next().children(".layui-table-box").children(".layui-table-fixed-r").children(".layui-table-header").children("table"),s=o.id,r=o.filter&&o.filter.items||U;function a(i){var e=i.data("items")?i.data("items").split(","):r;n.hideColumns(o,!1),n.hideDropList(o,!1),n.hideCondition(o,!1),E("[id^=main-list]").hide(),E("#main-list"+s).data({field:i.data("column"),split:i.data("split")}),E("#soul-columns"+s+" [type=checkbox]").attr("disabled",!1),E("#soul-columns"+s+" li[data-key="+i.parents("th").data("key").split("-")[2]+"] [type=checkbox]").attr("disabled",!0),E("#main-list"+s+" > li").hide(),i.hasClass("layui-table-sort")&&E("#main-list"+s+" .soul-sort").show();for(var t,l,a=0;a<e.length;a++)E("#main-list"+s+" ."+p[e[a]]).show(),E("#main-list"+s+" ."+p[e[a]]).index()!==a+2&&E("#main-list"+s+'>li:eq("'+(a+2)+'")').before(E("#main-list"+s+" ."+p[e[a]]));d&&clearTimeout(d),l=i.offset().left+E("#main-list"+s).outerWidth()<document.body.clientWidth?(t=i.offset().left+10,"fadeInLeft"):(t=i.offset().left-E("#main-list"+s).outerWidth(),"fadeInRight"),E("#main-list"+s).data("type",o.where.tableFilterType&&JSON.parse(o.where.tableFilterType)[i.data("column")]||"").hide().css({top:i.offset().top+10,left:t}).show().removeClass().addClass(l+" animated"),E("#main-list"+s+" .soul-sort").on("click",function(e){i.siblings(".layui-table-sort").find(".layui-table-sort-"+E(this).data("value")).trigger("click"),E("#main-list"+s).hide()}),j.render("checkbox","orm")}i.find(".soul-table-filter").off("click").on("click",function(e){e.stopPropagation(),a(E(this))}),t.find(".soul-table-filter").off("click").on("click",function(e){e.stopPropagation(),a(E(this))}),l.find(".soul-table-filter").off("click").on("click",function(e){e.stopPropagation(),a(E(this))}),E(document).on("click",function(e){E("#main-list"+s).hide(),n.hideColumns(o,!1),n.hideDropList(o,!1),n.hideCondition(o,!1),n.hideBfPrefix(o,!1),n.hideBfColumn(o,!1),n.hideBfType(o,!1)}),E("#main-list"+s+",#soul-columns"+s+",#soul-dropList"+s+",#soul-condition"+s).on("click",function(e){E(this).find(".layui-form-selected").removeClass("layui-form-selected"),e.stopPropagation()}),n.renderBottomCondition(o);for(var e=$[o.id]||{},u=JSON.parse(e.filterSos||"[]"),c=0;c<u.length;c++)if(u[c].head){var h=!1;switch(u[c].mode){case"in":u[c].values&&0<u[c].values.length&&(h=!0);break;case"date":"all"!==u[c].type&&void 0!==u[c].value&&""!==u[c].value&&(h=!0);break;case"group":u[c].children&&0<u[c].children.length&&(h=!0)}i.find('thead>tr>th[data-field="'+u[c].field+'"] .soul-table-filter').attr("soul-filter",""+h),t.find('thead>tr>th[data-field="'+u[c].field+'"] .soul-table-filter').attr("soul-filter",""+h),l.find('thead>tr>th[data-field="'+u[c].field+'"] .soul-table-filter').attr("soul-filter",""+h)}},resize:function(e){var i,t,e=E(e.elem),l=e.next().children(".layui-table-box"),a=l.children(".layui-table-main");0<e.next().children(".soul-bottom-contion").length&&(e.next().children(".soul-bottom-contion").children(".condition-items").css("width",e.next().children(".soul-bottom-contion").width()-e.next().children(".soul-bottom-contion").children(".editCondtion").outerWidth()),i=e.next().height()-e.next().children(".soul-bottom-contion").outerHeight(),0<e.next().children(".layui-table-tool").length&&(i-=e.next().children(".layui-table-tool").outerHeight()),0<e.next().children(".layui-table-total").length&&(i-=e.next().children(".layui-table-total").outerHeight()),0<e.next().children(".layui-table-page").length&&(i-=e.next().children(".layui-table-page").outerHeight()),i-=e.next().children(".layui-table-box").children(".layui-table-header").outerHeight(),e.next().children(".layui-table-box").children(".layui-table-body").height(i),i=i-this.getScrollWidth(a[0]),t=a.children("table").height(),e.next().children(".layui-table-box").children(".layui-table-fixed").children(".layui-table-body").height(i<=t?i:"auto"),e=a.width()-a.prop("clientWidth"),l.children(".layui-table-fixed-r").css("right",e-1))},updateDropList:function(e,i){E(e.elem);var t=e.id,l=E("#soul-dropList"+t+">ul").data("id"),a=E("#soul-dropList"+t+">ul input[type=checkbox]:checked"),o=[],d=E("#soul-dropList"+t+">ul").data("head"),n=E("#soul-dropList"+t+">ul").data("prefix"),s=E("#soul-dropList"+t+">ul").data("refresh"),r=E("#soul-dropList"+t+">ul").data("split"),a=(0<a.length&&a.each(function(){o.push(E(this).val())}),{id:l,head:d,prefix:n||"and",mode:"in",field:i,split:r,values:o});this.updateWhere(e,a),l||E("#soul-dropList"+t+">ul").data("id",a.id),0<E(".soul-edit-out").length&&E('.soul-edit-out li[data-id="'+a.id+'"]>.item-value').html("共"+(a.values?a.values.length:0)+"条数据"),s&&this.soulReload(e)},getFilterSoById:function(e,i){for(var t=0;t<e.length;t++){if(e[t].id===i)return e[t];if("group"===e[t].mode)for(var l=0;l<e[t].children.length;l++){var a=this.getFilterSoById(e[t].children,i);if(a)return a}}return null},updateWhere:function(e,i){var o=this,t=$[e.id]||{},l=JSON.parse(t.filterSos||"[]");if(i.id||i.groupId)for(var a=0;a<l.length;a++){if(i.delete&&l[a].id===i.id){l.splice(a,1);break}if(function e(i,t){var l=!1;i.id===t.id&&(E.extend(i,t),l=!0);if(t.id||i.id!==t.groupId){if("group"===i.mode)for(var a=0;a<i.children.length;a++){if(t.delete&&i.children[a].id===t.id)return i.children.splice(a,1),!0;if(e(i.children[a],t))return!0}}else i.children.push(E.extend(t,{id:o.getDifId()}));return l}(l[a],i))break}else("in"!==i.mode||i.values&&0<i.values.length)&&l.push(E.extend(i,{id:o.getDifId()}));t.filterSos=JSON.stringify(l),e.where=t,$[e.id]=t},soulReload:function(e,i){var a,o,d,t,n=this,l=E(e.elem),s=l.next().children(".layui-table-box").children(".layui-table-main").scrollLeft();J[e.id]=void 0===i||i,void 0!==e.url&&e.page?(l.data("scrollLeft",s),Y.reload(e.id,{where:$[e.id]||{},page:{curr:1}})):(i=$[e.id]||{},a=JSON.parse(i.filterSos||"[]"),o=i.tableFilterType?JSON.parse(i.tableFilterType):{},i=layer.load(2),e.page||(e.limit=1e8),0<a.length?(d=[],layui.each(X[e.id],function(e,i){for(var t=!0,l=0;l<a.length;l++)t=n.handleFilterSo(a[l],i,o,t,0===l);t&&d.push(i)}),e.page?Y.reload(e.id,{data:d,initSort:e.initSort,isSoulFrontFilter:!0,page:{curr:1}}):(t=e.url,l.next().off("click"),Y.reload(e.id,{url:"",initSort:e.initSort,isSoulFrontFilter:!0,data:d}).config.url=t),e.data=d):(e.page?Y.reload(e.id,{data:X[e.id],initSort:e.initSort,isSoulFrontFilter:!0,page:{curr:1}}):Y.reload(e.id,{data:X[e.id],initSort:e.initSort,isSoulFrontFilter:!0}),e.data=X[e.id]),l.next().children(".layui-table-box").children(".layui-table-main").scrollLeft(s),layer.close(i))},handleFilterSo:function(e,i,t,l,a){var o,a=!a&&"or"===e.prefix,d=e.field,n=e.value,s=!0;if(e.children&&0<e.children.length)for(var r=0;r<e.children.length;r++)s=this.handleFilterSo(e.children[r],i,t,s,0===r);else switch(e.mode){case"in":if(!(e.values&&0<e.values.length))return l;if(e.split){for(var u=(i[d]+"").split(e.split),c=!1,r=0;r<u.length;r++)-1!==e.values.indexOf(u[r])&&(c=!0);s=c}else s=-1!==e.values.indexOf(i[d]+"");break;case"condition":if("null"!==e.type&&"notNull"!==e.type&&(void 0===n||""===n))return l;switch(e.type){case"eq":s=isNaN(i[d])||isNaN(n)?i[d]===n:Number(i[d])===Number(n);break;case"ne":s=isNaN(i[d])||isNaN(n)?i[d]!==n:Number(i[d])!==Number(n);break;case"gt":s=isNaN(i[d])||isNaN(n)?i[d]>n:Number(i[d])>Number(n);break;case"ge":s=isNaN(i[d])||isNaN(n)?i[d]>=n:Number(i[d])>=Number(n);break;case"lt":s=isNaN(i[d])||isNaN(n)?i[d]<n:Number(i[d])<Number(n);break;case"le":s=isNaN(i[d])||isNaN(n)?i[d]<=n:Number(i[d])<=Number(n);break;case"contain":s=-1!==(i[d]+"").indexOf(n);break;case"notContain":s=-1===(i[d]+"").indexOf(n);break;case"start":s=0===(i[d]+"").indexOf(n);break;case"end":var h=(i[d]+"").length-(n+"").length,s=0<=h&&(i[d]+"").lastIndexOf(n)===h;break;case"null":s=void 0===i[d]||""===i[d]||null===i[d];break;case"notNull":s=void 0!==i[d]&&""!==i[d]&&null!==i[d]}break;case"date":var p=new Date(Date.parse(i[d].replace(/-/g,"/")));switch(e.type){case"all":s=!0;break;case"yesterday":s=i[d]&&v(p,y()-86400,y()-1);break;case"thisWeek":s=i[d]&&v(p,m(),m()+604800-1);break;case"lastWeek":s=i[d]&&v(p,m()-604800,m()-1);break;case"thisMonth":s=i[d]&&v(p,new Date((new Date).setDate(1)).setHours(0,0,0,0)/1e3,(f=new Date,o=f.getMonth(),o=++o,new Date(f.getFullYear(),o,1)/1e3-1));break;case"thisYear":s=i[d]&&v(p,new Date((new Date).getFullYear(),1,1)/1e3,new Date((new Date).getFullYear()+1,1,1)/1e3-1);break;case"specific":var f=p.getFullYear(),f=(f+="-"+b(p.getMonth()+1))+("-"+b(p.getDate()));s=i[d]&&f===n}}return a?l||s:l&&s;function y(){return(new Date).setHours(0,0,0,0)/1e3}function m(){var e=new Date,i=e.getDay()||7;return new Date(e.setDate(e.getDate()-i+1)).setHours(0,0,0,0)/1e3}function v(e,i,t){return e.getTime()/1e3>=i&&e.getTime()/1e3<=t}function b(e){return e=(e+="").length<=1?"0"+e:e}},getDifId:function(){return i++},showDate:function(l,a,e,i,t,o,d,n){var s,r=this,u=l.id,c=[],h=document.body.clientWidth;for(s in c.push('<div class="'+a+'Condition" data-value="'+a+'" style="padding: 5px;" >'),c.push('<div class="layui-row">'),b)c.push('<div class="layui-col-sm4"><input type="radio" name="datetime'+u+a+'" lay-filter="datetime'+u+'" value="'+s+'" title="'+b[s]+'"></div>');c.push("</div>"),c.push('<div><input type="radio" name="datetime'+u+a+'" lay-filter="datetime'+u+'"  value="specific" title="过滤具体日期"> <input type="hidden" class="specific_value"><div class="staticDate"></div></div></div>'),E("#soul-condition"+u).html(c.join(""));var p=y.toDateString(new Date,"yyyy-MM-dd");e?(E("#soul-condition"+u).data({id:e.id,head:!0}),E("#soul-condition"+u+">."+a+'Condition [name^=datetime][value="'+e.type+'"]').prop("checked",!0),"specific"===e.type&&(p=e.value)):(E("#soul-condition"+u).data({id:"",head:!0}),E("#soul-condition"+u+">."+a+'Condition [name^=datetime][value="all"]').prop("checked",!0)),E("#soul-condition"+u+" .specific_value").val(p),f.render({elem:"#soul-condition"+u+" .staticDate",position:"static",calendar:!0,btns:["now"],value:p,done:function(e){var i=E("#soul-condition"+u).data("id"),t=E("#soul-condition"+u).data("head"),t=(E("#soul-condition"+u+" .specific_value").val(e),E("#soul-condition"+u+" [name^=datetime]:checked").prop("checked",!1),E("#soul-condition"+u+" [name^=datetime][value=specific]").prop("checked",!0),{id:i,head:t,prefix:"and",mode:"date",field:a,type:"specific",value:e});r.updateWhere(l,t),i||E("#soul-condition"+u).data("id",t.id),0<E(".soul-edit-out").length&&E('.soul-edit-out li[data-id="'+t.id+'"]').children(".item-value").html(t.value),n&&r.soulReload(l),j.render("radio","orm")}}),j.on("radio(datetime"+u+")",function(e){var i=E("#soul-condition"+u).data("id"),t=E("#soul-condition"+u).data("head"),t={id:i,head:t,prefix:"and",mode:"date",field:a,type:e.value,value:E("#soul-condition"+u+" .specific_value").val()};r.updateWhere(l,t),i||E("#soul-condition"+u).data("id",t.id),0<E(".soul-edit-out").length&&E('.soul-edit-out li[data-id="'+t.id+'"]').children(".item-value").html(b[t.type]||t.value),n&&r.soulReload(l)}),j.render("radio","orm"),"down"===d?i=o+E("#soul-condition"+u).width()<h?"fadeInLeft":(o=o-E("#main-list"+u).width()-E("#soul-condition"+u).width(),"fadeInRight"):t=t-E("#soul-condition"+u).outerHeight()-10,E("#soul-condition"+u).css({top:t,left:o}).show().removeClass().addClass(i+" animated")},bottomConditionHtml:function(e,i,t,l){var a="or"===i.prefix,o=i.field;if("group"===i.mode){if(i.children&&0<i.children.length){e.push('<div class="condition-item" data-id="'+i.id+'" data-prefix="'+(i.prefix||"and")+'">'),l||e.push('<div class="item-prefix layui-red">'+(a?"或":"与")+"</div> ");for(var d=0;d<i.children.length;d++)this.bottomConditionHtml(e,i.children[d],t,0===d);e.push('<i class="condition-item-close soul-icon soul-icon-unfold" ></i>'),e.push("</div>")}}else{switch(e.push('<div class="condition-item" data-field="'+o+'" data-id="'+i.id+'" data-mode="'+i.mode+'" data-type="'+i.type+'" data-value="'+(void 0===i.value?"":i.value)+'" data-prefix="'+(i.prefix||"and")+'">'),l||e.push('<div class="item-prefix layui-red">'+(a?"或":"与")+"</div> "),e.push('<div class="item-field layui-firebrick">'+t[o].title+"</div> "),e.push('<div class="item-type layui-deeppink">'),i.mode){case"in":e.push("筛选数据");break;case"condition":e.push(_[i.type]);break;case"date":e.push("选择日期");break;default:e.push("未知")}if(e.push("</div> "),"null"!==i.type&&"notNull"!==i.type){switch(e.push('<div class="item-value layui-blueviolet '+("date"===i.mode&&"specific"!==i.type)+'">'),i.mode){case"in":e.push("共"+(i.values?i.values.length:0)+"条数据");break;case"date":e.push("specific"===i.type?i.value||"请选择":b[i.type]);break;default:e.push(void 0===i.value||""===i.value?"请输入...":i.value)}e.push("</div>")}e.push('<i class="condition-item-close soul-icon soul-icon-unfold" ></i>'),e.push("</div>")}},renderBottomCondition:function(h){for(var e,p=this,i=$[h.id]||{},f=i.filterSos?JSON.parse(i.filterSos):[],o=i.tableFilterType?JSON.parse(i.tableFilterType):{},i=E(h.elem),y=h.id,i=i.next().children(".soul-bottom-contion"),d={},t=[],l=h.filter&&h.filter.items||U,a=p.getCompleteCols(h.cols),n=0;n<a.length;n++)a[n].field&&a[n].filter&&(-1===(e=a[n].filter.items||l).indexOf("data")&&-1===e.indexOf("condition")||(d[a[n].field]={title:a[n].title,items:e}));for(n=0;n<f.length;n++)p.bottomConditionHtml(t,f[n],d,0===n);if(i.children(".condition-items").html(t.join("")),t=[],0===E("#soul-bf-prefix"+y).length&&(t.push('<div id="soul-bf-prefix'+y+'" style="display: none;"><ul>'),t.push('<li data-value="and">与</li>'),t.push('<li data-value="or">或</li>'),t.push("</ul></div>")),0===E("#soul-bf-column"+y).length){for(var s in t.push('<div id="soul-bf-column'+y+'" style="display: none;"><ul>'),d)t.push('<li data-field="'+s+'">'+d[s].title+"</li>");t.push("</ul></div>")}if(0===E("#soul-bf-type"+y).length){for(var r in t.push('<div id="soul-bf-type'+y+'" style="display: none;"><ul>'),t.push('<li data-value="in" data-mode="in">筛选数据</li>'),t.push('<li data-value="all" data-mode="date">选择日期</li>'),_)t.push('<li data-value="'+r+'" data-mode="condition">'+_[r]+"</li>");t.push("</ul></div>")}0===E("#soul-bf-cond2-dropList"+y).length&&t.push('<div id="soul-bf-cond2-dropList'+y+'" style="display: none;"><div class="filter-search"><input type="text" placeholder="关键字搜索" class="layui-input"></div><div class="check"><div class="multiOption" data-type="all"><i class="soul-icon">&#xe623;</i> 全选</div><div class="multiOption" data-type="none"><i class="soul-icon">&#xe63e;</i> 清空</div><div class="multiOption" data-type="reverse"><i class="soul-icon">&#xe614;</i>反选</div></div><ul></ul></div>'),E("body").append(t.join("")),i.find(".item-prefix").off("click").on("click",function(e){e.stopPropagation(),E("#main-list"+y).hide(),p.hideDropList(h),p.hideCondition(h),p.hideColumns(h),p.hideBfColumn(h),p.hideBfType(h);var e=E(this).offset().top-E("#soul-bf-prefix"+y).outerHeight()-10,i=E(this).offset().left;E("#soul-bf-prefix"+y).find("li.soul-bf-selected").removeClass("soul-bf-selected"),E("#soul-bf-prefix"+y).data("id",E(this).parent().data("id")).data("prefix",E(this).parent().data("prefix")).data("refresh",!0).show().css({top:e,left:i}).removeClass().addClass("fadeInUp animated").find('li[data-value="'+E(this).parent().data("prefix")+'"]').addClass("soul-bf-selected")}),i.find(".item-field").off("click").on("click",function(e){e.stopPropagation(),E("#main-list"+y).hide(),p.hideDropList(h),p.hideCondition(h),p.hideColumns(h),p.hideBfPrefix(h),p.hideBfType(h);var e=E(this).offset().top-E("#soul-bf-column"+y).outerHeight()-10,i=E(this).offset().left;E("#soul-bf-column"+y).find("li.soul-bf-selected").removeClass("soul-bf-selected"),E("#soul-bf-column"+y).data("field",E(this).parent().data("field")).data("id",E(this).parent().data("id")).data("mode",E(this).parent().data("mode")).data("group",E(this).parent().parent().data("id")||"").data("refresh",!0).show().css({top:e,left:i}).removeClass().addClass("fadeInUp animated").find('li[data-field="'+E(this).parent().data("field")+'"]').addClass("soul-bf-selected")}),i.find(".item-type").on("click",function(e){e.stopPropagation(),E("#main-list"+y).hide(),p.hideDropList(h),p.hideCondition(h),p.hideColumns(h),p.hideBfColumn(h),p.hideBfPrefix(h);var e=E(this).parent().data("field"),e=(E("#soul-bf-type"+y+" li").hide(),o[e]&&0===o[e].indexOf("date")&&E("#soul-bf-type"+y+" li[data-mode=date]").show(),-1!==d[e].items.indexOf("data")&&E("#soul-bf-type"+y+" li[data-mode=in]").show(),-1!==d[e].items.indexOf("condition")&&E("#soul-bf-type"+y+" li[data-mode=condition]").show(),E(this).offset().top-E("#soul-bf-type"+y).outerHeight()-10),i=E(this).offset().left;switch(E("#soul-bf-type"+y).find("li.soul-bf-selected").removeClass("soul-bf-selected"),E(this).parent().data("mode")){case"in":E("#soul-bf-type"+y).find('li[data-mode="in"]').addClass("soul-bf-selected");break;case"date":E("#soul-bf-type"+y).find('li[data-mode="date"]').addClass("soul-bf-selected");case"condition":E("#soul-bf-type"+y).find('li[data-value="'+E(this).parent().data("type")+'"]').addClass("soul-bf-selected")}E("#soul-bf-type"+y).data("type",E(this).parent().data("type")).data("mode",E(this).parent().data("mode")).data("id",E(this).parent().data("id")).data("group",E(this).parent().parent().data("id")||"").data("refresh",!0).show().css({top:e,left:i}).removeClass().addClass("fadeInUp animated")}),i.find(".item-value").on("click",function(e){e.stopPropagation(),E("#main-list"+y).hide(),p.hideColumns(h),p.hideBfType(h),p.hideBfPrefix(h),p.hideBfColumn(h);var i=E(this).offset().left,e=E(this).parent().data("mode"),t=E(this).parent().data("field"),l=E(this).parent().data("id"),a=E(this).parent().data("head"),o=E(this).parent().data("prefix");switch(e){case"in":p.hideCondition(h),q&&clearTimeout(q),E("#soul-dropList"+y+">.filter-search>input").val(""),E("#soul-dropList"+y).show(),E("#soulDropList"+y).find("."+t+"DropList li input[type=checkbox]:checked").prop("checked",!1);for(var d=p.getFilterSoById(f,l),n=0;n<d.values.length;n++)E("#soulDropList"+y).find("."+t+'DropList li input[type=checkbox][value="'+d.values[n]+'"]').prop("checked",!0);E("#soul-dropList"+y+">ul").data("id",l).data("head",a).data("refresh",!0).data("prefix",o).html(E("#soulDropList"+y).find("."+t+"DropList li").clone()),j.render("checkbox","orm"),r=E(this).offset().top-E("#soul-dropList"+y).outerHeight()-10,E("#soul-dropList"+y).css({top:r,left:i}).show().removeClass().addClass("fadeInUp animated"),setTimeout(function(){E("#soul-dropList"+y+">.filter-search>input").focus()},1);var s=!0;j.on("checkbox(soulDropList"+y+")",function(e){s=!1,p.updateDropList(h,t)}),E("#soul-dropList"+y+">ul>li[data-value]").on("click",function(){s&&E(this).find("div.layui-form-checkbox").trigger("click"),s=!0});break;case"date":p.hideDropList(h),B&&clearTimeout(B);var d=p.getFilterSoById(f,l),r=E(this).offset().top-10;p.showDate(h,t,d,"fadeInUp",r,i,"up",!0);break;default:p.hideDropList(h),B&&clearTimeout(B);var u=this,c=E(this).parents(".condition-item:eq(0)").data("value");E(u).hide(),E(u).after('<div><input style="height: 25px;" class="layui-input tempValue" value="" /></div>'),E(u).next().children().val(c).select().on("keydown",function(e){13===e.keyCode&&E(this).blur()}).on("blur",function(){var e=E(this).val();E(u).html(void 0===e||""===e?"请输入...":e),E(u).show(),E(this).parent().remove(),e!==c&&(p.updateWhere(h,{id:l,value:e}),p.soulReload(h))})}}),E("#soul-bf-prefix"+y+">ul>li").off("click").on("click",function(){var e=E(this).parent().parent().data("id"),i=E(this).data("value"),t=E(this).parent().parent().data("prefix"),l=E(this).parent().parent().data("refresh");t!==i&&(p.updateWhere(h,{id:e,prefix:i}),!0===l)&&p.soulReload(h)}),E("#soul-bf-column"+y+">ul>li").off("click").on("click",function(){var e=E(this).parent().parent().data("field"),i=E(this).data("field"),t=E(this).parent().parent().data("mode"),l=E(this).parent().parent().data("group"),a=E(this).parent().parent().data("refresh");e!==i&&(e={id:E(this).parent().parent().data("id"),field:i},-1===d[i].items.indexOf(u[t])?E.extend(e,E.extend({},c[u[t]],"condition"===c[u[t]].mode&&p.startsWith(o[i],"date")?{mode:"date",type:"all"}:{})):"in"===t?E.extend(e,{values:[]}):"date"!==t||p.startsWith(o[i],"date")?"date"!==t&&p.startsWith(o[i],"date")&&E.extend(e,{mode:"date",type:"all"}):E.extend(e,{mode:"condition",type:"eq",value:""}),l&&p.updateWhere(h,{id:l,head:!1}),p.updateWhere(h,e),0<E(".soul-edit-out").length&&(E('.soul-edit-out li[data-id="'+e.id+'"]').data(e).children(".item-field").html(d[i].title),"in"===e.mode?(E('.soul-edit-out li[data-id="'+e.id+'"]').children(".item-type").html("筛选数据"),E('.soul-edit-out li[data-id="'+e.id+'"]').children(".item-value").html("共0条数据")):t!==e.mode&&("date"===e.mode?(E('.soul-edit-out li[data-id="'+e.id+'"]').children(".item-type").html("选择日期"),E('.soul-edit-out li[data-id="'+e.id+'"]').children(".item-value").html(b[e.type])):"condition"===e.mode&&(E('.soul-edit-out li[data-id="'+e.id+'"]').children(".item-type").html(_[e.type]),E('.soul-edit-out li[data-id="'+e.id+'"]').children(".item-value").html(""===e.value?"请输入...":e.value)))),!0===a)&&p.soulReload(h)}),E("#soul-bf-type"+y+">ul>li").off("click").on("click",function(){var e=E(this).data("value")+"",i=E(this).data("mode"),t=E(this).parent().parent().data("type"),l=E(this).parent().parent().data("mode"),a=E(this).parent().parent().data("group"),o=E(this).parent().parent().data("refresh");if(t!==e){var d={id:E(this).parent().parent().data("id"),type:e,mode:i};if(l!==i&&E.extend(d,{value:"",values:[]}),a&&"in"===i&&p.updateWhere(h,{id:a,head:!1}),p.updateWhere(h,d),0<E(".soul-edit-out").length)switch(E('.soul-edit-out li[data-id="'+d.id+'"]').data(d).children(".item-value").show(),E('.soul-edit-out li[data-id="'+d.id+'"]').data(d).children(".item-type").html(_[e]||("in"===i?"筛选数据":"选择日期")),i){case"in":E('.soul-edit-out li[data-id="'+d.id+'"]').data(d).children(".item-value").html("共0条数据");break;case"date":E('.soul-edit-out li[data-id="'+d.id+'"]').data(d).children(".item-value").html(b[e]);break;case"condition":l!==i&&E('.soul-edit-out li[data-id="'+d.id+'"]').data(d).children(".item-value").html("请输入..."),E('.soul-edit-out li[data-id="'+d.id+'"]').data(d).children(".item-value")["null"==e||"notNull"==e?"hide":"show"]()}!0===o&&p.soulReload(h)}}),i.find(".condition-items .condition-item .condition-item-close").on("click",function(){p.updateWhere(h,{id:E(this).parents(".condition-item:eq(0)").data("id"),delete:!0}),p.soulReload(h)})},export:function(i,e){"string"==typeof i&&(i=Q[i]);var p,t,l=layer.msg("文件下载中",{icon:16,time:-1,anim:-1,fixed:!1}),f=this.deepClone(i.cols),a=i.elem.next().find("style")[0],a=a.sheet||a.styleSheet||{},a=a.cssRules||a.rules,o=(layui.each(a,function(e,i){var t;i.style.width&&(t=i.selectorText.split("-"),f[t[3]][t[4]].width=parseInt(i.style.width))}),JSON.parse(JSON.stringify(i.data||X[i.id]))),d={},n={},s=[],r={},a=E(i.elem),y=a.next().children(".layui-table-box").children(".layui-table-body").children("table"),B=i.totalRow?a.next().children(".layui-table-total").children(":first"):null,m=Object.assign({},i.excel,e),e=m.filename?"function"==typeof m.filename?m.filename.call(this):m.filename:"表格数据.xlsx",u=!0===m.checked,c=!0===m.curPage,v=m.columns,h=m.totalRow,j=e.substring(e.lastIndexOf(".")+1,e.length),b=m.add&&m.add.top&&Array.isArray(m.add.top.data)?m.add.top.data.length+1:1,J=m.add&&m.add.bottom&&Array.isArray(m.add.bottom.data)?m.add.bottom.data.length:0;if(m.data){if(!Array.isArray(m.data))return console.error("导出指定数据 data 不符合数组格式",m.data),void layer.close(l);o=m.data}else if(u){if(o=[],X[i.id]&&0<X[i.id].length)for(C=0;C<X[i.id].length;C++)X[i.id][C][Y.config.checkName]&&o.push(X[i.id][C])}else if(c)o=layui.table.cache[i.id];else if(i.url&&i.page){var H=!0,u=K[i.id]?$[i.id]:Q[i.id].where;if(i.contentType&&0==i.contentType.indexOf("application/json")&&(u=JSON.stringify(u)),E.ajax({url:i.url,data:u,dataType:"json",method:i.method||"post",async:!1,cache:!1,headers:i.headers||{},contentType:i.contentType,success:function(e){(e="function"==typeof i.parseData?i.parseData(e)||e:e)[i.response.statusName]!=i.response.statusCode?layer.msg('返回的数据不符合规范，正确的成功状态码应为："'+i.response.statusName+'": '+i.response.statusCode,{icon:2,anim:6}):o=e[i.response.dataName]},error:function(e){layer.msg("请求异常！",{icon:2,anim:6}),H=!1}}),!H)return}else{c=a.next().children(".layui-table-box").children(".layui-table-header").find('.layui-table-sort[lay-sort$="sc"]:eq(0)');if(0<c.length){var A=c.parent().parent().data("field");switch(c.attr("lay-sort")){case"asc":o=layui.sort(o,A);break;case"desc":o=layui.sort(o,A,!0)}}}for(var g,x,k=[],C=0;C<f.length;C++)for(p=x=0;p<f[C].length;p++)if(f[C][p].exportHandled)(!f[C][p].field&&"numbers"!==f[C][p].type||f[C][p].hide)&&x++;else{if(1<f[C][p].rowspan)for(!f[C][p].field&&"numbers"!==f[C][p].type||f[C][p].hide?x++:s.push([q(p+1-x)+(C+b),q(p+1-x)+(C+parseInt(f[C][p].rowspan)+b-1)]),(g=this.deepClone(f[C][p])).exportHandled=!0,t=C+1;t<f.length;)f[t].splice(p,0,g),t++;if(1<f[C][p].colspan){for(s.push([q(p+1-x)+(C+b),q(p+parseInt(f[C][p].colspan)-x)+(C+b)]),(g=this.deepClone(f[C][p])).exportHandled=!0,t=1;t<f[C][p].colspan;t++)f[C].splice(p,0,g);p=p+parseInt(f[C][p].colspan)-1}}var w=f[f.length-1];for(C=0;C<o.length;C++)for(p=0;p<w.length;p++)(w[p].field||"numbers"===w[p].type)&&(v&&Array.isArray(v)||!w[p].hide)&&(o[C][w[p].key]=o[C][w[p].field||w[p].LAY_INDEX]);if(!1!==h&&i.totalRow){var L={},S={};if("object"==typeof h&&"origin"===h.type){for(C=0;C<w.length;C++)w[C].field&&(L[w[C].key]=B.find('[data-field="'+w[C].field+'"]').text().trim());o.push(L)}else{for(C=0;C<w.length;C++)w[C].totalRowText?L[w[C].key]=w[C].totalRowText:w[C].totalRow&&(S[w[C].key]=0);if("{}"!==JSON.stringify(S))for(C=0;C<o.length;C++)for(var D in S)S[D]=(parseFloat(S[D])+(parseFloat(o[C][D])||0)).toFixed(2);o.push(Object.assign(L,S))}}if(v&&Array.isArray(v)){var _=[],N={},s=[];for(k[0]={},C=0;C<v.length;C++)for(p=0;p<w.length;p++)if(w[p].field===v[C]){w[p].hide=!1,_.push(w[p]),k[0][w[p].key]=w[p],N[w[p].key]=E("<div>"+w[p].title+"</div>").text();break}w=_,o.splice(0,0,N)}else for(C=0;C<f.length;C++){for(k[C]={},N={},p=0;p<f[C].length;p++)k[C][f[f.length-1][p].key]=f[C][p],N[f[f.length-1][p].key]=E("<div>"+f[C][p].title+"</div>").text();o.splice(C,0,N)}if(m.add){var O,T,F,I=m.add.top,W=m.add.bottom;if(I&&Array.isArray(I.data)&&0<I.data.length){for(C=0;C<I.data.length;C++){for(N={},p=F=0;p<(I.data[C].length>w.length?I.data[C]:w).length;p++)!w[p].field&&"numbers"!==w[p].type||w[p].hide?F++:N[w[p]?w[p].key:p+""]=I.data[C][p-F]||"";o.splice(C,0,N)}if(Array.isArray(I.heights)&&0<I.heights.length)for(C=0;C<I.heights.length;C++)r[C]=I.heights[C];if(Array.isArray(I.merge)&&0<I.merge.length)for(C=0;C<I.merge.length;C++)2===I.merge[C].length&&(O=I.merge[C][0].split(","),T=I.merge[C][1].split(","),s.push([q(O[1])+O[0],q(T[1])+T[0]]))}if(W&&Array.isArray(W.data)&&0<W.data.length){for(C=0;C<W.data.length;C++){for(N={},p=F=0;p<(W.data[C].length>w.length?W.data[C]:w).length;p++)!w[p].field&&"numbers"!==w[p].type||w[p].hide?F++:N[w[p]?w[p].key:p+""]=W.data[C][p-F]||"";o.push(N)}if(Array.isArray(W.heights)&&0<W.heights.length)for(C=0;C<W.heights.length;C++)r[o.length-W.data.length+C]=W.heights[C];if(Array.isArray(W.merge)&&0<W.merge.length)for(C=0;C<W.merge.length;C++)2===W.merge[C].length&&(O=W.merge[C][0].split(","),T=W.merge[C][1].split(","),s.push([q(O[1])+(o.length-W.data.length+parseInt(O[0])),q(T[1])+(o.length-W.data.length+parseInt(T[0]))]))}}var U=0,z={left:"left",center:"center",right:"right"},P=["top","bottom","left","right"];for(C=0;C<w.length;C++)!w[C].field&&"numbers"!==w[C].type||w[C].hide||(w[C].width&&(n[String.fromCharCode(64+parseInt(++U))]=w[C].width),d[w[C].key]=function(e,i,t,l){var a="ffffff",o="000000",d="Calibri",n=12,s="s",r=l-(v?1:f.length)-b+1,u={top:{style:"thin",color:{indexed:64}},bottom:{style:"thin",color:{indexed:64}},left:{style:"thin",color:{indexed:64}},right:{style:"thin",color:{indexed:64}}};if(m.border)for(p=0;p<P.length;p++)m.border[P[p]]?(u[P[p]].style=m.border[P[p]].style||u[P[p]].style,u[P[p]].color=R(m.border[P[p]].color)||u[P[p]].color):(m.border.color||m.border.style)&&(u[P[p]].style=m.border.style||u[P[p]].style,u[P[p]].color=R(m.border.color)||u[P[p]].color);if(l<b-1||l>=t.length-J)return{v:i[e]||"",s:{alignment:{horizontal:"center",vertical:"center"},font:{name:d,sz:n,color:{rgb:o}},fill:{fgColor:{rgb:a,bgColor:{indexed:64}}},border:u},t:s};if(r<0)a="C7C7C7",m.head&&(a=m.head.bgColor||a,o=m.head.color||o,d=m.head.family||d,n=m.head.size||n);else{if(m.font&&(a=m.font.bgColor||a,o=m.font.color||o,d=m.font.family||d,n=m.font.size||n),m.border)for(p=0;p<P.length;p++)m.border[P[p]]?(u[P[p]].style=m.border[P[p]].style||u[P[p]].style,u[P[p]].color=R(m.border[P[p]].color)||u[P[p]].color):(m.border.color||m.border.style)&&(u[P[p]].style=m.border.style||u[P[p]].style,u[P[p]].color=R(m.border.color)||u[P[p]].color);if(k[k.length-1][e].excel){var c="function"==typeof k[k.length-1][e].excel?k[k.length-1][e].excel.call(this,i,r,t.length-f.length-b+1-J):k[k.length-1][e].excel;if(c&&(a=c.bgColor||a,o=c.color||o,d=c.family||d,n=c.size||n,s=c.cellType||s,c.border))for(p=0;p<P.length;p++)c.border[P[p]]?(u[P[p]].style=c.border[P[p]].style||u[P[p]].style,u[P[p]].color=R(c.border[P[p]].color)||u[P[p]].color):(c.border.color||c.border.style)&&(u[P[p]].style=c.border.style||u[P[p]].style,u[P[p]].color=R(c.border.color)||u[P[p]].color)}}function h(e){return null==e?"":e}t=0<=r&&k[k.length-1][e].templet?"function"==typeof k[k.length-1][e].templet?0===E("<div>"+k[k.length-1][e].templet(i)+"</div>").find(":input").length?E("<div>"+k[k.length-1][e].templet(i)+"</div>").text():y.children("tbody").children("tr[data-index="+r+"]").children('td[data-key="'+e+'"]').find(":input").val()||h(i[e]):0===E("<div>"+M(E(k[k.length-1][e].templet).html()||String(k[k.length-1][e].templet)).render(i)+"</div>").find(":input").length?E("<div>"+M(E(k[k.length-1][e].templet).html()||String(k[k.length-1][e].templet)).render(i)+"</div>").text():y.children("tbody").children("tr[data-index="+r+"]").children('td[data-key="'+e+'"]').find(":input").val()||h(i[e]):0<=r&&"numbers"===k[k.length-1][e].type?1+r:h(i[e]);return{v:t,s:{alignment:{horizontal:k[r<-1?l-b+1:k.length-1][e].align?z[k[r<-1?l-b+1:k.length-1][e].align]:"top",vertical:"center"},font:{name:d,sz:n,color:{rgb:o}},fill:{fgColor:{rgb:a,bgColor:{indexed:64}}},border:u},t:-1===V.indexOf(t)?s:"s"}});function R(e){return e&&{rgb:e}}function q(e){for(var i=[];e;){var t=e%26;t||(t=26,--e),String.fromCodePoint||!function(d){function i(e){for(var i=[],t="",l=0,a=arguments.length;l!==a;++l){var o=+arguments[l];if(!(o<1114111&&o>>>0==o))throw RangeError("Invalid code point: "+o);16383<=(o<=65535?i.push(o):i.push(55296+((o-=65536)>>10),o%1024+56320))&&(t+=d.apply(null,i),i.length=0)}return t+d.apply(null,i)}try{Object.defineProperty(String,"fromCodePoint",{value:i,configurable:!0,writable:!0})}catch(e){String.fromCodePoint=i}}(String.fromCharCode),i.push(String.fromCodePoint(t+64)),String.fromCodePoint||!function(d){function i(e){for(var i=[],t="",l=0,a=arguments.length;l!==a;++l){var o=+arguments[l];if(!(o<1114111&&o>>>0==o))throw RangeError("Invalid code point: "+o);16383<=(o<=65535?i.push(o):i.push(55296+((o-=65536)>>10),o%1024+56320))&&(t+=d.apply(null,i),i.length=0)}return t+d.apply(null,i)}try{Object.defineProperty(String,"fromCodePoint",{value:i,configurable:!0,writable:!0})}catch(e){String.fromCodePoint=i}}(String.fromCharCode),e=~~(e/26)}return i.reverse().join("")}G.exportExcel({sheet1:G.filterExportData(o,d)},e,j,{extend:{"!cols":G.makeColConfig(n,80),"!merges":G.makeMergeConfig(s),"!rows":G.makeRowConfig(r,16)}}),layer.close(l)},startsWith:function(e,i){i=new RegExp("^"+i);return e&&i.test(e)},deepClone:function(e){var i=Array.isArray(e)?[]:{};if(e&&"object"==typeof e)for(var t in e)e.hasOwnProperty(t)&&(i[t]=e&&"object"==typeof e[t]?this.deepClone(e[t]):e[t]);return i},deepStringify:function(e){var t="[[JSON_FUN_PREFIX_",l="_JSON_FUN_SUFFIX]]";return JSON.stringify(e,function(e,i){return"function"==typeof i?t+i.toString()+l:i})},getScrollWidth:function(e){var i=0;return e?i=e.offsetWidth-e.clientWidth:((e=document.createElement("div")).style.width="100px",e.style.height="100px",e.style.overflowY="scroll",document.body.appendChild(e),i=e.offsetWidth-e.clientWidth,document.body.removeChild(e)),i},getCompleteCols:function(e){for(var i,t,l,a=this.deepClone(e),o=0;o<a.length;o++)for(i=0;i<a[o].length;i++)if(!a[o][i].exportHandled){if(1<a[o][i].rowspan)for((l=this.deepClone(a[o][i])).exportHandled=!0,t=o+1;t<a.length;)a[t].splice(i,0,l),t++;if(1<a[o][i].colspan){for((l=this.deepClone(a[o][i])).exportHandled=!0,t=1;t<a[o][i].colspan;t++)a[o].splice(i,0,l);i=i+parseInt(a[o][i].colspan)-1}}return a[a.length-1]},parseTempData:function(e,i,t,l){e=e.templet?"function"==typeof e.templet?e.templet(t):M(E(e.templet).html()||String(i)).render(t):i;return l?E("<div>"+e+"</div>").text():e},cache:X})});