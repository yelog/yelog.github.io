<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>å¶è½é˜</title>
  
  
  <link href="http://yelog.org/atom.xml" rel="self"/>
  
  <link href="http://yelog.org/"/>
  <updated>2024-08-12T09:33:11.729Z</updated>
  <id>http://yelog.org/</id>
  
  <author>
    <name>å¶è½é˜</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>ç”¨ vim å†™ markdown æ˜¯ä¸€ç§ä»€ä¹ˆæ ·çš„ä½“éªŒ(å«æŠ€å·§)</title>
    <link href="http://yelog.org/2024/08/02/vim-write-markdown-experience-and-tips/"/>
    <id>http://yelog.org/2024/08/02/vim-write-markdown-experience-and-tips/</id>
    <published>2024-08-02T07:10:59.000Z</published>
    <updated>2024-08-12T09:33:11.729Z</updated>
    
    
    
    
    <category term="å·¥å…·" scheme="http://yelog.org/categories/%E5%B7%A5%E5%85%B7/"/>
    
    <category term="vim" scheme="http://yelog.org/categories/%E5%B7%A5%E5%85%B7/vim/"/>
    
    
    <category term="vim" scheme="http://yelog.org/tags/vim/"/>
    
    <category term="neovim" scheme="http://yelog.org/tags/neovim/"/>
    
    <category term="markdown" scheme="http://yelog.org/tags/markdown/"/>
    
    <category term="editor" scheme="http://yelog.org/tags/editor/"/>
    
  </entry>
  
  <entry>
    <title>Jackson æ—¶é—´åºåˆ—åŒ–/ååºåˆ—åŒ–è¯¦è§£</title>
    <link href="http://yelog.org/2024/07/05/Jackson%20Time%20Serializer/Deserializer/"/>
    <id>http://yelog.org/2024/07/05/Jackson%20Time%20Serializer/Deserializer/</id>
    <published>2024-07-05T08:00:00.000Z</published>
    <updated>2024-08-12T09:33:12.215Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>æœ€è¿‘åœ¨é¡¹ç›®ä¸­é‡åˆ°äº†æ—¶é—´åºåˆ—åŒ–çš„é—®é¢˜ï¼Œæ‰€ä»¥ç ”ç©¶äº†ä¸€ä¸‹ Jackson çš„æ—¶é—´åºåˆ—åŒ–&#x2F;ååºåˆ—åŒ–ï¼Œè¿™é‡Œåšä¸€ä¸ªè¯¦ç»†çš„æ€»ç»“ã€‚</p><h1 id="0-å‡†å¤‡å·¥ä½œ"><a href="#0-å‡†å¤‡å·¥ä½œ" class="headerlink" title="0. å‡†å¤‡å·¥ä½œ"></a>0. å‡†å¤‡å·¥ä½œ</h1><p>å‡†å¤‡å®ä½“ç±» User.java</p><pre><code class="java">package com.example.testjava.entity;import lombok.Builder;import lombok.Data;import java.time.LocalDate;import java.time.LocalDateTime;import java.time.LocalTime;import java.util.Date;@Builder@Datapublic class User &#123;    private String name;    private Date date;    private LocalDate localDate;    private LocalDateTime localDateTime;    private LocalTime localTime;    private java.sql.Date sqlDate;    private java.sql.Time sqlTime;    private java.sql.Timestamp timestamp;&#125;</code></pre><p>ç®€å•æŸ¥è¯¢</p><pre><code class="java">package com.example.testjava.controller;import com.example.testjava.entity.User;import org.springframework.web.bind.annotation.GetMapping;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.RestController;import java.util.Date;@RestController@RequestMapping(&quot;/jackson&quot;)public class JacksonTestController &#123;    @GetMapping(&quot;/query&quot;)    public User testJavaDate() &#123;        return User.builder()                .name(&quot;test&quot;)                .date(new Date())                .localDate(java.time.LocalDate.now())                .localDateTime(java.time.LocalDateTime.now())                .localTime(java.time.LocalTime.now())                .sqlDate(new java.sql.Date(System.currentTimeMillis()))                .sqlTime(new java.sql.Time(System.currentTimeMillis()))                .timestamp(new java.sql.Timestamp(System.currentTimeMillis()))                .build();    &#125;&#125;</code></pre><h1 id="1-åºåˆ—åŒ–"><a href="#1-åºåˆ—åŒ–" class="headerlink" title="1. åºåˆ—åŒ–"></a>1. åºåˆ—åŒ–</h1><h2 id="1-1-é»˜è®¤è¿”å›"><a href="#1-1-é»˜è®¤è¿”å›" class="headerlink" title="1.1. é»˜è®¤è¿”å›"></a>1.1. é»˜è®¤è¿”å›</h2><pre><code class="json">&#123;    &quot;name&quot;: &quot;test&quot;,    &quot;date&quot;: &quot;2024-07-05T08:09:47.100+00:00&quot;,    &quot;localDate&quot;: &quot;2024-07-05&quot;,    &quot;localDateTime&quot;: &quot;2024-07-05T16:09:47.100462&quot;,    &quot;localTime&quot;: &quot;16:09:47.100514&quot;,    &quot;sqlDate&quot;: &quot;2024-07-05&quot;,    &quot;sqlTime&quot;: &quot;16:09:47&quot;,    &quot;timestamp&quot;: &quot;2024-07-05T08:09:47.100+00:00&quot;&#125;</code></pre><h1 id="1-2-æ·»åŠ é…ç½®"><a href="#1-2-æ·»åŠ é…ç½®" class="headerlink" title="1.2. æ·»åŠ é…ç½®"></a>1.2. æ·»åŠ é…ç½®</h1><p>é…ç½®å¦‚ä¸‹</p><pre><code class="yaml">spring:  jackson:    date-format: yyyy-MM-dd HH:mm:ss</code></pre><p>è¿”å›æ•ˆæœ</p><pre><code class="json">&#123;    &quot;name&quot;: &quot;test&quot;,    &quot;date&quot;: &quot;2024-07-05 08:16:07&quot;,    &quot;localDate&quot;: &quot;2024-07-05&quot;,    &quot;localDateTime&quot;: &quot;2024-07-05T16:16:07.097035&quot;,    &quot;localTime&quot;: &quot;16:16:07.09705&quot;,    &quot;sqlDate&quot;: &quot;2024-07-05&quot;,    &quot;sqlTime&quot;: &quot;16:16:07&quot;,    &quot;timestamp&quot;: &quot;2024-07-05 08:16:07&quot;&#125;</code></pre><p>å¯ä»¥å‘ç°, æ—¥æœŸæ—¶é—´ç±»å‹ä¸­, åªæœ‰ <code>java.time.LocalDateTime</code> æ²¡æœ‰æŒ‰ç…§é…ç½®åºåˆ—åŒ–, <code>java.util.Date</code> å’Œ <code>java.sql.Timestamp</code> æŒ‰ç…§é…ç½®åºåˆ—åŒ–äº†ã€‚</p><h1 id="1-3-æ·»åŠ æ³¨è§£"><a href="#1-3-æ·»åŠ æ³¨è§£" class="headerlink" title="1.3. æ·»åŠ æ³¨è§£"></a>1.3. æ·»åŠ æ³¨è§£</h1><pre><code class="java">package com.example.testjava.entity;import com.fasterxml.jackson.annotation.JsonFormat;import lombok.Builder;import lombok.Data;import java.time.LocalDate;import java.time.LocalDateTime;import java.time.LocalTime;import java.util.Date;@Builder@Datapublic class User &#123;    private String name;    @JsonFormat(pattern = &quot;yyyy-MM-dd HH:mm:ss&quot;)    private Date date;    private LocalDate localDate;    @JsonFormat(pattern = &quot;yyyy-MM-dd HH:mm:ss&quot;)    private LocalDateTime localDateTime;    @JsonFormat(pattern = &quot;HH:mm:ss&quot;)    private LocalTime localTime;    private java.sql.Date sqlDate;    private java.sql.Time sqlTime;    @JsonFormat(pattern = &quot;yyyy-MM-dd HH:mm:ss&quot;)    private java.sql.Timestamp timestamp;&#125;</code></pre><p>è¿”å›æ•ˆæœ</p><pre><code class="json">&#123;    &quot;name&quot;: &quot;test&quot;,    &quot;date&quot;: &quot;2024-07-05 08:24:36&quot;,    &quot;localDate&quot;: &quot;2024-07-05&quot;,    &quot;localDateTime&quot;: &quot;2024-07-05 16:24:36&quot;,    &quot;localTime&quot;: &quot;16:24:36&quot;,    &quot;sqlDate&quot;: &quot;2024-07-05&quot;,    &quot;sqlTime&quot;: &quot;16:24:36&quot;,    &quot;timestamp&quot;: &quot;2024-07-05 08:24:36&quot;&#125;</code></pre><p>æ³¨è§£æ˜¯å¯ä»¥éƒ½æœ‰æ•ˆçš„</p><h1 id="2-ååºåˆ—åŒ–"><a href="#2-ååºåˆ—åŒ–" class="headerlink" title="2. ååºåˆ—åŒ–"></a>2. ååºåˆ—åŒ–</h1><p>å‡†å¤‡è¯·æ±‚</p><pre><code class="java">    @PostMapping(&quot;/save&quot;)    public User save(@RequestBody User user) &#123;        return user;    &#125;</code></pre><p>è¯·æ±‚å‚æ•°</p><pre><code class="json">&#123;    &quot;name&quot;: &quot;test&quot;,    &quot;date&quot;: &quot;2024-07-05 08:24:36&quot;,    &quot;localDate&quot;: &quot;2024-07-05&quot;,    &quot;localDateTime&quot;: &quot;2024-07-05 16:24:36&quot;,    &quot;localTime&quot;: &quot;16:24:36&quot;,    &quot;sqlDate&quot;: &quot;2024-07-05&quot;,    &quot;sqlTime&quot;: &quot;16:24:36&quot;,    &quot;timestamp&quot;: &quot;2024-07-05 08:24:36&quot;&#125;</code></pre><h2 id="2-1-é»˜è®¤æ•ˆæœ"><a href="#2-1-é»˜è®¤æ•ˆæœ" class="headerlink" title="2.1 é»˜è®¤æ•ˆæœ"></a>2.1 é»˜è®¤æ•ˆæœ</h2><p>é»˜è®¤æŠ¥é”™</p><pre><code class="text">JSON parse error: Cannot deserialize value of type `java.util.Date` from String \&quot;2024-07-05 08:24:36\&quot;</code></pre><h2 id="2-2-æ·»åŠ é…ç½®"><a href="#2-2-æ·»åŠ é…ç½®" class="headerlink" title="2.2 æ·»åŠ é…ç½®"></a>2.2 æ·»åŠ é…ç½®</h2><p>æœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥è§£å†³, ä¸€ä¸ªæ˜¯è‡ªå®šä¹‰æ—¶é—´åºåˆ—åŒ–, ä¸€ä¸ªæ˜¯è‡ªå®šä¹‰ objectMapper</p><h3 id="2-2-1-è‡ªå®šä¹‰æ—¶é—´åºåˆ—åŒ–"><a href="#2-2-1-è‡ªå®šä¹‰æ—¶é—´åºåˆ—åŒ–" class="headerlink" title="2.2.1 è‡ªå®šä¹‰æ—¶é—´åºåˆ—åŒ–"></a>2.2.1 è‡ªå®šä¹‰æ—¶é—´åºåˆ—åŒ–</h3><pre><code class="java">/** * æ­¤è½¬æ¢æ–¹æ³•è¯•ç”¨äº json è¯·æ±‚ * LocalDateTime æ—¶é—´æ ¼å¼è½¬æ¢ æ”¯æŒ */@JsonComponent@Configurationpublic class LocalDateTimeFormatConfiguration extends JsonDeserializer&lt;LocalDateTime&gt; &#123;    @Value(&quot;$&#123;spring.jackson.date-format:yyyy-MM-dd HH:mm:ss&#125;&quot;)    private String pattern;    /**     * LocalDate ç±»å‹å…¨å±€æ—¶é—´æ ¼å¼åŒ–     * @return     */    @Bean    public LocalDateTimeSerializer localDateTimeDeserializer() &#123;        return new LocalDateTimeSerializer(DateTimeFormatter.ofPattern(pattern));    &#125;    @Bean    public Jackson2ObjectMapperBuilderCustomizer jackson2ObjectMapperBuilderCustomizer() &#123;        return builder -&gt; builder.serializerByType(LocalDateTime.class, localDateTimeDeserializer());    &#125;    @Override    public LocalDateTime deserialize(JsonParser jsonParser, DeserializationContext deserializationContext) throws IOException, JsonProcessingException &#123;        return StrUtil.isEmpty(jsonParser.getText()) ? null : LocalDateTimeUtil.of(new DateTime(jsonParser.getText()));    &#125;&#125;</code></pre><pre><code class="java">@JsonComponent@Configurationpublic class DateFormatConfiguration extends JsonDeserializer&lt;Date&gt; &#123;    @Value(&quot;$&#123;spring.jackson.date-format:yyyy-MM-dd HH:mm:ss&#125;&quot;)    private String pattern;    /**     * date ç±»å‹å…¨å±€æ—¶é—´æ ¼å¼åŒ–     *     * @return     */    @Bean    public Jackson2ObjectMapperBuilderCustomizer jackson2ObjectMapperBuilder() &#123;        return builder -&gt; &#123;            TimeZone tz = TimeZone.getTimeZone(&quot;UTC&quot;);            DateFormat df = new SimpleDateFormat(pattern);            df.setTimeZone(tz);            builder.failOnEmptyBeans(false)                    .failOnUnknownProperties(false)                    .featuresToDisable(SerializationFeature.WRITE_DATES_AS_TIMESTAMPS)                    .dateFormat(df);        &#125;;    &#125;    @Override    public Date deserialize(JsonParser jsonParser, DeserializationContext deserializationContext) throws IOException, JsonProcessingException &#123;        return StrUtil.isEmpty(jsonParser.getText()) ? null : new DateTime(jsonParser.getText());    &#125;&#125;</code></pre><h3 id="2-2-2-è‡ªå®šä¹‰-objectMapper"><a href="#2-2-2-è‡ªå®šä¹‰-objectMapper" class="headerlink" title="2.2.2 è‡ªå®šä¹‰ objectMapper"></a>2.2.2 è‡ªå®šä¹‰ objectMapper</h3><pre><code class="java">package com.example.testjava.config;import cn.hutool.core.date.DatePattern;import cn.hutool.core.date.DateTime;import cn.hutool.core.date.LocalDateTimeUtil;import cn.hutool.core.util.StrUtil;import com.fasterxml.jackson.core.JacksonException;import com.fasterxml.jackson.core.JsonGenerator;import com.fasterxml.jackson.core.JsonParser;import com.fasterxml.jackson.databind.Module;import com.fasterxml.jackson.databind.*;import com.fasterxml.jackson.datatype.jsr310.JavaTimeModule;import com.fasterxml.jackson.datatype.jsr310.deser.LocalDateDeserializer;import com.fasterxml.jackson.datatype.jsr310.deser.LocalTimeDeserializer;import com.fasterxml.jackson.datatype.jsr310.ser.LocalDateSerializer;import com.fasterxml.jackson.datatype.jsr310.ser.LocalDateTimeSerializer;import com.fasterxml.jackson.datatype.jsr310.ser.LocalTimeSerializer;import org.springframework.beans.factory.annotation.Value;import org.springframework.boot.autoconfigure.AutoConfigureBefore;import org.springframework.boot.autoconfigure.jackson.JacksonAutoConfiguration;import org.springframework.context.annotation.Bean;import org.springframework.context.annotation.Configuration;import java.io.IOException;import java.sql.Time;import java.sql.Timestamp;import java.text.SimpleDateFormat;import java.time.LocalDate;import java.time.LocalDateTime;import java.time.LocalTime;import java.time.format.DateTimeFormatter;import java.util.Date;@Configuration@AutoConfigureBefore(JacksonAutoConfiguration.class)public class JacksonConfig &#123;    @Value(&quot;$&#123;spring.jackson.date-format:yyyy-MM-dd HH:mm:ss&#125;&quot;)    private String pattern;    @Bean    public ObjectMapper objectMapper() &#123;        ObjectMapper objectMapper = new ObjectMapper();        // åœ¨ååºåˆ—åŒ–æ—¶, å¦‚æœå¯¹è±¡æ²¡æœ‰å¯¹åº”çš„å­—æ®µ, ä¸æŠ›å‡ºå¼‚å¸¸        objectMapper.configure(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES, false);        objectMapper.registerModule(javaTimeModule());        objectMapper.disable(SerializationFeature.WRITE_DATES_AS_TIMESTAMPS);        return objectMapper;    &#125;    private Module javaTimeModule() &#123;        JavaTimeModule module = new JavaTimeModule();        // åºåˆ—åŒ–        module.addSerializer(new LocalDateTimeSerializer(DateTimeFormatter.ofPattern(pattern)));        module.addSerializer(new LocalTimeSerializer(DateTimeFormatter.ofPattern(DatePattern.NORM_TIME_PATTERN)));        module.addSerializer(new LocalDateSerializer(DateTimeFormatter.ofPattern(DatePattern.NORM_DATE_PATTERN)));        module.addSerializer(Date.class, new JsonSerializer&lt;&gt;() &#123;            @Override            public void serialize(Date date, JsonGenerator jsonGenerator, SerializerProvider serializerProvider) throws IOException &#123;                SimpleDateFormat sdf = new SimpleDateFormat(pattern);                jsonGenerator.writeString(sdf.format(date));            &#125;        &#125;);        module.addSerializer(java.sql.Date.class, new JsonSerializer&lt;&gt;() &#123;            @Override            public void serialize(java.sql.Date date, JsonGenerator jsonGenerator, SerializerProvider serializerProvider) throws IOException &#123;                SimpleDateFormat sdf = new SimpleDateFormat(pattern);                jsonGenerator.writeString(sdf.format(date));            &#125;        &#125;);        module.addSerializer(Timestamp.class, new JsonSerializer&lt;&gt;() &#123;            @Override            public void serialize(Timestamp timestamp, JsonGenerator jsonGenerator, SerializerProvider serializerProvider) throws IOException &#123;                SimpleDateFormat sdf = new SimpleDateFormat(pattern);                jsonGenerator.writeString(sdf.format(timestamp));            &#125;        &#125;);        module.addSerializer(Time.class, new JsonSerializer&lt;&gt;() &#123;            @Override            public void serialize(Time time, JsonGenerator jsonGenerator, SerializerProvider serializerProvider) throws IOException &#123;                SimpleDateFormat sdf = new SimpleDateFormat(DatePattern.NORM_TIME_PATTERN);                jsonGenerator.writeString(sdf.format(time));            &#125;        &#125;);        // ååºåˆ—åŒ–        module.addDeserializer(LocalDateTime.class, new JsonDeserializer&lt;LocalDateTime&gt;() &#123;            @Override            public LocalDateTime deserialize(JsonParser jsonParser, DeserializationContext deserializationContext) throws IOException, JacksonException &#123;                return StrUtil.isEmpty(jsonParser.getText()) ? null : LocalDateTimeUtil.of(new DateTime(jsonParser.getText()));            &#125;        &#125;);        module.addDeserializer(LocalDate.class, new LocalDateDeserializer(DateTimeFormatter.ofPattern(DatePattern.NORM_DATE_PATTERN)));        module.addDeserializer(LocalTime.class, new LocalTimeDeserializer(DateTimeFormatter.ofPattern(DatePattern.NORM_TIME_PATTERN)));        module.addDeserializer(Date.class, new JsonDeserializer&lt;Date&gt;() &#123;            @Override            public Date deserialize(JsonParser jsonParser, DeserializationContext deserializationContext) throws IOException &#123;                return StrUtil.isEmpty(jsonParser.getText()) ? null : new DateTime(jsonParser.getText());            &#125;        &#125;);        module.addDeserializer(java.sql.Date.class, new JsonDeserializer&lt;java.sql.Date&gt;() &#123;            @Override            public java.sql.Date deserialize(JsonParser jsonParser, DeserializationContext deserializationContext) throws IOException &#123;                return StrUtil.isEmpty(jsonParser.getText()) ? null : new java.sql.Date(new DateTime(jsonParser.getText()).getTime());            &#125;        &#125;);        module.addDeserializer(Timestamp.class, new JsonDeserializer&lt;Timestamp&gt;() &#123;            @Override            public Timestamp deserialize(JsonParser jsonParser, DeserializationContext deserializationContext) throws IOException, JacksonException &#123;                return StrUtil.isEmpty(jsonParser.getText()) ? null : new Timestamp(new DateTime(jsonParser.getText()).getTime());            &#125;        &#125;);        module.addDeserializer(Time.class, new JsonDeserializer&lt;Time&gt;() &#123;            @Override            public Time deserialize(JsonParser jsonParser, DeserializationContext deserializationContext) throws IOException, JacksonException &#123;                return StrUtil.isEmpty(jsonParser.getText()) ? null : Time.valueOf(jsonParser.getText());            &#125;        &#125;);        // æ·»åŠ é»˜è®¤å¤„ç†        return module;    &#125;&#125;</code></pre><p>æ•ˆæœå¯ä»¥è¿”å›æ­£ç¡®çš„æ•°æ®</p><pre><code class="json">&#123;    &quot;name&quot;: &quot;test&quot;,    &quot;date&quot;: &quot;2024-07-05 08:24:36&quot;,    &quot;localDate&quot;: &quot;2024-07-05&quot;,    &quot;localDateTime&quot;: &quot;2024-07-05 16:24:36&quot;,    &quot;localTime&quot;: &quot;16:24:36&quot;,    &quot;sqlDate&quot;: &quot;2024-07-05 00:00:00&quot;,    &quot;sqlTime&quot;: &quot;16:24:36&quot;,    &quot;timestamp&quot;: &quot;2024-07-05 08:24:36&quot;&#125;</code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;æœ€è¿‘åœ¨é¡¹ç›®ä¸­é‡åˆ°äº†æ—¶é—´åºåˆ—åŒ–çš„é—®é¢˜ï¼Œæ‰€ä»¥ç ”ç©¶äº†ä¸€ä¸‹ Jackson çš„æ—¶é—´åºåˆ—åŒ–&amp;#x2F;ååºåˆ—åŒ–ï¼Œè¿™é‡Œåšä¸€ä¸ªè¯¦ç»†çš„æ€»ç»“ã€‚&lt;/p&gt;
&lt;h1</summary>
      
    
    
    
    <category term="åç«¯" scheme="http://yelog.org/categories/%E5%90%8E%E7%AB%AF/"/>
    
    
    <category term="java" scheme="http://yelog.org/tags/java/"/>
    
    <category term="translation" scheme="http://yelog.org/tags/translation/"/>
    
  </entry>
  
  <entry>
    <title>2024å¹´MacOSç»ˆç«¯å¤§æ¯”æ‹¼</title>
    <link href="http://yelog.org/2024/06/23/macos-terminal/"/>
    <id>http://yelog.org/2024/06/23/macos-terminal/</id>
    <published>2024-06-23T07:54:00.000Z</published>
    <updated>2024-08-12T09:33:11.893Z</updated>
    
    <content type="html"><![CDATA[<h2 id="æœ€æµè¡Œçš„ç»ˆç«¯"><a href="#æœ€æµè¡Œçš„ç»ˆç«¯" class="headerlink" title="æœ€æµè¡Œçš„ç»ˆç«¯"></a>æœ€æµè¡Œçš„ç»ˆç«¯</h2><h2 id="æ¨ªè¯„"><a href="#æ¨ªè¯„" class="headerlink" title="æ¨ªè¯„"></a>æ¨ªè¯„</h2><p>| capability | Kitty | Alacritty | WezTerm | iTerm2 | Native |<br>| â€”-       | â€”-  | â€”-      | â€”-    | â€”-   |        |<br>| key-bind   |       |           |         |        |        |</p><h2 id="log"><a href="#log" class="headerlink" title="log"></a>log</h2><h3 id="2024-06-27"><a href="#2024-06-27" class="headerlink" title="2024-06-27"></a>2024-06-27</h3><blockquote><p>æ”¾å¼ƒ <code>Kitty</code> -&gt; è½¬ä¸º <code>WezTerm</code></p></blockquote><p><code>Kitty</code> ç»‘å®š <code>cmd-shift-f</code> åœ¨ tmux ä¸‹æ— æ³•ä½¿ç”¨ï¼Œ ä¸”æ²¡æœ‰ <code>vim-mode</code></p><h3 id="2024-06-26"><a href="#2024-06-26" class="headerlink" title="2024-06-26"></a>2024-06-26</h3><blockquote><p>æ”¾å¼ƒä½¿ç”¨ <code>Alacritty</code> -&gt; è½¬ä¸º <code>Kitty</code></p></blockquote><p>å› ä¸ºåœ¨ <code>vim</code> çš„ <code>normal</code> æ¨¡å¼ä¸‹, å¦‚æœæ˜¯ä¸­æ–‡è¾“å…¥æ³•, è¾“å…¥çš„å†…å®¹ä¼šå‡ºç°åœ¨è¾“å…¥æ³•çš„å€™é€‰æ¡†å†…, ç„¶åæŒ‰ <code>&lt;CAPS&gt;</code> æŒ‰é”®åˆ‡æ¢è¾“å…¥æ³•, å€™é€‰æ¡†ä¸­çš„è¾“å…¥çš„å­—æ¯, ä¼šä»¥ insert çš„æ–¹å¼è¾“å‡ºåˆ°å…‰æ ‡æ‰€åœ¨çš„ä½ç½®, è¿™ä¸ªé—®é¢˜åœ¨ <code>WezTerm</code> å’Œ <code>Kitty</code> ä¸­æ²¡æœ‰å‡ºç°.</p><blockquote><p>æ³¨æ„: <code>Kitty</code> çš„ <code>map cmd+1 send_key cmd+1</code> èƒ½å¤Ÿæ­£å¸¸æ˜ å°„åˆ° <code>NeoVim</code> ä¸­è¿›è¡Œ <code>maps.n[&quot;&lt;D-1&gt;&quot;] = &#123; &quot;&lt;cmd&gt;Neotree left toggle&lt;cr&gt;&quot;, desc = &quot;Toggle Explorer&quot; &#125;</code> ç»‘å®š, ä½†æ˜¯å¼€å¯ tmux å, <code>cmd+1</code> æ˜ å°„åˆ° <code>NeoVim</code> ä¸­å°±ä¸è¡Œäº†</p></blockquote><h3 id="2024-06-20"><a href="#2024-06-20" class="headerlink" title="2024-06-20"></a>2024-06-20</h3><blockquote><p>æ”¾å¼ƒ <code>WezTerm</code> -&gt; è½¬ä¸º <code>Alacritty</code></p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;æœ€æµè¡Œçš„ç»ˆç«¯&quot;&gt;&lt;a href=&quot;#æœ€æµè¡Œçš„ç»ˆç«¯&quot; class=&quot;headerlink&quot; title=&quot;æœ€æµè¡Œçš„ç»ˆç«¯&quot;&gt;&lt;/a&gt;æœ€æµè¡Œçš„ç»ˆç«¯&lt;/h2&gt;&lt;h2 id=&quot;æ¨ªè¯„&quot;&gt;&lt;a href=&quot;#æ¨ªè¯„&quot; class=&quot;headerlink&quot; title=&quot;æ¨ªè¯„&quot;&gt;&lt;</summary>
      
    
    
    
    <category term="å·¥å…·" scheme="http://yelog.org/categories/%E5%B7%A5%E5%85%B7/"/>
    
    <category term="è½¯ä»¶è®°å½•" scheme="http://yelog.org/categories/%E5%B7%A5%E5%85%B7/%E8%BD%AF%E4%BB%B6%E8%AE%B0%E5%BD%95/"/>
    
    
    <category term="mac" scheme="http://yelog.org/tags/mac/"/>
    
    <category term="efficiency" scheme="http://yelog.org/tags/efficiency/"/>
    
    <category term="terminal" scheme="http://yelog.org/tags/terminal/"/>
    
  </entry>
  
  <entry>
    <title>ç¦»çº¿å®‰è£…Home Assistant</title>
    <link href="http://yelog.org/2024/03/22/home-assistant/"/>
    <id>http://yelog.org/2024/03/22/home-assistant/</id>
    <published>2024-03-22T01:05:44.000Z</published>
    <updated>2024-08-12T09:33:12.274Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æœ€è¿‘æ¬åˆ°äº†æ–°å®¶ï¼Œå®¶é‡Œçš„æ™ºèƒ½è®¾å¤‡ä¹Ÿè¶Šæ¥è¶Šå¤š, å¼•å…¥å¾ˆå¤šç±³å®¶è®¾å¤‡, ä½†åšä¸»ä½¿ç”¨çš„æ˜¯è‹¹æœç”Ÿæ€, éœ€è¦å°†è¿™äº›ä¸æ”¯æŒ <code>homekit</code> çš„ç±³å®¶è®¾å¤‡æ¥å…¥åˆ° <code>homekit</code> ä¸­, ç»è¿‡è°ƒç ”å‘ç° <code>Home Assistant</code> æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©, æœ¬æ–‡ä¼šä»‹ç»è”ç½‘å®‰è£…çš„è¿‡ç¨‹, å¹¶ä¸”å¦‚æœæœ‰éœ€è¦è”ç½‘çš„æ­¥éª¤, ä¹Ÿä¼šæä¾›<strong>ç¦»çº¿å®‰è£…</strong>çš„æ–¹æ³•.</p><p>æœ¬ç¯‡ä¸»è¦ä»‹ç»é€šè¿‡ <code>docker</code> éƒ¨ç½²çš„æ–¹å¼</p><h2 id="å®‰è£…-Docker"><a href="#å®‰è£…-Docker" class="headerlink" title="å®‰è£… Docker"></a>å®‰è£… Docker</h2><p>å¦‚å·²æœ‰ <code>docker</code> ç¯å¢ƒ, å¯ä»¥è·³è¿‡è¿™ä¸€æ­¥</p><pre><code class="bash">sudo apt-get updatesudo </code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;æœ€è¿‘æ¬åˆ°äº†æ–°å®¶ï¼Œå®¶é‡Œçš„æ™ºèƒ½è®¾å¤‡ä¹Ÿè¶Šæ¥è¶Šå¤š, å¼•å…¥å¾ˆå¤šç±³å®¶è®¾å¤‡, ä½†åšä¸»ä½¿ç”¨çš„æ˜¯è‹¹æœç”Ÿæ€, éœ€è¦å°†è¿™äº›ä¸æ”¯æŒ &lt;code&gt;homekit&lt;/c</summary>
      
    
    
    
    <category term="å·¥å…·" scheme="http://yelog.org/categories/%E5%B7%A5%E5%85%B7/"/>
    
    <category term="IOT" scheme="http://yelog.org/categories/%E5%B7%A5%E5%85%B7/IOT/"/>
    
    
    <category term="home-assistant" scheme="http://yelog.org/tags/home-assistant/"/>
    
    <category term="iot" scheme="http://yelog.org/tags/iot/"/>
    
  </entry>
  
  <entry>
    <title>K8s-å†…éƒ¨åŸ¹è®­</title>
    <link href="http://yelog.org/2024/02/05/k8s-inner-training/"/>
    <id>http://yelog.org/2024/02/05/k8s-inner-training/</id>
    <published>2024-02-05T01:17:27.000Z</published>
    <updated>2024-08-12T09:33:11.385Z</updated>
    
    <content type="html"><![CDATA[<h1 id="K8s-å†…éƒ¨åŸ¹è®­"><a href="#K8s-å†…éƒ¨åŸ¹è®­" class="headerlink" title="K8s å†…éƒ¨åŸ¹è®­"></a>K8s å†…éƒ¨åŸ¹è®­</h1><h2 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h2><p>K8s ä¸º Kubernetes çš„ç®€ç§°, æ˜¯ä¸€ä¸ªå¼€æºçš„<strong>å®¹å™¨ç¼–æ’</strong>å¹³å°, æœ€åˆæ˜¯ç”± Google å·¥ç¨‹å¸ˆå¼€å‘å’Œè®¾è®¡çš„, åäº 2015 å¹´æèµ ç»™äº†<a href="https://www.cncf.io/">äº‘åŸç”Ÿè®¡ç®—æœºåŸºé‡‘ä¼š-CNCF</a></p><h3 id="åº”ç”¨æœåŠ¡ç®¡ç†å‘å±•å²"><a href="#åº”ç”¨æœåŠ¡ç®¡ç†å‘å±•å²" class="headerlink" title="åº”ç”¨æœåŠ¡ç®¡ç†å‘å±•å²"></a>åº”ç”¨æœåŠ¡ç®¡ç†å‘å±•å²</h3><p>æ—©æœŸæœåŠ¡åº”ç”¨å¤§å¤šä»¥å•åŒ…çš„å½¢å¼è¿è¡Œåœ¨æœåŠ¡å™¨ä¸Š, å½“æˆ‘ä»¬å¢åŠ ä¸€äº›æœåŠ¡æ—¶, æ¯”å¦‚æ·»åŠ  <code>JOB</code> åº”ç”¨æ—¶, æˆ‘ä»¬ä¼šå¦å¼€ä¸€ä¸ªæ–°çš„åº”ç”¨, ä½†åŸºæœ¬ç”¨ä¸€å°æœåŠ¡å™¨ä¸Šå°±èƒ½å®Œæˆ</p><p>æ‰€ä»¥æˆ‘ä»¬æ—©æœŸåº”ç”¨çš„å‘å±•å°±å¦‚ä¸‹é¢å›¾è¡¨æ‰€ç¤º, ç”±äºç”¨æˆ·æ•°é‡è¾ƒå°‘, æ‰€ä»¥æ›´æ–°åº”ç”¨æ—¶çŸ­æš‚çš„æš‚åœæœåŠ¡ä¹Ÿæ˜¯å¯ä»¥æ¥å—çš„</p><div style="display: none">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€**çŸ³å™¨æ—¶ä»£**â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€**çŸ³å™¨æ—¶ä»£**â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€**çŸ³å™¨æ—¶ä»£**â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€`Server1`â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚     â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€`Server1`â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚     â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€`Server1`â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚â”‚ â”‚             â”Œâ”€â”€â˜•â”€â”€â”                â”‚ â”‚     â”‚ â”‚        â”Œâ”€â”€â˜•â”€â”€â”   â”Œâ”€â”€â˜•â”€â”€â”          â”‚ â”‚     â”‚ â”‚ â”Œâ”€â”€â˜•â”€â”€â”     â”Œâ”€â”€â˜•â”€â”€â”     â”Œâ”€â”€â˜•â”€â”€â”  â”‚ â”‚â”‚ â”‚             â”‚ APP1 â”‚                â”‚ â”‚     â”‚ â”‚        â”‚ APP1 â”‚   â”‚ APP2 â”‚          â”‚ â”‚     â”‚ â”‚ â”‚ APP1 â”‚     â”‚ APP2 â”‚     â”‚ APP3 â”‚  â”‚ â”‚â”‚ â”‚             â””â”€â”€â”€â”€â”€â”€â”˜                â”‚ â”‚ ==> â”‚ â”‚        â””â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”˜          â”‚ â”‚ ==> â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚     â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚     â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚â”‚ â”‚ å®‰è£…: JDK8, Tomcat, éœ€è¦æ‰‹åŠ¨å¯åŠ¨æœåŠ¡â”‚ â”‚     â”‚ â”‚ å®‰è£…: JDK8, Tomcat, éœ€è¦æ‰‹åŠ¨å¯åŠ¨æœåŠ¡â”‚ â”‚     â”‚ â”‚ å®‰è£…: JDK8, Tomcat, éœ€è¦æ‰‹åŠ¨å¯åŠ¨æœåŠ¡â”‚ â”‚â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚     â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚     â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</div><p><img src="https://cdn.jsdelivr.net/gh/yelog/assets/images/202402051408786.png"></p><p>éšç€ç”¨æˆ·æ•°é‡çš„ä¸Šå‡, åº”ç”¨çš„å¹¶å‘ä¹Ÿéšä¹‹æé«˜, å•å°æœåŠ¡å™¨çš„å‹åŠ›ä¹Ÿéšä¹‹å¢å¤§, æœ‰äº†å¦‚ä¸‹æƒ…å†µ:</p><ol><li>é«˜å³°æœŸç»å¸¸å‡ºç°å¡é¡¿</li><li>æ›´æ–°åº”ç”¨æ—¶çš„æš‚åœæœåŠ¡å·²ç»ä¸å¯æ¥å—</li><li>åœ¨æœåŠ¡å™¨å‡ºç°æ•…éšœæ—¶çš„é«˜å¯ç”¨æœ‰äº†æ›´é«˜çš„è¦æ±‚</li></ol><p>ä¸ºäº†è§£å†³ä¸Šé¢çš„é—®é¢˜, æˆ‘ä»¬å°±è¿›å…¥äº†ä¸‹ä¸ªæ—¶ä»£(ä¸‹å›¾ä¸€), é‡‡è´­å¤šå°æœåŠ¡å™¨, å¯¹åº”ç”¨è¿›è¡Œæ”¯æŒé›†ç¾¤çš„æ”¹é€ , è¿™æ—¶æˆ‘ä»¬çš„åº”ç”¨åˆ†åˆ«åœ¨ä¸‰å°æœåŠ¡å™¨ä¸Š, å¹¶å‘èƒ½åŠ›æé«˜äº†3å€, å¹¶ä¸”å†—ç¾èƒ½åŠ›å¤§å¹…æå‡</p><p>å°½ç®¡æˆ‘ä»¬è§£å†³äº†ä¸Šé¢çš„é—®é¢˜, ä½†æ˜¯å¸¦æ¥äº†æ–°çš„é—®é¢˜, å› ä¸ºæœåŠ¡å™¨æ•°é‡è¿‡å¤š, åœ¨å®‰è£…åº”ç”¨éœ€è¦çš„å·¥å…·å¦‚ JDKã€Tomcatã€Nodeã€Nginxã€Redis ç­‰ç­‰, å¯èƒ½ä¼šå› ä¸ºå®‰è£…ç‰ˆæœ¬å’ŒæœåŠ¡å™¨ç³»ç»Ÿç‰ˆæœ¬ä¸ä¸€è‡´å¯¼è‡´åº”ç”¨è¿è¡Œå¤±è´¥</p><p>æ‰€ä»¥ä¼šåœ¨ç¯å¢ƒå®‰è£…ä¸­æµªè´¹å¤ªå¤šæ—¶é—´, æ‰€ä»¥å¾ˆå¤šä¼ä¸šå¼€å§‹å¼•å…¥å¦‚ <code>Docker</code> çš„è™šæ‹ŸåŒ–æŠ€æœ¯(ä¸‹å›¾äºŒ), ç”¨æ¥è§£å†³ç¯å¢ƒä¸ä¸€è‡´çš„é—®é¢˜, å¹¶ä¸”ä¸€å¹¶è§£å†³äº†å®ˆæŠ¤è¿›ç¨‹, å¼€æœºå¯åŠ¨ç­‰é—®é¢˜</p><p>è¿™æ—¶æˆ‘ä»¬é€šè¿‡ <code>docker-compose</code> æŠ€æœ¯, å‡çº§åº”ç”¨ã€è°ƒæ•´é…ç½®ç›¸æ¯”ä»¥å‰å¤§å¤§ç®€åŒ–, ä½†æ˜¯éšç€åº”ç”¨è§„æ¨¡çš„æ‰©å¤§, å¯¹åº”ç”¨é«˜å¯ç”¨æœ‰äº†æ›´é«˜çš„è¦æ±‚, çº·çº·å¼€å§‹è¿›è¡Œå¾®æœåŠ¡æ‹†åˆ†, åº”ç”¨æ•°é‡å’ŒæœåŠ¡å™¨æ•°é‡è¶Šæ¥è¶Šå¤š, æœåŠ¡çš„è¿ç»´ç®¡ç†è¶Šæ¥è¶Šå¤æ‚ã€</p><p>å¤§å®¶å¼€å§‹å¼€å‘å„ç§é›†ç¾¤ç®¡ç†, è®©å¤§å®¶å¯ä»¥åœ¨ä¸€ä¸ªåœ°æ–¹å¹¶ä¸”å¯è§†åŒ–çš„ç®¡ç†é›†ç¾¤ä¸­çš„æ‰€æœ‰ <code>Docker</code>, ä»¥ Google å¼€æºçš„ Kubernetes åšçš„æœ€åŠŸèƒ½å®Œå–„ä¸”çµæ´»å¯é…ç½®, ä»è€Œå¼€å§‹çˆ†ç«.</p><p>äºæ˜¯ä¼—å¤šä¼ä¸šå¼€å§‹ä¸ŠK8s(ä¸‹å›¾ä¸‰), ä¸ä»…è§£å†³è¿ç»´å¤æ‚çš„é—®é¢˜, è€Œä¸”å¸¦æ¥äº†æ›´å¤šæ›´å¥½çš„ç‰¹æ€§:</p><ol><li>æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡</li><li>å­˜å‚¨ç¼–æ’</li><li>è‡ªåŠ¨éƒ¨ç½²å’Œå›æ»š</li><li>è‡ªæˆ‘ä¿®å¤</li><li>å¯†é’¥å’Œé…ç½®ç®¡ç†</li></ol><div style="display: block">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€**å†œè€•æ–‡æ˜**â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€**å·¥ä¸šæ–‡æ˜**â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€**ä¿¡æ¯æ–‡æ˜**â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€`Server1`â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚     â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€`Server1`â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚     â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€`K8s é›†ç¾¤`â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚â”‚ â”‚ â”Œâ”€â”€â˜•â”€â”€â”     â”Œâ”€â”€â˜•â”€â”€â”     â”Œâ”€â”€â˜•â”€â”€â”  â”‚ â”‚     â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€ğŸ³â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€ğŸ³â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€ğŸ³â”€â”€â”€â”€â”â”‚ â”‚     â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€ğŸ³â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€ğŸ³â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€ğŸ³â”€â”€â”€â”€â”â”‚ â”‚â”‚ â”‚ â”‚ APP1 â”‚     â”‚ APP2 â”‚     â”‚ APP3 â”‚  â”‚ â”‚     â”‚ â”‚ â”‚   APP1    â”‚â”‚   APP2    â”‚â”‚   APP3    â”‚â”‚ â”‚     â”‚ â”‚ â”‚   POD1    â”‚â”‚   POD2    â”‚â”‚   POD3    â”‚â”‚ â”‚â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚     â”‚ â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚ â”‚     â”‚ â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚ â”‚â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚     â”‚ â”‚ â”‚JDK8/Tomcatâ”‚â”‚JDK8/Tomcatâ”‚â”‚JDK8/Tomcatâ”‚â”‚ â”‚     â”‚ â”‚ â”‚JDK8/Tomcatâ”‚â”‚JDK8/Tomcatâ”‚â”‚JDK8/Tomcatâ”‚â”‚ â”‚â”‚ â”‚ å®‰è£…: JDK8, Tomcat, éœ€è¦æ‰‹åŠ¨å¯åŠ¨æœåŠ¡â”‚ â”‚     â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â”‚     â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â”‚â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚     â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚     â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€ğŸ³â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€ğŸ³â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€ğŸ³â”€â”€â”€â”€â”â”‚ â”‚â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€`Server2`â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚     â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€`Server1`â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚     â”‚ â”‚ â”‚   POD4    â”‚â”‚   POD5    â”‚â”‚   POD6    â”‚â”‚ â”‚â”‚ â”‚ â”Œâ”€â”€â˜•â”€â”€â”     â”Œâ”€â”€â˜•â”€â”€â”     â”Œâ”€â”€â˜•â”€â”€â”  â”‚ â”‚     â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€ğŸ³â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€ğŸ³â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€ğŸ³â”€â”€â”€â”€â”â”‚ â”‚     â”‚ â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚ â”‚â”‚ â”‚ â”‚ APP1 â”‚     â”‚ APP2 â”‚     â”‚ APP3 â”‚  â”‚ â”‚     â”‚ â”‚ â”‚   APP1    â”‚â”‚   APP2    â”‚â”‚   APP3    â”‚â”‚ â”‚     â”‚ â”‚ â”‚JDK8/Tomcatâ”‚â”‚JDK8/Tomcatâ”‚â”‚JDK8/Tomcatâ”‚â”‚ â”‚â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚ ==> â”‚ â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚ â”‚ ==> â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â”‚â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚     â”‚ â”‚ â”‚JDK8/Tomcatâ”‚â”‚JDK8/Tomcatâ”‚â”‚JDK8/Tomcatâ”‚â”‚ â”‚     â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€ğŸ³â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€ğŸ³â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€ğŸ³â”€â”€â”€â”€â”â”‚ â”‚â”‚ â”‚ å®‰è£…: JDK8, Tomcat, éœ€è¦æ‰‹åŠ¨å¯åŠ¨æœåŠ¡â”‚ â”‚     â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â”‚     â”‚ â”‚ â”‚   POD7    â”‚â”‚   POD8    â”‚â”‚   POD9    â”‚â”‚ â”‚â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚     â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚     â”‚ â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚ â”‚â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€`Server3`â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚     â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€`Server1`â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚     â”‚ â”‚ â”‚JDK8/Tomcatâ”‚â”‚JDK8/Tomcatâ”‚â”‚JDK8/Tomcatâ”‚â”‚ â”‚â”‚ â”‚ â”Œâ”€â”€â˜•â”€â”€â”     â”Œâ”€â”€â˜•â”€â”€â”     â”Œâ”€â”€â˜•â”€â”€â”  â”‚ â”‚     â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€ğŸ³â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€ğŸ³â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€ğŸ³â”€â”€â”€â”€â”â”‚ â”‚     â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â”‚â”‚ â”‚ â”‚ APP1 â”‚     â”‚ APP2 â”‚     â”‚ APP3 â”‚  â”‚ â”‚     â”‚ â”‚ â”‚   APP1    â”‚â”‚   APP2    â”‚â”‚   APP3    â”‚â”‚ â”‚     â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚     â”‚ â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚ â”‚     â”‚ â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”         â”‚ â”‚â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚     â”‚ â”‚ â”‚JDK8/Tomcatâ”‚â”‚JDK8/Tomcatâ”‚â”‚JDK8/Tomcatâ”‚â”‚ â”‚     â”‚ â”‚  â”‚Server1â”‚ â”‚Server2â”‚ â”‚Server3â”‚ â€¢â€¢â€¢     â”‚ â”‚â”‚ â”‚ å®‰è£…: JDK8, Tomcat, éœ€è¦æ‰‹åŠ¨å¯åŠ¨æœåŠ¡â”‚ â”‚     â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â”‚     â”‚ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ â”‚â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚     â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚     â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚ ä¼˜ç‚¹: èŠ‚çœèµ„æº, éœ€è¦æŒæ¡çš„çŸ¥è¯†è¾ƒå°‘      â”‚     â”‚ ä¼˜ç‚¹: ç¯å¢ƒæ­å»ºå®¹æ˜“, å®‰è£…Dockerå’Œé…ç½®æ–‡ä»¶   â”‚     â”‚ ä¼˜ç‚¹: è‡ªåŠ¨æ•…éšœæ¢å¤, ç›‘æ§å®Œå–„, æ“ä½œæ–¹ä¾¿     â”‚â”‚ ç¼ºç‚¹: è¿ç»´æ“ä½œç¹æ‚, JDKç‰ˆæœ¬éš¾ä»¥ç»Ÿä¸€     â”‚     â”‚ ç¼ºç‚¹: éšç€è§„æ¨¡æ‰©å¤§, æ—¥å¸¸è¿ç»´ä¹Ÿå˜å¾—ç¹æ‚     â”‚     â”‚ ç¼ºç‚¹: k8s åŠŸèƒ½è¾ƒå¤š, éœ€è¦æŒæ¡çš„çŸ¥è¯†ä¹Ÿå¤š     â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                å›¾ä¸€                                               å›¾äºŒ                                                å›¾ä¸‰</div><p><img src="https://cdn.jsdelivr.net/gh/yelog/assets/images/202402051410212.png"></p><h3 id="Kubernetes-ç»„ä»¶"><a href="#Kubernetes-ç»„ä»¶" class="headerlink" title="Kubernetes ç»„ä»¶"></a>Kubernetes ç»„ä»¶</h3><p><img src="https://cdn.jsdelivr.net/gh/yelog/assets/images/202402051554610.png" alt="Kubernetes å„ç»„ä»¶"></p><ul><li><code>Control Plane Components</code>: æ§åˆ¶å¹³é¢ç»„ä»¶<ul><li><code>kube-apiserver</code>: è´Ÿè´£å…¬å¼€ Kubernetes API, å¤„ç†è¯·æ±‚, ç±»ä¼¼ cloud ä¸­çš„ç½‘å…³</li><li><code>etcd</code>: key-value å­˜å‚¨, ç”¨äºä¿å­˜é›†ç¾¤æ•°æ®</li><li><code>kube-scheduler</code>: ä»»åŠ¡è°ƒåº¦, ç›‘å¬æœ‰æ–°åˆ›å»ºä½†æœªè¿è¡Œçš„pods, é€‰æ‹©èŠ‚ç‚¹æ¥è®© pod åœ¨ä¸Šé¢è¿è¡Œ</li><li><code>kube-controller-manager</code>: è´Ÿè´£è¿è¡Œæ§åˆ¶å™¨è¿›ç¨‹, æœ‰å¦‚ä¸‹ä¸åŒç±»å‹çš„æ§åˆ¶å™¨<ul><li><code>Node Controller</code>: èŠ‚ç‚¹æ§åˆ¶å™¨, è´Ÿè´£èŠ‚ç‚¹å‡ºç°æ•…éšœæ—¶è¿›è¡Œé€šçŸ¥å’Œå“åº”</li><li><code>Job Controller</code>: ä»»åŠ¡æ§åˆ¶å™¨, æ£€æµ‹ä»£è¡¨ä¸€æ¬¡æ€§ä»»åŠ¡çš„ Job å¯¹è±¡, ç„¶ååˆ›å»º Pod æ¥è¿è¡Œè¿™äº›ä»»åŠ¡ç›´è‡³å®Œæˆ</li><li><code>EndpointSlice Controller</code>: ç«¯ç‚¹åˆ†ç‰‡æ§åˆ¶å™¨, æä¾› Service å’Œ Pod ä¹‹é—´çš„é“¾æ¥</li><li><code>ServiceAccount Controller</code>: ä¸ºæ–°çš„å‘½åç©ºé—´åˆ›å»ºé»˜è®¤çš„æœåŠ¡è´¦å·</li></ul></li><li><code>cloud-controller-manager</code>: äº‘æ§åˆ¶ç®¡ç†å™¨, é›†æˆäº‘æä¾›å•†çš„API, æˆ‘ä»¬å†…ç½‘éƒ¨ç½²çš„ç”¨ä¸åˆ°</li></ul></li><li><code>Node Components</code>: èŠ‚ç‚¹ç»„ä»¶, è¿è¡Œåœ¨å„ä¸ªèŠ‚ç‚¹, è´Ÿè´£ç»´æŠ¤è¿è¡Œçš„ Pod, æä¾› Kubernetes çš„è¿è¡Œç¯å¢ƒ<ul><li><code>kubelet</code>: åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸­è¿è¡Œ, ä¿è¯å®¹å™¨éƒ½è¿è¡Œåœ¨ Pod ä¸­, kubelet æ¥å—ä¸€ç»„ PodSpec, ç¡®ä¿ PodSpec ä¸­æè¿°çš„å®¹å™¨å¤„äºè¿è¡ŒçŠ¶æ€ä¸”å¥åº·</li><li><code>kube-proxy</code>: ç½‘ç»œä»£ç†, æ˜¯å®ç° Service çš„ä¸€éƒ¨åˆ†</li><li><code>Container Runtime</code>: å®¹å™¨è¿è¡Œæ—¶, Kubernetes æ”¯æŒéœ€è¦å®¹å™¨è¿è¡Œç¯å¢ƒ, ä¾‹å¦‚: docker, containerd, CRI-O</li></ul></li><li><code>Addons</code>: æ’ä»¶, æä¾›é›†ç¾¤çº§åˆ«çš„åŠŸèƒ½, æ’ä»¶æä¾›çš„èµ„æºå±äº kube-system å‘½åç©ºé—´<ul><li><code>DNS</code>: æä¾›é›†ç¾¤å†…çš„åŸŸåç³»ç»Ÿ</li><li><code>Web UI/Dashboard</code>: é€šç”¨çš„åŸºäº Web çš„ç”¨æˆ·ç•Œé¢, å®ƒä½¿ç”¨æˆ·å¯ä»¥é›†ä¸­ç®¡ç†é›†ç¾¤ä¸­çš„åº”ç”¨å·²ç»é›†ç¾¤æœ¬èº«</li><li><code>Container Resource Monitoring</code>: å°†å®¹å™¨çš„ä¸€äº›å¸¸è§çš„æ—¶é—´åºåˆ—åº¦é‡å€¼ä¿å­˜åˆ°ä¸€ä¸ªé›†ä¸­çš„æ•°æ®åº“ä¸­, å¹¶æä¾›æµè§ˆè¿™äº›æ•°æ®çš„ç•Œé¢</li><li><code>Cluster-level Logging</code>: é›†ç¾¤çº§æ—¥å¿—, å°†å®¹å™¨æ—¥å¿—ä¿å­˜åˆ°ä¸€ä¸ªé›†ä¸­çš„æ—¥å¿—å­˜å‚¨ä¸­, è¿™ç§é›†ä¸­æ—¥å¿—å­˜å‚¨æä¾›æœç´¢å’Œæµè§ˆæ¥å£</li><li><code>Network Plugins</code>: ç½‘ç»œæ’ä»¶, å®ç°å®¹å™¨ç½‘ç»œæ¥å£(CNI)è§„èŒƒçš„è½¯ä»¶ç»„ä»¶, è´Ÿè´£ä¸º Pod åˆ†é… IP åœ°å€, å¹¶ä½¿è¿™äº› Pod èƒ½åœ¨é›†ç¾¤å†…éƒ¨äº’ç›¸é€šä¿¡</li></ul></li></ul><h3 id="Kubernetes-æ¶æ„"><a href="#Kubernetes-æ¶æ„" class="headerlink" title="Kubernetes æ¶æ„"></a>Kubernetes æ¶æ„</h3><p><img src="https://cdn.jsdelivr.net/gh/yelog/assets/images/202402051553913.png"></p><h4 id="Node-èŠ‚ç‚¹"><a href="#Node-èŠ‚ç‚¹" class="headerlink" title="Node èŠ‚ç‚¹"></a>Node èŠ‚ç‚¹</h4><p>Kubernetes é€šè¿‡å°†å®¹å™¨æ”¾å…¥åœ¨èŠ‚ç‚¹(Node) ä¸Šè¿è¡Œçš„ Pod æ¥æ‰§è¡Œä½ çš„è´Ÿè½½. èŠ‚ç‚¹å¯ä»¥æ˜¯ä¸€ä¸ªè™šæ‹Ÿæœºæˆ–ç‰©ç†æœº, æ¯ä¸ªèŠ‚ç‚¹åŒ…å« Pod æ‰€éœ€çš„æœåŠ¡å™¨, è¿™äº›èŠ‚ç‚¹ç”± <code>Control Plane</code> è´Ÿè´£ç®¡ç†</p><p>ä¸€ä¸ªé›†ç¾¤çš„èŠ‚ç‚¹æ•°é‡å¯ä»¥æ˜¯1ä¸ª, ä¹Ÿå¯ä»¥æ˜¯å¤šä¸ª. ä¸”èŠ‚ç‚¹åç§°æ˜¯å”¯ä¸€çš„.</p><p>å¯ä»¥é€šè¿‡ <code>kubectl</code> æ¥åˆ›å»ºå’Œä¿®æ”¹ Node å¯¹è±¡</p><pre><code class="bash"># æŸ¥ä¸€ä¸‹é›†ç¾¤ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹ä¿¡æ¯kubectl get node# æŸ¥çœ‹æŸä¸ªèŠ‚ç‚¹è¯¦ç»†ä¿¡æ¯kubectl descibe $NODENAME# æ ‡è®°ä¸€ä¸ª Node ä¸ºä¸å¯è°ƒåº¦kubectl cordon $NODENAME</code></pre><h4 id="Controllers-æ§åˆ¶å™¨"><a href="#Controllers-æ§åˆ¶å™¨" class="headerlink" title="Controllers æ§åˆ¶å™¨"></a>Controllers æ§åˆ¶å™¨</h4><p>åœ¨æœºå™¨äººå’Œè‡ªåŠ¨åŒ–é¢†åŸŸ, åˆä¸€ä¸ªç±»ä¼¼çš„æ¦‚å¿µå«æ§åˆ¶å›è·¯ (Control Loop), ç”¨äºè°ƒèŠ‚ç³»ç»ŸçŠ¶æ€, å¦‚: æˆ¿é—´é‡Œçš„æ¸©åº¦è‡ªåŠ¨è°ƒèŠ‚å™¨</p><p>å½“ä½ è®¾ç½®äº†æ¸©åº¦, æ¸©åº¦è‡ªåŠ¨è°ƒèŠ‚å™¨è®©å…¶å½“å‰çŠ¶æ€æ¥è¿‘æœŸæœ›æ¸©åº¦; åœ¨ Kubernetes ä¸­, æ§åˆ¶å™¨é€šè¿‡ç›‘æ§é›†ç¾¤çš„å…¬å…±çŠ¶æ€, <strong>å¹¶è‡´åŠ›äºå°†å½“å‰çš„çŠ¶æ€è½¬ä¸ºæœŸæœ›çŠ¶æ€</strong></p><p>æ§åˆ¶å™¨æ˜¯é€šè¿‡é€šçŸ¥ <code>apiserver</code> æ¥ç®¡ç†çŠ¶æ€çš„, å°±åƒæ¸©åº¦è‡ªåŠ¨è°ƒèŠ‚å™¨æ˜¯é€šè¿‡æ§åˆ¶ç©ºè°ƒæ¥è°ƒèŠ‚æ°”æ¸©çš„</p><h4 id="Container-Runtime-Interface-CRI-å®¹å™¨è¿è¡Œæ—¶æ¥å£"><a href="#Container-Runtime-Interface-CRI-å®¹å™¨è¿è¡Œæ—¶æ¥å£" class="headerlink" title="Container Runtime Interface&#x2F;CRI å®¹å™¨è¿è¡Œæ—¶æ¥å£"></a>Container Runtime Interface&#x2F;CRI å®¹å™¨è¿è¡Œæ—¶æ¥å£</h4><p>CRI æ˜¯ä¸€ä¸ªæ’ä»¶æ¥å£, å®ƒä½¿ kubelet èƒ½å¤Ÿä½¿ç”¨å„ç§å®¹å™¨è¿è¡Œæ—¶, å®šä¹‰äº†ä¸»è¦ gRPC åè®®, ç”¨äºèŠ‚ç‚¹ç»„ä»¶ kubelet å’Œå®¹å™¨è¿è¡Œæ—¶ä¹‹é—´çš„é€šä¿¡</p><h3 id="Containers-å®¹å™¨"><a href="#Containers-å®¹å™¨" class="headerlink" title="Containers å®¹å™¨"></a>Containers å®¹å™¨</h3><p><strong>å®¹å™¨</strong>å°†åº”ç”¨ä»åº•å±‚ä¸»æœºè®¾å¤‡ä¸­è§£è€¦, è¿™ä½¿å¾—åœ¨ä¸åŒçš„äº‘æˆ– OS ç¯å¢ƒä¸­éƒ¨ç½²æ›´åŠ å®¹æ˜“</p><p>Kubernetes é›†ç¾¤ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½ä¼šè¿è¡Œå®¹å™¨, è¿™äº›å®¹å™¨æ„æˆåˆ†é…ç»™è¯¥èŠ‚ç‚¹çš„ Pod, å•ä¸ª Pod ä¸­çš„å®¹å™¨ä¼šåœ¨å…±åŒè°ƒåº¦ä¸‹, è¿è¡Œåœ¨ç›¸åŒçš„èŠ‚ç‚¹</p><p><strong>å®¹å™¨é•œåƒ</strong>æ˜¯ä¸€ä¸ªéšæ—¶å¯ä»¥è¿è¡Œçš„è½¯ä»¶åŒ…, å®ƒåŒ…å«äº†è¿è¡Œå®¹å™¨ç¨‹åºæ‰€éœ€è¦çš„ä¸€åˆ‡, ä»£ç å’Œå®ƒéœ€è¦çš„è¿è¡Œæ—¶ã€åº”ç”¨ç¨‹åºå’Œç³»ç»Ÿåº“, ä»¥åŠä¸€äº›åŸºæœ¬è®¾ç½®</p><p><strong>å®¹å™¨è¿è¡Œæ—¶</strong>è¿™ä¸ªåŸºç¡€ç»„ä»¶ä½¿ Kubernetes èƒ½å¤Ÿæœ‰æ•ˆè¿è¡Œå®¹å™¨, ä»–è´Ÿè´£ç®¡ç† Kubernetes ç¯å¢ƒä¸­çš„å®¹å™¨çš„æ‰§è¡Œå’Œç”Ÿå‘½å‘¨æœŸ</p><h3 id="Pod"><a href="#Pod" class="headerlink" title="Pod"></a>Pod</h3><p>Pod æ˜¯å¯ä»¥åœ¨ Kubernetes ä¸­åˆ›å»ºå’Œç®¡ç†çš„ã€æœ€å°çš„å¯éƒ¨ç½²è®¡ç®—å•å…ƒ</p><p>Pod æ˜¯æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨ç»„æˆ, è¿™äº›å®¹å™¨å…±äº«å­˜å‚¨ã€ç½‘ç»œã€å·²ç»æ€ä¹ˆæ ·è¿è¡Œè¿™äº›å®¹å™¨çš„å£°æ˜, ç»Ÿä¸€è°ƒåº¦.</p><p>æ­¤å¤–è¿˜å¯ä»¥åŒ…å« init container, ç”¨äºåšä¸€äº›å¯åŠ¨ä¸»åº”ç”¨å‰çš„å‡†å¤‡å·¥ä½œ, æ¯”å¦‚é€šè¿‡ init container æ³¨å…¥ tingyun ç­‰ agent åŒ…</p><p>å¦‚ä¸‹ç¤ºä¾‹, å®ƒç”±ä¸€ä¸ªè¿è¡Œé•œåƒ <code>nginx:1.14.2</code> çš„å®¹å™¨ç»„æˆ</p><pre><code class="yaml">apiVersion: v1kind: Podmetadata:  name: nginx  labels:    app: my-nginxspec:  containers:  - name: nginx    image: nginx:1.14.2    ports:    - containerPort: 80</code></pre><p>è¦åˆ›å»ºä¸Šé¢æ˜¾ç¤ºçš„ Pod, ä¿å­˜ä¸Šé¢å†…å®¹åˆ° <code>my-nginx.yaml</code>, å¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤</p><pre><code class="bash">kubectl apply -f my-nginx.yaml</code></pre><h3 id="Workloads-å·¥ä½œè´Ÿè½½"><a href="#Workloads-å·¥ä½œè´Ÿè½½" class="headerlink" title="Workloads å·¥ä½œè´Ÿè½½"></a>Workloads å·¥ä½œè´Ÿè½½</h3><p>å·¥ä½œè´Ÿè½½æ˜¯åœ¨ Kubernetes ä¸Šè¿è¡Œçš„åº”ç”¨ç¨‹åº, æ— è®ºæ˜¯åˆä¸€ä¸ªè¿˜æ˜¯å¤šä¸ªç»„ä»¶æ„æˆ, ä½ éƒ½å¯ä»¥é€šè¿‡ä¸€ç»„ Pod æ¥è¿è¡Œå®ƒ, Pod ä»£è¡¨çš„æ˜¯é›†ç¾¤ä¸Šå¤„äºè¿è¡ŒçŠ¶æ€çš„ä¸€ç»„å®¹å™¨çš„é›†åˆ, ä½†é€šå¸¸ä¸€ä¸ª Pod å†…åªè¿è¡Œä¸€ä¸ªå®¹å™¨</p><p>Kubernetes æä¾›è‹¥å¹²ç§å†…ç½®çš„å·¥ä½œè´Ÿè½½èµ„æº:</p><ul><li><code>Deployment</code> å’Œ <code>ReplicaSet</code> Deployment é€‚åˆæ— çŠ¶æ€åº”ç”¨, Deployment ä¸­çš„æ‰€æœ‰ Pod éƒ½æ˜¯äº’ç›¸ç­‰ä»·çš„</li><li><code>StatefulSet</code> æœ‰çŠ¶æ€åº”ç”¨, æ¯”å¦‚å¯ä»¥ç‹¬ç«‹æŒä¹…åŒ–æ–‡ä»¶, äº’ä¸å½±å“</li><li><code>DaemonSet</code> æä¾›èŠ‚ç‚¹æœ¬åœ°æ”¯æ’‘è®¾æ–½çš„ Pod, ä¿è¯æ¯ä¸ªèŠ‚ç‚¹ä¸Šä¸€ä¸ª</li><li><code>Job</code> å’Œ <code>CronJob</code> å®šä¹‰åªéœ€è¦æ‰§è¡Œä¸€æ¬¡å¹¶ä¸”æ‰§è¡Œåè§†ä¸ºå®Œå®Œæˆçš„ä»»åŠ¡</li></ul><h3 id="Network-ç½‘ç»œ"><a href="#Network-ç½‘ç»œ" class="headerlink" title="Network ç½‘ç»œ"></a>Network ç½‘ç»œ</h3><h4 id="Service"><a href="#Service" class="headerlink" title="Service"></a>Service</h4><p><code>Service</code> æ˜¯å°†ä¸€ä¸ªæˆ–è€…ä¸€ç»„ Pod å…¬å¼€ä»£ç†ç»™é›†ç¾¤å†…éƒ¨, ä½¿ä¹‹èƒ½å¤Ÿå„ä¸ªåº”ç”¨ä¹‹é—´é€šä¿¡, ç”šè‡³ç”¨äºå…¬å¼€åˆ°é›†ç¾¤å¤–(NodePort æˆ–è€… ä»£ç†ç»™ Ingress)</p><p>å®ƒæä¾›äº†ç±»ä¼¼åŸŸåçš„è®¿é—®æ–¹å¼, ä½¿ç”¨è€…æ— éœ€å…³å¿ƒåé¢æœ‰å¤šå°‘ä¸ª Pod åœ¨æä¾›æœåŠ¡, ä»–ä»¬æ˜¯å¦å¥åº·, ä»–ä»¬ IP æ˜¯å¦å‘ç”Ÿå˜åŒ–.</p><p>å®šä¹‰ Service</p><pre><code class="yaml">apiVersion: v1kind: Servicemetadata:  name: nginx-servicespec:  selector:    app: my-nginx  ports:  - name: name-of-service-port    protocol: TCP    port: 80    targetPort: http-web-svc</code></pre><p>æœåŠ¡ç±»å‹(type):</p><ul><li><code>ClusterIp</code>: é»˜è®¤å€¼, æ™ºèƒ½åœ¨é›†ç¾¤å†…è®¿é—®</li><li><code>NodePort</code>: ç›´æ¥å‘é›†ç¾¤å¤–æš´éœ², é€šè¿‡èŠ‚ç‚¹ç«¯å£è®¿é—®</li><li><code>LoadBalancer</code>: ä½¿ç”¨äº‘å¹³å°çš„è´Ÿè½½å‡è¡¡, Kubernetes ä¸ç›´æ¥æä¾›</li><li><code>Externalname</code>: å°†æœåŠ¡æ˜ å°„åˆ° externalName å­—æ®µçš„å†…å®¹, ä¾‹å¦‚<code>api.foo.bar.example</code></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;K8s-å†…éƒ¨åŸ¹è®­&quot;&gt;&lt;a href=&quot;#K8s-å†…éƒ¨åŸ¹è®­&quot; class=&quot;headerlink&quot; title=&quot;K8s å†…éƒ¨åŸ¹è®­&quot;&gt;&lt;/a&gt;K8s å†…éƒ¨åŸ¹è®­&lt;/h1&gt;&lt;h2 id=&quot;ä»‹ç»&quot;&gt;&lt;a href=&quot;#ä»‹ç»&quot; class=&quot;headerlink&quot; titl</summary>
      
    
    
    
    <category term="è¿ç»´" scheme="http://yelog.org/categories/%E8%BF%90%E7%BB%B4/"/>
    
    
    <category term="docker" scheme="http://yelog.org/tags/docker/"/>
    
    <category term="k8s" scheme="http://yelog.org/tags/k8s/"/>
    
  </entry>
  
  <entry>
    <title>swift ç¦»çº¿å›¾ç‰‡è¯†åˆ«æ–‡å­—(ocr)</title>
    <link href="http://yelog.org/2024/01/02/macos-ocr-swift/"/>
    <id>http://yelog.org/2024/01/02/macos-ocr-swift/</id>
    <published>2024-01-02T02:09:19.000Z</published>
    <updated>2024-08-12T09:33:12.284Z</updated>
    
    <content type="html"><![CDATA[<h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>æœ€è¿‘æ‰“ç®—å†™ä¸€ä¸ª macos ç¿»è¯‘è½¯ä»¶, éœ€è¦ç”¨åˆ° ocr å›¾åƒè¯†åˆ«, å¹¶ä¸”å› ä¸ºé€Ÿåº¦é—®é¢˜, ä¸€å¼€å§‹å°±è€ƒè™‘ä½¿ç”¨ç³»ç»Ÿçš„è‡ªå¸¦èƒ½åŠ›æ¥å®ç°.</p><p>ç»è¿‡ç¿»é˜…æ–‡æ¡£å’Œ chatgpt æ‹‰æ‰¯äº†ä¸€ä¸‹åˆ, æœ€ç»ˆæˆåŠŸå®ç°.</p><h2 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h2><p>ä»£ç é€»è¾‘ä¸º, æ¥å—å‚æ•°: å›¾ç‰‡è·¯å¾„, ç„¶åè·å–å›¾ç‰‡, é€šè¿‡ <code>VNImageRequestHandler</code> å¯¹å›¾ç‰‡è¿›è¡Œæ–‡å­—è¯†åˆ«</p><p>å¦‚ä¸‹ä»£ç å¯ä»¥ç›´æ¥æ”¾è¿›ä¸€ä¸ª <code>ocr.swift</code>, ç„¶åæ‰§è¡Œ <code>swiftc -o ocr ocr.swift</code> , åœ¨æ‰§è¡Œ <code>./ocr /Users/yelog/Desktop/3.png</code> åé¢ä¸ºä½ å®é™…çš„æœ‰æ–‡å­—çš„å›¾ç‰‡è·¯ç»</p><pre><code class="swift">////  ocr.swift//  Fast Translation////  Created by æ¨ç‰æ° on 2023/12/31.//import SwiftUIimport Visionfunc handleDetectedText(request: VNRequest?, error: Error?) &#123;    if let error = error &#123;        print(&quot;ERROR: \(error)&quot;)        return    &#125;    guard let results = request?.results, results.count &gt; 0 else &#123;        print(&quot;No text found&quot;)        return    &#125;    for result in results &#123;        if let observation = result as? VNRecognizedTextObservation &#123;            for text in observation.topCandidates(1) &#123;                let string = text.string                print(&quot;è¯†åˆ«: \(string)&quot;)            &#125;        &#125;    &#125;&#125;func ocrImage(path: String) &#123;    let cgImage = NSImage(byReferencingFile: path)?.ciImage()?.cgImage    let requestHandler = VNImageRequestHandler(cgImage: cgImage!)    let request = VNRecognizeTextRequest(completionHandler: handleDetectedText)    // è®¾ç½®æ–‡æœ¬è¯†åˆ«çš„è¯­è¨€ä¸ºè‹±æ–‡    request.recognitionLanguages = [&quot;en&quot;]    request.recognitionLevel = .accurate    do &#123;        try requestHandler.perform([request])    &#125; catch &#123;        print(&quot;Unable to perform the requests: \(error).&quot;)    &#125;&#125;extension NSImage &#123;    func ciImage() -&gt; CIImage? &#123;        guard let data = self.tiffRepresentation,              let bitmap = NSBitmapImageRep(data: data) else &#123;            return nil        &#125;        let ci = CIImage(bitmapImageRep: bitmap)        return ci    &#125;&#125;// æ‰§è¡Œå‡½æ•°ï¼Œä»å‘½ä»¤è¡Œå‚æ•°ä¸­è·å–å›¾ç‰‡çš„åœ°å€ocrImage(path: CommandLine.arguments[1])</code></pre><p>ç„¶åå‡†å¤‡å¾…è¯†åˆ«çš„æœ‰æ–‡å­—çš„å›¾ç‰‡</p><p><img src="https://cdn.jsdelivr.net/gh/yelog/assets/images/202401021353013.png" alt="å¾…è¯†åˆ«çš„å›¾ç‰‡"> </p><pre><code class="bash"># ç¼–è¯‘ swift æ–‡ä»¶swiftc -o ocr ocr.swift# æ‰§è¡Œå¹¶ä¸”ä¼ é€’å›¾ç‰‡è·¯å¾„å‚æ•°./ocr /Users/yelog/Desktop/3.png</code></pre><p><img src="https://cdn.jsdelivr.net/gh/yelog/assets/images/202401021354591.png" alt="æ‰§è¡Œè¯†åˆ«æ•ˆæœ"></p><h2 id="æœ€å"><a href="#æœ€å" class="headerlink" title="æœ€å"></a>æœ€å</h2><p>æœ€è¿‘æ‰“ç®—ç€æ‰‹å†™ä¸€äº› macos çš„å°å·¥å…·, å¦‚æœå¯¹ <code>swift</code> æˆ–è€… <code>macos</code> æ„Ÿå…´è¶£çš„å¯ä»¥å…³æ³¨æˆ–è¯„è®º.</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;èƒŒæ™¯&quot;&gt;&lt;a href=&quot;#èƒŒæ™¯&quot; class=&quot;headerlink&quot; title=&quot;èƒŒæ™¯&quot;&gt;&lt;/a&gt;èƒŒæ™¯&lt;/h2&gt;&lt;p&gt;æœ€è¿‘æ‰“ç®—å†™ä¸€ä¸ª macos ç¿»è¯‘è½¯ä»¶, éœ€è¦ç”¨åˆ° ocr å›¾åƒè¯†åˆ«, å¹¶ä¸”å› ä¸ºé€Ÿåº¦é—®é¢˜, ä¸€å¼€å§‹å°±è€ƒè™‘ä½¿ç”¨ç³»ç»Ÿçš„è‡ªå¸¦èƒ½åŠ›æ¥å®ç°.&lt;/p&gt;
&lt;</summary>
      
    
    
    
    <category term="å¼€å‘" scheme="http://yelog.org/categories/%E5%BC%80%E5%8F%91/"/>
    
    <category term="swift" scheme="http://yelog.org/categories/%E5%BC%80%E5%8F%91/swift/"/>
    
    
    <category term="swift" scheme="http://yelog.org/tags/swift/"/>
    
    <category term="macos" scheme="http://yelog.org/tags/macos/"/>
    
    <category term="ocr" scheme="http://yelog.org/tags/ocr/"/>
    
  </entry>
  
  <entry>
    <title>Caused by: java.lang.ClassNotFoundException: org.springframework.boot.loader.JarLauncher</title>
    <link href="http://yelog.org/2023/12/11/springboot-jarlauncher/"/>
    <id>http://yelog.org/2023/12/11/springboot-jarlauncher/</id>
    <published>2023-12-11T08:58:00.000Z</published>
    <updated>2024-08-12T09:33:12.220Z</updated>
    
    <content type="html"><![CDATA[<h2 id="é—®é¢˜ç°è±¡"><a href="#é—®é¢˜ç°è±¡" class="headerlink" title="é—®é¢˜ç°è±¡"></a>é—®é¢˜ç°è±¡</h2><p>ä»Šå¤©åŒäº‹å†å‡çº§æ¡†æ¶å(spring-cloud 2022.0.4 -&gt; 2023.0.0)(spring-boot 3.1.6 -&gt; 3.2.0)</p><p>åŒæ—¶å› ä¸º spring-boot çš„ç‰ˆæœ¬é—®é¢˜, éœ€è¦å°† maven å‡çº§åˆ° 3.6.3+</p><p><img src="https://cdn.jsdelivr.net/gh/yelog/assets/images/202312111837604.png" alt="maven version"></p><p>å‡çº§åæ„å»º jar åŒ…å’Œæ„å»ºé•œåƒéƒ½æ˜¯æ­£å¸¸çš„, ä½†æ˜¯å‘å¸ƒåˆ°æµ‹è¯•ç¯å¢ƒå°±æŠ¥é”™ <code>Caused by: java.lang.ClassNotFoundException: org.springframework.boot.loader.JarLauncher</code></p><p><img src="https://cdn.jsdelivr.net/gh/yelog/assets/images/202312111851862.png" alt="error log"></p><h2 id="é—®é¢˜åˆ†æ"><a href="#é—®é¢˜åˆ†æ" class="headerlink" title="é—®é¢˜åˆ†æ"></a>é—®é¢˜åˆ†æ</h2><p>æŠ¥é”™ä¸º JarLauncher æ‰¾ä¸åˆ°, æ£€æŸ¥äº† <code>Jenkins</code> ä¸­çš„æ‰“åŒ…ä»»åŠ¡, å‘ç°å¹¶æ²¡æœ‰ç¼–è¯‘æŠ¥é”™, åŒäº‹ç›´æ¥ä½¿ç”¨æ‰“åŒ…ä»»åŠ¡ä¸­äº§ç”Ÿçš„ xx.jar, å¯ä»¥æ­£å¸¸è¿è¡Œ.</p><p>è¯´æ˜åœ¨æ‰“åŒ… <code>Docker</code> é•œåƒå‰éƒ½æ²¡æœ‰é—®é¢˜, è¿™æ—¶å°±æƒ³èµ·æ¥æˆ‘ä»¬åœ¨æ‰“åŒ…é•œåƒæ—¶, å…ˆè§£å‹ xx.jar, ç„¶åç›´æ¥æ‰§è¡Œ <code>org.springframework.boot.loader.JarLauncher</code>, æ‰€ä»¥å¾ˆå¯èƒ½æ˜¯å‡çº§å, å¯åŠ¨æ–‡ä»¶ <code>JarLauncher</code> çš„è·¯å¾„å˜äº†.</p><p>ä¸ºäº†éªŒè¯æˆ‘ä»¬çš„çŒœæƒ³, æˆ‘ä»¬å¾—çœ‹ä¸€ä¸‹å®é™…å®¹å™¨å†…çš„æ–‡ä»¶ç»“æ„, ä½†æ˜¯è¿™æ—¶å®¹å™¨ä¸€ç›´æŠ¥é”™å¯¼è‡´æ— æ³•å¯åŠ¨, ä¸èƒ½ç›´æ¥é€šè¿‡ <code>Rancher</code> æŸ¥çœ‹æ–‡ä»¶ç»“æ„, æˆ‘ä»¬å¯ä»¥é€šè¿‡æ–‡ä»¶æ‹·è´çš„æ–¹å¼æ¥è§£å†³, å¦‚ä¸‹:</p><pre><code class="bash"># ä¸‹è½½æœ‰é—®é¢˜çš„é•œåƒ, å¹¶ä¸”åˆ›å»ºå®¹å™¨(ä¸å¯åŠ¨)docker create -it --name dumy 10.188.132.123:5000/lemes-cloud/lemes-gateway:develop-202312111536 bash# ç›´æ¥æ‹·è´å®¹å™¨å†…çš„æˆ‘ä»¬æƒ³è¦çœ‹çš„ç›®å½•docker cp dumy:/data .</code></pre><p>åˆ°æœ¬åœ°å, å°±å¯ä»¥é€šè¿‡åˆé€‚çš„å·¥å…·æŸ¥æ‰¾ <code>JarLauncher</code> æ–‡ä»¶, æˆ‘è¿™é‡Œé€šè¿‡ <code>vim</code> æ¥å¯»æ‰¾, å¦‚ä¸‹å›¾:</p><p><img src="https://cdn.jsdelivr.net/gh/yelog/assets/images/202312111902709.png" alt="JarLauncher Path"></p><p>å‘ç°æ¯”åŸæ¥å¤šäº†ä¸€å±‚ç›®å½• <code>launch</code>, æ‰€ä»¥é—®é¢˜å°±å‘ç”Ÿåœ¨è¿™é‡Œäº†.</p><h2 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h2><p>æˆ‘ä»¬åœ¨æ‰“åŒ…è„šæœ¬ <code>JenkinsCommon.groovy</code> ä¸­æ ¹æ®å½“å‰æ‰“åŒ…çš„ JDK ç‰ˆæœ¬æ¥åˆ¤æ–­ä½¿ç”¨çš„å¯åŠ¨ç±»è·¯å¾„, å¦‚ä¸‹:</p><p><img src="https://cdn.jsdelivr.net/gh/yelog/assets/images/202312111905161.png" alt="Jenkins"></p><p>å†æ¬¡æ‰“åŒ…, åº”ç”¨æ­£å¸¸å¯åŠ¨.</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="https://docs.spring.io/spring-boot/docs/2.5.15/api/org/springframework/boot/loader/JarLauncher.html">JarLauncher</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;é—®é¢˜ç°è±¡&quot;&gt;&lt;a href=&quot;#é—®é¢˜ç°è±¡&quot; class=&quot;headerlink&quot; title=&quot;é—®é¢˜ç°è±¡&quot;&gt;&lt;/a&gt;é—®é¢˜ç°è±¡&lt;/h2&gt;&lt;p&gt;ä»Šå¤©åŒäº‹å†å‡çº§æ¡†æ¶å(spring-cloud 2022.0.4 -&amp;gt; 2023.0.0)(spring-boot 3</summary>
      
    
    
    
    <category term="åç«¯" scheme="http://yelog.org/categories/%E5%90%8E%E7%AB%AF/"/>
    
    
    <category term="java" scheme="http://yelog.org/tags/java/"/>
    
    <category term="docker" scheme="http://yelog.org/tags/docker/"/>
    
    <category term="spring-boot" scheme="http://yelog.org/tags/spring-boot/"/>
    
  </entry>
  
  <entry>
    <title>ideavim ä½¿ç”¨ç™¾åˆ†å·%æ”¯æŒxmlçš„å¯¹åº”æ ‡ç­¾è·³è½¬</title>
    <link href="http://yelog.org/2023/06/17/idea-tips-percent-mach-xml/"/>
    <id>http://yelog.org/2023/06/17/idea-tips-percent-mach-xml/</id>
    <published>2023-06-17T08:09:00.000Z</published>
    <updated>2024-08-12T09:33:12.028Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ç”±äºæœ€è¿‘å‡ å¹´ä½¿ç”¨ vim çš„é¢‘ç‡è¶Šæ¥è¶Šé«˜, æ‰€ä»¥åœ¨ idea ä¸­ä¹Ÿå¤§é‡å¼€å§‹ä½¿ç”¨ vim æŠ€å·§, åœ¨ä¸€å¹´å¤šå‰ç¢°åˆ°ä¸ªé—®é¢˜, ç»ˆäºåœ¨æœ€è¿‘è§£å†³äº†ã€‚</p><h2 id="é—®é¢˜æè¿°"><a href="#é—®é¢˜æè¿°" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h2><p>åœ¨ idea ä¸­, åœ¨ normal æ¨¡å¼ä¸‹, ä½¿ç”¨ % ä¸èƒ½åœ¨åŒ¹é…æ ‡ç­¾(xml&#x2F;htmlç­‰) ä¹‹é—´è·³è½¬</p><h2 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h2><p>åœ¨ <code>~/.ideavimrc</code> ä¸­æ·»åŠ å¦‚ä¸‹è®¾ç½®, é‡å¯ idea å³å¯</p><pre><code class="bash">set matchit</code></pre><h2 id="æ•ˆæœ"><a href="#æ•ˆæœ" class="headerlink" title="æ•ˆæœ"></a>æ•ˆæœ</h2><p><img src="https://cdn.jsdelivr.net/gh/yelog/assets/images/picgo_qiniu2023-06-17%2016.23.45.gif"></p><h2 id="æœ€å"><a href="#æœ€å" class="headerlink" title="æœ€å"></a>æœ€å</h2><p>æœ€è¿‘ä¼šæŠŠä¸€äº›åŠ çš„ tips åˆ†äº«å‡ºæ¥ï¼Œå¤§å®¶æœ‰ä»€ä¹ˆå»ºè®®å’Œé—®é¢˜éƒ½å¯ä»¥åœ¨è¯„è®ºåŒºè®¨è®º.</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;ç”±äºæœ€è¿‘å‡ å¹´ä½¿ç”¨ vim çš„é¢‘ç‡è¶Šæ¥è¶Šé«˜, æ‰€ä»¥åœ¨ idea ä¸­ä¹Ÿå¤§é‡å¼€å§‹ä½¿ç”¨ vim æŠ€å·§, åœ¨ä¸€å¹´å¤šå‰ç¢°åˆ°ä¸ªé—®é¢˜, ç»ˆäºåœ¨æœ€è¿‘è§£å†³äº†ã€‚&lt;</summary>
      
    
    
    
    <category term="å·¥å…·" scheme="http://yelog.org/categories/%E5%B7%A5%E5%85%B7/"/>
    
    <category term="IDEA" scheme="http://yelog.org/categories/%E5%B7%A5%E5%85%B7/IDEA/"/>
    
    
    <category term="efficiency" scheme="http://yelog.org/tags/efficiency/"/>
    
    <category term="vim" scheme="http://yelog.org/tags/vim/"/>
    
    <category term="IntellijIDEA" scheme="http://yelog.org/tags/IntellijIDEA/"/>
    
  </entry>
  
  <entry>
    <title>Raycast æœ€å¼ºæ•ˆç‡è½¯ä»¶æ¨è</title>
    <link href="http://yelog.org/2023/05/17/mac-raycast/"/>
    <id>http://yelog.org/2023/05/17/mac-raycast/</id>
    <published>2023-05-17T09:45:00.000Z</published>
    <updated>2024-08-12T09:33:11.882Z</updated>
    
    <content type="html"><![CDATA[<h2 id="è½¯ä»¶ä»‹ç»"><a href="#è½¯ä»¶ä»‹ç»" class="headerlink" title="è½¯ä»¶ä»‹ç»"></a>è½¯ä»¶ä»‹ç»</h2><p><img src="https://cdn.jsdelivr.net/gh/yelog/assets/images/picgo_qiniu202305171806865.png" alt="Raycast"></p><p>æœ€è¿‘åœ¨å¾ˆå¤šå¹³å°ä¸Šçœ‹åˆ° Raycast çš„æ¨èæ–‡ç« , ä»Šå¤©å°±å°è¯•äº†ä¸€ä¸‹, å‘ç°ç¡®å®ä¸é”™, å®Œå…¨å¯ä»¥æ›¿ä»£æˆ‘ç›®å‰å¯¹ Alfred çš„ä½¿ç”¨, ç”šè‡³å¾ˆå¤šåœ°æ–¹åšå¾—æ›´å¥½, æ‰€ä»¥æœ¬æ–‡å°±æ˜¯ä»‹ç»æˆ‘ä½¿ç”¨ Raycast çš„ä¸€äº›æ•ˆæœ(å¤šå›¾é¢„è­¦)ï¼Œ æ–¹ä¾¿é‚£äº›è¿˜æ²¡æœ‰æ¥è§¦è¿™ä¸ªè½¯ä»¶çš„äººå¯¹å®ƒæœ‰ä¸ªäº†è§£, å¦‚æœæœ‰æ’ä»¶æ¨è, æ¬¢è¿åœ¨è¯„è®ºåŒºè¿›è¡Œè®¨è®ºã€‚</p><p>Raycast æ˜¯ MacMac å¹³å°ç‹¬å çš„æ•ˆç‡å·¥å…·, ä¸»è¦åŒ…å«å¦‚ä¸‹åŠŸèƒ½:</p><ol><li>åº”ç”¨å¯åŠ¨</li><li>æ–‡ä»¶æŸ¥æ‰¾</li><li>çª—å£ç®¡ç†</li><li>å‰ªè´´æ¿å†å²</li><li>Snippets</li><li>åº”ç”¨èœå•æŸ¥è¯¢</li></ol><p>æ’ä»¶æ‰©å±•åŠŸèƒ½</p><ol><li>ç¿»è¯‘</li><li>æ–—å›¾</li><li>ç»“æŸè¿›ç¨‹</li><li>æŸ¥è¯¢ç«¯å£å ç”¨</li><li>æŸ¥è¯¢ip</li></ol><p>é™¤æ­¤ä¹‹å¤–, Raycastæä¾›çš„åœ¨çº¿æ’ä»¶å•†åº—, å¯ä»¥å¾ˆæ–¹ä¾¿çš„è¿›è¡ŒåŠŸèƒ½æ‰©å±•</p><p><a href="https://www.raycast.com/">Raycastå®˜ç½‘</a></p><h2 id="æ ¸å¿ƒåŠŸèƒ½"><a href="#æ ¸å¿ƒåŠŸèƒ½" class="headerlink" title="æ ¸å¿ƒåŠŸèƒ½"></a>æ ¸å¿ƒåŠŸèƒ½</h2><h3 id="åº”ç”¨å¯åŠ¨"><a href="#åº”ç”¨å¯åŠ¨" class="headerlink" title="åº”ç”¨å¯åŠ¨"></a>åº”ç”¨å¯åŠ¨</h3><p><img src="https://cdn.jsdelivr.net/gh/yelog/assets/images/picgo_qiniu202305172245860.png"></p><p>å¹¶ä¸”æ”¯æŒå¸è½½åº”ç”¨, æ‰¾åˆ°åº”ç”¨, <code>cmd+k</code> æ‰“å¼€æ“ä½œèœå•, ä¸‹æ‹‰åˆ°æœ€å<br><img src="https://cdn.jsdelivr.net/gh/yelog/assets/images/picgo_qiniu202305181223320.png"></p><h3 id="æ–‡ä»¶æŸ¥æ‰¾"><a href="#æ–‡ä»¶æŸ¥æ‰¾" class="headerlink" title="æ–‡ä»¶æŸ¥æ‰¾"></a>æ–‡ä»¶æŸ¥æ‰¾</h3><p><img src="https://cdn.jsdelivr.net/gh/yelog/assets/images/picgo_qiniu202305172249647.png"></p><h3 id="çª—å£ç®¡ç†"><a href="#çª—å£ç®¡ç†" class="headerlink" title="çª—å£ç®¡ç†"></a>çª—å£ç®¡ç†</h3><p><img src="https://cdn.jsdelivr.net/gh/yelog/assets/images/picgo_qiniu202305172251703.png"></p><h3 id="å‰ªè´´æ¿å†å²"><a href="#å‰ªè´´æ¿å†å²" class="headerlink" title="å‰ªè´´æ¿å†å²"></a>å‰ªè´´æ¿å†å²</h3><p>æ¨èä½¿ç”¨ <code>Clipboard History</code> è¿™ä¸ªæ‰©å±•ï¼Œå’Œ Alfred çš„ä¸€æ ·, å¹¶ä¸”æœ‰åˆ†ç±»ï¼Œæ•ˆæœå¦‚ä¸‹<br><img src="https://cdn.jsdelivr.net/gh/yelog/assets/images/picgo_qiniu202305181002644.png"></p><p>è®¾ç½®å¿«æ·é”® <code>cmd+shift+v</code><br><img src="https://cdn.jsdelivr.net/gh/yelog/assets/images/picgo_qiniu202305181052831.png"></p><h3 id="Snippets"><a href="#Snippets" class="headerlink" title="Snippets"></a>Snippets</h3><p>é€šè¿‡ Snippets å¯ä»¥ä¿å­˜è‡ªå®šä¹‰ç‰‡æ®µ, é€šè¿‡å…³é”®å­—å¿«é€ŸæŸ¥è¯¢å¹¶è¾“å‡ºåˆ°å…‰æ ‡å¤„, å¦‚å¸¸ç”¨è¯­ã€ é‚®ç®±ã€æ‰‹æœºå·ã€ç¨å·ã€ä»£ç ç‰‡æ®µç­‰ç­‰<br><img src="https://cdn.jsdelivr.net/gh/yelog/assets/images/picgo_qiniu202305181108693.png"></p><p>åˆ›å»º Snippets å¯ä»¥é€šè¿‡æœç´¢ <code>Create Snippet</code>, æœç´¢ Snippets å¯ä»¥é€šè¿‡æœç´¢<code>Search Snippet</code></p><h3 id="åº”ç”¨èœå•æŸ¥è¯¢"><a href="#åº”ç”¨èœå•æŸ¥è¯¢" class="headerlink" title="åº”ç”¨èœå•æŸ¥è¯¢"></a>åº”ç”¨èœå•æŸ¥è¯¢</h3><p>æŸ¥è¯¢å½“å‰æ¿€æ´»åº”ç”¨çš„æ‰€æœ‰èœå•, ä¸é™å±‚çº§. å¯ä»¥é€šè¿‡æœç´¢ <code>Search Menu Items</code> æ¥æŸ¥è¯¢ã€‚<br><img src="https://cdn.jsdelivr.net/gh/yelog/assets/images/picgo_qiniu202305181231629.png"></p><h2 id="æ¨èæ’ä»¶"><a href="#æ¨èæ’ä»¶" class="headerlink" title="æ¨èæ’ä»¶"></a>æ¨èæ’ä»¶</h2><h3 id="Easydict-ç¿»è¯‘è½¯ä»¶"><a href="#Easydict-ç¿»è¯‘è½¯ä»¶" class="headerlink" title="Easydict(ç¿»è¯‘è½¯ä»¶)"></a>Easydict(ç¿»è¯‘è½¯ä»¶)</h3><p>è¶…å¼ºçš„ç¿»è¯‘è½¯ä»¶ï¼Œ å®Œç¾æ›¿ä»£æˆ‘åœ¨ Alfred çš„ workflow ä¸­é…ç½®çš„æœ‰é“ç¿»è¯‘, æˆ‘é…ç½®äº†å¦‚ä¸‹åŠŸèƒ½</p><ul><li>è¾“å…¥ä¸­æ–‡, è‡ªåŠ¨ç¿»è¯‘æˆè‹±æ–‡</li><li>è¾“å…¥è‹±æ–‡, è‡ªåŠ¨ç¿»è¯‘æˆä¸­æ–‡</li><li>æ”¯æŒä¸€é”®å‘éŸ³</li><li>Open AI ç¿»è¯‘é•¿æ–‡æœ¬</li></ul><p><img src="https://cdn.jsdelivr.net/gh/yelog/assets/images/picgo_qiniu202305172258408.png"></p><h3 id="Doutu"><a href="#Doutu" class="headerlink" title="Doutu"></a>Doutu</h3><p>è¡¨æƒ…åŒ…æŸ¥è¯¢ï¼Œé€‰ä¸­å›è½¦å°±å¤åˆ¶åˆ°å‰ªè´´æ¿äº†ï¼Œ å°±å¯ä»¥ç²˜è´´åˆ° Discord&#x2F;QQ&#x2F;WechatÂ æ–—å›¾äº†, éå¸¸æ–¹ä¾¿ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/yelog/assets/images/picgo_qiniu202305172300474.png"></p><h3 id="Kill-Process"><a href="#Kill-Process" class="headerlink" title="Kill Process"></a>Kill Process</h3><p>å…³é”®å­—æŸ¥è¯¢, å¹¶ä¸€é”®ç»“æŸè¿›ç¨‹<br><img src="https://cdn.jsdelivr.net/gh/yelog/assets/images/picgo_qiniu202305181119726.png"></p><h3 id="Kill-Port"><a href="#Kill-Port" class="headerlink" title="Kill Port"></a>Kill Port</h3><p>æŸ¥è¯¢ç«¯å£å ç”¨çš„è¿›ç¨‹, å¹¶æ”¯æŒä¸€é”®ç»“æŸè¿›ç¨‹<br><img src="https://cdn.jsdelivr.net/gh/yelog/assets/images/picgo_qiniu202305181120514.png"></p><h3 id="MyIp"><a href="#MyIp" class="headerlink" title="MyIp"></a>MyIp</h3><p>æŸ¥è¯¢å½“å‰ip<br><img src="https://cdn.jsdelivr.net/gh/yelog/assets/images/picgo_qiniu202305181230312.png"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;è½¯ä»¶ä»‹ç»&quot;&gt;&lt;a href=&quot;#è½¯ä»¶ä»‹ç»&quot; class=&quot;headerlink&quot; title=&quot;è½¯ä»¶ä»‹ç»&quot;&gt;&lt;/a&gt;è½¯ä»¶ä»‹ç»&lt;/h2&gt;&lt;p&gt;&lt;img src=&quot;https://cdn.jsdelivr.net/gh/yelog/assets/images/picg</summary>
      
    
    
    
    <category term="å·¥å…·" scheme="http://yelog.org/categories/%E5%B7%A5%E5%85%B7/"/>
    
    <category term="è½¯ä»¶è®°å½•" scheme="http://yelog.org/categories/%E5%B7%A5%E5%85%B7/%E8%BD%AF%E4%BB%B6%E8%AE%B0%E5%BD%95/"/>
    
    
    <category term="mac" scheme="http://yelog.org/tags/mac/"/>
    
    <category term="efficiency" scheme="http://yelog.org/tags/efficiency/"/>
    
  </entry>
  
  <entry>
    <title>[Java]é€šè¿‡ CompletableFuture å®ç°å¼‚æ­¥å¤šçº¿ç¨‹ä¼˜åŒ–è¯·æ±‚å¤„ç†é€Ÿåº¦</title>
    <link href="http://yelog.org/2022/08/01/[Java]optimize-request-processing-speed-by-completablefuture/"/>
    <id>http://yelog.org/2022/08/01/[Java]optimize-request-processing-speed-by-completablefuture/</id>
    <published>2022-08-01T12:06:14.000Z</published>
    <updated>2024-08-12T09:33:12.263Z</updated>
    
    <content type="html"><![CDATA[<h3 id="é›¶ã€èƒŒæ™¯"><a href="#é›¶ã€èƒŒæ™¯" class="headerlink" title="é›¶ã€èƒŒæ™¯"></a>é›¶ã€èƒŒæ™¯</h3><p>æˆ‘ä»¬åœ¨å†™åç«¯è¯·æ±‚çš„æ—¶å€™, å¯èƒ½æ¶‰åŠå¤šæ¬¡ SQL æ‰§è¡Œ(æˆ–å…¶ä»–æ“ä½œ), å½“è¿™äº›è¯·æ±‚ç›¸äº’ä¸å…³è”, åœ¨é¡ºåºæ‰§è¡Œæ—¶å°±æµªè´¹äº†æ—¶é—´, è¿™äº›ä¸éœ€è¦å…ˆåé¡ºåºçš„æ“ä½œå¯ä»¥é€šè¿‡å¤šçº¿ç¨‹è¿›è¡ŒåŒæ—¶æ‰§è¡Œ, æ¥åŠ é€Ÿæ•´ä¸ªé€»è¾‘çš„æ‰§è¡Œé€Ÿåº¦.</p><p>æ—¢ç„¶æœ‰äº†ç›®æ ‡å’Œå¤§è‡´æ€è·¯, å¦‚æœæœ‰åšè¿‡å‰ç«¯çš„å°ä¼™ä¼´åº”è¯¥èƒ½æƒ³èµ·æ¥ Js é‡Œé¢æœ‰ä¸ª <code>Promise.all</code> æ¥è§£å†³è¿™ä¸ªé—®é¢˜, åœ¨ Java é‡Œä¹Ÿæœ‰ç±»ä¼¼åŠŸèƒ½çš„ç±» <code>CompletableFuture</code> , å®ƒå¯ä»¥å®ç°å¤šçº¿ç¨‹å’Œçº¿ç¨‹é˜»å¡, è¿™æ ·èƒ½å¤Ÿä¿è¯ç­‰å¾…å¤šä¸ªçº¿ç¨‹æ‰§è¡Œå®Œæˆåå†ç»§ç»­æ“ä½œ.</p><h3 id="ä¸€ã€CompletableFuture-æ˜¯ä»€ä¹ˆ"><a href="#ä¸€ã€CompletableFuture-æ˜¯ä»€ä¹ˆ" class="headerlink" title="ä¸€ã€CompletableFuture æ˜¯ä»€ä¹ˆ"></a>ä¸€ã€CompletableFuture æ˜¯ä»€ä¹ˆ</h3><p>é¦–å…ˆæˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸‹ <code>CompletableFuture</code> æ˜¯å¹²ä»€ä¹ˆ, æ¥ä¸‹æ¥æˆ‘ä»¬é€šè¿‡ç®€å•çš„ç¤ºä¾‹æ¥ä»‹ç»ä»–çš„ä½œç”¨.</p><pre><code class="java"> long startTime = System.currentTimeMillis();//ç”Ÿæˆå‡ ä¸ªä»»åŠ¡List&lt;CompletableFuture&lt;String&gt;&gt; futureList = new ArrayList&lt;&gt;();futureList.add(CompletableFuture.supplyAsync(()-&gt;&#123;    sleep(4000);    System.out.println(&quot;ä»»åŠ¡1 å®Œæˆ&quot;);    return &quot;ä»»åŠ¡1çš„æ•°æ®&quot;;&#125;));futureList.add(CompletableFuture.supplyAsync(()-&gt;&#123;    sleep(2000);    System.out.println(&quot;ä»»åŠ¡2 å®Œæˆ&quot;);    return &quot;ä»»åŠ¡2çš„æ•°æ®&quot;;&#125;));futureList.add(CompletableFuture.supplyAsync(()-&gt;&#123;    sleep(3000);    System.out.println(&quot;ä»»åŠ¡3 å®Œæˆ&quot;);    return &quot;ä»»åŠ¡3çš„æ•°æ®&quot;;&#125;));//å®Œæˆä»»åŠ¡CompletableFuture&lt;Void&gt; allTask = CompletableFuture.allOf(futureList.toArray(new CompletableFuture[0]))        .whenComplete((t, e) -&gt; &#123;            System.out.println(&quot;æ‰€æœ‰ä»»åŠ¡éƒ½å®Œæˆäº†ï¼Œ è¿”å›ç»“æœé›†: &quot;                    + futureList.stream().map(CompletableFuture::join).collect(Collectors.joining(&quot;,&quot;)));        &#125;);// é˜»å¡ä¸»çº¿ç¨‹allTask.join();System.out.println(&quot;main end, cost: &quot; + (System.currentTimeMillis() - startTime));</code></pre><p>æ‰§è¡Œç»“æœ</p><pre><code class="bash">ä»»åŠ¡2 å®Œæˆä»»åŠ¡3 å®Œæˆä»»åŠ¡1 å®Œæˆæ‰€æœ‰ä»»åŠ¡éƒ½å®Œæˆäº†ï¼Œ è¿”å›ç»“æœé›†: ä»»åŠ¡1çš„æ•°æ®,ä»»åŠ¡2çš„æ•°æ®,ä»»åŠ¡3çš„æ•°æ®main end, cost: 4032</code></pre><blockquote><p><strong>ç»“æœåˆ†æ:</strong> æˆ‘ä»¬éœ€è¦æ‰§è¡Œ3ä¸ªä»»åŠ¡, 3ä¸ªä»»åŠ¡åŒæ—¶æ‰§è¡Œ, äº’ä¸å½±å“</p></blockquote><ol><li>å…¶ä¸­ä»»åŠ¡2è€—æ—¶æœ€çŸ­,æå‰æ‰“å°å®Œæˆ</li><li>å…¶æ¬¡æ˜¯ä»»åŠ¡3</li><li>æœ€åæ˜¯æ‰§è¡Œ1å®Œæˆ</li><li>å½“æ‰€æœ‰ä»»åŠ¡å®Œæˆå, è§¦å‘ <code>whenComplete</code> æ–¹æ³•, æ‰“å°ä»»åŠ¡çš„è¿”å›ç»“æœ</li><li>æœ€åæ‰“å°æ€»è€—æ—¶ä¸º 4.032s</li><li>ç»“è®º: å¤šçº¿ç¨‹æ‰§è¡Œå, è€—æ—¶å–å†³äºæœ€è€—æ—¶çš„æ“ä½œ, è€Œå•çº¿ç¨‹æ˜¯æ‰€æœ‰æ“ä½œè€—æ—¶ä¹‹å’Œ</li></ol><h3 id="äºŒã€å°è£…å·¥å…·ç±»"><a href="#äºŒã€å°è£…å·¥å…·ç±»" class="headerlink" title="äºŒã€å°è£…å·¥å…·ç±»"></a>äºŒã€å°è£…å·¥å…·ç±»</h3><p>ç»è¿‡ä¸Šé¢çš„æµ‹è¯•, é€šè¿‡ <code>CompletableFuture</code> å·²ç»èƒ½å¤Ÿå®ç°æˆ‘ä»¬çš„é¢„æƒ³, ä¸ºäº†æ“ä½œæ–¹ä¾¿, æˆ‘ä»¬å°†å°è£…èµ·æ¥, ä¾¿äºç»Ÿä¸€ç®¡ç†</p><pre><code class="java">package org.yelog.java.usage.concurrent;import java.util.ArrayList;import java.util.List;import java.util.concurrent.CompletableFuture;import java.util.function.Consumer;import java.util.function.Function;import java.util.function.Predicate;/** * æ‰§è¡Œå¹¶å‘ä»»åŠ¡ * * @author yangyj13 * @date 11/7/22 9:49 PM */public class MultiTask&lt;T&gt; &#123;    private List&lt;CompletableFuture&lt;T&gt;&gt; futureList;    /**     * æ·»åŠ å¾…æ‰§è¡Œçš„ä»»åŠ¡     *     * @param completableFuture ä»»åŠ¡     * @return å½“å‰å¯¹è±¡     */    public MultiTask&lt;T&gt; addTask(CompletableFuture&lt;T&gt; completableFuture) &#123;        if (futureList == null) &#123;            futureList = new ArrayList&lt;&gt;();        &#125;        futureList.add(completableFuture);        return this;    &#125;    /**     * æ·»åŠ å¾…æ‰§è¡Œçš„ä»»åŠ¡(æ— è¿”å›)     *     * @param task ä»»åŠ¡     * @return å½“å‰å¯¹è±¡     */    public MultiTask&lt;T&gt; addTask(Consumer&lt;T&gt; task) &#123;        addTask(CompletableFuture.supplyAsync(() -&gt; &#123;            task.accept(null);            return null;        &#125;));        return this;    &#125;    /**     * æ·»åŠ å¾…æ‰§è¡Œçš„ä»»åŠ¡(æœ‰è¿”å›)     *     * @param task ä»»åŠ¡     * @return å½“å‰å¯¹è±¡     */    public MultiTask&lt;T&gt; addTask(Function&lt;Object, T&gt; task) &#123;        addTask(CompletableFuture.supplyAsync(() -&gt; task.apply(null)));        return this;    &#125;    /**     * å¼€å§‹æ‰§è¡Œä»»åŠ¡     *     * @param callback                å½“æ‰€æœ‰ä»»åŠ¡éƒ½å®Œæˆåè§¦å‘çš„å›è°ƒæ–¹æ³•     * @param waitTaskExecuteComplete æ˜¯å¦é˜»å¡ä¸»çº¿ç¨‹     */    private void execute(Consumer&lt;List&lt;T&gt;&gt; callback, Boolean waitTaskExecuteComplete) &#123;        CompletableFuture&lt;Void&gt; allFuture = CompletableFuture.allOf(futureList.toArray(new CompletableFuture[0]))                .whenComplete((t, e) -&gt; &#123;                    if (callback != null) &#123;                        List&lt;T&gt; objectList = new ArrayList&lt;&gt;();                        futureList.forEach((future) -&gt; &#123;                            objectList.add(future.join());                        &#125;);                        callback.accept(objectList);                    &#125;                &#125;);        if (callback != null || waitTaskExecuteComplete == null || waitTaskExecuteComplete) &#123;            allFuture.join();        &#125;    &#125;    /**     * å¼€å§‹æ‰§è¡Œä»»åŠ¡     * ç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆï¼ˆé˜»å¡ä¸»çº¿ç¨‹ï¼‰     */    public void execute() &#123;        execute(null, true);    &#125;    /**     * å¼€å§‹æ‰§è¡Œä»»åŠ¡     *     * @param waitTaskExecuteComplete æ˜¯å¦é˜»å¡ä¸»çº¿ç¨‹     */    public void execute(Boolean waitTaskExecuteComplete) &#123;        execute(null, waitTaskExecuteComplete);    &#125;    /**     * å¼€å§‹æ‰§è¡Œä»»åŠ¡     *     * @param callback å½“æ‰€æœ‰ä»»åŠ¡éƒ½å®Œæˆåè§¦å‘çš„å›è°ƒæ–¹æ³•     */    public void execute(Consumer&lt;List&lt;T&gt;&gt; callback) &#123;        execute(callback, true);    &#125;&#125;</code></pre><p>é‚£ä¹ˆä¸Šä¸€æ­¥æˆ‘ä»¬æµ‹è¯•çš„æµç¨‹è½¬æ¢æˆå·¥å…·ç±»åå¦‚ä¸‹</p><pre><code class="java">long startTime = System.currentTimeMillis();MultiTask&lt;String&gt; multiTask = new MultiTask&lt;&gt;();multiTask.addTask(t -&gt; &#123;    sleep(1000);    System.out.println(&quot;ä»»åŠ¡1 å®Œæˆ&quot;);&#125;).addTask(t -&gt; &#123;    sleep(3000);    System.out.println(&quot;ä»»åŠ¡2 å®Œæˆ&quot;);&#125;).addTask(CompletableFuture.supplyAsync(()-&gt;&#123;    sleep(2000);    System.out.println(&quot;ä»»åŠ¡3 å®Œæˆ&quot;);    return &quot;ä»»åŠ¡3çš„æ•°æ®&quot;;&#125;)).execute(resultList-&gt;&#123;    System.out.println(&quot;all complete: &quot; + resultList);&#125;);System.out.println(&quot;main end, cost: &quot; + (System.currentTimeMillis() - startTime));</code></pre><h3 id="ä¸‰ã€åº”ç”¨åˆ°å®é™…çš„æ•ˆæœ"><a href="#ä¸‰ã€åº”ç”¨åˆ°å®é™…çš„æ•ˆæœ" class="headerlink" title="ä¸‰ã€åº”ç”¨åˆ°å®é™…çš„æ•ˆæœ"></a>ä¸‰ã€åº”ç”¨åˆ°å®é™…çš„æ•ˆæœ</h3><p>æ‰§è¡Œä¸¤æ¬¡æ•°æ®åº“çš„æ“ä½œå¦‚ä¸‹</p><pre><code class="java">public interface TestMapper &#123;    @Select(&quot;select count(*) from test_user where score &lt; 1000 and user_id = #&#123;userId&#125;&quot;)    int countScoreLess1000(Integer userId);    @Select(&quot;select count(1) from test_log where success = true and user_id = #&#123;userId&#125;&quot;)    int countSuccess(Integer userId);&#125;</code></pre><p>è°ƒç”¨æ–¹æ³•:</p><pre><code class="java">long start = System.currentTimeMillis();testMapper.countScoreLess1000(userId);long countScoreLess1000End = System.currentTimeMillis();log.info(&quot;countScoreLess1000 cost: &quot; + (countScoreLess1000End - start));testMapper.countSuccess(userId);long countSuccessEnd = System.currentTimeMillis();log.info(&quot;countSuccess cost: &quot; + (countSuccessEnd - countScoreLess1000End));log.info(&quot;all cost: &quot; + (countSuccessEnd - start));</code></pre><p>é¡ºåºæ‰§è¡Œçš„å¹³å‡æ—¶é—´å¦‚ä¸‹</p><pre><code class="bash">countScoreLess1000 cost: 368countSuccess cost: 404all cost: 772</code></pre><p>å½“æˆ‘ä»¬åº”ç”¨çš„ä¸Šé¢çš„å·¥å…·ç±»åçš„è°ƒç”¨æ–¹æ³•</p><pre><code class="java">MultiTask multiTask = new MultiTask&lt;&gt;();multiTask.addTask(t -&gt; &#123;    testMapper.countScoreLess1000(userId);    log.info(&quot;countScoreLess1000 cost: &quot; + (System.currentTimeMillis() - start));&#125;).addTask(t -&gt; &#123;    testMapper.countSuccess(userId);    log.info(&quot;countSuccess cost: &quot; + (System.currentTimeMillis() - start));&#125;).execute();log.info(&quot;all cost: &quot; + (System.currentTimeMillis() - start));</code></pre><p>æ•ˆæœå¦‚ä¸‹</p><pre><code class="bash">countScoreLess1000 cost: 433countSuccess cost: 463all cost: 464</code></pre><p>å¯ä»¥çœ‹åˆ°å„å­ä»»åŠ¡æ‰§è¡Œæ—¶é•¿æ˜¯å·®ä¸å¤šçš„, ä½†æ˜¯æ€»è€—æ—¶ä½¿ç”¨å¤šçº¿ç¨‹åæœ‰äº†æ˜æ˜¾ä¸‹é™</p><h3 id="å››ã€æ€»ç»“"><a href="#å››ã€æ€»ç»“" class="headerlink" title="å››ã€æ€»ç»“"></a>å››ã€æ€»ç»“</h3><p>é€šè¿‡ä½¿ç”¨ <code>CompletableFuture</code> å®ç°å¤šçº¿ç¨‹é˜»å¡æ‰§è¡Œå, å¤§å¹…é™ä½è¿™ç±»è¯·æ±‚, å¹¶ä¸”å½“å¯ä»¥å¼‚æ­¥æ‰§è¡Œçš„å­ä»»åŠ¡è¶Šå¤š, æ•ˆæœè¶Šæ˜æ˜¾.</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;é›¶ã€èƒŒæ™¯&quot;&gt;&lt;a href=&quot;#é›¶ã€èƒŒæ™¯&quot; class=&quot;headerlink&quot; title=&quot;é›¶ã€èƒŒæ™¯&quot;&gt;&lt;/a&gt;é›¶ã€èƒŒæ™¯&lt;/h3&gt;&lt;p&gt;æˆ‘ä»¬åœ¨å†™åç«¯è¯·æ±‚çš„æ—¶å€™, å¯èƒ½æ¶‰åŠå¤šæ¬¡ SQL æ‰§è¡Œ(æˆ–å…¶ä»–æ“ä½œ), å½“è¿™äº›è¯·æ±‚ç›¸äº’ä¸å…³è”, åœ¨é¡ºåºæ‰§è¡Œæ—¶å°±æµªè´¹äº†æ—¶é—´, è¿™</summary>
      
    
    
    
    <category term="åç«¯" scheme="http://yelog.org/categories/%E5%90%8E%E7%AB%AF/"/>
    
    
    <category term="java" scheme="http://yelog.org/tags/java/"/>
    
    <category term="concurrent" scheme="http://yelog.org/tags/concurrent/"/>
    
  </entry>
  
  <entry>
    <title>åŸºäº nacos/ç°åº¦å‘å¸ƒ å®ç°å‡å°‘æœ¬åœ°å¯åŠ¨å¾®æœåŠ¡æ•°é‡çš„å®è·µ</title>
    <link href="http://yelog.org/2022/08/01/reducing-local-springcloud-base-on-nacos-and-gray-release/"/>
    <id>http://yelog.org/2022/08/01/reducing-local-springcloud-base-on-nacos-and-gray-release/</id>
    <published>2022-08-01T12:06:14.000Z</published>
    <updated>2024-08-12T09:33:12.211Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ä¸€ã€èƒŒæ™¯"><a href="#ä¸€ã€èƒŒæ™¯" class="headerlink" title="ä¸€ã€èƒŒæ™¯"></a>ä¸€ã€èƒŒæ™¯</h2><p>åå°æ¡†æ¶æ˜¯åŸºäº spring cloud çš„å¾®æœåŠ¡ä½“ç³», å½“å¼€å‘åŒå­¦åœ¨è‡ªå·±ç”µè„‘ä¸Šè¿›è¡Œå¼€å‘å·¥ä½œæ—¶, æ¯”å¦‚å¼€å‘è®¢å•æ¨¡å—, é™¤äº†éœ€è¦å¯åŠ¨è®¢å•æ¨¡å—å¤–, è¿˜éœ€è¦å¯åŠ¨ç½‘å…³æ¨¡å—ã€æƒé™æ ¡éªŒæ¨¡å—ã€å…¬å…±æœåŠ¡æ¨¡å—ç­‰ä¾èµ–æ¨¡å—, éå¸¸æ¶ˆè€—å¼€å‘åŒå­¦çš„æœ¬åœ°ç”µè„‘çš„èµ„æº, ä¹ŸåŠå…¶æµªè´¹æ—¶é—´.</p><p><img src="https://cdn.jsdelivr.net/gh/yelog/assets/images/picgo_qiniu20220801233224.png" alt="Spring Cloud"></p><h2 id="äºŒã€è§£å†³æ–¹æ¡ˆ"><a href="#äºŒã€è§£å†³æ–¹æ¡ˆ" class="headerlink" title="äºŒã€è§£å†³æ–¹æ¡ˆ"></a>äºŒã€è§£å†³æ–¹æ¡ˆ</h2><h3 id="2-1-ç›®æ ‡å’Œå…³é”®é—®é¢˜"><a href="#2-1-ç›®æ ‡å’Œå…³é”®é—®é¢˜" class="headerlink" title="2.1 ç›®æ ‡å’Œå…³é”®é—®é¢˜"></a>2.1 ç›®æ ‡å’Œå…³é”®é—®é¢˜</h3><p>èƒ½ä¸èƒ½å¼€å‘åŒå­¦æœ¬åœ°åªéœ€è¦å¯åŠ¨éœ€è¦å¼€å‘çš„æ¨¡å—:è®¢å•æ¨¡å—, å…¶ä»–æ¨¡å—å‡é€‚ç”¨æµ‹è¯•ç¯å¢ƒä¸­æ­£åœ¨è¿è¡Œçš„æœåŠ¡.</p><p>æ—¢ç„¶è¦å®ç°çš„ç›®æ ‡æœ‰äº†, æˆ‘ä»¬å°±å¼€å§‹ç ”ç©¶å¯è¡Œæ€§å’Œå…³é”®é—®é¢˜</p><ol><li>å¼€å‘ç¯å¢ƒå’Œæµ‹è¯•ç¯å¢ƒè¦åœ¨åŒä¸€ä¸ª nacos çš„ namespace ä¸­, è¿™æ ·æ‰æœ‰å¯èƒ½è®©å¼€å‘ç¯å¢ƒè°ƒç”¨åˆ°æµ‹è¯•ç¯å¢ƒçš„æœåŠ¡.</li><li>æµ‹è¯•ç¯å¢ƒåªèƒ½è°ƒç”¨æµ‹è¯•ç¯å¢ƒçš„å¾®æœåŠ¡, å®ç°å’Œå¼€å‘ç¯å¢ƒçš„æœåŠ¡éš”ç¦»</li><li>å¼€å‘åŒå­¦ä¹‹é—´çš„å¾®æœåŠ¡ä¹Ÿè¦å®ç°æœåŠ¡éš”ç¦»</li></ol><h3 id="2-2-æ€è·¯"><a href="#2-2-æ€è·¯" class="headerlink" title="2.2 æ€è·¯"></a>2.2 æ€è·¯</h3><p>æ—¢è¦åœ¨åŒä¸€ä¸ª namespace ä¸‹, åˆè¦èƒ½å¤Ÿå®ç°ä¸åŒäººè®¿é—®ä¸åŒçš„å‰¯æœ¬, å¾ˆå®¹æ˜“æƒ³åˆ°å¯ä»¥åˆ©ç”¨<code>ç°åº¦å‘å¸ƒ</code>æ¥å®ç°:</p><ol><li>æµ‹è¯•ç¯å¢ƒè®¾ç½® metadata <code>lemes-env=product</code> æ¥æ ‡è¯†æµ‹è¯•ç¯å¢ƒå‰¯æœ¬, ç”¨äºåŒºåˆ†å¼€å‘ç¯å¢ƒçš„å¾®æœåŠ¡æµ‹æµ‹è¯•ç¯å¢ƒçš„å¾®æœåŠ¡</li><li>å¼€å‘åŒå­¦æœ¬åœ°å¯åŠ¨æ³¨å†Œå¼€å‘ç¯å¢ƒå‰¯æœ¬, éƒ½ä¼šæºå¸¦å”¯ä¸€IP, åˆ™æˆ‘ä»¬å¯ä»¥é€šè¿‡IPæ¥åŒºåˆ†ä¸åŒå¼€å‘åŒå­¦çš„å‰¯æœ¬</li></ol><p>å‡è®¾æˆ‘ä»¬éœ€è¦å¼€å‘çš„ API çš„åå°æœåŠ¡è°ƒç”¨é“¾æ¡å¦‚ä¸‹:</p><p><img src="https://cdn.jsdelivr.net/gh/yelog/assets/images/picgo_qiniu20220802004250.png" alt="è¯·æ±‚è°ƒç”¨"></p><p>æˆ‘ä»¬éœ€è¦å¼€å‘çš„ API ä¸º <code>/addMo</code>, æ‰“ç®—å†™åœ¨ <code>Order</code> è¿™ä¸ªå¾®æœåŠ¡é‡Œé¢, å¹¶ä¸”ä»–ä¼šè°ƒç”¨ <code>common</code> è¿™ä¸ªå¾®æœåŠ¡çš„ <code>/getDict</code> è·å–ä¸€ä¸ªå­—å…¸æ•°æ®, <code>/getDict</code> æ˜¯ç°æˆçš„, ä¸éœ€è¦å¼€å‘, å¦‚æœæ˜¯ä¹‹å‰çš„æƒ…å†µ, å¼€å‘æœ¬åœ°è‡³å°‘éœ€è¦å¯åŠ¨5ä¸ªå¾®æœåŠ¡æ‰èƒ½è¿›è¡Œè°ƒè¯•.</p><p><img src="https://cdn.jsdelivr.net/gh/yelog/assets/images/picgo_qiniu20220802004109.png" alt="å®ç°æ•ˆæœ"></p><h2 id="ä¸‰ã€å…·ä½“å®ç°"><a href="#ä¸‰ã€å…·ä½“å®ç°" class="headerlink" title="ä¸‰ã€å…·ä½“å®ç°"></a>ä¸‰ã€å…·ä½“å®ç°</h2><h3 id="3-1-æµ‹è¯•ç¯å¢ƒè®¾ç½®-metadata"><a href="#3-1-æµ‹è¯•ç¯å¢ƒè®¾ç½®-metadata" class="headerlink" title="3.1 æµ‹è¯•ç¯å¢ƒè®¾ç½® metadata"></a>3.1 æµ‹è¯•ç¯å¢ƒè®¾ç½® metadata</h3><p>ç”±äºæµ‹è¯•ç¯å¢ƒéƒ½æ˜¯é€šè¿‡å®¹å™¨éƒ¨ç½²çš„, é‚£ä¹ˆå¯åŠ¨æ–¹å¼å°±æ˜¯ä¸‹é¢å®¹å™¨ä¸­çš„ <code>CMD</code>, æˆ‘ä»¬åœ¨å…¶ä¸­åŠ å…¥ <code>-Dspring.cloud.nacos.discovery.metadata.lemes-env=product</code>, ç”¨äºåŒºåˆ†å¼€å‘ç¯å¢ƒçš„å¾®æœåŠ¡æµ‹æµ‹è¯•ç¯å¢ƒçš„å¾®æœåŠ¡</p><pre><code class="Dockerfile"># è¯´æ˜ï¼šDockerfile è¿‡ç¨‹åˆ†ä¸ºä¸¤éƒ¨åˆ†ã€‚ç¬¬ä¸€æ¬¡ç”¨æ¥è§£å‹ jar åŒ…ï¼Œå¹¶ä¸ä¼šåœ¨ç›®æ ‡é•œåƒå†…äº§ç”Ÿ history/layerã€‚ç¬¬äºŒéƒ¨åˆ†å°†è§£å‹å†…å®¹åˆ† layer æ‹·è´åˆ°ç›®æ ‡é•œåƒå†…# ç›®çš„ï¼šæ›´æ–°é•œåƒæ—¶ï¼Œåªéœ€è¦ä¼ è¾“ä»£ç éƒ¨åˆ†ï¼Œä¾èµ–æ²¡æœ‰å˜åŠ¨åˆ™ä¸æ›´æ–°ï¼ŒèŠ‚çœå‘åŒ…æ—¶çš„ç½‘ç»œä¼ è¾“é‡# åŸç†ï¼šåœ¨ç¬¬äºŒéƒ¨åˆ†ä¸­ï¼Œæ¯æ¬¡ copy å°±ä¼šåœ¨ç›®æ ‡é•œåƒå†…äº§ç”Ÿä¸€å±‚ layerï¼Œå°†ä¾èµ–å’Œä»£ç åˆ†å¼€ï¼Œ#      ç»å¤§éƒ¨åˆ†æ›´æ–°éƒ½ä¸ä¼šåŠ¨åˆ°ä¾èµ–ï¼Œæ‰€ä»¥åªéœ€æ›´æ–°ä»£ç å‡ åkå·¦å³çš„ä»£ç å±‚å³å¯FROM 10.176.66.20:5000/library/amazoncorretto:11.0.11  as builderWORKDIR /buildARG ARTIFACT_IDCOPY target/$&#123;ARTIFACT_ID&#125;.jar app.jarRUN java -Djarmode=layertools -jar app.jar extract &amp;&amp; rm app.jarFROM 10.176.66.20:5000/library/amazoncorretto:11.0.11LABEL maintainer=&quot;yangyj13@lenovo.com&quot;WORKDIR /dataARG ARTIFACT_IDENV ARTIFACT_ID $&#123;ARTIFACT_ID&#125;# ä¾èµ–COPY --from=builder /build/dependencies/ ./COPY --from=builder /build/snapshot-dependencies/ ./COPY --from=builder /build/spring-boot-loader/ ./# åº”ç”¨ä»£ç COPY --from=builder /build/application/ ./# å®¹å™¨è¿è¡Œæ—¶å¯åŠ¨å‘½ä»¤CMD echo &quot;NACOS_ADDR: $&#123;NACOS_ADDR&#125;&quot;; \    echo &quot;JAVA_OPTS: $&#123;JAVA_OPTS&#125;&quot;; \    echo &quot;TZ: $&#123;TZ&#125;&quot;; \    echo &quot;ARTIFACT_ID: $&#123;ARTIFACT_ID&#125;&quot;; \    # å»é™¤äº† server çš„åº”ç”¨å    REAL_APP_NAME=$&#123;ARTIFACT_ID//-server/&#125;; \    echo &quot;REAL_APP_NAME: $&#123;REAL_APP_NAME&#125;&quot;; \    # è·å–å½“å‰æ—¶é—´    now=`date +%F+%T+%Z`; \    # java å¯åŠ¨å‘½ä»¤    java $JAVA_OPTS \    -Dtingyun.app_name=$&#123;REAL_APP_NAME&#125;-$&#123;TINGYUN_SUFFIX&#125; \    -Dspring.cloud.nacos.discovery.metadata.lemes-env=product \    -Dspring.cloud.nacos.discovery.metadata.startup-time=$&#123;now&#125; \    -Dspring.cloud.nacos.discovery.server-addr=$&#123;NACOS_ADDR&#125; \    -Dspring.cloud.nacos.discovery.group=$&#123;NACOS_GROUP&#125; \    -Dspring.cloud.nacos.config.namespace=$&#123;NACOS_NAMESPACE&#125; \    -Dspring.cloud.nacos.discovery.namespace=$&#123;NACOS_NAMESPACE&#125; \    -Dspring.cloud.nacos.discovery.ip=$&#123;HOST_IP&#125; \    org.springframework.boot.loader.JarLauncher</code></pre><p><img src="https://cdn.jsdelivr.net/gh/yelog/assets/images/picgo_qiniu20220802135945.png" alt="set nacos metadata"></p><h3 id="3-2-å¼€å‘å‰ç«¯ä¼ é€’å¼€å¯æ™ºèƒ½è¿æ¥"><a href="#3-2-å¼€å‘å‰ç«¯ä¼ é€’å¼€å¯æ™ºèƒ½è¿æ¥" class="headerlink" title="3.2 å¼€å‘å‰ç«¯ä¼ é€’å¼€å¯æ™ºèƒ½è¿æ¥"></a>3.2 å¼€å‘å‰ç«¯ä¼ é€’å¼€å¯æ™ºèƒ½è¿æ¥</h3><pre><code class="js">const devIp = getLocalIP(&#39;10.&#39;)module.exports = &#123;  devServer: &#123;    proxy: &#123;      &#39;/lemes-api&#39;: &#123;        target: &#39;http://10.176.66.58/lemes-api&#39;,        ws: true,        pathRewrite: &#123;          &#39;^/lemes-api&#39;: &#39;/&#39;        &#125;,        headers: &#123;          &#39;dev-ip&#39;: devIp,          &#39;dev-sc&#39;: &#39;true&#39;        &#125;      &#125;    &#125;  &#125;,&#125;// è·å–æœ¬æœº IPfunction getLocalIP(prefix) &#123;  const excludeNets = [&#39;docker&#39;, &#39;cni&#39;, &#39;flannel&#39;, &#39;vi&#39;, &#39;ve&#39;]  const os = require(&#39;os&#39;)  const osType = os.type() // ç³»ç»Ÿç±»å‹  const netInfo = os.networkInterfaces() // ç½‘ç»œä¿¡æ¯  const ipList = []  if (prefix) &#123;    for (const netInfoKey in netInfo) &#123;      if (excludeNets.filter(item =&gt; netInfoKey.startsWith(item)).length === 0) &#123;        for (let i = 0; i &lt; netInfo[netInfoKey].length; i++) &#123;          const net = netInfo[netInfoKey][i]          if (net.family === &#39;IPv4&#39; &amp;&amp; net.address.startsWith(prefix)) &#123;            ipList.push(net.address)          &#125;        &#125;      &#125;    &#125;  &#125;  if (ipList.length === 0) &#123;    if (osType === &#39;Windows_NT&#39;) &#123;      for (const dev in netInfo) &#123;        // win7çš„ç½‘ç»œä¿¡æ¯ä¸­æ˜¾ç¤ºä¸ºæœ¬åœ°è¿æ¥ï¼Œwin10æ˜¾ç¤ºä¸ºä»¥å¤ªç½‘        if (dev === &#39;æœ¬åœ°è¿æ¥&#39; || dev === &#39;ä»¥å¤ªç½‘&#39;) &#123;          for (let j = 0; j &lt; netInfo[dev].length; j++) &#123;            if (netInfo[dev][j].family === &#39;IPv4&#39;) &#123;              ipList.push(netInfo[dev][j].address)            &#125;          &#125;        &#125;      &#125;    &#125; else if (osType === &#39;Linux&#39;) &#123;      ipList.push(netInfo.eth0[0].address)    &#125; else if (osType === &#39;Darwin&#39;) &#123;      ipList.push(netInfo.en0[0].address)    &#125;  &#125;  console.log(&#39;è¯†åˆ«åˆ°çš„ç½‘å¡ä¿¡æ¯&#39;, JSON.stringify(ipList))  return ipList.length &gt; 0 ? ipList[0] : &#39;&#39;&#125;</code></pre><h3 id="3-3-åç«¯ç°åº¦å¤„ç†"><a href="#3-3-åç«¯ç°åº¦å¤„ç†" class="headerlink" title="3.3 åç«¯ç°åº¦å¤„ç†"></a>3.3 åç«¯ç°åº¦å¤„ç†</h3><p>ä¸è®ºæ˜¯ <code>gateway</code> è¿˜æ˜¯ <code>openfeign</code> éƒ½æ˜¯é€šè¿‡ spring çš„ <code>loadbalancer</code> è¿›è¡Œåº”ç”¨é€‰æ‹©çš„, é‚£æˆ‘ä»¬é€šè¿‡å®ç°æˆ–è€…ç»§æ‰¿ <code>ReactorServiceInstanceLoadBalancer</code> æ¥é‡å†™é€‰æ‹©çš„è¿‡ç¨‹.</p><pre><code class="java">@Log4j2public class LemesLoadBalancer implements ReactorServiceInstanceLoadBalancer&#123;    @Autowired    private NacosDiscoveryProperties nacosDiscoveryProperties;    final AtomicInteger position;    // loadbalancer æä¾›çš„è®¿é—®å½“å‰æœåŠ¡çš„åç§°    final String serviceId;    // loadbalancer æä¾›çš„è®¿é—®çš„æœåŠ¡åˆ—è¡¨    ObjectProvider&lt;ServiceInstanceListSupplier&gt; serviceInstanceListSupplierProvider;    public LemesLoadBalancer(ObjectProvider&lt;ServiceInstanceListSupplier&gt; serviceInstanceListSupplierProvider, String serviceId) &#123;        this(serviceInstanceListSupplierProvider, serviceId, new Random().nextInt(1000));    &#125;    public LemesLoadBalancer(ObjectProvider&lt;ServiceInstanceListSupplier&gt; serviceInstanceListSupplierProvider,                             String serviceId, int seedPosition) &#123;        this.serviceId = serviceId;        this.serviceInstanceListSupplierProvider = serviceInstanceListSupplierProvider;        this.position = new AtomicInteger(seedPosition);    &#125;    @Override    public Mono&lt;Response&lt;ServiceInstance&gt;&gt; choose(Request request) &#123;        ServiceInstanceListSupplier supplier = serviceInstanceListSupplierProvider                .getIfAvailable(NoopServiceInstanceListSupplier::new);        RequestDataContext context = (RequestDataContext) request.getContext();        RequestData clientRequest = context.getClientRequest();        return supplier.get(request).next()                .map(serviceInstances -&gt; processInstanceResponse(clientRequest,supplier, serviceInstances));    &#125;    private Response&lt;ServiceInstance&gt; processInstanceResponse(RequestData clientRequest,ServiceInstanceListSupplier supplier,                                                              List&lt;ServiceInstance&gt; serviceInstances) &#123;        Response&lt;ServiceInstance&gt; serviceInstanceResponse = getInstanceResponse(clientRequest,serviceInstances);        if (supplier instanceof SelectedInstanceCallback &amp;&amp; serviceInstanceResponse.hasServer()) &#123;            ((SelectedInstanceCallback) supplier).selectedServiceInstance(serviceInstanceResponse.getServer());        &#125;        return serviceInstanceResponse;    &#125;    private Response&lt;ServiceInstance&gt; getInstanceResponse(RequestData clientRequest, List&lt;ServiceInstance&gt; instances) &#123;        if (instances.isEmpty()) &#123;            if (log.isWarnEnabled()) &#123;                log.warn(&quot;No servers available for service: &quot; + serviceId);            &#125;            return new EmptyResponse();        &#125;        int pos = Math.abs(this.position.incrementAndGet());        // ç­›é€‰åçš„æœåŠ¡åˆ—è¡¨        List&lt;ServiceInstance&gt; filteredInstances;        String devSmartConnect = clientRequest.getHeaders().getFirst(CommonConstants.DEV_SMART_CONNECT);        if (StrUtil.equals(devSmartConnect, &quot;true&quot;)) &#123;            String devIp = clientRequest.getHeaders().getFirst(CommonConstants.DEV_IP);            // devIp ä¸ºç©ºï¼Œä¸ºå¼‚å¸¸æƒ…å†µä¸å¤„ç†ï¼Œè¿”å›ç©ºå®ä¾‹é›†åˆ            if (StrUtil.isBlank(devIp)) &#123;                log.warn(&quot;devIp is NULL,No servers available for service: &quot; + serviceId);                return new EmptyResponse();            &#125;            // æ™ºèƒ½è¿æ¥: å¦‚æœæœ¬åœ°å¯åŠ¨äº†æœåŠ¡ï¼Œåˆ™ä¼˜å…ˆè®¿é—®æœ¬åœ°æœåŠ¡ï¼Œå¦‚æœæœ¬åœ°æ²¡æœ‰å¯åŠ¨ï¼Œåˆ™è®¿é—®æµ‹è¯•ç¯å¢ƒæœåŠ¡            // ä¼˜å…ˆè°ƒç”¨æœ¬åœ°è‡ªæœ‰æœåŠ¡            filteredInstances = instances.stream().filter(item -&gt; StrUtil.equals(devIp, item.getHost())).collect(Collectors.toList());            // å¦‚æœæœ¬åœ°æœåŠ¡æ²¡æœ‰å¼€å¯ï¼Œåˆ™è°ƒç”¨ç”Ÿäº§/æµ‹è¯•æœåŠ¡            if (CollUtil.isEmpty(filteredInstances)) &#123;                filteredInstances = instances.stream()                        .filter(item -&gt; StrUtil.equals(CommonConstants.LEMES_ENV_PRODUCT, item.getMetadata().get(&quot;lemes-env&quot;)))                        .collect(Collectors.toList());                // è§£å†³å¼€å‘ç¯å¢ƒæ— æ³•è®¿é—® k8s é›†ç¾¤å†… ip çš„é—®é¢˜                String oneNacosIp = nacosDiscoveryProperties.getServerAddr().split(&quot;,&quot;)[0].replaceAll(&quot;:[\\s\\S]*&quot;, &quot;&quot;);                filteredInstances.forEach(item -&gt; &#123;                    NacosServiceInstance instance = (NacosServiceInstance) item;                    // cloud ä»¥ 80 ç«¯å£å¯åŠ¨ï¼Œè®¤ä¸ºæ˜¯ k8s å†…çš„åº”ç”¨                    if (instance.getPort() == 80) &#123;                        instance.setHost(oneNacosIp);                        instance.setPort(Integer.parseInt(item.getMetadata().get(&quot;port&quot;)));                    &#125;                &#125;);            &#125;        &#125; else &#123;            // ä¸æ˜¯æ™ºèƒ½è®¿é—®ï¼Œåˆ™åªè®¿é—®ä¸€ä¸ªç¯å¢ƒ            // å½“å‰æœåŠ¡ ip            String currentIp = nacosDiscoveryProperties.getIp();            String lemesEnv = nacosDiscoveryProperties.getMetadata().get(&quot;lemes-env&quot;);            filteredInstances = instances.stream()                    .filter(item -&gt; StrUtil.equals(lemesEnv, CommonConstants.LEMES_ENV_PRODUCT)                            // è®¿é—®æµ‹è¯•ç¯å¢ƒ                            ? StrUtil.equals(CommonConstants.LEMES_ENV_PRODUCT, item.getMetadata().get(&quot;lemes-env&quot;))                            // è®¿é—®å¼€å‘ç¯å¢ƒ                            : StrUtil.equals(currentIp, item.getHost()))                    .collect(Collectors.toList());        &#125;        if (filteredInstances.isEmpty()) &#123;            log.warn(&quot;No oneself servers and beta servers available for service: &quot; + serviceId + &quot;, use other instances&quot;);            // æ‰¾ä¸åˆ°è‡ªå·±æ³¨å†ŒIPå¯¹åº”çš„æœåŠ¡å’Œæµ‹è¯•æœåŠ¡ï¼Œåˆ™ç”¨nacosä¸­å…¶å®ƒçš„æœåŠ¡            filteredInstances = instances;        &#125;        //æœ€ç»ˆçš„è¿”å›çš„ serviceInstance        ServiceInstance instance = filteredInstances.get(pos % filteredInstances.size());        return new DefaultResponse(instance);    &#125;&#125;</code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;ä¸€ã€èƒŒæ™¯&quot;&gt;&lt;a href=&quot;#ä¸€ã€èƒŒæ™¯&quot; class=&quot;headerlink&quot; title=&quot;ä¸€ã€èƒŒæ™¯&quot;&gt;&lt;/a&gt;ä¸€ã€èƒŒæ™¯&lt;/h2&gt;&lt;p&gt;åå°æ¡†æ¶æ˜¯åŸºäº spring cloud çš„å¾®æœåŠ¡ä½“ç³», å½“å¼€å‘åŒå­¦åœ¨è‡ªå·±ç”µè„‘ä¸Šè¿›è¡Œå¼€å‘å·¥ä½œæ—¶, æ¯”å¦‚å¼€å‘è®¢å•æ¨¡å—, é™¤äº†éœ€</summary>
      
    
    
    
    <category term="åç«¯" scheme="http://yelog.org/categories/%E5%90%8E%E7%AB%AF/"/>
    
    
    <category term="java" scheme="http://yelog.org/tags/java/"/>
    
    <category term="k8s" scheme="http://yelog.org/tags/k8s/"/>
    
    <category term="nacos" scheme="http://yelog.org/tags/nacos/"/>
    
    <category term="springcloud" scheme="http://yelog.org/tags/springcloud/"/>
    
    <category term="gray-release" scheme="http://yelog.org/tags/gray-release/"/>
    
  </entry>
  
  <entry>
    <title>åŸºäº nacos/springcloud/k8s çš„ä¸åœæœºæœåŠ¡æ›´æ–°[graceful shutdown]</title>
    <link href="http://yelog.org/2022/07/27/springboot-graceful-shutdown-based-on-nacos2-and-k8s/"/>
    <id>http://yelog.org/2022/07/27/springboot-graceful-shutdown-based-on-nacos2-and-k8s/</id>
    <published>2022-07-27T07:35:39.000Z</published>
    <updated>2024-08-12T09:33:11.981Z</updated>
    
    <content type="html"><![CDATA[<h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>æˆ‘ä»¬çš„ SpringCloud æ˜¯éƒ¨ç½²åœ¨ k8s ä¸Šçš„, å½“é€šè¿‡ k8s è¿›è¡Œæ»šåŠ¨å‡çº§æ—¶, ä¼šæœ‰è¯·æ±‚ 500 çš„æƒ…å†µ, ä¸åˆ©äºç”¨æˆ·ä½“éªŒ, ä¸¥é‡çš„å¯èƒ½é€ æˆæ•°æ®é”™è¯¯çš„é—®é¢˜</p><blockquote><p>k8s æ»šåŠ¨æ›´æ–°ç­–ç•¥ä»‹ç»<br>å‡è®¾æˆ‘ä»¬è¦å‡çº§çš„å¾®æœåŠ¡åœ¨ç¯å¢ƒä¸Šä¸º3ä¸ªå‰¯æœ¬çš„é›†ç¾¤, å‡çº§åº”ç”¨æ—¶, ä¼šå…ˆå¯åŠ¨1ä¸ªæ–°ç‰ˆæœ¬çš„å‰¯æœ¬, ç„¶åä¸‹çº¿ä¸€ä¸ªæ—§ç‰ˆæœ¬çš„å‰¯æœ¬, ä¹‹åå†å¯åŠ¨1ä¸ªæ–°ç‰ˆæœ¬çš„å‰¯æœ¬, ä¸€æ¬¡ç±»æ¨,ç›´åˆ°æ‰€æœ‰æ—§å‰¯æœ¬éƒ½æ›¿æ¢æ–°å‰¯æœ¬.</p></blockquote><p>é€šè¿‡é“¾è·¯è¿½è¸ªåˆ†æ, æŠ¥é”™çš„åŸå› åˆ†åˆ«ç”±ä»¥ä¸‹ä¸¤ç§æƒ…å†µ</p><ol><li>SpringCloud ä¸­çš„å¾®æœåŠ¡åœ¨å‡çº§è¿‡ç¨‹ä¸­, å½“æ—§çš„å¾®æœåŠ¡ä¸­è¿˜æœ‰æ²¡æœ‰å¤„ç†å®Œæˆçš„è¯·æ±‚æ—¶, å°±å¼€å§‹å…³é—­åŠ¨ä½œ, é€ æˆè¯·æ±‚ä¸­æ–­</li><li>å½“æ—§åº”ç”¨æ‰§è¡Œå…³é—­åŠ¨ä½œæ—¶, å·²ç»å¼€å§‹æ‹’ç»è¯·æ±‚, ä½†æ˜¯ nacos ä¸­çš„è·¯ç”±å¹¶æ²¡æœ‰åŠæ—¶æ›´æ–°, é€ æˆ gateway&#x2F;openfeign åœ¨è·¯ç”±æ—¶ä»ä¼šå‘½ä¸­æ­£åœ¨å…³é—­çš„åº”ç”¨, é€ æˆè¯·æ±‚æŠ¥é”™</li></ol><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜, æˆ‘ä»¬å°†åˆ©ç”¨ springboot çš„ graceful shutdown åŠŸèƒ½å’Œ nacos çš„ä¸»åŠ¨ä¸‹çº¿åŠŸèƒ½æ¥è§£å†³è¿™ä¸ªé—®é¢˜. å…·ä½“æ€è·¯å¦‚ä¸‹:</p><p>æ¯”å¦‚å½“æˆ‘ä»¬æ‰§è¡Œè®¢å•å¾®æœåŠ¡(3ä¸ªå‰¯æœ¬)æ»šåŠ¨æ›´æ–°æ—¶</p><ol><li>å…ˆå¯åŠ¨ä¸€ä¸ªæ–°ç‰ˆæœ¬<code>å‰¯æœ¬4</code></li><li>ç„¶åå‡†å¤‡å…³é—­<code>å‰¯æœ¬1</code>, åœ¨å…³é—­ä¹‹å‰å…ˆé€šçŸ¥ nacos è®¢å•æœåŠ¡çš„<code>å‰¯æœ¬1</code>ä¸‹çº¿, ç„¶åç”± nacos é€šçŸ¥ç»™å…¶ä»–åº”ç”¨(nacos2.x æ˜¯grpc, æ‰€ä»¥é€šçŸ¥é€Ÿåº¦æ¯”è¾ƒå¿«), è¿™æ ·, è®¢å•æœåŠ¡çš„<code>å‰¯æœ¬1</code>å°±ä¸ä¼šå†æ¥æ”¶åˆ°è¯·æ±‚, ç„¶åæ‰§è¡Œ graceful shutdown(springboot åŸç”Ÿæ”¯æŒ, å¯ç”¨æ–¹æ³•å¯ä»¥çœ‹åé¢ä»£ç ), æ‰€æœ‰è¯·æ±‚å¤„ç†å®Œæˆåå…³é—­åº”ç”¨. è¿™æ ·å°±å®Œæˆäº† <code>å‰¯æœ¬1</code> çš„å…³é—­</li><li>å¯åŠ¨æ–°ç‰ˆæœ¬<code>å‰¯æœ¬5</code></li><li>å†ä¼˜é›…å…³é—­<code>å‰¯æœ¬2</code>(å‚è€ƒç¬¬2ç‚¹<code>å‰¯æœ¬1</code>çš„æµç¨‹)</li><li>ç„¶åå¯åŠ¨æ–°ç‰ˆæœ¬<code>å‰¯æœ¬6</code></li><li>å†ä¼˜é›…å…³é—­<code>å‰¯æœ¬3</code></li><li>å®Œæˆäº†æœåŠ¡ä¸ä¸­æ–­çš„åº”ç”¨å‡çº§</li></ol><h2 id="å®ç°å…³é”®ç‚¹"><a href="#å®ç°å…³é”®ç‚¹" class="headerlink" title="å®ç°å…³é”®ç‚¹"></a>å®ç°å…³é”®ç‚¹</h2><p>ä¸ºäº†å®ç°ä¸Šé¢èƒŒæ™¯ä¸­æåˆ°çš„æ€è·¯, ä¸»è¦ä»å¦‚ä¸‹å‡ ä¸ªæ–¹é¢å…¥æ‰‹</p><h3 id="åˆ›å»ºä»-nacos-ä¸­ä¸‹çº¿å‰¯æœ¬çš„API"><a href="#åˆ›å»ºä»-nacos-ä¸­ä¸‹çº¿å‰¯æœ¬çš„API" class="headerlink" title="åˆ›å»ºä» nacos ä¸­ä¸‹çº¿å‰¯æœ¬çš„API"></a>åˆ›å»ºä» nacos ä¸­ä¸‹çº¿å‰¯æœ¬çš„API</h3><p>æˆ‘ä»¬é€šè¿‡åˆ›å»ºè‡ªå®šä¹‰åä¸º <code>deregister</code> çš„ <code>endpoint</code> æ¥é€šçŸ¥ <code>nacos</code> ä¸‹çº¿å‰¯</p><pre><code class="java">import com.alibaba.cloud.nacos.NacosDiscoveryProperties;import com.alibaba.cloud.nacos.registry.NacosRegistration;import com.alibaba.cloud.nacos.registry.NacosServiceRegistry;import lombok.extern.log4j.Log4j2;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.boot.actuate.endpoint.annotation.Endpoint;import org.springframework.boot.actuate.endpoint.annotation.ReadOperation;import org.springframework.stereotype.Component;@Component@Endpoint(id = &quot;deregister&quot;)@Log4j2public class LemesNacosServiceDeregisterEndpoint &#123;    @Autowired    private NacosDiscoveryProperties nacosDiscoveryProperties;    @Autowired    private NacosRegistration nacosRegistration;    @Autowired    private NacosServiceRegistry nacosServiceRegistry;    /**     * ä» nacos ä¸­ä¸»åŠ¨ä¸‹çº¿ï¼Œç”¨äº k8s æ»šåŠ¨æ›´æ–°æ—¶ï¼Œæå‰ä¸‹çº¿åˆ†æµæµé‡     *     * @param     * @return com.lenovo.lemes.framework.core.util.ResultData&lt;java.lang.String&gt;     * @author Yujie Yang     * @date 4/6/22 2:57 PM     */    @ReadOperation    public String endpoint() &#123;        String serviceName = nacosDiscoveryProperties.getService();        String groupName = nacosDiscoveryProperties.getGroup();        String clusterName = nacosDiscoveryProperties.getClusterName();        String ip = nacosDiscoveryProperties.getIp();        int port = nacosDiscoveryProperties.getPort();        log.info(&quot;deregister from nacos, serviceName:&#123;&#125;, groupName:&#123;&#125;, clusterName:&#123;&#125;, ip:&#123;&#125;, port:&#123;&#125;&quot;, serviceName, groupName, clusterName, ip, port);        // è®¾ç½®æœåŠ¡ä¸‹çº¿        nacosServiceRegistry.setStatus(nacosRegistration, &quot;DOWN&quot;);        return &quot;success&quot;;    &#125;&#125;</code></pre><h3 id="æ”¯æŒ-Graceful-Shutdown"><a href="#æ”¯æŒ-Graceful-Shutdown" class="headerlink" title="æ”¯æŒ Graceful Shutdown"></a>æ”¯æŒ Graceful Shutdown</h3><p>ç”±äº springboot åŸç”Ÿæ”¯æŒ, æˆ‘ä»¬åªéœ€è¦åœ¨ <code>bootstrap.yaml</code> ä¸­æ·»åŠ å¦‚ä¸‹é…ç½®å³å¯</p><pre><code class="yaml">server:  # å¼€å¯ä¼˜é›…ä¸‹çº¿  shutdown: gracefulspring:  lifecycle:    # ä¼˜é›…ä¸‹çº¿è¶…æ—¶æ—¶é—´    timeout-per-shutdown-phase: 5m# æš´éœ² shutdown æ¥å£management:  endpoint:    shutdown:      enabled: true  endpoints:    web:      exposure:        include: shutdown</code></pre><h3 id="K8s-é…ç½®"><a href="#K8s-é…ç½®" class="headerlink" title="K8s é…ç½®"></a>K8s é…ç½®</h3><p>æœ‰äº†ä¸Šé¢ä¸¤ä¸ª API, æ¥ä¸‹æ¥å°±é…ç½®åˆ° k8s ä¸Š</p><ol><li>terminationGracePeriodSeconds å¦‚æœå…³é—­åº”ç”¨çš„æ—¶é—´è¶…è¿‡ 10 åˆ†é’Ÿ, åˆ™å‘å®¹å™¨å‘é€ TERM ä¿¡å·, é˜²æ­¢åº”ç”¨é•¿æ—¶é—´ä¸‹çº¿ä¸äº†</li><li>preStop å…ˆæ‰§è¡Œä¸‹çº¿æ“ä½œ, ç­‰å¾…30s, ç•™å¤Ÿé€šçŸ¥åˆ°å…¶ä»–åº”ç”¨çš„æ—¶é—´, ç„¶åæ‰§è¡Œ graceful shutdown å…³é—­åº”ç”¨</li></ol><pre><code class="yaml">---apiVersion: apps/v1kind: Deploymentmetadata:  name: lemes-service-common  labels:    app: lemes-service-commonspec:  replicas: 2  selector:    matchLabels:      app: lemes-service-common#  strategy:#    type: RollingUpdate#    rollingUpdate:##     replicas - maxUnavailable &lt; running num  &lt; replicas + maxSurge#      maxUnavailable: 1#      maxSurge: 1  template:    metadata:      labels:        app: lemes-service-common    spec:#      å®¹å™¨é‡å¯ç­–ç•¥ Never Always OnFailure#      restartPolicy: Never#     å¦‚æœå…³é—­æ—¶é—´è¶…è¿‡10åˆ†é’Ÿï¼Œ åˆ™å‘å®¹å™¨å‘é€ TERM ä¿¡å·      terminationGracePeriodSeconds: 600      affinity:        podAntiAffinity:          preferredDuringSchedulingIgnoredDuringExecution:            - podAffinityTerm:                topologyKey: &quot;kubernetes.io/hostname&quot;                labelSelector:                  matchExpressions:                    - key: app                      operator: In                      values:                        - lemes-service-common              weight: 100#          requiredDuringSchedulingIgnoredDuringExecution:#            - labelSelector:#                matchExpressions:#                  - key: app#                    operator: In#                    values:#                      - lemes-service-common#              topologyKey: &quot;kubernetes.io/hostname&quot;      volumes:        - name: lemes-host-path          hostPath:            path: /data/logs            type: DirectoryOrCreate        - name: sidecar          emptyDir: &#123; &#125;      containers:        - name: lemes-service-common          image: 10.176.66.20:5000/lemes-cloud/lemes-service-common-server:v0.1          imagePullPolicy: Always          volumeMounts:            - name: lemes-host-path              mountPath: /data/logs            - name: sidecar              mountPath: /sidecar          ports:            - containerPort: 80          resources:#           èµ„æºé€šå¸¸æƒ…å†µä¸‹çš„å ç”¨            requests:              memory: &#39;2048Mi&#39;#           èµ„æºå ç”¨ä¸Šé™            limits:              memory: &#39;4096Mi&#39;          livenessProbe:            httpGet:              path: /actuator/health/liveness              port: 80            initialDelaySeconds: 5#           æ¢é’ˆå¯ä»¥è¿ç»­å¤±è´¥çš„æ¬¡æ•°            failureThreshold: 10#           æ¢é’ˆè¶…æ—¶æ—¶é—´            timeoutSeconds: 10#           å¤šä¹…æ‰§è¡Œä¸€æ¬¡æ¢é’ˆæŸ¥è¯¢            periodSeconds: 10          startupProbe:            httpGet:              path: /actuator/health/liveness              port: 80            failureThreshold: 30            timeoutSeconds: 10            periodSeconds: 10          readinessProbe:            httpGet:              path: /actuator/health/readiness              port: 80            initialDelaySeconds: 5            timeoutSeconds: 10            periodSeconds: 10          lifecycle:            preStop:              exec:#               åº”ç”¨å…³é—­æ“ä½œï¼š1. ä» nacos ä¸‹çº¿ï¼Œ2. ç­‰å¾…30s, ä¿è¯ nacos é€šçŸ¥åˆ°å…¶ä»–åº”ç”¨ 2.è§¦å‘ springboot çš„ graceful shutdown                command:                  - sh                  - -c                  - curl http://127.0.0.1/actuator/deregister;sleep 30;curl -X POST http://127.0.0.1/actuator/shutdown;</code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;èƒŒæ™¯&quot;&gt;&lt;a href=&quot;#èƒŒæ™¯&quot; class=&quot;headerlink&quot; title=&quot;èƒŒæ™¯&quot;&gt;&lt;/a&gt;èƒŒæ™¯&lt;/h2&gt;&lt;p&gt;æˆ‘ä»¬çš„ SpringCloud æ˜¯éƒ¨ç½²åœ¨ k8s ä¸Šçš„, å½“é€šè¿‡ k8s è¿›è¡Œæ»šåŠ¨å‡çº§æ—¶, ä¼šæœ‰è¯·æ±‚ 500 çš„æƒ…å†µ, ä¸åˆ©äºç”¨æˆ·ä½“éªŒ, ä¸¥</summary>
      
    
    
    
    <category term="åç«¯" scheme="http://yelog.org/categories/%E5%90%8E%E7%AB%AF/"/>
    
    
    <category term="java" scheme="http://yelog.org/tags/java/"/>
    
    <category term="k8s" scheme="http://yelog.org/tags/k8s/"/>
    
    <category term="nacos" scheme="http://yelog.org/tags/nacos/"/>
    
    <category term="springcloud" scheme="http://yelog.org/tags/springcloud/"/>
    
  </entry>
  
  <entry>
    <title>2022å¹´æˆ‘åœ¨ä½¿ç”¨è¿™äº›vimæ’ä»¶</title>
    <link href="http://yelog.org/2022/06/27/vim-plugs-2022/"/>
    <id>http://yelog.org/2022/06/27/vim-plugs-2022/</id>
    <published>2022-06-27T07:07:39.000Z</published>
    <updated>2024-08-12T09:33:11.752Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ä»ç¬¬ä¸€æ¬¡æ¥è§¦ <code>vim</code> å·²é€¾æœŸ 10 å¹´, æœŸé—´å¤§éƒ¨åˆ†éƒ½æ˜¯ä¸€äº›ç®€å•æ“ä½œ,<br>æœ€è¿‘ä¸€ä¸¤å¹´å¼€å§‹æ·±åº¦ä½¿ç”¨ <code>vim</code>, ç›®å‰ä½¿ç”¨ <code>neovim</code> ç‰ˆæœ¬.<br>æœ¬æ–‡å°†è®°å½•ä¸€äº›ç¬”è€…è§‰å¾—å¥½ç”¨çš„ä¸€äº› <code>Plugin</code>, æœ¬æ–‡ä¹Ÿå°†æŒç»­æ›´æ–°.</p><blockquote><p>æ³¨æ„: ç¬”è€…ä½¿ç”¨çš„æ’ä»¶ç®¡ç†å™¨æ˜¯ <a href="https://github.com/junegunn/vim-plug">vim-plug</a>,<br>æ‰€ä»¥ä»¥ä¸‹ç¤ºä¾‹éƒ½æ˜¯åŸºäº <code>vim-plug</code> æ¥å†™çš„.</p></blockquote><h2 id="Goto-Open"><a href="#Goto-Open" class="headerlink" title="Goto&#x2F;Open"></a>Goto&#x2F;Open</h2><h3 id="vim-open-url"><a href="#vim-open-url" class="headerlink" title="vim-open-url"></a>vim-open-url</h3><p><a href="https://github.com/dhruvasagar/vim-open-url">vim-open-url</a><br>å¯ä»¥ç”¨æµè§ˆå™¨æ‰“å¼€å…‰æ ‡ä¸‹çš„ url. </p><ul><li><code>gB</code> ç”¨é»˜è®¤æµè§ˆå™¨æ‰“å¼€å…‰æ ‡ä¸‹çš„ url</li><li><code>g&lt;CR&gt;</code> ä½¿ç”¨é»˜è®¤æœç´¢å¼•æ“æœç´¢å…‰æ ‡ä¸‹çš„å•è¯</li><li><code>gG</code> ä½¿ç”¨ Google æœç´¢å…‰æ ‡ä¸‹çš„å•è¯</li><li><code>gW</code> ä½¿ç”¨ Wikipedia æœç´¢å…‰æ ‡ä¸‹çš„å•è¯</li></ul><pre><code class="vim">Plug &#39;dhruvasagar/vim-open-url&#39;</code></pre><h2 id="Auto-Complete"><a href="#Auto-Complete" class="headerlink" title="Auto Complete"></a>Auto Complete</h2><h3 id="neoclide-coc-nvim"><a href="#neoclide-coc-nvim" class="headerlink" title="neoclide&#x2F;coc.nvim"></a>neoclide&#x2F;coc.nvim</h3>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;ä»ç¬¬ä¸€æ¬¡æ¥è§¦ &lt;code&gt;vim&lt;/code&gt; å·²é€¾æœŸ 10 å¹´, æœŸé—´å¤§éƒ¨åˆ†éƒ½æ˜¯ä¸€äº›ç®€å•æ“ä½œ,&lt;br&gt;æœ€è¿‘ä¸€ä¸¤å¹´å¼€å§‹æ·±åº¦ä½¿ç”¨ &lt;code&gt;</summary>
      
    
    
    
    <category term="è¿ç»´" scheme="http://yelog.org/categories/%E8%BF%90%E7%BB%B4/"/>
    
    
    <category term="vim" scheme="http://yelog.org/tags/vim/"/>
    
    <category term="neovim" scheme="http://yelog.org/tags/neovim/"/>
    
  </entry>
  
  <entry>
    <title>el-drawer å®ç°é¼ æ ‡æ‹–æ‹½å®½åº¦[ElementUI]</title>
    <link href="http://yelog.org/2022/06/24/el-drawer-drag-width/"/>
    <id>http://yelog.org/2022/06/24/el-drawer-drag-width/</id>
    <published>2022-06-24T11:38:00.000Z</published>
    <updated>2024-08-12T09:33:11.941Z</updated>
    
    <content type="html"><![CDATA[<h3 id="å®ç°æ•ˆæœ"><a href="#å®ç°æ•ˆæœ" class="headerlink" title="å®ç°æ•ˆæœ"></a>å®ç°æ•ˆæœ</h3><p><img src="https://cdn.jsdelivr.net/gh/yelog/assets/images/picgo_qiniu2022-06-25%2010.12.32.gif" alt="el-drawer-drag-width"></p><h3 id="å®ç°æ€è·¯"><a href="#å®ç°æ€è·¯" class="headerlink" title="å®ç°æ€è·¯"></a>å®ç°æ€è·¯</h3><p>é€šè¿‡æŒ‡ä»¤çš„æ–¹å¼, åœ¨ <code>drawer</code> çš„å·¦ä¾§è¾¹ç¼˜, æ·»åŠ ä¸€ä¸ªè§¦å‘æ‹–æ‹½çš„é•¿æ¡å½¢åŒºåŸŸ, ç›‘å¬é¼ æ ‡å·¦é”®æŒ‰ä¸‹æ—¶å¯åŠ¨ <code>document.onmousemove</code> çš„ç›‘å¬, ç›‘å¬é¼ æ ‡è·ç¦»æµè§ˆå™¨å³è¾¹çš„è·ç¦», è®¾ç½®ä¸º <code>drawer</code> çš„å®½åº¦, å¹¶æ·»åŠ çº¦æŸ: ä¸èƒ½å°äºæµè§ˆå™¨å®½åº¦çš„ 20%, ä¸èƒ½å¤§äºæµè§ˆå™¨å®½åº¦çš„ 80%.</p><h3 id="æŒ‡ä»¤ä»£ç "><a href="#æŒ‡ä»¤ä»£ç " class="headerlink" title="æŒ‡ä»¤ä»£ç "></a>æŒ‡ä»¤ä»£ç </h3><p>åˆ›å»ºæ–‡ä»¶ <code>src/directive/elment-ui/drawer-drag-width.js</code>, å†…å®¹å¦‚ä¸‹</p><pre><code class="js">import Vue from &#39;vue&#39;/** * el-drawer æ‹–æ‹½æŒ‡ä»¤ */Vue.directive(&#39;el-drawer-drag-width&#39;, &#123;  bind(el, binding, vnode, oldVnode) &#123;    const drawerEle = el.querySelector(&#39;.el-drawer&#39;)    console.log(drawerEle)    // åˆ›å»ºè§¦å‘æ‹–æ‹½çš„å…ƒç´     const dragItem = document.createElement(&#39;div&#39;)    // å°†å…ƒç´ æ”¾ç½®åˆ°æŠ½å±‰çš„å·¦è¾¹è¾¹ç¼˜    dragItem.style.cssText = &#39;height: 100%;width: 5px;cursor: w-resize;position: absolute;left: 0;&#39;    drawerEle.append(dragItem)    dragItem.onmousedown = (downEvent) =&gt; &#123;      // æ‹–æ‹½æ—¶ç¦ç”¨æ–‡æœ¬é€‰ä¸­      document.body.style.userSelect = &#39;none&#39;      document.onmousemove = function(moveEvent) &#123;        // è·å–é¼ æ ‡è·ç¦»æµè§ˆå™¨å³è¾¹ç¼˜çš„è·ç¦»        let realWidth = document.body.clientWidth - moveEvent.pageX        const width30 = document.body.clientWidth * 0.2        const width80 = document.body.clientWidth * 0.8        // å®½åº¦ä¸èƒ½å¤§äºæµè§ˆå™¨å®½åº¦ 80%ï¼Œä¸èƒ½å°äºå®½åº¦çš„ 20%        realWidth = realWidth &gt; width80 ? width80 : realWidth &lt; width30 ? width30 : realWidth        drawerEle.style.width = realWidth + &#39;px&#39;      &#125;      document.onmouseup = function(e) &#123;        // æ‹–æ‹½æ—¶ç»“æŸæ—¶ï¼Œå–æ¶ˆç¦ç”¨æ–‡æœ¬é€‰ä¸­        document.body.style.userSelect = &#39;initial&#39;        document.onmousemove = null        document.onmouseup = null      &#125;    &#125;  &#125;&#125;)</code></pre><p>ç„¶ååœ¨ <code>main.js</code> ä¸­å°†å…¶å¯¼å…¥</p><pre><code class="js">import &#39;./directive/element-ui/drawer-drag-width&#39;</code></pre><h3 id="æŒ‡ä»¤ä½¿ç”¨"><a href="#æŒ‡ä»¤ä½¿ç”¨" class="headerlink" title="æŒ‡ä»¤ä½¿ç”¨"></a>æŒ‡ä»¤ä½¿ç”¨</h3><p>åœ¨ <code>el-drawer</code>  ä¸Šæ·»åŠ æŒ‡ä»¤ <code>v-el-drawer-drag-width</code> å³å¯, å¦‚ä¸‹</p><pre><code class="html">&lt;el-drawer  v-el-drawer-drag-width  :visible.sync=&quot;helpDrawer.show&quot;  direction=&quot;rtl&quot;  class=&quot;my-drawer&quot;&gt;  &lt;template #title&gt;    &lt;div class=&quot;draw-title&quot;&gt;&#123;&#123; helpDrawer.title &#125;&#125;&lt;/div&gt;  &lt;/template&gt;  &lt;Editor    v-model=&quot;helpDrawer.html&quot;    v-loading=&quot;helpDrawer.loading&quot;    class=&quot;my-wang-editor&quot;    style=&quot;overflow-y: auto;&quot;    :default-config=&quot;helpDrawer.editorConfig&quot;    :mode=&quot;helpDrawer.mode&quot;    @onCreated=&quot;onCreatedHelp&quot;  /&gt;&lt;/el-drawer&gt;</code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;å®ç°æ•ˆæœ&quot;&gt;&lt;a href=&quot;#å®ç°æ•ˆæœ&quot; class=&quot;headerlink&quot; title=&quot;å®ç°æ•ˆæœ&quot;&gt;&lt;/a&gt;å®ç°æ•ˆæœ&lt;/h3&gt;&lt;p&gt;&lt;img src=&quot;https://cdn.jsdelivr.net/gh/yelog/assets/images/picg</summary>
      
    
    
    
    <category term="å¤§å‰ç«¯" scheme="http://yelog.org/categories/%E5%A4%A7%E5%89%8D%E7%AB%AF/"/>
    
    
    <category term="ElementUI" scheme="http://yelog.org/tags/ElementUI/"/>
    
    <category term="Vue" scheme="http://yelog.org/tags/Vue/"/>
    
  </entry>
  
  <entry>
    <title>SpringCloudç³»åˆ—ä¹‹æ¥å…¥SkyWalkingè¿›è¡Œé“¾è·¯è¿½è¸ªå’Œæ—¥å¿—æ”¶é›†</title>
    <link href="http://yelog.org/2021/09/26/spring-cloud-skywalking/"/>
    <id>http://yelog.org/2021/09/26/spring-cloud-skywalking/</id>
    <published>2021-09-26T10:08:00.000Z</published>
    <updated>2024-08-12T09:33:12.244Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å‰ä¸€æ®µæ—¶é—´ä¸€ç›´åœ¨ç ”ç©¶å‡çº§å…¬å¸é¡¹ç›®çš„æ¶æ„ï¼Œåœ¨ä¸æ–­å­¦ä¹ å’Œè¯•é”™åï¼Œæœ€ç»ˆç¡®å®šäº†ä¸€å¥—åŸºäº k8s çš„é«˜å¯ç”¨æ¶æ„ä½“ç³»ï¼Œæœªæ¥å‡ æœŸä¼šå°†è¿™å¥—æ¶æ„ä½“ç³»çš„æ¶è®¾è¿‡ç¨‹å’Œæ³¨æ„äº‹é¡¹ä»¥ç³»åˆ—æ–‡ç« çš„å½¢å¼åˆ†äº«å‡ºæ¥ï¼Œæ•¬è¯·æœŸå¾…ï¼</p><p>ç”±äºé›†ç¾¤å’Œåˆ†å¸ƒå¼è§„æ¨¡çš„æ‰©å¤§ï¼Œå¯¹å¾®æœåŠ¡é“¾è·¯çš„ç›‘æ§å’Œæ—¥å¿—æ”¶é›†ï¼Œè¶Šæ¥è¶Šæœ‰å¿…è¦æ€§ï¼Œæ‰€ä»¥åœ¨ç­›é€‰äº†äº†ä¸€äº›æ–¹æ¡ˆåï¼Œå‘ç° SkyWalking å®Œç¾ç¬¦åˆæˆ‘ä»¬çš„é¢„æœŸï¼Œå¯¹é“¾è·¯è¿½è¸ªå’Œæ—¥å¿—æ”¶é›†éƒ½æœ‰ä¸é”™çš„å®ç°ã€‚</p><h2 id="SkyWalking-ç®€ä»‹"><a href="#SkyWalking-ç®€ä»‹" class="headerlink" title="SkyWalking ç®€ä»‹"></a>SkyWalking ç®€ä»‹</h2><p>SkyWalking æ˜¯ä¸€æ¬¾ APMï¼ˆåº”ç”¨ç¨‹åºç›‘æ§ï¼‰ç³»ç»Ÿï¼Œè½¬ä¸ºå¾®æœåŠ¡ã€äº‘åŸç”Ÿã€åŸºäºå®¹å™¨çš„æ¶æ„è€Œè®¾è®¡ã€‚ä¸»è¦åŒ…å«äº†ä¸€ä¸‹æ ¸å¿ƒåŠŸèƒ½</p><ol><li>å¯¹æœåŠ¡ã€è¿è¡Œå®ä¾‹ã€APIè¿›è¡ŒæŒ‡æ ‡åˆ†æ</li><li>é“¾è·¯æ£€æµ‹ï¼Œæ£€æŸ¥ç¼“æ…¢çš„æœåŠ¡å’ŒAPI</li><li>å¯¹åŸºç¡€è®¾æ–½ï¼ˆVMã€ç½‘ç»œã€ç£ç›˜ã€æ•°æ®åº“ï¼‰è¿›è¡Œç›‘æ§</li><li>å¯¹è¶…å‡ºé˜ˆå€¼çš„æƒ…å†µè¿›è¡Œè­¦æŠ¥</li><li>ç­‰ç­‰</li></ol><p>å¼€æºåœ°å€ï¼š<a href="https://github.com/apache/skywalking">apache&#x2F;skywalking</a></p><p>å®˜ç½‘ï¼š<a href="https://skywalking.apache.org/">Apache SkyWalking</a></p><h2 id="SpringCloud-æ•´åˆ-SkyWalking"><a href="#SpringCloud-æ•´åˆ-SkyWalking" class="headerlink" title="SpringCloud æ•´åˆ SkyWalking"></a>SpringCloud æ•´åˆ SkyWalking</h2><h3 id="1-æ­å»º-SkyWalking-æœåŠ¡"><a href="#1-æ­å»º-SkyWalking-æœåŠ¡" class="headerlink" title="1. æ­å»º SkyWalking æœåŠ¡"></a>1. æ­å»º SkyWalking æœåŠ¡</h3><p>åœ¨ä½¿ç”¨ SkyWalking è¿›è¡Œé“¾è·¯è¿½è¸ªå’Œæ—¥å¿—æ”¶é›†ä¹‹å‰ï¼Œéœ€è¦å…ˆæ­å»ºèµ·ä¸€å¥— SkyWalking çš„æœåŠ¡ï¼Œç„¶åæ‰èƒ½é€šè¿‡ agent å°† SpringCloud çš„è¿è¡ŒçŠ¶æ€å’Œæ—¥å¿—å‘é€ç»™ SkyWalking è¿›è¡Œè§£æå’Œå±•ç¤ºã€‚</p><p>SkyWalking çš„æ­å»ºæ–¹å¼æœ‰å¾ˆå¤šä¸­ï¼Œæˆ‘è¿™é‡Œä»‹ç»ä¸¤ç§ docker-composeï¼ˆéé«˜å¯ç”¨ï¼Œå¿«é€Ÿå¯åŠ¨ï¼Œæ–¹ä¾¿æµ‹è¯•ã€å­¦ä¹ ï¼‰ å’Œ k8sï¼ˆé«˜å¯ç”¨ã€ç”Ÿäº§çº§åˆ«ï¼‰</p><h4 id="docker-compose-çš„æ–¹å¼"><a href="#docker-compose-çš„æ–¹å¼" class="headerlink" title="docker-compose çš„æ–¹å¼"></a>docker-compose çš„æ–¹å¼</h4><p>docker å’Œ docker-compose çš„å®‰è£…ä¸æ˜¯æœ¬æ–‡çš„é‡ç‚¹ï¼Œæ‰€ä»¥æœ‰éœ€è¦å¯ä»¥è‡ªè¡ŒæŸ¥è¯¢ã€‚</p><p>ä»¥ä¸‹æ“ä½œä¼šå¯åŠ¨ä¸‰ä¸ªå®¹å™¨</p><ol><li><code>elasticsearch</code> ä½œä¸º skywalking çš„å­˜å‚¨ï¼Œä¿å­˜é“¾è·¯å’Œæ—¥å¿—æ•°æ®ç­‰</li><li><code>oap</code> æ•°æ®æ¥æ”¶å’Œåˆ†æ Observability Analysis Platform</li><li><code>ui</code> webç«¯çš„æ•°æ®å±•ç¤º</li></ol><pre><code class="bash"># åˆ›å»ºé…ç½®æ–‡ä»¶ä¿å­˜çš„ç›®å½•mkdir -p /data/docker/admin/skywalking# åˆ‡æ¢åˆ°åˆšåˆ›å»ºçš„ç›®å½•cd /data/docker/admin/skywalking# å°†ä¸‹é¢çš„ docker-compose.yml æ–‡ä»¶ä¿å­˜åˆ°è¿™ä¸ªç›®å½•vi docker-compose.yml# æ‹‰å»é•œåƒå¹¶å¯åŠ¨docker-compose up -d# æŸ¥çœ‹æ—¥å¿—docker-compose logs -f</code></pre><p>docker-compose.yml</p><pre><code class="yaml">version: &#39;3.8&#39;services:  elasticsearch:    image: docker.elastic.co/elasticsearch/elasticsearch:7.14.1    container_name: elasticsearch    restart: always    ports:      - 9200:9200    healthcheck:      test: [&quot;CMD-SHELL&quot;, &quot;curl --silent --fail localhost:9200/_cluster/health || exit 1&quot;]      interval: 30s      timeout: 10s      retries: 3      start_period: 40s    environment:      - discovery.type=single-node      - bootstrap.memory_lock=true      - &quot;ES_JAVA_OPTS=-Xms512m -Xmx512m&quot;      - TZ=Asia/Shanghai    ulimits:      memlock:        soft: -1        hard: -1  oap:    image: apache/skywalking-oap-server:8.7.0-es7    container_name: oap    depends_on:      - elasticsearch    links:      - elasticsearch    restart: always    ports:      - 11800:11800      - 12800:12800    healthcheck:      test: [&quot;CMD-SHELL&quot;, &quot;/skywalking/bin/swctl&quot;]      interval: 30s      timeout: 10s      retries: 3      start_period: 40s    environment:      TZ: Asia/Shanghai      SW_STORAGE: elasticsearch7      SW_STORAGE_ES_CLUSTER_NODES: elasticsearch:9200  ui:    image: apache/skywalking-ui:8.7.0    container_name: ui    depends_on:      - oap    links:      - oap    restart: always    ports:      - 8088:8080    environment:      TZ: Asia/Shanghai      SW_OAP_ADDRESS: http://oap:12800</code></pre><p>å¯åŠ¨ä¹‹åæµè§ˆå™¨è®¿é—® <code>æœåŠ¡ip:8080</code> å³å¯</p><h4 id="k8s"><a href="#k8s" class="headerlink" title="k8s"></a>k8s</h4><p>ç­‰å¾…æ›´æ–°ã€‚ã€‚</p><h3 id="2-ä¸‹è½½-agent-ä»£ç†åŒ…"><a href="#2-ä¸‹è½½-agent-ä»£ç†åŒ…" class="headerlink" title="2. ä¸‹è½½ agent ä»£ç†åŒ…"></a>2. ä¸‹è½½ agent ä»£ç†åŒ…</h3><p>ç‚¹å‡»é“¾æ¥è¿›è¡Œä¸‹è½½ï¼Œ<a href="https://archive.apache.org/dist/skywalking/8.7.0/apache-skywalking-apm-8.7.0.tar.gz">skywalking-apm-8.7</a></p><blockquote><p>å…¶ä»–ç‰ˆæœ¬å¯ä»¥çœ‹ <a href="https://archive.apache.org/dist/skywalking/">apache å½’æ¡£ç«™</a>ï¼Œæ‰¾åˆ°å¯¹åº”ç‰ˆæœ¬çš„ <code>.tar.gz</code> åç¼€çš„åŒ…ï¼Œè¿›è¡Œä¸‹è½½</p></blockquote><p>é€šè¿‡å‘½ä»¤æˆ–è€…è½¯ä»¶è¿›è¡Œè§£å‹ <code>tar -zxvf apache-skywalking-apm-8.7.0.tar.gz</code></p><h3 id="3-java-å‘½ä»¤ä½¿ç”¨ä»£ç å¯åŠ¨-jar-åŒ…"><a href="#3-java-å‘½ä»¤ä½¿ç”¨ä»£ç å¯åŠ¨-jar-åŒ…" class="headerlink" title="3. java å‘½ä»¤ä½¿ç”¨ä»£ç å¯åŠ¨ jar åŒ…"></a>3. java å‘½ä»¤ä½¿ç”¨ä»£ç å¯åŠ¨ jar åŒ…</h3><p>springcloud&#x2F;springboot ä¸€èˆ¬æ˜¯é€šè¿‡ <code>java -jar xxx.jar</code> è¿›è¡Œå¯åŠ¨ã€‚æˆ‘ä»¬åªéœ€è¦åœ¨å…¶ä¸­åŠ ä¸Š <code>-javaagent</code> å‚æ•°å³å¯ï¼Œå¦‚ä¸‹</p><p>å…¶ä¸­ <strong>è‡ªå®šä¹‰æœåŠ¡å</strong> å¯ä»¥æ”¹ä¸ºåº”ç”¨å å¦‚ <code>lemes-auth</code>ï¼Œ<strong>æœåŠ¡ip</strong> ä¸ºç¬¬ä¸€æ­¥æ­å»ºçš„ SkyWalking æœåŠ¡çš„ipï¼Œ<strong>ç«¯å£11800</strong> ä¸ºå¯åŠ¨çš„ oap è¿™ä¸ªå®¹å™¨çš„ç«¯å£</p><pre><code class="bash">java -javaagent:ä¸Šä¸€æ­¥è§£å‹ç›®å½•/agent/skywalking-agent.jar=agent.service_name=è‡ªå®šä¹‰æœåŠ¡å,collector.backend_service=æœåŠ¡ip:11800 -jar xx.jar</code></pre><p>æ‰§è¡Œå‘½ä»¤å¯åŠ¨åï¼Œè®¿é—®ä»¥ä¸‹æ¥å£ï¼Œå°±å¯ä»¥åœ¨ç¬¬ä¸€æ­¥ <code>æœåŠ¡ip:8080</code> ä¸­çœ‹åˆ°è®¿é—®çš„é“¾æ¥å’Œè°ƒç”¨é“¾è·¯ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/yelog/assets/images/picgo_qiniu20210926164151.png" alt="é“¾è·¯è¿½è¸ª"><br><img src="https://cdn.jsdelivr.net/gh/yelog/assets/images/picgo_qiniu20210926164350.png" alt="æ‹“æ‰‘å›¾"></p><h3 id="4-å¼€å¯æ—¥å¿—æ”¶é›†"><a href="#4-å¼€å¯æ—¥å¿—æ”¶é›†" class="headerlink" title="4. å¼€å¯æ—¥å¿—æ”¶é›†"></a>4. å¼€å¯æ—¥å¿—æ”¶é›†</h3><p>æœ¬æ–‡ä¸»è¦ä»¥ log4j2 æ¥ä»‹ç»ï¼Œå…¶ä»–çš„å¤§åŒå°å¼‚ï¼Œå¯ä»¥ç½‘ä¸Šæ‰¾æ•™ç¨‹ã€‚SpringCloud é›†æˆ log4j2 ä¸æ˜¯æœ¬æ–‡é‡ç‚¹ï¼Œæ‰€ä»¥è¯·è‡ªè¡Œ Googleã€‚</p><h4 id="å¼•å…¥ä¾èµ–"><a href="#å¼•å…¥ä¾èµ–" class="headerlink" title="å¼•å…¥ä¾èµ–"></a>å¼•å…¥ä¾èµ–</h4><p>è¦å¼€å¯æ—¥å¿—æ”¶é›†ï¼Œå¿…é¡»è¦æ·»åŠ ä¾èµ–ï¼Œå¦‚ä¸‹</p><pre><code class="xml">&lt;dependency&gt;    &lt;groupId&gt;org.apache.skywalking&lt;/groupId&gt;    &lt;artifactId&gt;apm-toolkit-log4j-2.x&lt;/artifactId&gt;    &lt;version&gt;8.7.0&lt;/version&gt;&lt;/dependency&gt;</code></pre><h4 id="ä¿®æ”¹-log4j2-xml"><a href="#ä¿®æ”¹-log4j2-xml" class="headerlink" title="ä¿®æ”¹ log4j2.xml"></a>ä¿®æ”¹ log4j2.xml</h4><p>éœ€è¦ä¿®æ”¹ log4j2.xml ä¸»è¦æ·»åŠ ä¸‹é¢ä¸¤ä¸ªå…³é”®ç‚¹</p><ul><li>æ·»åŠ  <code>%traceId</code> æ¥æ‰“å° traceid</li><li>å£°æ˜ GRPCLogClientAppender</li></ul><p>å®Œæ•´å†…å®¹å¦‚ä¸‹</p><pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;!--æ—¥å¿—çº§åˆ«ä»¥åŠä¼˜å…ˆçº§æ’åº: OFF &gt; FATAL &gt; ERROR &gt; WARN &gt; INFO &gt; DEBUG &gt; TRACE &gt; ALL --&gt;&lt;!-- Configurationåé¢çš„statusï¼Œè¿™ä¸ªç”¨äºè®¾ç½®log4j2è‡ªèº«å†…éƒ¨çš„ä¿¡æ¯è¾“å‡ºï¼Œå¯ä»¥ä¸è®¾ç½®ï¼Œå½“è®¾ç½®æˆtraceæ—¶ï¼Œ     ä½ ä¼šçœ‹åˆ°log4j2å†…éƒ¨å„ç§è¯¦ç»†è¾“å‡ºã€‚å¯ä»¥è®¾ç½®æˆOFF(å…³é—­) æˆ– Error(åªè¾“å‡ºé”™è¯¯ä¿¡æ¯)ã€‚--&gt;&lt;!--monitorIntervalï¼šLog4jèƒ½å¤Ÿè‡ªåŠ¨æ£€æµ‹ä¿®æ”¹é…ç½® æ–‡ä»¶å’Œé‡æ–°é…ç½®æœ¬èº«ï¼Œè®¾ç½®é—´éš”ç§’æ•°--&gt;&lt;configuration status=&quot;WARN&quot; monitorInterval=&quot;30&quot;&gt;    &lt;Properties&gt;        &lt;Property name=&quot;log.path&quot;&gt;logs/lemes-auth&lt;/Property&gt;        &lt;Property name=&quot;logging.lemes.pattern&quot;&gt;            %d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%-5level] [%traceId] [%logger&#123;50&#125;.%M:%L] - %msg%n        &lt;/Property&gt;    &lt;/Properties&gt;    &lt;Appenders&gt;        &lt;!-- è¾“å‡ºæ§åˆ¶å°æ—¥å¿—çš„é…ç½® --&gt;        &lt;Console name=&quot;Console&quot; target=&quot;SYSTEM_OUT&quot;&gt;            &lt;!--æ§åˆ¶å°åªè¾“å‡ºlevelåŠä»¥ä¸Šçº§åˆ«çš„ä¿¡æ¯ï¼ˆonMatchï¼‰ï¼Œå…¶ä»–çš„ç›´æ¥æ‹’ç»ï¼ˆonMismatchï¼‰--&gt;            &lt;ThresholdFilter level=&quot;debug&quot; onMatch=&quot;ACCEPT&quot; onMismatch=&quot;DENY&quot;/&gt;            &lt;!-- è¾“å‡ºæ—¥å¿—çš„æ ¼å¼ --&gt;            &lt;PatternLayout pattern=&quot;$&#123;logging.lemes.pattern&#125;&quot;/&gt;        &lt;/Console&gt;        &lt;RollingRandomAccessFile name=&quot;debugRollingFile&quot; fileName=&quot;$&#123;log.path&#125;/debug.log&quot;                                 filePattern=&quot;$&#123;log.path&#125;/debug/$$&#123;date:yyyy-MM&#125;/debug.%d&#123;yyyy-MM-dd&#125;-%i.log.gz&quot;&gt;            &lt;ThresholdFilter level=&quot;debug&quot; onMatch=&quot;ACCEPT&quot; onMismatch=&quot;DENY&quot;/&gt;            &lt;PatternLayout charset=&quot;UTF-8&quot; pattern=&quot;$&#123;logging.lemes.pattern&#125;&quot;/&gt;            &lt;Policies&gt;                &lt;TimeBasedTriggeringPolicy interval=&quot;1&quot;/&gt;                &lt;SizeBasedTriggeringPolicy size=&quot;100 MB&quot;/&gt;            &lt;/Policies&gt;            &lt;DefaultRolloverStrategy max=&quot;30&quot;/&gt;        &lt;/RollingRandomAccessFile&gt;        &lt;GRPCLogClientAppender name=&quot;grpc-log&quot;&gt;            &lt;PatternLayout pattern=&quot;$&#123;logging.lemes.pattern&#125;&quot;/&gt;        &lt;/GRPCLogClientAppender&gt;    &lt;/Appenders&gt;    &lt;Loggers&gt;        &lt;!-- ALL &lt; TRACE &lt; DEBUG &lt; INFO &lt; WARN &lt; ERROR &lt; FATAL &lt; OFF --&gt;        &lt;Logger name=&quot;com.lenovo.lemes&quot; level=&quot;debug&quot;/&gt;        &lt;Logger name=&quot;org.apache.kafka&quot; level=&quot;warn&quot;/&gt;        &lt;Root level=&quot;info&quot;&gt;            &lt;AppenderRef ref=&quot;Console&quot;/&gt;            &lt;AppenderRef ref=&quot;debugRollingFile&quot;/&gt;            &lt;AppenderRef ref=&quot;grpc-log&quot;/&gt;        &lt;/Root&gt;    &lt;/Loggers&gt;&lt;/configuration&gt;</code></pre><h4 id="å¯åŠ¨å‘½ä»¤ä¸­å£°æ˜ä¸ŠæŠ¥æ—¥å¿—"><a href="#å¯åŠ¨å‘½ä»¤ä¸­å£°æ˜ä¸ŠæŠ¥æ—¥å¿—" class="headerlink" title="å¯åŠ¨å‘½ä»¤ä¸­å£°æ˜ä¸ŠæŠ¥æ—¥å¿—"></a>å¯åŠ¨å‘½ä»¤ä¸­å£°æ˜ä¸ŠæŠ¥æ—¥å¿—</h4><p>åœ¨ä¸Šä¸€æ­¥çš„ agent ä¸­æ·»åŠ ä¸ŠæŠ¥æ—¥å¿—çš„å‚æ•° <code>plugin.toolkit.log.grpc.reporter.server_host=æœåŠ¡ip,plugin.toolkit.log.grpc.reporter.server_port=11800</code></p><p>å®Œæ•´å¦‚ä¸‹</p><pre><code class="bash">java -javaagent:ä¸Šä¸€æ­¥è§£å‹ç›®å½•/agent/skywalking-agent.jar=agent.service_name=è‡ªå®šä¹‰æœåŠ¡å,collector.backend_service=æœåŠ¡ip:11800,plugin.toolkit.log.grpc.reporter.server_host=æœåŠ¡ip,plugin.toolkit.log.grpc.reporter.server_port=11800 -jar xx.jar</code></pre><h4 id="æ—¥å¿—æ”¶é›†æ•ˆæœ"><a href="#æ—¥å¿—æ”¶é›†æ•ˆæœ" class="headerlink" title="æ—¥å¿—æ”¶é›†æ•ˆæœ"></a>æ—¥å¿—æ”¶é›†æ•ˆæœ</h4><p>è¿™æ ·å¯åŠ¨æ—¥å¿—ä¸­å°±ä¼šæ‰“å° traceid , <code>N/A</code> ä»£è¡¨çš„æ˜¯éè¯·æ±‚çš„æ—¥å¿—ï¼Œæœ‰ traceid çš„ä¸º api è¯·æ±‚æ—¥å¿—</p><p><img src="https://cdn.jsdelivr.net/gh/yelog/assets/images/picgo_qiniu20210926170409.png" alt="traceid"></p><p>åœ¨ skywalking ä¸­å°±èƒ½çœ‹åˆ°æˆ‘ä»¬ä¸ŠæŠ¥çš„æ—¥å¿—</p><p><img src="https://cdn.jsdelivr.net/gh/yelog/assets/images/picgo_qiniu20210926170953.png" alt="skywalking æ—¥å¿—ä¸ŠæŠ¥"></p><p>é‡ç‚¹ï¼šSkyWalking å¯ä»¥åœ¨é“¾è·¯è¿½è¸ªä¸­æŸ¥çœ‹å½“å‰è¯·æ±‚çš„æ‰€æœ‰æ—¥å¿—ï¼ˆä¸åŒå®ä¾‹&#x2F;æ¨¡å—ï¼‰</p><p><img src="https://cdn.jsdelivr.net/gh/yelog/assets/images/picgo_qiniu20210926171217.png" alt="SkyWalking é“¾è·¯æ—¥å¿—"></p><p><img src="https://cdn.jsdelivr.net/gh/yelog/assets/images/picgo_qiniu20210926171256.png" alt="SkyWalking é“¾è·¯æ—¥å¿—"></p><h3 id="5-å…¼å®¹-spring-cloud-gateway"><a href="#5-å…¼å®¹-spring-cloud-gateway" class="headerlink" title="5. å…¼å®¹ spring-cloud-gateway"></a>5. å…¼å®¹ spring-cloud-gateway</h3><p>ç»è¿‡ä¸Šé¢çš„æ­¥éª¤ä¹‹åï¼Œé“¾è·¯å·²ç»æ­å»ºå®Œæˆï¼ŒæŸ¥çœ‹å‘ç°äº†ä¸€ä¸ªé—®é¢˜ï¼Œgateway æ¨¡å—çš„ <code>traceId</code> å’Œ ä¸šåŠ¡æ¨¡å—çš„ <code>traceId</code> ä¸ç»Ÿä¸€ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/yelog/assets/images/picgo_qiniu20210926164350.png" alt="æ‹“æ‰‘å›¾"></p><p>è¿™æ˜¯ç”±äº SkyWalking å¯¹äº <code>spring-cloud-gateway</code> çš„æ”¯æŒä¸æ˜¯é»˜è®¤çš„ï¼Œæ‰€ä»¥éœ€è¦å°† <code>agent/optional-plugins/apm-spring-cloud-gateway-2.1.x-plugin-8.7.0.jar</code> å¤åˆ¶åˆ° <code>agent/plugins</code> ä¸‹ï¼Œç„¶åé‡å¯å³å¯ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/yelog/assets/images/picgo_qiniu20210926180619.png" alt="ä¼˜åŒ–è¿‡ gateway çš„æ‹“æ‰‘å›¾"></p><h2 id="æœ€å"><a href="#æœ€å" class="headerlink" title="æœ€å"></a>æœ€å</h2><p>SkyWalking ä¸Šé¢è¿™ä¸¤ä¸ªåŠŸèƒ½å°±å·²ç»éå¸¸å¼ºå¤§ï¼Œèƒ½å¤Ÿæœ‰æ•ˆå¸®åŠ©æˆ‘ä»¬ä¼˜åŒ–æˆ‘ä»¬çš„ç¨‹åºï¼Œç›‘æ§ç³»ç»Ÿçš„é—®é¢˜ï¼Œå¹¶åŠæ—¶æŠ¥è­¦ã€‚æ—¥å¿—æ”¶é›†ä¹Ÿè§£å†³çš„åœ¨å¤§è§„æ¨¡åˆ†å¸ƒå¼é›†ç¾¤ä¸‹æ—¥å¿—æŸ¥è¯¢éš¾çš„é—®é¢˜ã€‚</p><p>SkyWalking è¿˜æ”¯æŒ VMã€æµè§ˆå™¨ã€k8sç­‰ç›‘æ§ï¼Œåç»­å¦‚æœæœ‰å®è·µï¼Œå°†ä¼šé€æ­¥æ›´æ–°ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;å‰ä¸€æ®µæ—¶é—´ä¸€ç›´åœ¨ç ”ç©¶å‡çº§å…¬å¸é¡¹ç›®çš„æ¶æ„ï¼Œåœ¨ä¸æ–­å­¦ä¹ å’Œè¯•é”™åï¼Œæœ€ç»ˆç¡®å®šäº†ä¸€å¥—åŸºäº k8s çš„é«˜å¯ç”¨æ¶æ„ä½“ç³»ï¼Œæœªæ¥å‡ æœŸä¼šå°†è¿™å¥—æ¶æ„ä½“ç³»çš„æ¶è®¾è¿‡ç¨‹</summary>
      
    
    
    
    <category term="åç«¯" scheme="http://yelog.org/categories/%E5%90%8E%E7%AB%AF/"/>
    
    
    <category term="java" scheme="http://yelog.org/tags/java/"/>
    
    <category term="SpringCloud" scheme="http://yelog.org/tags/SpringCloud/"/>
    
    <category term="SkyWalking" scheme="http://yelog.org/tags/SkyWalking/"/>
    
  </entry>
  
  <entry>
    <title>3-hexoæ·»åŠ è‡ªå®šä¹‰å›¾æ ‡</title>
    <link href="http://yelog.org/2020/12/28/3-hexo-add-icon/"/>
    <id>http://yelog.org/2020/12/28/3-hexo-add-icon/</id>
    <published>2020-12-28T14:00:00.000Z</published>
    <updated>2024-08-12T09:33:12.053Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ä¸€ã€å‰è¨€"><a href="#ä¸€ã€å‰è¨€" class="headerlink" title="ä¸€ã€å‰è¨€"></a>ä¸€ã€å‰è¨€</h2><p>é‰´äºè®¸å¤šäººé—®è¿‡å¦‚ä½•æ·»åŠ è‡ªå®šä¹‰å›¾æ ‡ï¼Œè¿™é‡Œå°±è¯¦ç»†è¯´æ˜ä¸€ä¸‹ï¼Œä»¥å¤‡åäººä¹˜å‡‰ã€‚</p><p>è¿™ç¯‡æ–‡ç« ä¸»è¦è®²è§£æ˜¯ä» <a href="https://www.iconfont.cn/">iconfont</a> æ·»åŠ å›¾æ ‡ã€‚</p><h2 id="äºŒã€æ·»åŠ å½©è‰²å›¾æ ‡"><a href="#äºŒã€æ·»åŠ å½©è‰²å›¾æ ‡" class="headerlink" title="äºŒã€æ·»åŠ å½©è‰²å›¾æ ‡"></a>äºŒã€æ·»åŠ å½©è‰²å›¾æ ‡</h2><h3 id="2-1-ç™»å½•å¹¶æ·»åŠ å›¾æ ‡"><a href="#2-1-ç™»å½•å¹¶æ·»åŠ å›¾æ ‡" class="headerlink" title="2.1 ç™»å½•å¹¶æ·»åŠ å›¾æ ‡"></a>2.1 ç™»å½•å¹¶æ·»åŠ å›¾æ ‡</h3><p>è®¿é—® <a href="https://www.iconfont.cn/">iconfont</a>ï¼Œç‚¹å‡»å¦‚ä¸‹å›¾ä½ç½®ç™»å½•ï¼Œå¯ä»¥ä½¿ç”¨ <code>Github</code> è´¦å·ç™»å½•ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/yelog/assets/images/picgo_qiniu20201228230707.png" alt="iconfont ç™»å½•"></p><p>ç™»å½•æˆåŠŸåï¼Œæœç´¢åˆé€‚çš„å›¾æ ‡ï¼Œç„¶åç‚¹å‡»æ·»åŠ åˆ°è´­ç‰©è½¦ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/yelog/assets/images/picgo_qiniu20201228231118.png"></p><p>æ·»åŠ äº†å¤šä¸ªåï¼Œå¯ä»¥ç‚¹å‡»å³ä¸Šè§’çš„â€œè´­ç‰©è½¦â€ï¼Œæ·»åŠ åˆ°é¡¹ç›®ï¼Œç‚¹å‡»åŠ å·åˆ›å»ºé¡¹ç›®ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/yelog/assets/images/picgo_qiniu20201228231558.png"></p><p>æ·»åŠ å®Œæˆåå›åˆ°é¡¹ç›®é¡µé¢ï¼Œæ‰¾åˆ°è‡ªå·±åˆšåˆšåˆ›å»ºçš„é¡¹ç›®ã€‚</p><blockquote><p>å¦‚æœæ²¡æœ‰åˆ°é¡¹ç›®é¡µé¢ï¼Œå¯ä»¥ç‚¹å‡»ä¸Šé¢èœå•è¿›å…¥ï¼šèµ„æºç®¡ç† -&gt; æˆ‘çš„é¡¹ç›®</p></blockquote><h3 id="2-2-å¼•å…¥-3-hexo-ä¸­"><a href="#2-2-å¼•å…¥-3-hexo-ä¸­" class="headerlink" title="2.2 å¼•å…¥ 3-hexo ä¸­"></a>2.2 å¼•å…¥ 3-hexo ä¸­</h3><p>ç‚¹å‡»ä¸‹è½½åˆ°æœ¬åœ°ï¼Œè§£å‹å¹¶å¤åˆ¶å…¶ä¸­çš„ <code>iconfont.js</code> åˆ°é¡¹ç›® <code>3-hexo/source/js/</code> ä¸‹ï¼Œå¹¶æ”¹å <code>custom-iconfont.js</code>ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/yelog/assets/images/picgo_qiniu20201229003210.png"></p><p>åœ¨æ–‡ä»¶ <code>3-hexo/layout/_partial/meta.ejs</code> æœ€åè¿½åŠ ä¸‹é¢ä¸€è¡Œã€‚</p><pre><code class="html">&lt;script src=&quot;&lt;%=theme.blog_path?theme.blog_path.lastIndexOf(&quot;/&quot;) === theme.blog_path.length-1?theme.blog_path.slice(0, theme.blog_path.length-1):theme.blog_path:&#39;&#39; %&gt;/js/custom-iconfont.js?v=&lt;%=theme.version%&gt;&quot; &gt;&lt;/script&gt;</code></pre><h3 id="2-3-åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ ç”Ÿæ•ˆ"><a href="#2-3-åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ ç”Ÿæ•ˆ" class="headerlink" title="2.3 åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ ç”Ÿæ•ˆ"></a>2.3 åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ ç”Ÿæ•ˆ</h3><p>ä¿®æ”¹ <code>3-hexo/_config.yml</code> å¦‚ä¸‹å›¾æ‰€ç¤º</p><p><img src="https://cdn.jsdelivr.net/gh/yelog/assets/images/picgo_qiniu20201229001129.png"></p><p>å®Œæˆï¼</p><blockquote><p>å›¾æ ‡åå¦‚ä¸Šé¢çš„ <code>gitee</code> å¯ä»¥åœ¨ ç½‘ç«™ä¸Šä¿®æ”¹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º<br><img src="https://cdn.jsdelivr.net/gh/yelog/assets/images/picgo_qiniu20201229002057.png"></p></blockquote><h2 id="ä¸‰ã€æ·»åŠ é»‘ç™½å›¾æ ‡"><a href="#ä¸‰ã€æ·»åŠ é»‘ç™½å›¾æ ‡" class="headerlink" title="ä¸‰ã€æ·»åŠ é»‘ç™½å›¾æ ‡"></a>ä¸‰ã€æ·»åŠ é»‘ç™½å›¾æ ‡</h2><p><code>link.theme=white</code></p><h3 id="3-1-åŒ-2-1"><a href="#3-1-åŒ-2-1" class="headerlink" title="3.1 åŒ 2.1"></a>3.1 åŒ 2.1</h3><h3 id="3-2-å¼•å…¥-3-hexo-ä¸­"><a href="#3-2-å¼•å…¥-3-hexo-ä¸­" class="headerlink" title="3.2 å¼•å…¥ 3-hexo ä¸­"></a>3.2 å¼•å…¥ 3-hexo ä¸­</h3><p>ç‚¹å‡»ç”Ÿæˆä»£ç ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/yelog/assets/images/picgo_qiniu20201228231715.png"></p><p>å¤åˆ¶ç”Ÿæˆçš„ä»£ç ï¼Œä¿®æ”¹ <code>font-family</code> çš„å€¼ä¸º <code>custom-iconfont</code>ï¼Œæ·»åŠ åˆ° <code>3-hexo/source/css/_partial/font.styl</code> æœ€åï¼Œå¹¶å†™å…¥å›¾æ ‡ä¿¡æ¯ï¼Œ<code>content</code> å¯ä»¥ç§»åˆ°å›¾æ ‡ä¸Šè¿›è¡Œå¤åˆ¶ï¼Œæ³¨æ„å‰é¢æ–œæ è½¬è¯‘å’Œå»æ‰åé¢çš„åˆ†å·ã€‚</p><pre><code class="css">@font-face &#123;  font-family: &#39;custom-iconfont&#39;;  /* project id 2298064 */  src: url(&#39;//at.alicdn.com/t/font_2298064_34vkk4c9945.eot&#39;);  src: url(&#39;//at.alicdn.com/t/font_2298064_34vkk4c9945.eot?#iefix&#39;) format(&#39;embedded-opentype&#39;),  url(&#39;//at.alicdn.com/t/font_2298064_34vkk4c9945.woff2&#39;) format(&#39;woff2&#39;),  url(&#39;//at.alicdn.com/t/font_2298064_34vkk4c9945.woff&#39;) format(&#39;woff&#39;),  url(&#39;//at.alicdn.com/t/font_2298064_34vkk4c9945.ttf&#39;) format(&#39;truetype&#39;),  url(&#39;//at.alicdn.com/t/font_2298064_34vkk4c9945.svg#iconfont&#39;) format(&#39;svg&#39;);&#125;.icon-gitee:before &#123;  content: &quot;\e602&quot;;&#125;.icon-youtubeautored:before &#123;  content: &quot;\e649&quot;;&#125;</code></pre><h3 id="3-3-åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ ç”Ÿæ•ˆ-åŒ2-2"><a href="#3-3-åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ ç”Ÿæ•ˆ-åŒ2-2" class="headerlink" title="3.3 åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ ç”Ÿæ•ˆ åŒ2.2"></a>3.3 åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ ç”Ÿæ•ˆ åŒ2.2</h3><p>ç»“æŸï¼</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;ä¸€ã€å‰è¨€&quot;&gt;&lt;a href=&quot;#ä¸€ã€å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;ä¸€ã€å‰è¨€&quot;&gt;&lt;/a&gt;ä¸€ã€å‰è¨€&lt;/h2&gt;&lt;p&gt;é‰´äºè®¸å¤šäººé—®è¿‡å¦‚ä½•æ·»åŠ è‡ªå®šä¹‰å›¾æ ‡ï¼Œè¿™é‡Œå°±è¯¦ç»†è¯´æ˜ä¸€ä¸‹ï¼Œä»¥å¤‡åäººä¹˜å‡‰ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ç¯‡æ–‡ç« ä¸»è¦è®²è§£æ˜¯ä» &lt;a href=&quot;</summary>
      
    
    
    
    <category term="å·¥å…·" scheme="http://yelog.org/categories/%E5%B7%A5%E5%85%B7/"/>
    
    <category term="hexo" scheme="http://yelog.org/categories/%E5%B7%A5%E5%85%B7/hexo/"/>
    
    
    <category term="3-hexo" scheme="http://yelog.org/tags/3-hexo/"/>
    
    <category term="hexo" scheme="http://yelog.org/tags/hexo/"/>
    
  </entry>
  
  <entry>
    <title>ä¸€æ–‡çœ‹æ‡‚JavaScriptä¸­çš„Promise</title>
    <link href="http://yelog.org/2020/10/20/know-javascript-promise/"/>
    <id>http://yelog.org/2020/10/20/know-javascript-promise/</id>
    <published>2020-10-20T11:43:44.000Z</published>
    <updated>2024-08-12T09:33:11.924Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ä¸€ã€Promise-æ˜¯ä»€ä¹ˆ"><a href="#ä¸€ã€Promise-æ˜¯ä»€ä¹ˆ" class="headerlink" title="ä¸€ã€Promise æ˜¯ä»€ä¹ˆ"></a>ä¸€ã€Promise æ˜¯ä»€ä¹ˆ</h2><p><code>Promise</code> æ˜¯ <code>ES6</code> æä¾›çš„åŸç”Ÿå¯¹è±¡ï¼Œç”¨æ¥å¤„ç†å¼‚æ­¥æ“ä½œ</p><p>å®ƒæœ‰ä¸‰ç§çŠ¶æ€</p><ul><li><code>pending</code>: åˆå§‹çŠ¶æ€ï¼Œä¸æ˜¯æˆåŠŸæˆ–å¤±è´¥çŠ¶æ€ã€‚</li><li><code>fulfilled</code>: æ„å‘³ç€æ“ä½œæˆåŠŸå®Œæˆã€‚</li><li><code>rejected</code>: æ„å‘³ç€æ“ä½œå¤±è´¥ã€‚</li></ul><h2 id="äºŒã€ä½¿ç”¨"><a href="#äºŒã€ä½¿ç”¨" class="headerlink" title="äºŒã€ä½¿ç”¨"></a>äºŒã€ä½¿ç”¨</h2><h3 id="2-1-åˆ›å»º-Promise"><a href="#2-1-åˆ›å»º-Promise" class="headerlink" title="2.1 åˆ›å»º Promise"></a>2.1 åˆ›å»º Promise</h3><p>é€šè¿‡ <code>new Promise</code> æ¥å®ä¾‹åŒ–ï¼Œæ”¯æŒé“¾å¼è°ƒç”¨</p><pre><code class="javascript">new Promise((resolve, reject)=&gt;&#123;  // é€»è¾‘&#125;).then(()=&gt;&#123;  //å½“ä¸Šé¢&quot;é€»è¾‘&quot;ä¸­è°ƒç”¨ resolve() æ—¶è§¦å‘æ­¤æ–¹æ³•&#125;).catch(()=&gt;&#123;  //å½“ä¸Šé¢&quot;é€»è¾‘&quot;ä¸­è°ƒç”¨ reject() æ—¶è§¦å‘æ­¤æ–¹æ³•&#125;)</code></pre><h3 id="2-2-æ‰§è¡Œé¡ºåº"><a href="#2-2-æ‰§è¡Œé¡ºåº" class="headerlink" title="2.2 æ‰§è¡Œé¡ºåº"></a>2.2 æ‰§è¡Œé¡ºåº</h3><p><code>Promise</code>ä¸€æ—¦åˆ›å»ºå°±ç«‹å³æ‰§è¡Œï¼Œå¹¶ä¸”æ— æ³•ä¸­é€”å–æ¶ˆï¼Œæ‰§è¡Œé€»è¾‘å’Œé¡ºåºå¯ä»¥ä»ä¸‹é¢çš„ç¤ºä¾‹ä¸­è·å¾—</p><p>å¦‚ä¸‹ï¼Œå¯ä¿®æ”¹ <code>if</code> æ¡ä»¶æ¥æ”¹å˜å¼‚æ­¥ç»“æœï¼Œä¸‹é¢æ‰“å°å¼€å§‹çš„æ•°å­—æ˜¯æ‰§è¡Œé¡ºåº</p><p><a href="https://jsbin.com/cijuwakeha/1/edit?js,console">åœ¨çº¿è°ƒè¯•æ­¤ç¤ºä¾‹ - jsbin</a></p><pre><code class="javascript">console.log(&#39;1.å¼€å§‹åˆ›å»ºå¹¶æ‰§è¡Œ Promise&#39;)new Promise(function(resolve, reject) &#123;  console.log(&#39;2.ç”±äºåˆ›å»ºä¼šç«‹å³æ‰§è¡Œï¼Œæ‰€ä»¥ä¼šç«‹å³æ‰§è¡Œåˆ°æœ¬è¡Œ&#39;)  setTimeout(()=&gt;&#123; // æ¨¡æ‹Ÿå¼‚æ­¥è¯·æ±‚    console.log(&#39;4. 1sä¹‹æœŸå·²åˆ°ï¼Œå¼€å§‹æ‰§è¡Œå¼‚æ­¥æ“ä½œ&#39;)    if (true) &#123;        // ä¸€èˆ¬æˆ‘ä»¬ç¬¦åˆé¢„æœŸçš„ç»“æœæ—¶è°ƒç”¨ resolve()ï¼Œä¼šåœ¨ .then ä¸­ç»§ç»­æ‰§è¡Œ        resolve(&#39;æˆåŠŸ&#39;)    &#125; else &#123;        // ä¸ç¬¦åˆé¢„æœŸæ—¶è°ƒç”¨ reject()ï¼Œä¼šåœ¨ .catch ä¸­ç»§ç»­æ‰§è¡Œ        reject(&#39;ä¸ç¬¦åˆé¢„æœŸ&#39;)    &#125;  &#125;, 1000)&#125;).then((res)=&gt;&#123;  console.log(&#39;5.è°ƒç”¨äº†thenï¼Œæ¥æ”¶æ•°æ®ï¼š&#39; + res)&#125;).catch((error)=&gt;&#123;  console.log(&#39;5.è°ƒç”¨äº†catchï¼Œé”™è¯¯ä¿¡æ¯ï¼š&#39; + error)&#125;)console.log(&#39;3.æœ¬è¡Œä¸ºåŒæ­¥æ“ä½œï¼Œæ‰€ä»¥å…ˆäº Promise å†…çš„å¼‚æ­¥æ“ä½œï¼ˆsetTimeoutï¼‰&#39;)</code></pre><p>æ‰§è¡Œç»“æœå¦‚ä¸‹</p><pre><code class="javascript">&quot;1.å¼€å§‹åˆ›å»ºå¹¶æ‰§è¡Œ Promise&quot;&quot;2.ç”±äºåˆ›å»ºä¼šç«‹å³æ‰§è¡Œï¼Œæ‰€ä»¥ä¼šç«‹å³æ‰§è¡Œåˆ°æœ¬è¡Œ&quot;&quot;3.æœ¬è¡Œä¸ºåŒæ­¥æ“ä½œï¼Œæ‰€ä»¥å…ˆäº Promise å†…çš„å¼‚æ­¥æ“ä½œï¼ˆsetTimeoutï¼‰&quot;&quot;4. 1sä¹‹æœŸå·²åˆ°ï¼Œå¼€å§‹æ‰§è¡Œå¼‚æ­¥æ“ä½œ&quot;&quot;5.è°ƒç”¨äº†thenï¼Œæ¥æ”¶æ•°æ®ï¼šæˆåŠŸ&quot;</code></pre><h3 id="2-3-ç”¨å‡½æ•°å°è£…-Promise"><a href="#2-3-ç”¨å‡½æ•°å°è£…-Promise" class="headerlink" title="2.3 ç”¨å‡½æ•°å°è£… Promise"></a>2.3 ç”¨å‡½æ•°å°è£… Promise</h3><p>è¿™æ˜¯æ¯”è¾ƒå¸¸ç”¨çš„æ–¹æ³•ï¼Œå¦‚ä¸‹ç”¨ <code>setTimeout</code> æ¨¡æ‹Ÿå¼‚æ­¥è¯·æ±‚ï¼Œå°è£…é€šç”¨è¯·æ±‚å‡½æ•°</p><p><a href="https://jsbin.com/figuhohoki/1/edit?js,console">åœ¨çº¿è°ƒè¯•æ­¤ç¤ºä¾‹ - jsbin</a></p><pre><code class="javascript">// è¿™æ˜¯ä¸€ä¸ªå¼‚æ­¥æ–¹æ³•function ajax(url)&#123;  return new Promise(resolve=&gt;&#123;    console.log(&#39;å¼‚æ­¥æ–¹æ³•å¼€å§‹æ‰§è¡Œ&#39;)    setTimeout(()=&gt;&#123;      console.log(&#39;å¼‚æ­¥æ–¹æ³•æ‰§è¡Œå®Œæˆ&#39;)      resolve(url+&#39;çš„ç»“æœé›†&#39;)    &#125;, 1000)  &#125;)&#125;// è°ƒç”¨è¯·æ±‚å‡½æ•°ï¼Œå¹¶æ¥å—å¤„ç†è¿”å›ç»“æœajax(&#39;/user/list&#39;).then((res)=&gt;&#123;  console.log(res)&#125;)</code></pre><p>æ‰§è¡Œç»“æœ</p><pre><code class="javascript">&quot;å¼‚æ­¥æ–¹æ³•å¼€å§‹æ‰§è¡Œ&quot;&quot;å¼‚æ­¥æ–¹æ³•æ‰§è¡Œå®Œæˆ&quot;&quot;/user/listçš„ç»“æœé›†&quot;</code></pre><h2 id="ä¸‰ã€é«˜çº§ç”¨æ³•"><a href="#ä¸‰ã€é«˜çº§ç”¨æ³•" class="headerlink" title="ä¸‰ã€é«˜çº§ç”¨æ³•"></a>ä¸‰ã€é«˜çº§ç”¨æ³•</h2><h3 id="3-1-åŒæ—¶æ”¯æŒCallbackä¸Promise"><a href="#3-1-åŒæ—¶æ”¯æŒCallbackä¸Promise" class="headerlink" title="3.1 åŒæ—¶æ”¯æŒCallbackä¸Promise"></a>3.1 åŒæ—¶æ”¯æŒCallbackä¸Promise</h3><p><a href="https://jsbin.com/qitewirina/1/edit?js,console">åœ¨çº¿è°ƒè¯•æ­¤ç¤ºä¾‹ - jsbin</a></p><pre><code class="javascript">function ajax(url, success, fail) &#123;  if (typeof success === &#39;function&#39;) &#123;    setTimeout(() =&gt; &#123;      if (true) &#123;        success(&#123;user: &#39;ç¾Š&#39;&#125;)      &#125; else if (typeof fail === &#39;function&#39;) &#123;        console.log(typeof fail)        fail(&#39;ç”¨æˆ·ä¸å­˜åœ¨&#39;)      &#125;    &#125;, 1000)  &#125; else &#123;    return new Promise((resolve, reject) =&gt; &#123;      this.ajax(url, resolve, reject)    &#125;)  &#125;&#125;// callback è°ƒç”¨æ–¹å¼ajax(&#39;/user/get&#39;, (res)=&gt;&#123;  console.log(&#39;Callbackè¯·æ±‚æˆåŠŸï¼è¿”å›ç»“æœ:&#39;, res)&#125;, (error)=&gt;&#123;  console.log(&#39;Callbackè¯·æ±‚å¤±è´¥ï¼é”™è¯¯ä¿¡æ¯:&#39;, error)&#125;)// Promise è°ƒç”¨æ–¹å¼ajax(&#39;/user/get&#39;).then((res)=&gt;&#123;  console.log(&#39;Pormiseè¯·æ±‚æˆåŠŸï¼è¿”å›ç»“æœï¼š&#39;, res)&#125;).catch((error)=&gt;&#123;  console.log(&#39;Promiseè¯·æ±‚å¤±è´¥ï¼è¿”å›ç»“æœï¼š&#39;, error)&#125;)</code></pre><p>æ‰§è¡Œç»“æœ</p><pre><code class="javascript">Callbackè¯·æ±‚æˆåŠŸï¼è¿”å›ç»“æœ: &#123;user: &quot;ç¾Š&quot;&#125;Pormiseè¯·æ±‚æˆåŠŸï¼è¿”å›ç»“æœï¼š &#123;user: &quot;ç¾Š&quot;&#125;</code></pre><h3 id="3-2-é“¾å¼è°ƒç”¨"><a href="#3-2-é“¾å¼è°ƒç”¨" class="headerlink" title="3.2 é“¾å¼è°ƒç”¨"></a>3.2 é“¾å¼è°ƒç”¨</h3><p><code>.then</code> æ”¯æŒè¿”å› <code>Promise</code> å¯¹è±¡è¿›è¡Œé“¾å¼è°ƒç”¨</p><pre><code class="javascript">ajax(&#39;/user/info&#39;).then((res)=&gt;&#123;  // ç”¨æˆ·ä¿¡æ¯æŸ¥è¯¢æˆåŠŸåï¼Œå¯ä»¥æ ¹æ®è¿”å›ç»“æœæŸ¥è¯¢åç»­ä¿¡æ¯  console.log(&#39;ç”¨æˆ·ä¿¡æ¯:&#39;, res)  return ajax(&#39;/user/score&#39;)&#125;).then((res)=&gt;&#123;  console.log(&#39;ç”¨æˆ·æˆç»©:&#39;, res)  return ajax(&#39;/user/friends&#39;)&#125;).then((res)=&gt;&#123;  console.log(&#39;ç”¨æˆ·æœ‹å‹:&#39;, res)&#125;)</code></pre><h3 id="3-3-Promise-all"><a href="#3-3-Promise-all" class="headerlink" title="3.3 Promise.all"></a>3.3 Promise.all</h3><p><code>Promise.all</code> æ–¹æ³•ç”¨äºå°†å¤šä¸ª <code>Promise</code> å®ä¾‹ï¼ŒåŒ…è£…æˆä¸€ä¸ªæ–°çš„ <code>Promise</code> å®ä¾‹ã€‚<br><a href="https://jsbin.com/xojifuzapo/1/edit?js,console">åœ¨çº¿è°ƒè¯•æ­¤ç¤ºä¾‹ - jsbin</a></p><pre><code class="javascript">// ç”Ÿæˆä¸€ä¸ªPromiseå¯¹è±¡çš„æ•°ç»„var promises = [2, 3, 5, 7, 11, 13].map(function(id)&#123;  return new Promise((resolve, reject)=&gt;&#123;    if (id % 3 === 0) &#123;      resolve(id)    &#125; else &#123;      reject(id)    &#125;  &#125;);&#125;);Promise.all(promises).then(function(post) &#123;  console.log(&#39;å…¨éƒ¨é€šè¿‡&#39;)&#125;).catch(function(reason)&#123;  console.log(&#39;æœªå…¨éƒ¨é€šè¿‡ï¼Œæœ‰é—®é¢˜idï¼š&#39;+reason)&#125;);</code></pre><p>æ‰§è¡Œç»“æœ</p><pre><code class="javascript">æœªå…¨éƒ¨é€šè¿‡ï¼Œæœ‰é—®é¢˜idï¼š2</code></pre><h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise">mozilla web docs</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;ä¸€ã€Promise-æ˜¯ä»€ä¹ˆ&quot;&gt;&lt;a href=&quot;#ä¸€ã€Promise-æ˜¯ä»€ä¹ˆ&quot; class=&quot;headerlink&quot; title=&quot;ä¸€ã€Promise æ˜¯ä»€ä¹ˆ&quot;&gt;&lt;/a&gt;ä¸€ã€Promise æ˜¯ä»€ä¹ˆ&lt;/h2&gt;&lt;p&gt;&lt;code&gt;Promise&lt;/code&gt; æ˜¯ &lt;co</summary>
      
    
    
    
    <category term="å¤§å‰ç«¯" scheme="http://yelog.org/categories/%E5%A4%A7%E5%89%8D%E7%AB%AF/"/>
    
    
    <category term="javascript" scheme="http://yelog.org/tags/javascript/"/>
    
  </entry>
  
  <entry>
    <title>Docker æŠ€æœ¯æ•´ç†</title>
    <link href="http://yelog.org/2020/09/01/Docker-summary/"/>
    <id>http://yelog.org/2020/09/01/Docker-summary/</id>
    <published>2020-09-01T14:11:00.000Z</published>
    <updated>2024-08-12T09:33:11.794Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ä¸€ã€æ¦‚è¿°"><a href="#ä¸€ã€æ¦‚è¿°" class="headerlink" title="ä¸€ã€æ¦‚è¿°"></a>ä¸€ã€æ¦‚è¿°</h2><h3 id="1-1-ä»€ä¹ˆæ˜¯docker"><a href="#1-1-ä»€ä¹ˆæ˜¯docker" class="headerlink" title="1.1 ä»€ä¹ˆæ˜¯docker"></a>1.1 ä»€ä¹ˆæ˜¯docker</h3><p>Docker è¯ç”Ÿäº 2013 å¹´åˆï¼Œç”± dotCloud å…¬å¸ï¼ˆåæ”¹åä¸º Docker Incï¼‰åŸºäº Go è¯­è¨€å®ç°å¹¶å¼€æºçš„é¡¹ç›®ã€‚æ­¤é¡¹ç›®åæ¥åŠ å…¥ LinuxåŸºé‡‘ä¼šï¼Œéµä»äº† Apache 2.0 åè®®</p><p>Docker é¡¹ç›®çš„ç›®æ ‡æ˜¯å®ç°è½»é‡çº§çš„æ“ä½œç³»ç»Ÿè™šæ‹ŸåŒ–è§£å†³æ–¹æ¡ˆã€‚Docker æ˜¯åœ¨ Linux å®¹å™¨æŠ€æœ¯ï¼ˆLXCï¼‰çš„åŸºç¡€ä¸Šè¿›è¡Œäº†å°è£…ï¼Œè®©ç”¨æˆ·å¯ä»¥å¿«é€Ÿå¹¶å¯é çš„å°†åº”ç”¨ç¨‹åºä»ä¸€å°è¿è¡Œåˆ°å¦ä¸€å°ä¸Šã€‚</p><p>ä½¿ç”¨å®¹å™¨éƒ¨ç½²åº”ç”¨è¢«ç§°ä¸º<strong>å®¹å™¨åŒ–</strong>ï¼Œå®¹å™¨åŒ–æŠ€æœ¯çš„å‡ å¤§ä¼˜åŠ¿ï¼š</p><ol><li><strong>çµæ´»</strong>ï¼šç”šè‡³å¤æ‚çš„åº”ç”¨ä¹Ÿå¯ä»¥è¢«å®¹å™¨åŒ–</li><li><strong>è½»é‡</strong>ï¼šå®¹å™¨åˆ©ç”¨å’Œå…±äº«å®¿ä¸»æœºå†…æ ¸ï¼Œä»è€Œåœ¨åˆ©ç”¨ç³»ç»Ÿèµ„æºæ¯”è™šæ‹Ÿæœºæ›´åŠ çš„æœ‰æ•ˆ</li><li><strong>å¯ç§»æ¤</strong>ï¼šä½ å¯ä»¥åœ¨æœ¬åœ°æ„å»ºï¼Œåœ¨äº‘ç«¯éƒ¨ç½²å¹¶åœ¨ä»»ä½•åœ°æ–¹è¿è¡Œ</li><li><strong>æ¾è€¦åˆ</strong>ï¼šå®¹å™¨æ˜¯é«˜åº¦å°è£…å’Œè‡ªç»™è‡ªè¶³çš„ï¼Œå…è®¸ä½ åœ¨ä¸ç ´ç¯å…¶ä»–å®¹å™¨çš„æƒ…å†µä¸‹æ›¿æ¢æˆ–å‡çº§ä»»ä½•ä¸€ä¸ª</li><li><strong>å¯æ‰©å±•</strong>ï¼šä½ å¯ä»¥é€šè¿‡æ•°æ®ä¸­å¿ƒæ¥æ–°å¢å’Œè‡ªåŠ¨åˆ†å‘å®¹å™¨</li><li><strong>å®‰å…¨</strong>ï¼šå®¹å™¨ä¾èµ–å¼ºçº¦æŸå’Œç‹¬ç«‹çš„è¿›ç¨‹</li></ol><h3 id="1-2-å’Œä¼ ç»Ÿè™šæ‹Ÿæœºçš„åŒºåˆ«"><a href="#1-2-å’Œä¼ ç»Ÿè™šæ‹Ÿæœºçš„åŒºåˆ«" class="headerlink" title="1.2 å’Œä¼ ç»Ÿè™šæ‹Ÿæœºçš„åŒºåˆ«"></a>1.2 å’Œä¼ ç»Ÿè™šæ‹Ÿæœºçš„åŒºåˆ«</h3><p>å®¹å™¨åœ¨Linuxä¸Šæœ¬åœ°è¿è¡Œï¼Œå¹¶ä¸å…¶ä»–å®¹å™¨å…±äº«ä¸»æœºçš„å†…æ ¸ã€‚å®ƒè¿è¡Œä¸€ä¸ªç¦»æ•£è¿›ç¨‹ï¼Œä¸å ç”¨ä»»ä½•å…¶ä»–å¯æ‰§è¡Œæ–‡ä»¶æ›´å¤šçš„å†…å­˜ï¼Œä»è€Œä½¿å…¶è½»å·§ã€‚</p><p><img src="https://cdn.nlark.com/yuque/0/2020/png/93990/1598693996043-1d7fecba-79fd-489c-b933-2d23c37680a8.png" alt="image.png"></p><h3 id="1-3-ç›¸å…³é“¾æ¥"><a href="#1-3-ç›¸å…³é“¾æ¥" class="headerlink" title="1.3 ç›¸å…³é“¾æ¥"></a>1.3 ç›¸å…³é“¾æ¥</h3><p>å®˜ç½‘ï¼š<a href="https://www.docker.com/">https://www.docker.com/</a></p><p>æ–‡æ¡£ï¼š<a href="https://docs.docker.com/">https://docs.docker.com/</a></p><h2 id="äºŒã€Imageé•œåƒ"><a href="#äºŒã€Imageé•œåƒ" class="headerlink" title="äºŒã€Imageé•œåƒ"></a>äºŒã€Imageé•œåƒ</h2><h3 id="2-1-ä»‹ç»"><a href="#2-1-ä»‹ç»" class="headerlink" title="2.1 ä»‹ç»"></a>2.1 ä»‹ç»</h3><p>Docker é•œåƒæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„æ–‡ä»¶ç³»ç»Ÿï¼Œé™¤äº†æä¾›å®¹å™¨è¿è¡Œæ—¶æ‰€éœ€çš„ç¨‹åºã€åº“ã€èµ„æºã€é…ç½®ç­‰æ–‡ä»¶å¤–ï¼Œè¿˜åŒ…å«äº†ä¸€äº›ä¸ºè¿è¡Œæ—¶å‡†å¤‡çš„ä¸€äº›é…ç½®å‚æ•°ï¼ˆå¦‚åŒ¿åå·ã€ç¯å¢ƒå˜é‡ã€ç”¨æˆ·ç­‰ï¼‰ã€‚é•œåƒä¸åŒ…å«ä»»ä½•åŠ¨æ€æ•°æ®ï¼Œå…¶å†…å®¹åœ¨æ„å»ºä¹‹åä¹Ÿ<strong>ä¸ä¼šè¢«æ”¹å˜</strong>ã€‚</p><ol><li><strong>çˆ¶é•œåƒ</strong>ï¼šæ¯ä¸ªé•œåƒéƒ½å¯èƒ½ä¾èµ–äºæœ‰ä¸€ä¸ªæˆ–å¤šä¸ªä¸‹å±‚ç»„æˆçš„å¦ä¸€ä¸ªé•œåƒã€‚ä¸‹å±‚é‚£ä¸ªé•œåƒå°±æ˜¯ä¸Šå±‚é•œåƒçš„çˆ¶é•œåƒ</li><li><strong>åŸºç¡€é•œåƒ</strong>ï¼šä¸€ä¸ªæ²¡æœ‰ä»»ä½•çˆ¶é•œåƒçš„é•œåƒï¼Œè¢«ç§°ä¸ºåŸºç¡€é•œåƒ</li><li><strong>é•œåƒID</strong>ï¼šæ‰€æœ‰é•œåƒéƒ½æ˜¯é€šè¿‡ä¸€ä¸ª 64 ä½åå…­è¿›åˆ¶å­—ç¬¦ä¸²ï¼ˆ256 bit çš„å€¼ï¼‰æ¥æ ‡è¯†çš„ã€‚ä¸ºäº†ç®€åŒ–ä½¿ç”¨ï¼Œå‰ 12 ä¸ªè‡ªè´Ÿå¯ä»¥ç»„æˆä¸€ä¸ªçŸ­IDï¼Œå¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­ä½¿ç”¨ã€‚çŸ­IDè¿˜æ˜¯æœ‰ä¸€å®šçš„ç¢°æ’å‡ ç‡ï¼Œæ‰€ä»¥æœåŠ¡å™¨æ€»æ˜¯è¿”å›é•¿ID</li></ol><h3 id="2-2-ä»ä»“åº“ä¸‹è½½é•œåƒ"><a href="#2-2-ä»ä»“åº“ä¸‹è½½é•œåƒ" class="headerlink" title="2.2 ä»ä»“åº“ä¸‹è½½é•œåƒ"></a>2.2 ä»ä»“åº“ä¸‹è½½é•œåƒ</h3><p>å¯ä»¥é€šè¿‡ <code>docker pull</code> å‘½ä»¤ä»ä»“åº“è·å–æ‰€éœ€è¦çš„é•œåƒ</p><pre><code>docker pull [é€‰é¡¹] [Docker Registry åœ°å€]&lt;é•œåƒå&gt;:&lt;æ ‡ç­¾&gt;</code></pre><p><strong>é€‰é¡¹:</strong></p><ol><li>â€“all-tags,-a : æ‹‰å»æ‰€æœ‰ tagged é•œåƒ</li><li>â€“disable-content-trustï¼šå¿½ç•¥é•œåƒçš„æ ¡éªŒï¼Œé»˜è®¤</li><li>â€“platformï¼šå¦‚æœæœåŠ¡å™¨æ˜¯å¼€å¯å¤šå¹³å°æ”¯æŒçš„ï¼Œåˆ™éœ€è¦è®¾ç½®å¹³å°</li><li>â€“quiet,-qï¼šé™é»˜æ‰§è¡Œï¼Œä¸æ‰“å°è¯¦ç»†ä¿¡æ¯</li></ol><p>æ ‡ç­¾ï¼š ä¸‹è½½æŒ‡å®šæ ‡ç­¾çš„é•œåƒï¼Œé»˜è®¤ <code>latest</code></p><p><strong>ç¤ºä¾‹</strong></p><pre><code># ä» Docker Hub ä¸‹è½½æœ€æ–°çš„ debian é•œåƒdocker pull debian# ä» Docker Hub ä¸‹è½½ jessie ç‰ˆ debian é•œåƒdocker pull debian:jessie# ä¸‹è½½æŒ‡å®šæ‘˜è¦(sha256)çš„é•œåƒdocker pull ubuntu@sha256:45b23dee08af5e43a7fea6c4cf9c25ccf269ee113168c19722f87876677c5cb2</code></pre><h3 id="2-3-åˆ—å‡ºæœ¬åœ°é•œåƒ"><a href="#2-3-åˆ—å‡ºæœ¬åœ°é•œåƒ" class="headerlink" title="2.3 åˆ—å‡ºæœ¬åœ°é•œåƒ"></a>2.3 åˆ—å‡ºæœ¬åœ°é•œåƒ</h3><pre><code># åˆ—å‡ºå·²ä¸‹è½½çš„é•œåƒ image_name: æŒ‡å®šåˆ—å‡ºæŸä¸ªé•œåƒdocker images [é€‰é¡¹] [image_name]</code></pre><p><strong>é€‰é¡¹</strong></p><table><thead><tr><th>å‚æ•°</th><th>æè¿°</th></tr></thead><tbody><tr><td>â€“all, -a</td><td>å±•ç¤ºæ‰€æœ‰é•œåƒ(åŒ…æ‹¬ intermediate é•œåƒ)</td></tr><tr><td>â€“digests</td><td>å±•ç¤ºæ‘˜è¦</td></tr><tr><td>â€“filter, -f</td><td>æ·»åŠ è¿‡æ»¤æ¡ä»¶</td></tr><tr><td>â€“format</td><td>ä½¿ç”¨ Go æ¨¡ç‰ˆæ›´å¥½çš„å±•ç¤º</td></tr><tr><td>â€“no-trunc</td><td>ä¸åˆ å‡è¾“å‡º</td></tr><tr><td>â€“quiet, -q</td><td>é™é»˜è¾“å‡ºï¼Œä»…ä»…å±•ç¤º IDs</td></tr></tbody></table><p><strong>ç¤ºä¾‹</strong></p><pre><code># å±•ç¤ºæœ¬åœ°æ‰€æœ‰ä¸‹è½½çš„é•œåƒdocker images# åœ¨æœ¬åœ°æŸ¥æ‰¾é•œåƒåæ˜¯ &quot;java&quot; æ ‡ç­¾æ˜¯ &quot;8&quot; çš„ å¥–é¡¹docker images: java:8# æŸ¥æ‰¾æ‚¬æŒ‚é•œåƒdocker images --filter &quot;dangling=true&quot;# è¿‡æ»¤ lable ä¸º &quot;com.example.version&quot; çš„å€¼ä¸º 0.1 çš„é•œåƒdocker images --filter &quot;label=com.example.version=0.1&quot;</code></pre><h3 id="2-4-Dockerfileåˆ›å»ºé•œåƒ"><a href="#2-4-Dockerfileåˆ›å»ºé•œåƒ" class="headerlink" title="2.4 Dockerfileåˆ›å»ºé•œåƒ"></a>2.4 Dockerfileåˆ›å»ºé•œåƒ</h3><p>ä¸ºäº†æ–¹ä¾¿åˆ†äº«å’Œå¿«é€Ÿéƒ¨ç½²ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>docker build</code> æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„é•œåƒï¼Œé¦–å…ˆåˆ›å»ºä¸€ä¸ªæ–‡ä»¶ Dockerfileï¼Œå¦‚ä¸‹</p><pre><code># This is a commentFROM ubuntu:14.04MAINTAINER Chris &lt;jaytp@qq.com&gt;RUN apt-get -qq updateRUN apt-get -qqy install ruby ruby-devRUN gem install sinatra</code></pre><p>ç„¶ååœ¨æ­¤ Dockerfile æ‰€åœ¨ç›®å½•æ‰§è¡Œ <code>docker build -t yelog/ubuntu:v1 .</code> æ¥ç”Ÿæˆé•œåƒï¼Œæ‰€å±ç»„ç»‡&#x2F;é•œåƒå:æ ‡ç­¾</p><h3 id="2-5-ä¸Šä¼ é•œåƒ"><a href="#2-5-ä¸Šä¼ é•œåƒ" class="headerlink" title="2.5 ä¸Šä¼ é•œåƒ"></a>2.5 ä¸Šä¼ é•œåƒ</h3><p>ç”¨æˆ·å¯ä»¥é€šè¿‡ <code>docker push</code> å‘½ä»¤ï¼ŒæŠŠè‡ªå·±åˆ›å»ºçš„é•œåƒä¸Šä¼ åˆ°ä»“åº“ä¸­æ¥å…±äº«ã€‚ä¾‹å¦‚ï¼Œç”¨æˆ·åœ¨ Docker Hub ä¸Šå®Œæˆæ³¨å†Œåï¼Œå¯ä»¥æ¨é€è‡ªå·±çš„é•œåƒåˆ°ä»“åº“ä¸­ã€‚</p><pre><code>docker push yelog/ubuntu</code></pre><h3 id="2-6-å¯¼å‡ºå’Œè½½å…¥é•œåƒ"><a href="#2-6-å¯¼å‡ºå’Œè½½å…¥é•œåƒ" class="headerlink" title="2.6 å¯¼å‡ºå’Œè½½å…¥é•œåƒ"></a>2.6 å¯¼å‡ºå’Œè½½å…¥é•œåƒ</h3><p>docker æ”¯æŒå°†é•œåƒå¯¼å‡ºä¸ºæ–‡ä»¶ï¼Œç„¶åå¯ä»¥å†ä»æ–‡ä»¶å¯¼å…¥åˆ°æœ¬åœ°é•œåƒä»“åº“</p><pre><code># å¯¼å‡ºdocker load --input yelog_ubuntu_v1.tar# è½½å…¥docker load &lt; yelog_ubuntu_v1.tar</code></pre><h3 id="2-7-ç§»é™¤æœ¬åœ°é•œåƒ"><a href="#2-7-ç§»é™¤æœ¬åœ°é•œåƒ" class="headerlink" title="2.7 ç§»é™¤æœ¬åœ°é•œåƒ"></a>2.7 ç§»é™¤æœ¬åœ°é•œåƒ</h3><pre><code># -f å¼ºåˆ¶åˆ é™¤docker rmi [-f] yelog/ubuntu:v1# åˆ é™¤æ‚¬æŒ‚é•œåƒdocker rmi $(docker images -f &quot;dangling=true&quot; -q)# åˆ é™¤æ‰€æœ‰æœªè¢«å®¹å™¨ä½¿ç”¨çš„é•œåƒdocker image prune -a</code></pre><h2 id="ä¸‰ã€å®¹å™¨"><a href="#ä¸‰ã€å®¹å™¨" class="headerlink" title="ä¸‰ã€å®¹å™¨"></a>ä¸‰ã€å®¹å™¨</h2><h3 id="3-1-ä»‹ç»"><a href="#3-1-ä»‹ç»" class="headerlink" title="3.1 ä»‹ç»"></a>3.1 ä»‹ç»</h3><p>å®¹å™¨å’Œé•œåƒï¼Œå°±åƒé¢å‘å¯¹è±¡ä¸­çš„ <strong>ç±»</strong> å’Œ <strong>ç¤ºä¾‹</strong> ä¸€æ ·ï¼Œé•œåƒæ˜¯é™æ€çš„å®šä¹‰ï¼Œå®¹å™¨æ˜¯é•œåƒè¿è¡Œçš„å®ä½“ï¼Œå®¹å™¨å¯ä»¥è¢«åˆ›å»ºã€å¯åŠ¨ã€åœæ­¢ã€åˆ é™¤å’Œæš‚åœç­‰</p><p>å®¹å™¨çš„å®è´¨æ˜¯è¿›åŸï¼Œè€½äºç›´æ¥çš„å®¿ä¸»æ‰§è¡Œçš„è¿›ç¨‹ä¸åŒï¼Œå®¹å™¨è¿›ç¨‹è¿è¡Œäºå±äºè‡ªå·±çš„ç‹¬ç«‹çš„å‘½åç©ºé—´ã€‚å› æ­¤å®¹å™¨å¯ä»¥æ‹¥æœ‰è‡ªå·±çš„ root æ–‡ä»¶ç³»ç»Ÿã€ç½‘ç»œé…ç½®å’Œè¿›ç¨‹ç©ºé—´ï¼Œç”šè‡³è‡ªå·±çš„ç”¨æˆ· ID ç©ºé—´ã€‚å®¹å™¨å†…çš„è¿›ç¨‹æ˜¯è¿è¡Œåœ¨ä¸€ä¸ªéš”ç¦»çš„ç¯å¢ƒé‡Œï¼Œä½¿ç”¨èµ·æ¥ï¼Œå°±å¥½åƒæ˜¯åœ¨ä¸€ä¸ªç‹¬ç«‹äºå®¿ä¸»çš„ç³»ç»Ÿä¸‹ä¸€æ ·ã€‚è¿™ç§ç‰¹æ€§ä½¿å¾—å®¹å™¨å°è£…çš„åº”ç”¨æ¯”ç›´æ¥åœ¨å®¿ä¸»è¿è¡Œæ›´åŠ å®‰å…¨ã€‚</p><h3 id="3-2-åˆ›å»ºå®¹å™¨"><a href="#3-2-åˆ›å»ºå®¹å™¨" class="headerlink" title="3.2 åˆ›å»ºå®¹å™¨"></a>3.2 åˆ›å»ºå®¹å™¨</h3><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡å‘½ä»¤ <code>docker run</code> å‘½ä»¤åˆ›å»ºå®¹å™¨</p><p>å¦‚ä¸‹ï¼Œå¯åŠ¨ä¸€ä¸ªå®¹å™¨ï¼Œæ‰§è¡Œå‘½ä»¤è¾“å‡º â€œHello wordâ€ï¼Œä¹‹åç»ˆæ­¢å®¹å™¨</p><pre><code>docker run ubuntu:14.04 /bin/echo &#39;Hello world&#39;</code></pre><p>ä¸‹é¢çš„å‘½ä»¤åˆ™æ˜¯å¯åŠ¨ä¸€ä¸ª bash ç»ˆç«¯ï¼Œå…è®¸ç”¨æˆ·è¿›è¡Œäº¤äº’</p><pre><code>docker run -t -i ubuntu:14.04 /bin/bash</code></pre><p><code>-t</code> è®© Dcoker åˆ†é…ä¸€ä¸ªä¼ªç»ˆç«¯ï¼ˆpseudo-ttyï¼‰å¹¶ç»‘å®šåˆ°å®¹å™¨çš„æ ‡å‡†è¾“å…¥ä¸Š</p><p><code>-i</code> è´£è®©å®¹å™¨çš„æ ‡å‡†è¾“å…¥ä¿æŒæ‰“å¼€</p><p>æ›´å¤šå‚æ•°å¯é€‰</p><table><thead><tr><th>-a stdin</th><th>æŒ‡å®šæ ‡å‡†è¾“å…¥è¾“å‡ºå†…å®¹ç±»å‹</th></tr></thead><tbody><tr><td>-d</td><td>åå°è¿è¡Œå®¹å™¨ï¼Œå¹¶è¿”å›å®¹å™¨ID</td></tr><tr><td>-i</td><td>ä»¥äº¤äº’æ¨¡å¼è¿è¡Œå®¹å™¨ï¼Œé€šå¸¸ä¸ -t åŒæ—¶ä½¿ç”¨</td></tr><tr><td>-P</td><td>éšæœºç«¯å£æ˜ å°„ï¼Œå®¹å™¨ç«¯å£å†…éƒ¨éšå³æ˜ å°„åˆ°å®¿ä¸»æœºçš„ç«¯å£ä¸Š</td></tr><tr><td>-p</td><td>æŒ‡å®šç«¯å£æ˜ å°„ï¼Œ -p å®¿ä¸»æœºç«¯å£:å®¹å™¨ç«¯å£</td></tr><tr><td>-t</td><td>ä¸ºå®¹å™¨é‡æ–°åˆ†é…ä¸€ä¸ªä¼ªè¾“å…¥ç»ˆï¼Œé€šå¸¸ä¸ -i åŒæ—¶ä½¿ç”¨</td></tr><tr><td>â€“name&#x3D;â€gateâ€</td><td>ä¸ºå®¹å™¨æŒ‡å®šä¸€ä¸ªåç§°</td></tr><tr><td>â€“dns 8.8.8.8</td><td>æŒ‡å®šå®¹å™¨çš„ DNS æœåŠ¡å™¨ï¼Œé»˜è®¤ä¸å®¿ä¸»æœºä¸€è‡´</td></tr><tr><td>â€“dns-search example.com</td><td>æŒ‡å®šå®¹å™¨ DNS æœç´¢åŸŸåï¼Œé»˜è®¤ä¸å®¿ä¸»æœºä¸€è‡´</td></tr><tr><td>-h â€œgateâ€</td><td>æŒ‡å®šå®¹å™¨çš„ hostname</td></tr><tr><td>-e username&#x3D;â€™gateâ€™</td><td>è®¾ç½®ç¯å¢ƒå˜é‡</td></tr><tr><td>â€“env-file&#x3D;[]</td><td>ä»æŒ‡å®šæ–‡ä»¶è¯»å…¥ç¯å¢ƒå˜é‡</td></tr><tr><td>â€“cpuset&#x3D;â€0-2â€ or â€“cpuset&#x3D;â€0,1,2â€</td><td>ç»‘å®šå®¹å™¨åˆ°æŒ‡å®š CPU è¿è¡Œ</td></tr><tr><td>-m</td><td>è®¾ç½®å®¹å™¨ä½¿ç”¨å†…å­˜æœ€å¤§å€¼</td></tr><tr><td>â€“net&#x3D;â€bridgeâ€</td><td>æŒ‡å®šå®¹å™¨çš„ç½‘ç»œè¿æ¥ç±»å‹æ”¯æŒ bridge&#x2F;host&#x2F;none&#x2F;container</td></tr><tr><td>â€“link&#x3D;[]</td><td>æ·»åŠ é“¾æ¥åˆ°å¦ä¸€ä¸ªå®¹å™¨</td></tr><tr><td>â€“expose&#x3D;[]</td><td>å¼€æ”¾ä¸€ä¸ªç«¯å£æˆ–ä¸€ç»„ç«¯å£</td></tr><tr><td>â€“volume,-v</td><td>ç»‘å®šä¸€ä¸ªå·</td></tr></tbody></table><p>å½“åˆ©ç”¨ <code>docker run</code> æ¥åˆ›å»ºå®¹å™¨æ—¶ï¼ŒDcoker åœ¨åå°è¿è¡Œçš„æ ‡å‡†æ“ä½œåŒ…æ‹¬ï¼š</p><ul><li>æ£€æŸ¥æœ¬åœ°æ˜¯å¦å­˜åœ¨æŒ‡å®šçš„é•œåƒï¼Œä¸å­˜åœ¨å°±ä»å…¬æœ‰ä»“åº“ä¸‹è½½</li><li>åˆ©ç”¨é•œåƒåˆ›å»ºå¹¶å¯åŠ¨ä¸€ä¸ªå®¹å™¨</li><li>åˆ†é…ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œå¹¶åœ¨åªè¯»çš„é•œåƒå¤–é¢æŒ‚åœ¨ä¸€å±‚å¯è¯»å†™å±‚</li><li>ä»å®¿ä¸»ä¸»æœºé…ç½®çš„ç½‘æ¡¥æ¥å£ä¸­æ¡¥æ¥ä¸€ä¸ªè™šæ‹Ÿå€Ÿå£åˆ°å®¹å™¨ä¸­å»</li><li>ä»åœ°å€æ± é…ç½®ä¸€ä¸ª ip åœ°å€ç»™å®¹å™¨</li><li>æ‰§è¡Œç”¨æˆ·æŒ‡å®šçš„åº”ç”¨ç¨‹åº</li><li>æ‰§è¡Œç”¨æˆ·æŒ‡å®šçš„åº”ç”¨ç¨‹åº</li><li>æ‰§è¡Œå®Œæ¯•åå®¹å™¨è¢«ç»ˆæ­¢</li></ul><h3 id="3-3-å¯åŠ¨å®¹å™¨"><a href="#3-3-å¯åŠ¨å®¹å™¨" class="headerlink" title="3.3 å¯åŠ¨å®¹å™¨"></a>3.3 å¯åŠ¨å®¹å™¨</h3><pre><code># åˆ›å»ºä¸€ä¸ªåä¸º test çš„å®¹å™¨ï¼Œå®¹å™¨ä»»åŠ¡æ˜¯ï¼šæ‰“å°ä¸€è¡Œ Hello worddocker run --name=&#39;test&#39; ubuntu:14.04 /bin/echo &#39;Hello world&#39;# æŸ¥çœ‹æ‰€æœ‰å¯ç”¨å®¹å™¨ [-a]åŒ…æ‹¬ç»ˆæ­¢åœ¨å†…çš„æ‰€æœ‰å®¹å™¨docker ps -a# å¯åŠ¨æŒ‡å®š name çš„å®¹å™¨docker start test# é‡å¯æŒ‡å®š name çš„å®¹å™¨docker restart test# æŸ¥çœ‹æ—¥å¿—è¿è¡Œæ—¥å¿—ï¼ˆæ¯æ¬¡å¯åŠ¨çš„æ—¥å¿—å‡è¢«æŸ¥è¯¢å‡ºæ¥ï¼‰$ docker logs testHello worldHello world</code></pre><h3 id="3-4-å®ˆæŠ¤æ€è¿è¡Œ"><a href="#3-4-å®ˆæŠ¤æ€è¿è¡Œ" class="headerlink" title="3.4 å®ˆæŠ¤æ€è¿è¡Œ"></a>3.4 å®ˆæŠ¤æ€è¿è¡Œ</h3><p>å‰é¢åˆ›å»ºçš„å®¹å™¨éƒ½æ˜¯æ‰§è¡Œä»»åŠ¡ï¼ˆæ‰“å°Hello worldï¼‰åï¼Œå®¹å™¨å°±ç»ˆæ­¢äº†ã€‚æ›´å¤šçš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦è®© Docker å®¹å™¨åœ¨åå°ä»¥å®ˆæŠ¤æ€ï¼ˆDaemonizedï¼‰å½¢å¼è¿è¡Œã€‚æ­¤æ—¶ï¼Œå¯ä»¥é€šè¿‡æ·»åŠ  <code>-d</code> å‚æ•°æ¥å®ç°</p><blockquote><p>æ³¨æ„ï¼šdockeræ˜¯å¦ä¼šé•¿ä¹…è¿è¡Œï¼Œå’Œ docker run æŒ‡å®šçš„å‘½ä»¤æœ‰å…³</p></blockquote><pre><code># åˆ›å»º docker åå°å®ˆæŠ¤è¿›ç¨‹çš„å®¹å™¨docker run --name=&#39;test2&#39; -d ubuntu:14.04 /bin/sh -c &quot;while true; do echo hello world; sleep 1; done&quot;# æŸ¥çœ‹å®¹å™¨$ docker psCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                               NAMES237e555d4457        ubuntu:14.04        &quot;/bin/sh -c &#39;while tâ€¦&quot;   52 seconds ago      Up 51 seconds                                           test2# è·å–å®¹å™¨çš„è¾“å‡ºä¿¡æ¯$ docker logs test2hello worldhello worldhello world</code></pre><h3 id="3-5-è¿›å…¥å®¹å™¨"><a href="#3-5-è¿›å…¥å®¹å™¨" class="headerlink" title="3.5 è¿›å…¥å®¹å™¨"></a>3.5 è¿›å…¥å®¹å™¨</h3><p>ä¸Šä¸€æ­¥æˆ‘ä»¬å·²ç»å®ç°äº†å®¹å™¨å®ˆæŠ¤æ€é•¿ä¹…è¿è¡Œï¼ŒæŸäº›æ—¶å€™éœ€è¦è¿›å…¥å®¹å™¨è¿›è¡Œæ“ä½œï¼Œå¯ä»¥ä½¿ç”¨ <code>attach</code> ã€<code>exec</code> è¿›å…¥å®¹å™¨ã€‚</p><pre><code># ä¸å®‰å…¨çš„ï¼Œctrl+d é€€å‡ºæ—¶å®¹å™¨ä¹Ÿä¼šç»ˆæ­¢docker attach [å®¹å™¨Name]# ä»¥äº¤äº’å¼å‘½ä»¤è¡Œè¿›å…¥ï¼Œå®‰å…¨çš„ï¼Œæ¨èä½¿ç”¨docker exec -it [å®¹å™¨Name] /bin/bash</code></pre><p><strong>å‘½ä»¤ä¼˜åŒ–</strong></p><ol><li>ä½¿ç”¨ <code>docker exec</code> å‘½ä»¤æ—¶ï¼Œå¥½ç”¨ï¼Œä½†æ˜¯å‘½ä»¤è¿‡é•¿ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è‡ªå®šä¹‰å‘½ä»¤æ¥ç®€åŒ–ä½¿ç”¨</li><li>åˆ›å»ºæ–‡ä»¶ <code>/user/bin/ctn</code> å‘½ä»¤æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹</li></ol><pre><code>docker exec -it $1 /bin/bash</code></pre><ol><li>æ£€æŸ¥ç¯å¢ƒå˜é‡æœ‰æ²¡æœ‰é…ç½®ç›®å½• <code>/usr/bin</code> ï¼ˆä¸€èˆ¬æ˜¯æœ‰é…ç½®åœ¨ç¯å¢ƒå˜é‡é‡Œé¢çš„ï¼Œä¸è¿‡æœ€å¥½å†ç¡®è®¤ä¸€ä¸‹ï¼‰</li></ol><pre><code>$PATHbash: /usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games: No such file or directory</code></pre><ol><li>å®Œæˆä¸Šé¢æ­¥éª¤åï¼Œå°±å¯ä»¥ç›´æ¥é€šè¿‡å‘½ä»¤ <code>ctn</code> æ¥è¿›å…¥å®¹å™¨</li></ol><blockquote><p>æ³¨æ„ï¼šå¦‚æœæ˜¯ä½¿ç”¨é root è´¦å·åˆ›å»ºçš„å‘½ä»¤ï¼Œè€Œ docker å‘½ä»¤æ˜¯ root æƒé™ï¼Œå¯èƒ½å­˜åœ¨æƒé™é—®é¢˜ï¼Œå¯ä»¥é€šè¿‡è®¾ç½® <code>chmod 777 /usr/bin/ctn</code> è®¾ç½®æƒé™ï¼Œä½¿ç”¨ <code>sudo ctn [å®¹å™¨Name]</code> å³å¯è¿›å…¥å®¹å™¨</p></blockquote><pre><code>$ ctn [å®¹å™¨Name]</code></pre><ol><li>ä½¿ç”¨ä¸Šé¢å‘½ä»¤æ—¶ï¼Œå®¹å™¨Name éœ€è¦æ‰‹åŠ¨è¾“å…¥ï¼Œå®¹å™¨å‡ºé”™ã€‚æˆ‘ä»¬å¯ä»¥å€ŸåŠ© <code>complete</code> å‘½ä»¤æ¥è¡¥å…¨ å®¹å™¨Nameï¼Œåœ¨ <code>~/.bashrc</code> ï¼ˆä½œç”¨äºå½“å‰ç”¨æˆ·ï¼Œå¦‚æœæƒ³è¦æ‰€è¦ç”¨æˆ·ä¸Šæ ¡ï¼Œå¯ä»¥ä¿®æ”¹ <code>/etc/bashrc</code>ï¼‰æ–‡ä»¶ä¸­æ·»åŠ ä¸€è¡Œï¼Œå†…å®¹å¦‚ä¸‹ã€‚ä¿å­˜åæ‰§è¡Œ <code>source ~/.bashrc</code> ä½¿ä¹‹ç”Ÿæ•ˆï¼Œä¹‹åæˆ‘ä»¬è¾“å…¥ <code>ctn</code> åï¼ŒæŒ‰ <code>tab</code> å°±ä¼šæç¤ºæˆ–è‡ªåŠ¨è¡¥å…¨å®¹å™¨åäº†äº†</li></ol><pre><code># ctn auto completecomplete -W &quot;$(docker ps --format&quot;&#123;&#123;.Names&#125;&#125;&quot;)&quot; ctn</code></pre><blockquote><p>æ³¨æ„ï¼š ç”±äºæç¤ºçš„ å®¹å™¨Name æ˜¯ <code>~/.bashrc</code> ç”Ÿæ•ˆæ—¶çš„åˆ—è¡¨ï¼Œæ‰€æœ‰å¦‚æœä¹‹å docker å®¹å™¨åˆ—è¡¨æœ‰å˜åŠ¨ï¼Œéœ€è¦é‡æ–°æ‰§è¡Œ <code>source ~/.bashrc</code> ä½¿ä¹‹æ›´æ–°æç¤ºåˆ—è¡¨</p></blockquote><h3 id="3-6-ç»ˆæ­¢å®¹å™¨"><a href="#3-6-ç»ˆæ­¢å®¹å™¨" class="headerlink" title="3.6 ç»ˆæ­¢å®¹å™¨"></a>3.6 ç»ˆæ­¢å®¹å™¨</h3><p>é€šè¿‡ <code>docker stop [å®¹å™¨Name]</code> æ¥ç»ˆæ­¢ä¸€ä¸ª<strong>è¿è¡Œä¸­</strong>çš„å®¹å™¨</p><pre><code># ç»ˆæ­¢å®¹å™¨åä¸º test2 çš„å®¹å™¨docker stop test2# æŸ¥çœ‹æ­£åœ¨è¿è¡Œä¸­çš„å®¹å™¨docker ps# æŸ¥çœ‹æ‰€æœ‰å®¹å™¨ï¼ˆåŒ…æ‹¬ç»ˆæ­¢çš„ï¼‰docker ps -a</code></pre><h3 id="3-7-å°†å®¹å™¨ä¿å­˜ä¸ºé•œåƒ"><a href="#3-7-å°†å®¹å™¨ä¿å­˜ä¸ºé•œåƒ" class="headerlink" title="3.7 å°†å®¹å™¨ä¿å­˜ä¸ºé•œåƒ"></a>3.7 å°†å®¹å™¨ä¿å­˜ä¸ºé•œåƒ</h3><p>æˆ‘ä»¬ä¿®æ”¹ä¸€ä¸ªå®¹å™¨åï¼Œå¯ä»¥ç»å½“å‰å®¹å™¨çŠ¶æ€æ‰“åŒ…æˆé•œåƒï¼Œæ–¹ä¾¿ä¸‹æ¬¡ç›´æ¥é€šè¿‡é•œåƒä»“åº“ç”Ÿæˆå½“å‰çŠ¶æ€çš„å®¹å™¨ã€‚</p><pre><code># åˆ›å»ºå®¹å™¨docker run -t -i training/sinatra /bin/bash# æ·»åŠ ä¸¤ä¸ªåº”ç”¨gem install json# å°†ä¿®æ”¹åçš„å®¹å™¨æ‰“åŒ…æˆæ–°çš„é•œåƒdocker commit -m &quot;Added json gem&quot; -a &quot;Docker Newbee&quot; 0b2616b0e5a8 ouruser/sinatra:v2</code></pre><h3 id="3-8-å¯¼å‡º-å¯¼å…¥å®¹å™¨"><a href="#3-8-å¯¼å‡º-å¯¼å…¥å®¹å™¨" class="headerlink" title="3.8 å¯¼å‡º&#x2F;å¯¼å…¥å®¹å™¨"></a>3.8 å¯¼å‡º&#x2F;å¯¼å…¥å®¹å™¨</h3><p>å®¹å™¨ -&gt;å¯¼å‡º&gt; å®¹å™¨å¿«ç…§æ–‡ä»¶ -&gt;å¯¼å…¥&gt; æœ¬åœ°é•œåƒä»“åº“ -&gt;æ–°å»º&gt; å®¹å™¨</p><pre><code>$ docker ps -aCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                               NAMES2a8bffa405c8        ubuntu:14.04        &quot;/bin/sh -c &#39;while tâ€¦&quot;   About an hour ago   Up 3 seconds                                            test2# å¯¼å‡º$ docker export 2a8bffa405c8 &gt; ubuntu.tar# å¯¼å…¥ä¸ºé•œåƒ$ docker ubuntu.tar | docker import - test/ubuntu:v1.0# ä»æŒ‡å®š URL æˆ–è€…æŸä¸ªç›®å½•å¯¼å…¥$ docker import http://example.com/exampleimage.tgz example/imagerepo</code></pre><blockquote><p>æ³¨æ„ï¼šç”¨æˆ·æ—¢å¯ä»¥é€šè¿‡ <code>docker load</code> æ¥å¯¼å…¥é•œåƒå­˜å‚¨æ–‡ä»¶åˆ°æœ¬åœ°é•œåƒä»“åº“ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ <code>docker import</code> æ¥å¯¼å…¥ä¸€ä¸ªå®¹å™¨å¿«æ‰¾åˆ°æœ¬åœ°é•œåƒä»“åº“ï¼Œä¸¤è€…çš„åŒºåˆ«åœ¨äºå®¹å™¨å¿«ç…§å°†ä¸¢å¤±æ‰€æœ‰çš„å†å²è®°å½•å’Œå…ƒæ•°æ®ä¿¡æ¯ï¼Œä»…ä¿å­˜å®¹å™¨å½“æ—¶çš„çŠ¶æ€ï¼Œè€Œé•œåƒå­˜å‚¨æ–‡ä»¶å°†ä¿å­˜å®Œæˆçš„è®°å½•ï¼Œä½“ç§¯è¦æ›´å¤§ã€‚æ‰€æœ‰å®¹å™¨å¿«ç…§æ–‡ä»¶å¯¼å…¥æ—¶éœ€è¦é‡æ–°æŒ‡å®šæ ‡ç­¾ç­‰å…ƒæ•°æ®ä¿¡æ¯ã€‚</p></blockquote><h3 id="3-9-åˆ é™¤å®¹å™¨"><a href="#3-9-åˆ é™¤å®¹å™¨" class="headerlink" title="3.9 åˆ é™¤å®¹å™¨"></a>3.9 åˆ é™¤å®¹å™¨</h3><p>å¯ä»¥ä½¿ç”¨ <code>docker rm [å®¹å™¨Name]</code> æ¥åˆ é™¤ä¸€ä¸ªç»ˆæ­¢çŠ¶æ€çš„å®¹å™¨ï¼Œå¦‚æœå®¹å™¨è¿˜æœªç»ˆæ­¢ï¼Œå¯ä»¥å…ˆä½¿ç”¨ <code>docker stop [å®¹å™¨Name]</code> æ¥ç»ˆæ­¢å®¹å™¨ï¼Œå†è¿›è¡Œåˆ é™¤æ“ä½œ</p><pre><code>docker rm test2# åˆ é™¤å®¹å™¨ -f: å¼ºåˆ¶åˆ é™¤ï¼Œæ— è§†æ˜¯å¦è¿è¡Œ$ docker [-f] rm myubuntu# åˆ é™¤æ‰€æœ‰å·²å…³é—­çš„å®¹å™¨$ docker rm $(docker ps -a -q)</code></pre><h3 id="3-10-æŸ¥çœ‹å®¹å™¨çŠ¶æ€"><a href="#3-10-æŸ¥çœ‹å®¹å™¨çŠ¶æ€" class="headerlink" title="3.10 æŸ¥çœ‹å®¹å™¨çŠ¶æ€"></a>3.10 æŸ¥çœ‹å®¹å™¨çŠ¶æ€</h3><pre><code>docker stats $(docker ps --format=&#123;&#123;.Names&#125;&#125;)</code></pre><h2 id="å››ã€æ•°æ®å·"><a href="#å››ã€æ•°æ®å·" class="headerlink" title="å››ã€æ•°æ®å·"></a>å››ã€æ•°æ®å·</h2><h3 id="4-1-ä»‹ç»"><a href="#4-1-ä»‹ç»" class="headerlink" title="4.1 ä»‹ç»"></a>4.1 ä»‹ç»</h3><p>æ•°æ®å·æ˜¯ä¸€ä¸ªå¯ä¾›ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨ä½¿ç”¨çš„ç‰¹æ®Šç›®å½•ï¼Œå®ƒç»•è¿‡ UFSï¼Œå¯ä»¥æä¾›å¾ˆå¤šç‰¹æ€§ï¼š</p><ul><li>æ•°æ®å·å¯ä»¥åœ¨å®¹å™¨ä¹‹é—´å…±äº«å’Œé‡ç”¨</li><li>å¯¹æ•°æ®å·çš„ä¿®æ”¹ä¼šç«‹é©¬ç”Ÿæ•ˆ</li><li>å¯¹æ•°æ®å·çš„æ›´æ–°ï¼Œä¸ä¼šå½±å“é•œåƒ</li><li>å·ä¼šä¸€ç›´å­˜åœ¨ï¼Œç›´åˆ°æ²¡æœ‰å®¹å™¨ä½¿ç”¨</li></ul><blockquote><p>æ•°æ®å·ç±»ä¼¼äº Linux ä¸‹å¯¹ç›®å½•æˆ–æ–‡ä»¶è¿›è¡Œ mount</p></blockquote><h3 id="4-2-åˆ›å»ºæ•°æ®å·"><a href="#4-2-åˆ›å»ºæ•°æ®å·" class="headerlink" title="4.2 åˆ›å»ºæ•°æ®å·"></a>4.2 åˆ›å»ºæ•°æ®å·</h3><p>åœ¨ç”¨ <code>docker run</code> å‘½ä»¤çš„æ—¶å€™ï¼Œä½¿ç”¨ <code>-v</code> æ ‡è®°æ¥åˆ›å»ºä¸€ä¸ªæ•°æ®å·å¹¶æŒ‚åœ¨åœ¨å®¹å™¨é‡Œï¼Œå¯åŒæ—¶æŒ‚åœ¨å¤šä¸ªã€‚</p><pre><code># åˆ›å»ºä¸€ä¸ª web å®¹å™¨ï¼Œå¹¶åŠ è½½ä¸€ä¸ªæ•°æ®å·åˆ°å®¹å™¨çš„ /webapp ç›®å½•docker run -d -P --name web -v /webapp training/webapp python app.py# æŒ‚è½½ä¸€ä¸ªå®¿ä¸»æœºç›®å½• /data/webapp åˆ°å®¹å™¨ä¸­çš„ /opt/webappdocker run -d -P --name web -v /src/webapp:/opt/webapp training/webapp python app.py# é»˜è®¤æ˜¯è¯»å†™æƒé™ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šä¸ºåªè¯»docker run -d -P --name web -v /src/webapp:/opt/webapp:ro# æŒ‚è½½å•ä¸ªæ–‡ä»¶docker run --rm -it -v ~/.bash_history:/.bash_history ubuntu /bin/bash</code></pre><h3 id="4-3-æ•°æ®å·å®¹å™¨"><a href="#4-3-æ•°æ®å·å®¹å™¨" class="headerlink" title="4.3 æ•°æ®å·å®¹å™¨"></a>4.3 æ•°æ®å·å®¹å™¨</h3><p>å¦‚æœéœ€è¦å¤šä¸ªå®¹å™¨å…±äº«æ•°æ®ï¼Œæœ€å¥½åˆ›å»ºæ•°æ®å·å®¹å™¨ï¼Œå°±æ˜¯ä¸€ä¸ªæ­£å¸¸çš„å®¹å™¨ï¼Œæ’°æ–‡ç”¨æ¥æä¾›æ•°æ®å·ä¾›å…¶ä»–å®¹å™¨æŒ‚è½½çš„</p><pre><code># åˆ›å»ºä¸€ä¸ªæ•°æ®å·å®¹å™¨ dbdatadocker run -d -v /dbdata --name dbdata training/postgres echo Data-only container for postgres# å…¶ä»–å®¹å™¨æŒ‚è½½ dbdata å®¹å™¨çš„æ•°æ®å·docker run -d --volumes-from dbdata --name db1 training/postgresdocker run -d --volumes-from dbdata --name db2 training/postgres</code></pre><h2 id="äº”ã€ç½‘ç»œ"><a href="#äº”ã€ç½‘ç»œ" class="headerlink" title="äº”ã€ç½‘ç»œ"></a>äº”ã€ç½‘ç»œ</h2><h3 id="5-1-å¤–éƒ¨è®¿é—®å®¹å™¨"><a href="#5-1-å¤–éƒ¨è®¿é—®å®¹å™¨" class="headerlink" title="5.1 å¤–éƒ¨è®¿é—®å®¹å™¨"></a>5.1 å¤–éƒ¨è®¿é—®å®¹å™¨</h3><p>åœ¨å®¹å™¨å†…è¿è¡Œä¸€äº›æœåŠ¡ï¼Œéœ€è¦å¤–éƒ¨å¯ä»¥è®¿é—®åˆ°è¿™äº›æœåŠ¡ï¼Œå¯ä»¥é€šè¿‡ <code>-P</code> æˆ– <code>-p</code> å‚æ•°æ¥æŒ‡å®šç«¯å£æ˜ å°„ã€‚</p><p>å½“ä½¿ç”¨ <code>-P</code> æ ‡è®°æ—¶ï¼ŒDocker ä¼šéšå³æ˜ å°„ä¸€ä¸ª <code>49000ï½49900</code> çš„ç«¯å£åˆ°å†…éƒ¨å®¹å™¨å¼€æ”¾çš„ç½‘ç»œç«¯å£ã€‚</p><p>ä½¿ç”¨ <code>docker ps</code> å¯ä»¥æŸ¥çœ‹ç«¯å£æ˜ å°„æƒ…å†µ</p><pre><code>$ docker psCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                               NAMES7f43807dc042        training/webapp     &quot;python app.py&quot;          3 seconds ago       Up 2 seconds        0.0.0.0:32770-&gt;5000/tcp             amazing_liskov</code></pre><p>-p æŒ‡å®šç«¯å£æ˜ å°„ï¼Œæ”¯æŒæ ¼å¼ <code>ip:hostPort:containerPort | ip::containerPort | hostPort:containerPort</code></p><pre><code># ä¸é™åˆ¶ipè®¿é—®docker run -d -p 5000:5000 training/webapp python app.py# åªå…è®¸å®¿ä¸»æœºå›ç¯åœ°å€è®¿é—®docker run -d -p 127.0.0.1:5000:5000 training/webapp python app.py# å®¿ä¸»æœºè‡ªåŠ¨åˆ†é…ç»‘å®šç«¯å£docker run -d -p 127.0.0.1::5000 training/webapp python app.py# æŒ‡å®š udp ç«¯å£docker run -d -p 127.0.0.1:5000:5000/udp training/webapp python app.py# æŒ‡å®šå¤šä¸ªç«¯å£æ˜ å°„docker run -d -p 5000:5000  -p 3000:80 training/webapp python app.py# æŸ¥çœ‹æ˜ å°„ç«¯å£é…ç½®$ docker port amazing_liskov5000/tcp -&gt; 0.0.0.0:32770</code></pre><h3 id="5-2-å®¹å™¨äº’è”"><a href="#5-2-å®¹å™¨äº’è”" class="headerlink" title="5.2 å®¹å™¨äº’è”"></a>5.2 å®¹å™¨äº’è”</h3><p>å®¹å™¨é™¤äº†è·Ÿå®¿ä¸»æœºç«¯å£æ˜ å°„å¤–ï¼Œè¿˜æœ‰ä¸€ç§å®¹å™¨é—´äº¤äº’çš„æ–¹å¼ï¼Œå¯ä»¥åœ¨æº&#x2F;ç›®æ ‡å®¹å™¨ä¹‹é—´å»ºç«‹ä¸€ä¸ªéš§é“ï¼Œç›®æ ‡å®¹å™¨å¯ä»¥çœ‹åˆ°æºå®¹å™¨æŒ‡å®šçš„ä¿¡æ¯ã€‚</p><p>å¯ä»¥é€šè¿‡ <code>--link name:alias</code> æ¥è¿æ¥å®¹å™¨ï¼Œä¸‹é¢å°±æ˜¯ â€œwebå®¹å™¨è¿æ¥dbå®¹å™¨â€ çš„ä¾‹å­</p><pre><code># åˆ›å»º å®¹å™¨dbdocker run -d --name db training/postgres# åˆ›å»º å®¹å™¨web å¹¶è¿æ¥åˆ° å®¹å™¨dbdocker run -d -P --name web --link db:db training/webapp python app.py# è¿›å…¥ å®¹å™¨webï¼Œæµ‹è¯•è¿é€šæ€§$ ctn web$ ping dbPING db (172.17.0.3) 56(84) bytes of data.64 bytes from db (172.17.0.3): icmp_seq=1 ttl=64 time=0.254 ms64 bytes from db (172.17.0.3): icmp_seq=2 ttl=64 time=0.190 ms64 bytes from db (172.17.0.3): icmp_seq=3 ttl=64 time=0.389 ms</code></pre><h3 id="5-3-è®¿é—®æ§åˆ¶"><a href="#5-3-è®¿é—®æ§åˆ¶" class="headerlink" title="5.3 è®¿é—®æ§åˆ¶"></a>5.3 è®¿é—®æ§åˆ¶</h3><p>å®¹å™¨æƒ³è¦è®¿é—®å¤–éƒ¨ç½‘ç»œï¼Œéœ€è¦å®¿ä¸»æœºçš„è½¬å‘æ”¯æŒã€‚åœ¨ Linux ç³»ç»Ÿä¸­ï¼Œé€šè¿‡ä»¥ä¸‹å‘½ä»¤æ£€æŸ¥æ˜¯å¦æ‰“å¼€</p><pre><code>$ sysctl net.ipv4.ip_forwardnet.ipv4.ip_forward = 1</code></pre><p>å¦‚æœæ˜¯ 0ï¼Œè¯´æ˜æ²¡æœ‰å¼€å¯è½¬å‘ï¼Œåˆ™éœ€è¦æ‰‹åŠ¨æ‰“å¼€ã€‚</p><pre><code>$ sysctl -w net.ipv4.ip_forward=1</code></pre><h3 id="5-4-é…ç½®-docker0-æ¡¥æ¥"><a href="#5-4-é…ç½®-docker0-æ¡¥æ¥" class="headerlink" title="5.4 é…ç½® docker0 æ¡¥æ¥"></a>5.4 é…ç½® docker0 æ¡¥æ¥</h3><p>Docker æœåŠ¡é»˜è®¤ä¼šåˆ›å»ºä¸€ä¸ª <code>docker0</code> ç½‘æ¡¥ï¼Œä»–åœ¨å†…æ ¸å±‚è¿é€šäº†å…¶ä»–ç‰©ç†æˆ–è™šæ‹Ÿç½‘å¡ï¼Œè¿™å°±å°†å®¹å™¨å’Œä¸»æœºéƒ½æ”¾åœ¨åŒä¸€ä¸ªç‰©ç†ç½‘ç»œã€‚</p><p>Docker é»˜è®¤åˆ¶å®šäº† <code>docker0</code> æ¥å£çš„IPåœ°å€å’Œå­ç½‘æ©ç ï¼Œè®©ä¸»æœºå’Œå®¹å™¨é—´å¯ä»¥é€šè¿‡ç½‘æ¡¥ç›¸äº’é€šä¿¡ï¼Œä»–è¿˜ç»™äº† MTUï¼ˆæ¥å£å…è®¸æ¥æ”¶çš„æœ€å¤§å•å…ƒï¼‰ï¼Œé€šå¸¸æ˜¯ 1500 Bytesï¼Œæˆ–å®¿ä¸»æœºç½‘ç»œè·¯ç”±ä¸Šæ”¯æŒçš„é»˜è®¤å€¼ã€‚è¿™äº›éƒ½å¯ä»¥åœ¨æœåŠ¡å¯åŠ¨çš„æ—¶å€™è¿›è¡Œé…ç½®ã€‚</p><ul><li><code>--bip=CIDR</code> ipåœ°å€åŠ å­ç½‘æ©ç æ ¼å¼ï¼Œå¦‚ 192.168.1.5&#x2F;24</li><li><code>--mtu=BYTES</code> è¦†ç›–é»˜è®¤çš„ Docker MTU é…ç½®</li></ul><p>å¯ä»¥é€šè¿‡ <code>brctl show</code> æ¥æŸ¥çœ‹ç½‘æ¡¥å’Œç«¯å£è¿æ¥ä¿¡æ¯</p><h3 id="5-5-ç½‘ç»œé…ç½®æ–‡ä»¶"><a href="#5-5-ç½‘ç»œé…ç½®æ–‡ä»¶" class="headerlink" title="5.5 ç½‘ç»œé…ç½®æ–‡ä»¶"></a>5.5 ç½‘ç»œé…ç½®æ–‡ä»¶</h3><p>Docker 1.2.0 å¼€å§‹æ”¯æŒåœ¨è¿è¡Œä¸­çš„å®¹å™¨é‡Œç¼–è¾‘ <code>/etc/hosts</code> ã€<code>/etc/hostsname</code> å’Œ <code>/etc/resolve.conf</code> æ–‡ä»¶ï¼Œä¿®æ”¹éƒ½æ˜¯ä¸´æ—¶çš„ï¼Œé‡æ–°å®¹å™¨å°†ä¼šä¸¢å¤±ä¿®æ”¹ï¼Œé€šè¿‡ <code>docker commit</code> ä¹Ÿä¸ä¼šè¢«æäº¤ã€‚</p><h2 id="å…­ã€Dockerfile"><a href="#å…­ã€Dockerfile" class="headerlink" title="å…­ã€Dockerfile"></a>å…­ã€Dockerfile</h2><h3 id="6-1-ä»‹ç»"><a href="#6-1-ä»‹ç»" class="headerlink" title="6.1 ä»‹ç»"></a>6.1 ä»‹ç»</h3><p>Dockerfile æ˜¯ç”±ä¸€è¡Œè¡Œå‘½ä»¤ç»„æˆçš„å‘½ä»¤é›†åˆï¼Œåˆ†ä¸ºå››ä¸ªéƒ¨åˆ†ï¼š</p><ol><li>åŸºç¡€é•œåƒä¿¡æ¯</li><li>ç»´æŠ¤ç€ä¿¡æ¯</li><li>é•œåƒæ“ä½œæŒ‡ä»¤</li><li>å®¹å™¨å¯åŠ¨æ—¶æ‰§è¡ŒæŒ‡ä»¤</li></ol><p>å¦‚ä¸‹ï¼š</p><pre><code># æœ€å‰é¢ä¸€èˆ¬æ”¾è¿™ä¸ª Dockerfile çš„ä»‹ç»ã€ç‰ˆæœ¬ã€ä½œè€…åŠä½¿ç”¨è¯´æ˜ç­‰# This dockerfile uses the ubuntu image# VERSION 2 - EDITION 1# Author: docker_user# Command format: Instruction [arguments / command] ..# ä½¿ç”¨çš„åŸºç¡€é•œåƒï¼Œå¿…é¡»æ”¾åœ¨éæ³¨é‡Šç¬¬ä¸€è¡ŒFROM ubuntu# ç»´æŠ¤ç€ä¿¡æ¯ä¿¡æ¯ï¼š åå­— è”ç³»æ–¹å¼MAINTAINER docker_user docker_user@email.com# æ„å»ºé•œåƒçš„å‘½ä»¤ï¼šå¯¹é•œåƒåšçš„è°ƒæ•´éƒ½åœ¨è¿™é‡ŒRUN echo &quot;deb http://archive.ubuntu.com/ubuntu/ raring main universe&quot; &gt;&gt; /etc/apt/sources.listRUN apt-get update &amp;&amp; apt-get install -y nginxRUN echo &quot;\ndaemon off;&quot; &gt;&gt; /etc/nginx/nginx.conf# åˆ›å»º/è¿è¡Œ å®¹å™¨æ—¶çš„æ“ä½œæŒ‡ä»¤ # å¯ä»¥ç†è§£ä¸º docker run åè·Ÿçš„è¿è¡ŒæŒ‡ä»¤CMD /usr/sbin/nginx</code></pre><h3 id="6-2-æŒ‡ä»¤"><a href="#6-2-æŒ‡ä»¤" class="headerlink" title="6.2 æŒ‡ä»¤"></a>6.2 æŒ‡ä»¤</h3><p>æŒ‡ä»¤ä¸€èˆ¬æ ¼å¼ä¸º <code>INSTRUCTION args</code>ï¼ŒåŒ…æ‹¬ <code>FORM</code> ã€ <code>MAINTAINER</code> ã€<code>RUN</code> ç­‰</p><table><thead><tr><th>FORM</th><th>ç¬¬ä¸€æ¡æŒ‡ä»¤å¿…é¡»æ˜¯ <code>FORM</code> æŒ‡ä»¤ï¼Œå¹¶ä¸”å¦‚æœåœ¨åŒä¸€ä¸ª<code>Dockerfile</code> ä¸­åˆ›å»ºå¤šä¸ªé•œåƒï¼Œå¯ä»¥ä½¿ç”¨å¤šä¸ª <code>FROM</code> æŒ‡ä»¤ï¼ˆæ¯ä¸ªé•œåƒä¸€æ¬¡ï¼‰</th><th>FORM ubuntuFORM ubuntu:14.04</th></tr></thead><tbody><tr><td>MAINTAINER</td><td>ç»´æŠ¤è€…ä¿¡æ¯</td><td>MAINTAINER Chris <a href="mailto:&#x78;&#x78;&#64;&#x67;&#109;&#x61;&#x69;&#108;&#x2e;&#x63;&#111;&#x6d;">&#x78;&#x78;&#64;&#x67;&#109;&#x61;&#x69;&#108;&#x2e;&#x63;&#111;&#x6d;</a></td></tr><tr><td>RUN</td><td>æ¯æ¡ RUN æŒ‡ä»¤åœ¨å½“å‰é•œåƒåŸºç¡€ä¸Šæ‰§è¡Œå‘½ä»¤ï¼Œå¹¶æäº¤ä¸ºæ–°çš„é•œåƒã€‚å½“å‘½ä»¤è¿‡é•¿æ—¶å¯ä»¥ä½¿ç”¨ <code>\</code> æ¥æ¢è¡Œ</td><td>åœ¨ shell ç»ˆç«¯ä¸­è¿è¡Œå‘½ä»¤<code>RUN apt-get update &amp;&amp; apt-get install -y nginx</code>åœ¨ <code>exec</code> ä¸­æ‰§è¡Œ:<code>RUN [&quot;/bin/bash&quot;, &quot;-c&quot;, &quot;echo hello&quot;]</code></td></tr><tr><td>CMD</td><td>æŒ‡å®šå¯åŠ¨å®¹å™¨æ—¶æ‰§è¡Œçš„å‘½ä»¤ï¼Œæ¯ä¸ª Dockerfile åªèƒ½æœ‰ä¸€æ¡ CMD å‘½ä»¤ã€‚å¦‚æœæŒ‡å®šäº†å¤šæ¡å‘½ä»¤ï¼Œåªæœ‰æœ€åä¸€æ¡ä¼šè¢«æ‰§è¡Œã€‚</td><td><code>CMD [&quot;executable&quot;,&quot;param1&quot;,&quot;param2&quot;]</code> ä½¿ç”¨ <code>exec</code> æ‰§è¡Œï¼Œæ¨èæ–¹å¼ï¼›<code>CMD command param1 param2</code> åœ¨ <code>/bin/sh</code> ä¸­æ‰§è¡Œï¼Œæä¾›ç»™éœ€è¦äº¤äº’çš„åº”ç”¨ï¼›<code>CMD [&quot;param1&quot;,&quot;param2&quot;]</code> æä¾›ç»™ <code>ENTRYPOINT</code> çš„é»˜è®¤å‚æ•°ï¼›</td></tr><tr><td>EXPOSE</td><td>å‘Šè¯‰æœåŠ¡ç«¯å®¹å™¨æš´éœ²çš„ç«¯å£å·ï¼Œ</td><td>EXPOSE <port></td></tr><tr><td>ENV</td><td>æŒ‡å®šç¯å¢ƒå˜é‡</td><td>ENV PG_MAJOR 9.3ENV PATH &#x2F;usr&#x2F;local&#x2F;postgres-$PG_MAJOR&#x2F;bin:$PATH</td></tr><tr><td>ADD</td><td><code>ADD  </code>è¯¥å‘½ä»¤å°†å¤åˆ¶æŒ‡å®šçš„ <code> </code>åˆ°å®¹å™¨ä¸­çš„ <code>ã€‚å…¶ä¸­ </code> å¯ä»¥æ˜¯ <code>Dockerfile</code> æ‰€åœ¨ç›®å½•çš„ä¸€ä¸ªç›¸å¯¹è·¯å¾„ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ª<code>URL</code>ï¼›è¿˜å¯ä»¥æ˜¯ä¸€ä¸ª taræ–‡ä»¶ï¼ˆè‡ªåŠ¨è§£å‹ä¸ºç›®å½•ï¼‰</td><td></td></tr><tr><td>COPY</td><td>æ ¼å¼ä¸º <code>COPY  </code>å¤åˆ¶æœ¬åœ°ä¸»æœºçš„ <code>ï¼ˆä¸º Dockerfile æ‰€åœ¨ç›®å½•çš„ç›¸å¯¹è·¯å¾„ï¼‰åˆ°å®¹å™¨ä¸­çš„</code> ã€‚å½“ä½¿ç”¨æœ¬åœ°ç›®å½•ä¸ºæºç›®å½•æ—¶ï¼Œæ¨èä½¿ç”¨ <code>COPY</code></td><td></td></tr><tr><td>ENTRYPOINT</td><td>é…ç½®å®¹å™¨å¯åŠ¨æ‰§è¡Œçš„å‘½ä»¤ï¼Œå¹¶ä¸”ä¸å¯è¢« <code>docker run</code> æä¾›çš„å‚æ•°è¦†ç›–æ¯ä¸ªDocekrfile ä¸­åªèƒ½æœ‰ä¸€ä¸ª <code>ENTRYPOINT</code> ï¼Œå½“æŒ‡å®šå¤šä¸ªæ—¶ï¼Œåªæœ‰æœ€åä¸€ä¸ªèµ·æ•ˆ</td><td>ä¸¤ç§æ ¼å¼<code>ENTRYPOINT [&quot;executable&quot;, &quot;param1&quot;, &quot;param2&quot;]``ENTRYPOINT command param1 param2</code>ï¼ˆshellä¸­æ‰§è¡Œï¼‰</td></tr><tr><td>VOLUME</td><td>åˆ›å»ºä¸€ä¸ªå¯ä»¥ä»æœ¬åœ°ä¸»æœºæˆ–å…¶ä»–å®¹å™¨æŒ‚è½½çš„æŒ‚è½½ç‚¹ï¼Œä¸€èˆ¬ç”¨æ¥å­˜æ”¾æ•°æ®åº“å’Œéœ€è¦ä¿æŒçš„æ•°æ®ç­‰ã€‚</td><td>VOLUME [â€œ&#x2F;dataâ€]</td></tr><tr><td>USER</td><td>æŒ‡å®šè¿è¡Œå®¹å™¨æ—¶çš„ç”¨æˆ·åæˆ– UIDï¼Œåç»­çš„ <code>RUN</code> ä¹Ÿä¼šä½¿ç”¨æŒ‡å®šç”¨æˆ·</td><td>USER daemon</td></tr><tr><td>WORKDIR</td><td>ä¸ºåç»­çš„ <code>RUN</code>ã€<code>CMD</code>ã€<code>ENTRYPOINT</code> æŒ‡ä»¤é…ç½®å·¥ä½œç›®å½•ã€‚å¯ä»¥ä½¿ç”¨å¤šä¸ª <code>WORKDIR</code> æŒ‡ä»¤ï¼Œåç»­å‘½ä»¤å¦‚æœå‚æ•°æ˜¯ç›¸å¯¹è·¯å¾„ï¼Œåˆ™ä¼šåŸºäºä¹‹å‰å‘½ä»¤æŒ‡å®šçš„è·¯å¾„ã€‚</td><td>æ ¼å¼ä¸º <code>WORKDIR /path/to/workdir</code>ã€‚ WORKDIR &#x2F;aWORKDIR bWORKDIR cRUN pwdæœ€åçš„è·¯å¾„ä¸º &#x2F;a&#x2F;b&#x2F;c</td></tr><tr><td>ONBUILD</td><td>é…ç½®å½“æ‰€åˆ›å»ºçš„é•œåƒä½œä¸ºå…¶å®ƒæ–°åˆ›å»ºé•œåƒçš„åŸºç¡€é•œåƒæ—¶ï¼Œæ‰€æ‰§è¡Œçš„æ“ä½œæŒ‡ä»¤ã€‚</td><td>æ ¼å¼ä¸º <code>ONBUILD [INSTRUCTION]</code>ã€‚</td></tr></tbody></table><h3 id="6-3-åˆ›å»ºé•œåƒ"><a href="#6-3-åˆ›å»ºé•œåƒ" class="headerlink" title="6.3 åˆ›å»ºé•œåƒ"></a>6.3 åˆ›å»ºé•œåƒ</h3><p>ç¼–å†™å®Œæˆ Dockerfile ä¹‹åï¼Œå¯ä»¥é€šè¿‡ <code>docker build</code> å‘½ä»¤æ¥åˆ›å»ºé•œåƒ</p><p><code>docker build [é€‰é¡¹] è·¯å¾„</code> è¯¥å‘½ä»¤æ±Ÿéƒ½åŒºæŒ‡å®šè·¯å¾„ä¸‹ï¼ˆåŒ…æ‹¬å­ç›®å½•ï¼‰çš„Dockerfileï¼Œå¹¶å°†è¯¥è·¯å¾„ä¸‹æ‰€æœ‰å†…å®¹å‘é€ç»™ Docker æœåŠ¡ç«¯ï¼Œæœ‰æœåŠ¡ç«¯æ¥åˆ›å»ºé•œåƒã€‚å¯ä»¥é€šè¿‡ <code>.dockerignore</code> æ–‡ä»¶æ¥è®© Docker å¿½ç•¥è·¯å¾„ä¸‹çš„ç›®å½•ä¸æ–‡ä»¶</p><pre><code># ä½¿ç”¨ -t æŒ‡å®šé•œåƒçš„æ ‡ç­¾ä¿¡æ¯docker build -t myrepo/myimage .</code></pre><h2 id="ä¸ƒã€Docker-Compose"><a href="#ä¸ƒã€Docker-Compose" class="headerlink" title="ä¸ƒã€Docker Compose"></a>ä¸ƒã€Docker Compose</h2><h3 id="7-1-ä»‹ç»"><a href="#7-1-ä»‹ç»" class="headerlink" title="7.1 ä»‹ç»"></a>7.1 ä»‹ç»</h3><p>Docker Compose æ˜¯ Docker å®˜æ–¹ç¼–æ’é¡¹ç›®ä¹‹ä¸€ï¼Œè´Ÿè´£å¿«é€Ÿåœ¨é›†ç¾¤ä¸­éƒ¨ç½²åˆ†å¸ƒå¼åº”ç”¨ã€‚ç»´æŠ¤åœ°å€ï¼š<a href="https://github.com/docker/compose%EF%BC%8C%E7%94%B1">https://github.com/docker/composeï¼Œç”±</a> Python ç¼–å†™ï¼Œå®é™…è°ƒç”¨ Dockeræä¾›çš„APIå®ç°ã€‚</p><p>Dockerfile å¯ä»¥è®©ç”¨æˆ·ç®¡ç†ä¸€ä¸ªå•ç‹¬çš„åº”ç”¨å®¹å™¨ï¼Œè€Œ Compose åˆ™å…è®¸ç”¨æˆ·åœ¨ä¸€ä¸ªæ¨¡ç‰ˆï¼ˆYAMLæ ¼å¼ï¼‰ä¸­å®šä¹‰ä¸€ç»„ç›¸å…³è”çš„åº”ç”¨å®¹å™¨ï¼ˆè¢«ç§°ä¸ºä¸€ä¸ªproject&#x2F;é¡¹ç›®ï¼‰ï¼Œä¾‹å¦‚ä¸€ä¸ª webå®¹å™¨å†åŠ ä¸Šæ•°æ®åº“ã€redisç­‰ã€‚</p><h3 id="7-2-å®‰è£…"><a href="#7-2-å®‰è£…" class="headerlink" title="7.2 å®‰è£…"></a>7.2 å®‰è£…</h3><pre><code># ä½¿ç”¨ pip è¿›è¡Œå®‰è£…pip install -U docker-compose# æŸ¥çœ‹ç”¨æ³•docker-ompose -h# æ·»åŠ  bash è¡¥å…¨å‘½ä»¤curl -L https://raw.githubusercontent.com/docker/compose/1.2.0/contrib/completion/bash/docker-compose &gt; /etc/bash_completion.d/docker-compose</code></pre><h3 id="7-3-ä½¿ç”¨"><a href="#7-3-ä½¿ç”¨" class="headerlink" title="7.3 ä½¿ç”¨"></a>7.3 ä½¿ç”¨</h3><p>æœ¯è¯­</p><ul><li>æœåŠ¡&#x2F;serviceï¼š ä¸€ä¸ªåº”ç”¨å®¹å™¨ï¼Œå®é™…ä¸Šå¯ä»¥è¿è¡Œå¤šä¸ªç›¸åŒé•œåƒçš„å®ä¾‹</li><li>é¡¹ç›®&#x2F;projectï¼š æœ‰ä¸€ç»„å…³è”çš„åº”ç”¨å®¹å™¨ç»„æˆçš„å®Œæˆä¸šåŠ¡å•å…ƒ</li></ul><p>ç¤ºä¾‹ï¼šåˆ›å»ºä¸€ä¸ª Haproxy æŒ‚è½½ä¸‰ä¸ª Web å®¹å™¨</p><p>åˆ›å»ºä¸€ä¸ª <code>compose-haproxy-web</code> ç›®å½•ï¼Œä½œä¸ºé¡¹ç›®å·¥ä½œç›®å½•ï¼Œå¹¶åœ¨å…¶ä¸­åˆ†åˆ«åˆ›å»ºä¸¤ä¸ªå­ç›®å½•ï¼š <code>haproxy</code> å’Œ <code>web</code> ã€‚</p><pre><code>compose-haproxy-webcompose-haproxy-webgit clone https://github.com/yelog/compose-haproxy-web.git</code></pre><p>ç›®å½•é•¿è¿™æ ·ï¼š</p><pre><code>compose-haproxy-webâ”œâ”€â”€ docker-compose.ymlâ”œâ”€â”€ haproxyâ”‚   â””â”€â”€ haproxy.cfgâ””â”€â”€ web    â”œâ”€â”€ Dockerfile    â”œâ”€â”€ index.html    â””â”€â”€ index.py</code></pre><p>åœ¨è¯¥ç›®å½•æ‰§è¡Œ <code>docker-compose up</code> å‘½ä»¤ï¼Œä¼šæ•´åˆè¾“å‡ºæ‰€æœ‰å®¹å™¨çš„è¾“å‡º</p><pre><code>$ docker-compose upStarting compose-haproxy-web_webb_1 ... doneStarting compose-haproxy-web_webc_1 ... doneStarting compose-haproxy-web_weba_1 ... doneRecreating compose-haproxy-web_haproxy_1 ... doneAttaching to compose-haproxy-web_webb_1, compose-haproxy-web_weba_1, compose-haproxy-web_webc_1, compose-haproxy-web_haproxy_1haproxy_1  | [NOTICE] 244/131022 (1) : haproxy version is 2.2.2haproxy_1  | [NOTICE] 244/131022 (1) : path to executable is /usr/local/sbin/haproxyhaproxy_1  | [ALERT] 244/131022 (1) : parsing [/usr/local/etc/haproxy/haproxy.cfg:14] : &#39;listen&#39; cannot handle unexpected argument &#39;:70&#39;.haproxy_1  | [ALERT] 244/131022 (1) : parsing [/usr/local/etc/haproxy/haproxy.cfg:14] : please use the &#39;bind&#39; keyword for listening addresses.haproxy_1  | [ALERT] 244/131022 (1) : Error(s) found in configuration file : /usr/local/etc/haproxy/haproxy.cfghaproxy_1  | [ALERT] 244/131022 (1) : Fatal errors found in configuration.compose-haproxy-web_haproxy_1 exited with code 1</code></pre><p>æ­¤æ—¶è®¿é—®æœ¬åœ°çš„ 80 ç«¯å£ï¼Œä¼šç»è¿‡ haproxy è‡ªåŠ¨è½¬å‘åˆ°åç«¯çš„æŸä¸ª web å®¹å™¨ä¸Šï¼Œåˆ·æ–°é¡µé¢ï¼Œå¯ä»¥è§‚å¯Ÿåˆ°è®¿é—®çš„å®¹å™¨åœ°å€çš„å˜åŒ–ã€‚</p><h3 id="7-4-å‘½ä»¤è¯´æ˜"><a href="#7-4-å‘½ä»¤è¯´æ˜" class="headerlink" title="7.4 å‘½ä»¤è¯´æ˜"></a>7.4 å‘½ä»¤è¯´æ˜</h3><p>å¤§éƒ¨åˆ†å‘½ä»¤éƒ½å¯ä»¥è¿è¡Œåœ¨ä¸€ä¸ªæˆ–å¤šä¸ªæœåŠ¡ä¸Šã€‚å¦‚æœæ²¡æœ‰ç‰¹åˆ«çš„è¯´æ˜ï¼Œå‘½ä»¤åˆ™åº”ç”¨åœ¨é¡¹ç›®æ‰€æœ‰çš„æœåŠ¡ä¸Šã€‚</p><p>æ‰§è¡Œ <code>docker-compose [COMMAND] --help</code> æŸ¥çœ‹å…·ä½“æŸä¸ªå‘½ä»¤çš„ä½¿ç”¨è¯´æ˜</p><p>ä½¿ç”¨æ ¼å¼</p><pre><code>docker-compose [options] [COMMAND] [ARGS...]</code></pre><table><thead><tr><th>build</th><th>æ„å»º&#x2F;é‡å»ºæœåŠ¡æœåŠ¡ä¸€æ—¦æ„å»ºåï¼Œå°†ä¼šå¸¦ä¸Šä¸€ä¸ªæ ‡è®°åï¼Œä¾‹å¦‚ web_dbå¯ä»¥éšæ—¶åœ¨é¡¹ç›®ç›®å½•è¿è¡Œ <code>docker-compose build</code> æ¥é‡æ–°æ„å»ºæœåŠ¡</th></tr></thead><tbody><tr><td>help</td><td>è·å¾—ä¸€ä¸ªå‘½ä»¤çš„ä¿¡æ¯</td></tr><tr><td>kill</td><td>é€šè¿‡å‘é€ <code>SIGKILL</code> ä¿¡å·æ¥å¼ºåˆ¶åœæ­¢æœåŠ¡å®¹å™¨ï¼Œæ”¯æŒé€šè¿‡å‚æ•°æ¥æŒ‡å®šå‘é€ä¿¡å·ï¼Œä¾‹å¦‚<code>docker-compose kill -s SIGINT</code></td></tr><tr><td>logs</td><td>æŸ¥çœ‹æœåŠ¡çš„è¾“å‡º</td></tr><tr><td>port</td><td>æ‰“å°ç»‘å®šçš„å…¬å…±ç«¯å£</td></tr><tr><td>ps</td><td>åˆ—å‡ºæ‰€æœ‰å®¹å™¨</td></tr><tr><td>pull</td><td>æ‹‰å»æœåŠ¡é•œåƒ</td></tr><tr><td>rm</td><td>åˆ é™¤åœæ­¢çš„æœåŠ¡å®¹å™¨</td></tr><tr><td>run</td><td>åœ¨ä¸€ä¸ªæœåŠ¡ä¸Šæ‰§è¡Œä¸€ä¸ªå‘½ä»¤<code>docker-compose run ubuntu ping docker.com</code></td></tr><tr><td>scale</td><td>è®¾ç½®åŒä¸€ä¸ªæœåŠ¡è¿è¡Œçš„å®¹å™¨ä¸ªæ•°é€šè¿‡ <code>service=num</code> çš„å‚æ•°æ¥è®¾ç½®æ•°é‡<code>docker-compose scale web=2 worker=3</code></td></tr><tr><td>start</td><td>å¯åŠ¨ä¸€ä¸ªå·²ç»å­˜åœ¨çš„æœåŠ¡å®¹å™¨</td></tr><tr><td>stop</td><td>åœæ­¢ä¸€ä¸ªå·²ç»è¿è¡Œçš„å®¹å™¨ï¼Œä½†ä¸åˆ é™¤ã€‚å¯ä»¥é€šè¿‡ <code>docker-compose start</code> å†æ¬¡å¯åŠ¨</td></tr><tr><td>up</td><td>æ„å»ºã€åˆ›å»ºã€å¯åŠ¨ã€é“¾æ¥ä¸€ä¸ªæœåŠ¡ç›¸å…³çš„å®¹å™¨é“¾æ¥æœåŠ¡éƒ½å°†è¢«å¯åŠ¨ï¼Œé™¤éä»–ä»¬å·²ç»è¿è¡Œ<code>docker-compose up -d</code> å°†åå°è¿è¡Œå¹¶å¯åŠ¨<code>docker-compose up</code> å·²å­˜åœ¨å®¹å™¨å°†ä¼šé‡æ–°åˆ›å»º<code>docker-compose up --no-recreate</code> å°†ä¸ä¼šé‡æ–°åˆ›å»ºå®¹å™¨</td></tr></tbody></table><h3 id="7-5-ç¯å¢ƒå˜é‡"><a href="#7-5-ç¯å¢ƒå˜é‡" class="headerlink" title="7.5 ç¯å¢ƒå˜é‡"></a>7.5 ç¯å¢ƒå˜é‡</h3><p>ç¯å¢ƒå˜é‡å¯ä»¥ç”¨æ¥é…ç½® Compose çš„è¡Œä¸º</p><p>ä»¥ <code>Docker_</code> å¼€å¤´çš„å˜é‡ç”¨æ¥é…ç½® Docker å‘½ä»¤è¡Œå®¢æˆ·ç«¯ä½¿ç”¨çš„ä¸€æ ·</p><table><thead><tr><th>COMPOSE_PROJECT_NAME</th><th>è®¾ç½®é€šè¿‡ Compose å¯åŠ¨çš„æ¯ä¸€ä¸ªå®¹å™¨å‰æ·»åŠ çš„é¡¹ç›®åç§°ï¼Œé»˜è®¤æ˜¯å½“å‰å·¥ä½œç›®å½•çš„åå­—ã€‚</th></tr></thead><tbody><tr><td>COMPOSE_FILE</td><td>è®¾ç½®è¦ä½¿ç”¨çš„ <code>docker-compose.yml</code> çš„è·¯å¾„ã€‚é»˜è®¤è·¯å¾„æ˜¯å½“å‰å·¥ä½œç›®å½•ã€‚</td></tr><tr><td>DOCKER_HOST</td><td>è®¾ç½® Docker daemon çš„åœ°å€ã€‚é»˜è®¤ä½¿ç”¨ <code>unix:///var/run/docker.sock</code>ï¼Œä¸ Docker å®¢æˆ·ç«¯é‡‡ç”¨çš„é»˜è®¤å€¼ä¸€è‡´ã€‚</td></tr><tr><td>DOCKER_TLS_VERIFY</td><td>å¦‚æœè®¾ç½®ä¸ä¸ºç©ºï¼Œåˆ™ä¸ Docker daemon äº¤äº’é€šè¿‡ TLS è¿›è¡Œã€‚</td></tr><tr><td>DOCKER_CERT_PATH</td><td>é…ç½® TLS é€šä¿¡æ‰€éœ€è¦çš„éªŒè¯ï¼ˆ<code>ca.pem</code>ã€<code>cert.pem</code> å’Œ <code>key.pem</code>ï¼‰æ–‡ä»¶çš„è·¯å¾„ï¼Œé»˜è®¤æ˜¯ <code>~/.docker</code> ã€‚</td></tr></tbody></table><h3 id="7-6-docker-compose-yml"><a href="#7-6-docker-compose-yml" class="headerlink" title="7.6 docker-compose.yml"></a>7.6 docker-compose.yml</h3><p>é»˜è®¤æ¨¡ç‰ˆæ–‡ä»¶æ˜¯ <code>docker-compose.yml</code> ï¼Œå¯åŠ¨å®šä¹‰äº†æ¯ä¸ªæœåŠ¡éƒ½å¿…é¡»ç»è¿‡ <code>image</code> æŒ‡ä»¤æŒ‡å®šé•œåƒæˆ– <code>build</code> æŒ‡ä»¤ï¼ˆéœ€è¦ Dockerfile) æ¥è‡ªåŠ¨æ„å»ºã€‚</p><p>å…¶ä»–å¤§éƒ¨åˆ†æŒ‡ä»¤è·Ÿ <code>docker run</code> ç±»ä¼¼</p><p>å¦‚æœä½¿ç”¨ <code>build</code> æŒ‡ä»¤ï¼Œåœ¨ Dockerfile ä¸­è®¾ç½®çš„é€‰é¡¹ï¼ˆå¦‚ <code>CMD</code> ã€<code>EXPOSE</code> ç­‰ï¼‰å°†ä¼šè¢«è‡ªåŠ¨è·å–ï¼Œæ— éœ€åœ¨ <code>docker-compose.yml</code> ä¸­å†æ¬¡è®¾ç½®ã€‚</p><pre><code>**image**</code></pre><p>æŒ‡å®šé•œåƒåç§°æˆ–é•œåƒIDï¼Œå¦‚æœæœ¬åœ°ä»“åº“ä¸å­˜åœ¨ï¼Œå°†å°è¯•ä»è¿œç¨‹ä»“åº“æ‹‰å»æ­¤é•œåƒ</p><pre><code>image: ubuntuimage: orchardup/postgresqlimage: a4bc65fd**build**</code></pre><p>æŒ‡å®š <code>Dockerfile</code> æ‰€åœ¨æ–‡ä»¶çš„è·¯å¾„ã€‚<code>Compose</code> å°†åˆ©ç”¨å®ƒè‡ªåŠ¨æ„å»ºè¿™ä¸ªé•œåƒï¼Œç„¶åä½¿ç”¨è¿™ä¸ªé•œåƒã€‚</p><pre><code>build: /path/to/build/dir**command**</code></pre><p>è¦†ç›–å®¹å™¨å¯åŠ¨é»˜è®¤æ‰§è¡Œå‘½ä»¤</p><pre><code>command: bundle exec thin -p 3000**links**</code></pre><p>é“¾æ¥åˆ°å…¶ä»–æœåŠ¡ä¸­çš„å®¹å™¨ï¼Œä½¿ç”¨æœåŠ¡åç§°æˆ–åˆ«å</p><pre><code>links:    - db  - db:database  - redis</code></pre><p>åˆ«åä¼šè‡ªåŠ¨åœ¨æœåŠ¡å™¨ä¸­çš„ <code>/etc/hosts</code> é‡Œåˆ›å»ºã€‚ä¾‹å¦‚ï¼š</p><pre><code>172.17.2.186  db172.17.2.186  database172.17.2.187  redis**external_links**</code></pre><p>è¿æ¥åˆ° <code>docker-compose.yml</code> å¤–éƒ¨çš„å®¹å™¨ï¼Œç”šè‡³å¹¶é <code>Compose</code> ç®¡ç†çš„å®¹å™¨ã€‚</p><pre><code>external_links: - redis_1 - project_db_1:mysql - project_db_1:postgresql</code></pre><p><strong><code>ports</code></strong></p><p>æš´éœ²ç«¯å£ä¿¡æ¯ <code>HOST:CONTAINER</code></p><p>æ ¼å¼æˆ–è€…ä»…ä»…æŒ‡å®šå®¹å™¨çš„ç«¯å£ï¼ˆå®¿ä¸»æœºä¼šéšæœºåˆ†é…ç«¯å£ï¼‰</p><pre><code>ports: - &quot;3000&quot; - &quot;8000:8000&quot; - &quot;49100:22&quot; - &quot;127.0.0.1:8001:8001&quot;</code></pre><blockquote><p><em>æ³¨ï¼šå½“ä½¿ç”¨ <code>HOST:CONTAINER</code> æ ¼å¼æ¥æ˜ å°„ç«¯å£æ—¶ï¼Œå¦‚æœä½ ä½¿ç”¨çš„å®¹å™¨ç«¯å£å°äº 60 ä½ å¯èƒ½ä¼šå¾—åˆ°é”™è¯¯å¾—ç»“æœï¼Œå› ä¸º <code>YAML</code> å°†ä¼šè§£æ <code>xx:yy</code> è¿™ç§æ•°å­—æ ¼å¼ä¸º 60 è¿›åˆ¶ã€‚æ‰€ä»¥å»ºè®®é‡‡ç”¨å­—ç¬¦ä¸²æ ¼å¼ã€‚</em></p></blockquote><pre><code>**expose**</code></pre><p>æš´éœ²ç«¯å£ï¼Œä½†ä¸æ˜ å°„åˆ°å®¿ä¸»æœºï¼Œåªè¢«è¿æ¥çš„æœåŠ¡è®¿é—®</p><pre><code>expose: - &quot;3000&quot; - &quot;8000&quot;</code></pre><p><strong><code>volumes</code></strong></p><p>å·æŒ‚è½½è·¯å¾„è®¾ç½®ã€‚å¯ä»¥è®¾ç½®å®¿ä¸»æœºè·¯å¾„ ï¼ˆ<code>HOST:CONTAINER</code>ï¼‰ æˆ–åŠ ä¸Šè®¿é—®æ¨¡å¼ ï¼ˆ<code>HOST:CONTAINER:ro</code>ï¼‰ã€‚</p><pre><code>volumes: - /var/lib/mysql - cache/:/tmp/cache - ~/configs:/etc/configs/:ro</code></pre><p>**<br>**</p><p><strong><code>volumes_from</code></strong></p><p>ä»å¦ä¸€ä¸ªæœåŠ¡æˆ–å®¹å™¨æŒ‚è½½å®ƒçš„æ‰€æœ‰å·ã€‚</p><pre><code>volumes_from: - service_name - container_name</code></pre><pre><code>environment</code></pre><p>è®¾ç½®ç¯å¢ƒå˜é‡ã€‚ä½ å¯ä»¥ä½¿ç”¨æ•°ç»„æˆ–å­—å…¸ä¸¤ç§æ ¼å¼ã€‚</p><p>åªç»™å®šåç§°çš„å˜é‡ä¼šè‡ªåŠ¨è·å–å®ƒåœ¨ Compose ä¸»æœºä¸Šçš„å€¼ï¼Œå¯ä»¥ç”¨æ¥é˜²æ­¢æ³„éœ²ä¸å¿…è¦çš„æ•°æ®ã€‚</p><pre><code>environment:  RACK_ENV: development  SESSION_SECRET:environment:  - RACK_ENV=development  - SESSION_SECRET</code></pre><p><strong><code>env_file</code></strong></p><p>ä»æ–‡ä»¶ä¸­è·å–ç¯å¢ƒå˜é‡ï¼Œå¯ä»¥ä¸ºå•ç‹¬çš„æ–‡ä»¶è·¯å¾„æˆ–åˆ—è¡¨ã€‚</p><p>å¦‚æœé€šè¿‡ <code>docker-compose -f FILE</code> æŒ‡å®šäº†æ¨¡æ¿æ–‡ä»¶ï¼Œåˆ™ <code>env_file</code> ä¸­è·¯å¾„ä¼šåŸºäºæ¨¡æ¿æ–‡ä»¶è·¯å¾„ã€‚</p><p>å¦‚æœæœ‰å˜é‡åç§°ä¸ <code>environment</code> æŒ‡ä»¤å†²çªï¼Œåˆ™ä»¥åè€…ä¸ºå‡†ã€‚</p><pre><code>env_file: .envenv_file:  - ./common.env  - ./apps/web.env  - /opt/secrets.env</code></pre><p>ç¯å¢ƒå˜é‡æ–‡ä»¶ä¸­æ¯ä¸€è¡Œå¿…é¡»ç¬¦åˆæ ¼å¼ï¼Œæ”¯æŒ <code>#</code> å¼€å¤´çš„æ³¨é‡Šè¡Œã€‚</p><pre><code># common.env: Set Rails/Rack environmentRACK_ENV=development</code></pre><p><strong><code>extends</code></strong></p><p>åŸºäºå·²æœ‰çš„æœåŠ¡è¿›è¡Œæ‰©å±•ã€‚ä¾‹å¦‚æˆ‘ä»¬å·²ç»æœ‰äº†ä¸€ä¸ª webapp æœåŠ¡ï¼Œæ¨¡æ¿æ–‡ä»¶ä¸º <code>common.yml</code>ã€‚</p><pre><code># common.ymlwebapp:  build: ./webapp  environment:    - DEBUG=false    - SEND_EMAILS=false</code></pre><p>ç¼–å†™ä¸€ä¸ªæ–°çš„ <code>development.yml</code> æ–‡ä»¶ï¼Œä½¿ç”¨ <code>common.yml</code> ä¸­çš„ webapp æœåŠ¡è¿›è¡Œæ‰©å±•ã€‚</p><pre><code># development.ymlweb:  extends:    file: common.yml    service: webapp  ports:    - &quot;8000:8000&quot;  links:    - db  environment:    - DEBUG=truedb:  image: postgres</code></pre><p>åè€…ä¼šè‡ªåŠ¨ç»§æ‰¿ common.yml ä¸­çš„ webapp æœåŠ¡åŠç›¸å…³ç¯èŠ‚å˜é‡ã€‚</p><p>**<br>**</p><p><strong><code>net</code></strong></p><p>è®¾ç½®ç½‘ç»œæ¨¡å¼ã€‚ä½¿ç”¨å’Œ <code>docker client</code> çš„ <code>--net</code> å‚æ•°ä¸€æ ·çš„å€¼ã€‚</p><pre><code>net: &quot;bridge&quot;net: &quot;none&quot;net: &quot;container:[name or id]&quot;net: &quot;host&quot;</code></pre><p>**<br>**</p><p><strong><code>pid</code></strong></p><p>è·Ÿä¸»æœºç³»ç»Ÿå…±äº«è¿›ç¨‹å‘½åç©ºé—´ã€‚æ‰“å¼€è¯¥é€‰é¡¹çš„å®¹å™¨å¯ä»¥ç›¸äº’é€šè¿‡è¿›ç¨‹ ID æ¥è®¿é—®å’Œæ“ä½œã€‚</p><pre><code>pid: &quot;host&quot;</code></pre><p><strong><code>dns</code></strong></p><p>é…ç½® DNS æœåŠ¡å™¨ã€‚å¯ä»¥æ˜¯ä¸€ä¸ªå€¼ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªåˆ—è¡¨ã€‚</p><pre><code>dns: 8.8.8.8dns:  - 8.8.8.8  - 9.9.9.9</code></pre><p><strong><code>cap_add, cap_drop</code></strong></p><p>æ·»åŠ æˆ–æ”¾å¼ƒå®¹å™¨çš„ Linux èƒ½åŠ›ï¼ˆCapabiliityï¼‰ã€‚</p><pre><code>cap_add:  - ALLcap_drop:  - NET_ADMIN  - SYS_ADMIN</code></pre><p>**<br>**</p><p><strong><code>dns_search</code></strong></p><p>é…ç½® DNS æœç´¢åŸŸã€‚å¯ä»¥æ˜¯ä¸€ä¸ªå€¼ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªåˆ—è¡¨ã€‚</p><pre><code class="yaml">dns_search: example.comdns_search:  - domain1.example.com  - domain2.example.com</code></pre><p>**<br>**</p><p><strong><code>working_dir, entrypoint, user, hostname, domainname, mem_limit, privileged, restart, stdin_open, tty, cpu_shares</code></strong></p><p>è¿™äº›éƒ½æ˜¯å’Œ <code>docker run</code> æ”¯æŒçš„é€‰é¡¹ç±»ä¼¼ã€‚</p><h2 id="å…«ã€å®‰å…¨"><a href="#å…«ã€å®‰å…¨" class="headerlink" title="å…«ã€å®‰å…¨"></a>å…«ã€å®‰å…¨</h2><h3 id="8-1-å†…æ ¸å‘½åç©ºé—´"><a href="#8-1-å†…æ ¸å‘½åç©ºé—´" class="headerlink" title="8.1 å†…æ ¸å‘½åç©ºé—´"></a>8.1 å†…æ ¸å‘½åç©ºé—´</h3><p>å½“ä½¿ç”¨ <code>docker run</code> å¯åŠ¨ä¸€ä¸ªå®¹å™¨æ—¶ï¼Œåœ¨åå° Docker ä¸ºå®¹å™¨åˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„å‘½åç©ºé—´å’Œæ§åˆ¶é›†åˆã€‚å‘½åç©ºé—´è¸¢ç©ºäº†æœ€åŸºç¡€çš„ä¹Ÿæ˜¯æœ€ç›´æ¥çš„éš”ç¦»ï¼Œåœ¨å®¹å™¨ä¸­è¿è¡Œçš„è¿›ç¨‹ä¸ä¼šè¢«è¿è¡Œåœ¨ä¸»æœºä¸Šçš„è¿›ç¨‹å’Œå…¶ä»–å®¹å™¨å‘ç°å’Œä½œç”¨ã€‚</p><h3 id="8-2-æ§åˆ¶ç»„"><a href="#8-2-æ§åˆ¶ç»„" class="headerlink" title="8.2 æ§åˆ¶ç»„"></a>8.2 æ§åˆ¶ç»„</h3><p>æ§åˆ¶ç»„æ˜¯ Linux å®¹å™¨æœºåˆ¶çš„å¦ä¸€ä¸ªå…³é”®ç»„ä»¶ï¼Œè´Ÿè´£å®ç°èµ„æºçš„å®¡è®¡å’Œé™åˆ¶ã€‚</p><p>å®ƒæä¾›äº†å¾ˆå¤šç‰¹æ€§ï¼Œç¡®ä¿å“¥å“¥å®¹å™¨å¯ä»¥å…¬å¹³åœ°åˆ†äº«ä¸»æœºçš„å†…å­˜ã€CPUã€ç£ç›˜IOç­‰èµ„æºï¼›å½“ç„¶ï¼Œæ›´é‡è¦çš„æ˜¯ï¼Œæ§åˆ¶ç»„ç¡®ä¿äº†å½“å®¹å™¨å†…çš„èµ„æºä½¿ç”¨äº§ç”Ÿå‹åŠ›æ—¶ä¸ä¼šè¿ç´¯ä¸»æœºç³»ç»Ÿã€‚</p><h3 id="8-3-å†…æ ¸èƒ½åŠ›æœºåˆ¶"><a href="#8-3-å†…æ ¸èƒ½åŠ›æœºåˆ¶" class="headerlink" title="8.3 å†…æ ¸èƒ½åŠ›æœºåˆ¶"></a>8.3 å†…æ ¸èƒ½åŠ›æœºåˆ¶</h3><p>èƒ½åŠ›æœºåˆ¶æ˜¯ Linux å†…æ ¸çš„ä¸€ä¸ªå¼ºå¤§ç‰¹æ€§ï¼Œå¯ä»¥æä¾›ç»†ç²’åº¦çš„æƒé™è®¿é—®æ§åˆ¶ã€‚ å¯ä»¥ä½œç”¨åœ¨è¿›ç¨‹ä¸Šï¼Œä¹Ÿå¯ä»¥ä½œç”¨åœ¨æ–‡ä»¶ä¸Šã€‚</p><p>ä¾‹å¦‚ä¸€ä¸ªæœåŠ¡éœ€è¦ç»‘å®šä½äº 1024 çš„ç«¯å£æƒé™ï¼Œå¹¶ä¸éœ€è¦ root æƒé™ï¼Œé‚£ä¹ˆå®ƒåªéœ€è¦è¢«æˆæƒ <code>net_bind_service</code> èƒ½åŠ›å³å¯ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ Docker å¯åŠ¨çš„å®¹å™¨è¢«ä¸¥æ ¼é™åˆ¶åªå…è®¸ä½¿ç”¨å†…æ ¸çš„ä¸€éƒ¨åˆ†èƒ½åŠ›ã€‚</p><p>ä½¿ç”¨èƒ½åŠ›æœºåˆ¶åŠ å¼º Docker å®¹å™¨çš„å®‰å…¨æœ‰å¾ˆå¤šå¥½å¤„ï¼Œå¯ä»¥æŒ‰éœ€åˆ†é…ç»™å®¹å™¨æƒé™ï¼Œè¿™æ ·ï¼Œå³ä¾¿æ”»å‡»è€…åœ¨å®¹å™¨ä¸­å–å¾—äº† root æƒé™ï¼Œä¹Ÿä¸èƒ½è·å–å®¿ä¸»æœºè¾ƒé«˜æƒé™ï¼Œèƒ½è¿›è¡Œçš„ç ´åä¹Ÿæ˜¯æœ‰é™çš„ã€‚</p><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><p><a href="https://docs.docker.com/engine/reference/commandline/images/">https://docs.docker.com/engine/reference/commandline/images/</a></p><p><a href="http://www.dockerinfo.net/">http://www.dockerinfo.net/</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;ä¸€ã€æ¦‚è¿°&quot;&gt;&lt;a href=&quot;#ä¸€ã€æ¦‚è¿°&quot; class=&quot;headerlink&quot; title=&quot;ä¸€ã€æ¦‚è¿°&quot;&gt;&lt;/a&gt;ä¸€ã€æ¦‚è¿°&lt;/h2&gt;&lt;h3 id=&quot;1-1-ä»€ä¹ˆæ˜¯docker&quot;&gt;&lt;a href=&quot;#1-1-ä»€ä¹ˆæ˜¯docker&quot; class=&quot;headerlink</summary>
      
    
    
    
    <category term="è¿ç»´" scheme="http://yelog.org/categories/%E8%BF%90%E7%BB%B4/"/>
    
    
    <category term="docker" scheme="http://yelog.org/tags/docker/"/>
    
    <category term="linux" scheme="http://yelog.org/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>3-hexoè¯„è®ºè®¾ç½®</title>
    <link href="http://yelog.org/2020/05/23/3-hexo-comment/"/>
    <id>http://yelog.org/2020/05/23/3-hexo-comment/</id>
    <published>2020-05-23T14:26:23.000Z</published>
    <updated>2024-08-12T09:33:12.062Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ç›®å‰ <code>3-hexo</code> å·²ç»é›†æˆäº†è¯„è®ºç³»ç»Ÿæœ‰ <code>gitalk</code> ã€<code>gitment</code>ã€ <code>disqus</code> ã€<code>æ¥å¿…åŠ›</code>ã€<code>utteranc</code></p><h2 id="ä¸€ã€gitalk"><a href="#ä¸€ã€gitalk" class="headerlink" title="ä¸€ã€gitalk"></a>ä¸€ã€gitalk</h2><p>gitalk æ˜¯ä¸€æ¬¾åŸºäº Github Issue å’Œ Preact å¼€å‘çš„è¯„è®ºæ’ä»¶ å®˜ç½‘: <a href="https://gitalk.github.io/">https://gitalk.github.io/</a></p><h3 id="1-ç™»å½•-github-ï¼Œæ³¨å†Œåº”ç”¨"><a href="#1-ç™»å½•-github-ï¼Œæ³¨å†Œåº”ç”¨" class="headerlink" title="1. ç™»å½• github ï¼Œæ³¨å†Œåº”ç”¨"></a>1. ç™»å½• github ï¼Œæ³¨å†Œåº”ç”¨</h3><p><a href="https://github.com/settings/applications/new">ç‚¹å‡»è¿›è¡Œæ³¨å†Œ</a> ï¼Œå¦‚ä¸‹</p><p><img src="https://i.loli.net/2020/05/23/6BmnUbX5gzPHqk1.png" alt="æ³¨å†Œåº”ç”¨"></p><p>æ³¨å†Œå®Œåï¼Œå¯å¾—åˆ° <code>Client ID</code> å’Œ <code>Client Secret</code></p><h3 id="2-æ–°å»ºå­˜æ”¾è¯„è®ºçš„ä»“åº“"><a href="#2-æ–°å»ºå­˜æ”¾è¯„è®ºçš„ä»“åº“" class="headerlink" title="2. æ–°å»ºå­˜æ”¾è¯„è®ºçš„ä»“åº“"></a>2. æ–°å»ºå­˜æ”¾è¯„è®ºçš„ä»“åº“</h3><p>å› ä¸º <code>gitalk</code> æ˜¯åŸºäº Github çš„ Issue çš„ï¼Œæ‰€ä»¥éœ€è¦æŒ‡å®šä¸€ä¸ªä»“åº“ï¼Œç”¨æ¥æ‰¿æ¥ gitalk çš„è¯„è®ºï¼Œæˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨ Github Page æ¥åšæˆ‘ä»¬åšå®¢çš„è¯„è®ºï¼Œæ‰€ä»¥ï¼Œæ–°å»ºä»“åº“åä¸º <code>xxx.github.io</code>ï¼Œå…¶ä¸­ xxx ä¸ºä½ çš„ Github ç”¨æˆ·å</p><h3 id="3-é…ç½®ä¸»é¢˜"><a href="#3-é…ç½®ä¸»é¢˜" class="headerlink" title="3. é…ç½®ä¸»é¢˜"></a>3. é…ç½®ä¸»é¢˜</h3><p>åœ¨ä¸»é¢˜ä¸‹ <code>_config.yml</code> ä¸­æ‰¾åˆ°å¦‚ä¸‹é…ç½®ï¼Œå¯ç”¨è¯„è®ºï¼Œå¹¶ä½¿ç”¨ <code>gitalk</code></p><pre><code class="yaml">##########è¯„è®ºè®¾ç½®#############comment:  on: true  type: gitalk</code></pre><p>åœ¨ä¸»é¢˜ä¸‹ <code>_config.yml</code> ä¸­æ‰¾åˆ° gitalk é…ç½®ï¼Œå°† ç¬¬1æ­¥ å¾—åˆ°çš„  <code>Client ID</code> å’Œ <code>Client Secret</code> å¤åˆ¶åˆ°å¦‚ä¸‹ä½ç½®</p><pre><code class="yaml">gitalk:  githubID:    # å¡«ä½ çš„ github ç”¨æˆ·å  repo:  xxx.github.io # æ‰¿è½½è¯„è®ºçš„ä»“åº“ï¼Œä¸€èˆ¬ä½¿ç”¨ Github Page ä»“åº“  ClientID:   # ç¬¬1æ­¥è·å¾— Client ID  ClientSecret:  # ç¬¬1æ­¥è·å¾— Client Secret  adminUser:     # Github ç”¨æˆ·å  distractionFreeMode: true  language: zh-CN  perPage: 10</code></pre><h2 id="äºŒã€æ¥å¿…åŠ›"><a href="#äºŒã€æ¥å¿…åŠ›" class="headerlink" title="äºŒã€æ¥å¿…åŠ›"></a>äºŒã€æ¥å¿…åŠ›</h2><h3 id="1-åˆ›å»ºæ¥å¿…åŠ›è´¦å·ï¼Œå¹¶é€‰æ‹©-City-å…è´¹ç‰ˆ"><a href="#1-åˆ›å»ºæ¥å¿…åŠ›è´¦å·ï¼Œå¹¶é€‰æ‹©-City-å…è´¹ç‰ˆ" class="headerlink" title="1. åˆ›å»ºæ¥å¿…åŠ›è´¦å·ï¼Œå¹¶é€‰æ‹© City å…è´¹ç‰ˆ"></a>1. åˆ›å»ºæ¥å¿…åŠ›è´¦å·ï¼Œå¹¶é€‰æ‹© City å…è´¹ç‰ˆ</h3><p>å®˜ç½‘<a href="http://livere.com/">http://livere.com/</a> ï¼Œåˆ›å»ºè´¦å·ï¼Œç‚¹å‡»ä¸Šé¢çš„å®‰è£…ï¼Œé€‰æ‹© City å…è´¹ç‰ˆ</p><p><img src="https://i.loli.net/2020/05/23/mLYfjrJ1UgOIpiD.png" alt="é€‰æ‹© city å…è´¹ç‰ˆ"></p><p>å¤åˆ¶è·å–åˆ°çš„ä»£ç ä¸­çš„ <code>data-uid</code></p><p><img src="http://yelog-img.test.upcdn.net/447D431A-998C-4327-9463-A51D7CE91CE3.png" alt="å¤åˆ¶ data-uid"></p><h3 id="2-ä¸»é¢˜é€‰æ‹©ä½¿ç”¨æ¥å¿…åŠ›è¯„è®º"><a href="#2-ä¸»é¢˜é€‰æ‹©ä½¿ç”¨æ¥å¿…åŠ›è¯„è®º" class="headerlink" title="2. ä¸»é¢˜é€‰æ‹©ä½¿ç”¨æ¥å¿…åŠ›è¯„è®º"></a>2. ä¸»é¢˜é€‰æ‹©ä½¿ç”¨æ¥å¿…åŠ›è¯„è®º</h3><p>åœ¨ä¸»é¢˜ä¸‹ <code>_config.yml</code>  </p><p>åœ¨æ‰¾åˆ°æ¥å¿…åŠ›é…ç½®å¦‚ä¸‹ï¼Œç¬¬ä¸€æ­¥ä¸­å¤åˆ¶çš„ <code>data-uid</code> ç²˜è´´åˆ°ä¸‹é¢ <code>data_uid</code> å¤„</p><pre><code class="yaml">livere:  data_uid: xxxxxx</code></pre><p>æ‰¾åˆ°ä»¥ä¸‹ä»£ç ï¼Œ å¼€å¯å¹¶é€‰æ‹© livere (æ¥å¿…åŠ›)</p><pre><code class="yaml">##########è¯„è®ºè®¾ç½®#############comment:  on: true  type: livere</code></pre><h2 id="ä¸‰ã€utteranc"><a href="#ä¸‰ã€utteranc" class="headerlink" title="ä¸‰ã€utteranc"></a>ä¸‰ã€utteranc</h2><p>å®˜ç½‘åœ°å€ï¼š<a href="https://utteranc.es/">https://utteranc.es/</a></p><h3 id="1-å®‰è£…-utterances"><a href="#1-å®‰è£…-utterances" class="headerlink" title="1. å®‰è£… utterances"></a>1. å®‰è£… utterances</h3><p><a href="https://github.com/apps/utterances">ç‚¹æˆ‘è¿›è¡Œå®‰è£…</a></p><h3 id="2-é…ç½®ä¸»é¢˜"><a href="#2-é…ç½®ä¸»é¢˜" class="headerlink" title="2. é…ç½®ä¸»é¢˜"></a>2. é…ç½®ä¸»é¢˜</h3><p>åœ¨ä¸»é¢˜ä¸‹ <code>_config.yml</code> ä¸­æ‰¾åˆ° <code>utteranc</code> çš„é…ç½® ï¼Œä¿®æ”¹ <code>repo</code> ä¸ºè‡ªå·±çš„ä»“åº“å</p><pre><code class="yaml">utteranc:  repo: xxx/xxx.github.io # æ‰¿è½½è¯„è®ºçš„ä»“åº“ï¼Œå¡«ä¸Šè‡ªå·±çš„ä»“åº“  issue_term: pathname    # Issue ä¸ åšå®¢æ–‡ç«  ä¹‹é—´æ˜ å°„å…³ç³»  label: utteranc         # åˆ›å»ºçš„ Issue æ·»åŠ çš„æ ‡ç­¾  theme: github-light     # ä¸»é¢˜ï¼Œå¯é€‰ä¸»é¢˜è¯·æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ https://utteranc.es/#heading-theme# å®˜æ–¹æ–‡æ¡£ https://utteranc.es/# ä½¿ç”¨è¯´æ˜ https://yelog.org//2020/05/23/3-hexo-comment/</code></pre><p>åœ¨ä¸»é¢˜ä¸‹ <code>_config.yml</code> ä¸­æ‰¾åˆ°å¦‚ä¸‹é…ç½®ï¼Œå¯ç”¨è¯„è®ºï¼Œå¹¶ä½¿ç”¨ <code>utteranc</code></p><pre><code class="yaml">comment:  on: true  type: utteranc</code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;ç›®å‰ &lt;code&gt;3-hexo&lt;/code&gt; å·²ç»é›†æˆäº†è¯„è®ºç³»ç»Ÿæœ‰ &lt;code&gt;gitalk&lt;/code&gt; ã€&lt;code&gt;gitment&lt;/</summary>
      
    
    
    
    <category term="å·¥å…·" scheme="http://yelog.org/categories/%E5%B7%A5%E5%85%B7/"/>
    
    <category term="hexo" scheme="http://yelog.org/categories/%E5%B7%A5%E5%85%B7/hexo/"/>
    
    
    <category term="3-hexo" scheme="http://yelog.org/tags/3-hexo/"/>
    
  </entry>
  
  <entry>
    <title>3-hexoæ”¯æŒmermaidå›¾è¡¨</title>
    <link href="http://yelog.org/2019/11/12/3-hexo-support-mermaid/"/>
    <id>http://yelog.org/2019/11/12/3-hexo-support-mermaid/</id>
    <published>2019-11-12T01:55:37.000Z</published>
    <updated>2024-08-12T09:33:12.135Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ä¸€ã€è¯´æ˜"><a href="#ä¸€ã€è¯´æ˜" class="headerlink" title="ä¸€ã€è¯´æ˜"></a>ä¸€ã€è¯´æ˜</h2><h3 id="å¼€å¯"><a href="#å¼€å¯" class="headerlink" title="å¼€å¯"></a>å¼€å¯</h3><ol><li>å®‰è£…hexoæ’ä»¶</li></ol><pre><code class="bash">npm install hexo-filter-mermaid-diagrams</code></pre><ol start="2"><li>ä¿®æ”¹<code>themes/3-hexo/_config.yml</code> çš„ <code>mermaid.on</code>ï¼Œå¼€å¯ä¸»é¢˜æ”¯æŒ</li></ol><pre><code class="yml"># Mermaid æ”¯æŒmermaid:  on: true  cdn: //cdn.jsdelivr.net/npm/mermaid@8.4.2/dist/mermaid.min.js  #cdn: //cdnjs.cloudflare.com/ajax/libs/mermaid/8.3.1/mermaid.min.js  options: # æ›´å¤šé…ç½®ä¿¡æ¯å¯ä»¥å‚è€ƒ https://mermaidjs.github.io/#/mermaidAPI    theme: &#39;default&#39;    startOnLoad: true    flowchart:      useMaxWidth: false      htmlLabels: true</code></pre><ol start="3"><li>åœ¨markdownä¸­ï¼Œåƒå†™ä»£ç å—ä¸€æ ·å†™å›¾è¡¨<br><img src="//img.saodiyang.com/FuBTJvG5xIOIcKZPnO9UX5GCwthK.png"></li></ol><h2 id="äºŒã€ç¤ºä¾‹"><a href="#äºŒã€ç¤ºä¾‹" class="headerlink" title="äºŒã€ç¤ºä¾‹"></a>äºŒã€ç¤ºä¾‹</h2><p>ä»¥ä¸‹ç¤ºä¾‹æºç å¯ä»¥åœ¨è¿™è¾¹æŸ¥çœ‹ <a href="https://github.com/yelog/blog/blob/master/source/_posts/tools/3-hexo%E6%94%AF%E6%8C%81mermaid%E5%9B%BE%E8%A1%A8.md">æœ¬æ–‡æºç </a><br>æ›´å¤šç¤ºä¾‹å¯ä»¥æŸ¥çœ‹å®˜ç½‘ï¼š<a href="https://mermaidjs.github.io/">https://mermaidjs.github.io</a></p><h3 id="1-flowchart"><a href="#1-flowchart" class="headerlink" title="1. flowchart"></a>1. flowchart</h3><pre class="mermaid">graph TD;    A-->B;    A-->C;    B-->D;    C-->D;</pre><pre class="mermaid">graph TB    c1-->a2    subgraph one    a1-->a2    end    subgraph two    b1-->b2    end    subgraph three    c1-->c2    end</pre><h3 id="2-Sequence-diagrams"><a href="#2-Sequence-diagrams" class="headerlink" title="2.Sequence diagrams"></a>2.Sequence diagrams</h3><pre class="mermaid">sequenceDiagram    participant Alice    participant Bob    Alice->>John: Hello John, how are you?    loop Healthcheck        John->>John: Fight against hypochondria    end    Note right of John: Rational thoughts <br/>prevail!    John-->>Alice: Great!    John->>Bob: How about you?    Bob-->>John: Jolly good!</pre><h3 id="3-Class-diagrams"><a href="#3-Class-diagrams" class="headerlink" title="3.Class diagrams"></a>3.Class diagrams</h3><pre class="mermaid">classDiagram     Animal <|-- Duck     Animal <|-- Fish     Animal <|-- Zebra     Animal : +int age     Animal : +String gender     Animal: +isMammal()     Animal: +mate()     class Duck{         +String beakColor         +swim()         +quack()     }     class Fish{         -int sizeInFeet         -canEat()     }     class Zebra{         +bool is_wild         +run()     }</pre><h3 id="4-State-diagrams"><a href="#4-State-diagrams" class="headerlink" title="4.State diagrams"></a>4.State diagrams</h3><pre class="mermaid">stateDiagram       [*] --> Active       state Active {           [*] --> NumLockOff           NumLockOff --> NumLockOn : EvNumLockPressed           NumLockOn --> NumLockOff : EvNumLockPressed           --           [*] --> CapsLockOff           CapsLockOff --> CapsLockOn : EvCapsLockPressed           CapsLockOn --> CapsLockOff : EvCapsLockPressed           --           [*] --> ScrollLockOff           ScrollLockOff --> ScrollLockOn : EvCapsLockPressed           ScrollLockOn --> ScrollLockOff : EvCapsLockPressed       }</pre><h3 id="5-Gantt-diagrams"><a href="#5-Gantt-diagrams" class="headerlink" title="5.Gantt diagrams"></a>5.Gantt diagrams</h3><pre class="mermaid">gantt       dateFormat  YYYY-MM-DD       title Adding GANTT diagram functionality to mermaid       section A section       Completed task            :done,    des1, 2014-01-06,2014-01-08       Active task               :active,  des2, 2014-01-09, 3d       Future task               :         des3, after des2, 5d       Future task2              :         des4, after des3, 5d       section Critical tasks       Completed task in the critical line :crit, done, 2014-01-06,24h       Implement parser and jison          :crit, done, after des1, 2d       Create tests for parser             :crit, active, 3d       Future task in critical line        :crit, 5d       Create tests for renderer           :2d       Add to mermaid                      :1d       section Documentation       Describe gantt syntax               :active, a1, after des1, 3d       Add gantt diagram to demo page      :after a1  , 20h       Add another diagram to demo page    :doc1, after a1  , 48h       section Last section       Describe gantt syntax               :after doc1, 3d       Add gantt diagram to demo page      :20h       Add another diagram to demo page    :48h</pre><h3 id="6-Pie-chart-diagrams"><a href="#6-Pie-chart-diagrams" class="headerlink" title="6.Pie chart diagrams"></a>6.Pie chart diagrams</h3><pre class="mermaid">pie    "Dogs" : 386    "Cats" : 85    "Rats" : 15</pre>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;ä¸€ã€è¯´æ˜&quot;&gt;&lt;a href=&quot;#ä¸€ã€è¯´æ˜&quot; class=&quot;headerlink&quot; title=&quot;ä¸€ã€è¯´æ˜&quot;&gt;&lt;/a&gt;ä¸€ã€è¯´æ˜&lt;/h2&gt;&lt;h3 id=&quot;å¼€å¯&quot;&gt;&lt;a href=&quot;#å¼€å¯&quot; class=&quot;headerlink&quot; title=&quot;å¼€å¯&quot;&gt;&lt;/a&gt;å¼€å¯&lt;/h</summary>
      
    
    
    
    <category term="å·¥å…·" scheme="http://yelog.org/categories/%E5%B7%A5%E5%85%B7/"/>
    
    <category term="hexo" scheme="http://yelog.org/categories/%E5%B7%A5%E5%85%B7/hexo/"/>
    
    
    <category term="3-hexo" scheme="http://yelog.org/tags/3-hexo/"/>
    
    <category term="hexo" scheme="http://yelog.org/tags/hexo/"/>
    
  </entry>
  
</feed>
